import{c as Xe,r as t,j as e,H as Ze,b as A,t as n}from"./app-qt2VCSHW.js";import{A as Ke}from"./app-layout-BCZxZifr.js";import{c as Qe,B as i}from"./button-DFXYzV2Z.js";import{C as o,a as d,b as x,c as j,d as se}from"./card-DWiMLnI2.js";import{B as h,F as M}from"./Combination-CoqYx7MN.js";import{A as We,G as R,F as xe,D as w,a as S,b as D,c as E,d as k,T as re,e as F,t as Ye,p as es}from"./app-sidebar-layout-G6-wDKKL.js";import{I as $}from"./input-CfE4Xz_e.js";import{L as m}from"./label-Bpt8UETt.js";import{S as me,a as he,b as je,c as pe,d as p,C as ss}from"./select-Dx62Pp_e.js";import{C as X}from"./circle-check-big-D6l2AZf0.js";import{C as ae}from"./circle-alert-BfA0k-TX.js";import{R as ue}from"./rotate-ccw-CKlI_VzW.js";import{T as ve}from"./trash-2-Cbg74AW7.js";import{F as Z}from"./folder-BdePZ2wi.js";import{U as P}from"./upload-ECErDzyH.js";import{D as ie}from"./users-DgarvUGi.js";import{P as ge}from"./plus-Duwb9YvA.js";import{F as le}from"./file-spreadsheet-BC7_ypNb.js";import{S as rs}from"./square-pen-DaHUNztC.js";import{F as as}from"./folder-open-BYmbCUb5.js";/* empty css            */import"./index-BZgYwWWx.js";import"./index-VNIC8-9Y.js";import"./index-DnmBUpJw.js";import"./x-BxMqO2Dk.js";import"./app-logo-icon-B2qWlKKR.js";import"./user-DeQjT80T.js";import"./mail-DfyVAEco.js";import"./triangle-alert-B9FT7Ibe.js";import"./search-DaadPwJz.js";import"./BrandingProvider-kslcjmn_.js";import"./index-DAU4uJyH.js";import"./check-BtaW2LyL.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1",key:"1oajmo"}],["path",{d:"M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1",key:"mpwhp6"}]],ls=Qe("FileJson",is),Ne=({node:r,onEdit:T,onDelete:b,onAddChild:u})=>{const[f,I]=t.useState(!0),v=r.hijos&&r.hijos.length>0,K=g=>{switch(g){case"fondo":return e.jsx(as,{className:"h-4 w-4 text-blue-600"});case"seccion":return e.jsx(Z,{className:"h-4 w-4 text-green-600"});case"subseccion":return e.jsx(Z,{className:"h-4 w-4 text-yellow-600"});case"serie":return e.jsx(M,{className:"h-4 w-4 text-purple-600"});case"subserie":return e.jsx(M,{className:"h-4 w-4 text-pink-600"});default:return e.jsx(M,{className:"h-4 w-4 text-gray-600"})}},V=g=>({fondo:"bg-blue-100 text-blue-800",seccion:"bg-green-100 text-green-800",subseccion:"bg-yellow-100 text-yellow-800",serie:"bg-purple-100 text-purple-800",subserie:"bg-pink-100 text-pink-800"})[g]||"bg-gray-100 text-gray-800";return e.jsxs("div",{className:"ml-4",children:[e.jsxs("div",{className:"flex items-center gap-2 py-2 group hover:bg-gray-50 rounded-md px-2",children:[e.jsx("button",{onClick:()=>I(!f),className:"p-0.5 hover:bg-gray-200 rounded",disabled:!v,children:v?f?e.jsx(ss,{className:"h-4 w-4"}):e.jsx(es,{className:"h-4 w-4"}):e.jsx("div",{className:"w-4 h-4"})}),K(r.tipo_nivel),e.jsxs("div",{className:"flex-1 flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-sm",children:r.nombre}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",r.codigo,")"]}),e.jsx(h,{variant:"outline",className:`text-xs ${V(r.tipo_nivel)}`,children:r.tipo_nivel}),!r.activo&&e.jsx(h,{variant:"outline",className:"text-xs bg-red-100 text-red-800",children:"Inactivo"})]}),e.jsxs("div",{className:"hidden group-hover:flex items-center gap-1",children:[e.jsx(i,{size:"sm",variant:"ghost",onClick:()=>u(r),className:"h-7 w-7 p-0",children:e.jsx(ge,{className:"h-3 w-3"})}),e.jsx(i,{size:"sm",variant:"ghost",onClick:()=>T(r),className:"h-7 w-7 p-0",children:e.jsx(rs,{className:"h-3 w-3"})}),e.jsx(i,{size:"sm",variant:"ghost",onClick:()=>b(r),className:"h-7 w-7 p-0 hover:bg-red-100 hover:text-red-600",children:e.jsx(ve,{className:"h-3 w-3"})})]})]}),f&&v&&e.jsx("div",{className:"border-l-2 border-gray-200 ml-2",children:r.hijos.map(g=>e.jsx(Ne,{node:g,onEdit:T,onDelete:b,onAddChild:u},g.id))})]})};function Rs({ccd:r,estructura:T,estadisticas:b,errores_validacion:u,trds_relacionadas:f=[],series_relacionadas:I=[]}){const v=Xe({only:["ccd","estructura","estadisticas","errores_validacion","trds_relacionadas","series_relacionadas"]}),[K,V]=t.useState(!1),[g,z]=t.useState(!1),[be,O]=t.useState(!1),[fe,q]=t.useState(!1),[ye,B]=t.useState(!1),[Ce,ne]=t.useState(!1),[te,ce]=t.useState(!1),[_,L]=t.useState(null),[we,Q]=t.useState(!1),[W,Se]=t.useState(null),[Y,De]=t.useState(null),[Ee,H]=t.useState(!1),[ke,J]=t.useState(!1),[N,U]=t.useState(null),[l,c]=t.useState({codigo:"",nombre:"",descripcion:"",tipo_nivel:"fondo",orden:0,activo:!0}),[y,G]=t.useState({version:"",cambios:""}),Fe=[{title:"Dashboard",href:"/admin"},{title:"CCD",href:"/admin/ccd"},{title:r.nombre,href:`/admin/ccd/${r.id}`}],oe=s=>({borrador:"bg-gray-100 text-gray-800",activo:"bg-green-100 text-green-800",inactivo:"bg-red-100 text-red-800",archivado:"bg-yellow-100 text-yellow-800"})[s]||"bg-gray-100 text-gray-800",de=(s=null)=>{Se(s),c({codigo:"",nombre:"",descripcion:"",tipo_nivel:s?"seccion":"fondo",orden:0,activo:!0}),V(!0)},Ve=s=>{De(s),c({codigo:s.codigo,nombre:s.nombre,descripcion:s.descripcion||"",tipo_nivel:s.tipo_nivel,orden:s.orden,activo:s.activo}),z(!0)},_e=s=>{if(s.hijos&&s.hijos.length>0){n.error("No se puede eliminar un nivel que tiene hijos");return}v.destroy(`/admin/ccd/nivel/${s.id}`,{confirmMessage:`¿Está seguro de eliminar el nivel "${s.nombre}"?`,successMessage:"Nivel eliminado exitosamente",errorMessage:"Error al eliminar el nivel"})},Ae=()=>{v.create(`/admin/ccd/${r.id}/nivel`,{...l,parent_id:W?.id||null},{successMessage:"Nivel agregado exitosamente",errorMessage:"Error al agregar nivel",onSuccess:()=>{V(!1),c({codigo:"",nombre:"",descripcion:"",tipo_nivel:"fondo",orden:0,activo:!0})}})},$e=()=>{Y&&v.update(`/admin/ccd/nivel/${Y.id}`,l,{successMessage:"Nivel actualizado exitosamente",errorMessage:"Error al actualizar nivel",onSuccess:()=>{z(!1)}})},Me=()=>{if(u.length>0){n.error("No se puede aprobar: "+u.join(", "));return}v.create(`/admin/ccd/${r.id}/aprobar`,{},{successMessage:"CCD aprobado exitosamente",errorMessage:"Error al aprobar el CCD"})},Te=async s=>{ne(!0);try{const a=`/admin/ccd/${r.id}/exportar?formato=${s}`,C=document.createElement("a");C.href=a,C.download=`CCD_${r.codigo}_v${r.version}.${s==="excel"?"xlsx":s}`,document.body.appendChild(C),C.click(),document.body.removeChild(C),n.success(`Exportación en formato ${s.toUpperCase()} iniciada`),O(!1)}catch(a){console.error("Error al exportar:",a),n.error("Error al exportar el CCD")}finally{ne(!1)}},Ie=()=>{if(!_){n.error("Por favor seleccione un archivo Excel");return}const s=new FormData;s.append("file",_),ce(!0),A.post(route("admin.ccd.importar-excel",r.id),s,{onSuccess:()=>{n.success("Archivo importado exitosamente"),B(!1),L(null),A.reload({only:["estructura","estadisticas"]})},onError:a=>{console.error("Errores de importación:",a),n.error(a.file||"Error al importar el archivo")},onFinish:()=>{ce(!1)}})},ze=s=>{const a=s.target.files?.[0];if(a){if(!a.name.match(/\.(xlsx|xls|csv)$/)){n.error("Por favor seleccione un archivo Excel (.xlsx, .xls o .csv)");return}L(a)}},ee=s=>{s.preventDefault(),s.stopPropagation(),s.type==="dragenter"||s.type==="dragover"?Q(!0):s.type==="dragleave"&&Q(!1)},Le=s=>{s.preventDefault(),s.stopPropagation(),Q(!1);const a=s.dataTransfer.files?.[0];if(a){if(!a.name.match(/\.(xlsx|xls|csv)$/)){n.error("Por favor seleccione un archivo Excel (.xlsx, .xls o .csv)");return}L(a)}},Re=()=>{window.location.href=route("admin.ccd.plantilla-excel"),n.success("Descargando plantilla Excel...")},Pe=[{id:"json",name:"JSON",description:"Formato de datos estructurado, ideal para integración con otros sistemas",icon:ls,color:"text-yellow-600 bg-yellow-50"},{id:"csv",name:"CSV",description:"Valores separados por comas, compatible con Excel y hojas de cálculo",icon:M,color:"text-green-600 bg-green-50"},{id:"excel",name:"Excel (XLSX)",description:"Hoja de cálculo con formato y colores por tipo de nivel",icon:le,color:"text-emerald-600 bg-emerald-50"},{id:"pdf",name:"PDF",description:"Documento portable para impresión y archivo",icon:Ye,color:"text-red-600 bg-red-50"}],Oe=()=>{const a=(r.version||"1.0").split("."),C=parseInt(a[1]||"0")+1,Ge=`${a[0]}.${C}`;G({version:Ge,cambios:""}),q(!0)},qe=()=>{if(!y.version.trim()){n.error("La versión es requerida");return}if(!y.cambios.trim()){n.error("Debe describir los cambios realizados");return}A.post(`/admin/ccd/${r.id}/version`,y,{onSuccess:()=>{n.success("Nueva versión creada exitosamente. El CCD requiere nueva aprobación."),q(!1),G({version:"",cambios:""})},onError:s=>{console.error("Errores:",s),n.error("Error al crear la nueva versión")}})},Be=(s,a)=>{U({id:s,version:a}),H(!0)},He=()=>{N&&A.delete(`/admin/ccd/version/${N.id}`,{preserveScroll:!0,onSuccess:()=>{n.success(`Versión ${N.version} eliminada exitosamente`),H(!1),U(null)},onError:()=>{n.error("Error al eliminar la versión")}})},Je=(s,a)=>{U({id:s,version:a}),J(!0)},Ue=()=>{N&&A.post(`/admin/ccd/${r.id}/revertir/${N.id}`,{},{preserveScroll:!0,onSuccess:()=>{n.success(`CCD revertido a versión ${N.version}`),J(!1),U(null)},onError:()=>{n.error("Error al revertir la versión")}})};return e.jsxs(Ke,{breadcrumbs:Fe,children:[e.jsx(Ze,{title:`CCD - ${r.nombre}`}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(i,{variant:"outline",onClick:()=>A.visit("/admin/ccd"),children:[e.jsx(We,{className:"h-4 w-4 mr-2"}),"Volver"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:r.nombre}),e.jsxs("p",{className:"text-sm text-gray-500",children:[r.codigo," • Versión ",r.version]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{className:oe(r.estado),children:r.estado}),r.vigente&&e.jsxs(h,{className:"bg-green-100 text-green-800",children:[e.jsx(X,{className:"h-3 w-3 mr-1"}),"Vigente"]})]})]}),u.length>0&&e.jsxs(o,{className:"border-red-200 bg-red-50",children:[e.jsx(d,{children:e.jsxs(x,{className:"text-red-800 flex items-center gap-2",children:[e.jsx(ae,{className:"h-5 w-5"}),"Errores de Validación"]})}),e.jsx(j,{children:e.jsx("ul",{className:"list-disc list-inside space-y-1",children:u.map((s,a)=>e.jsx("li",{className:"text-sm text-red-700",children:s},a))})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(o,{children:[e.jsx(d,{className:"pb-2",children:e.jsx(x,{className:"text-sm font-medium text-gray-600",children:"Total Niveles"})}),e.jsx(j,{children:e.jsx("div",{className:"text-2xl font-bold text-[#2a3d83]",children:b.total_niveles})})]}),e.jsxs(o,{children:[e.jsx(d,{className:"pb-2",children:e.jsx(x,{className:"text-sm font-medium text-gray-600",children:"Niveles Activos"})}),e.jsx(j,{children:e.jsx("div",{className:"text-2xl font-bold text-green-600",children:b.niveles_activos})})]}),e.jsxs(o,{children:[e.jsx(d,{className:"pb-2",children:e.jsx(x,{className:"text-sm font-medium text-gray-600",children:"Profundidad Máxima"})}),e.jsx(j,{children:e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:b.profundidad_maxima})})]}),e.jsxs(o,{children:[e.jsx(d,{className:"pb-2",children:e.jsx(x,{className:"text-sm font-medium text-gray-600",children:"Vocabularios"})}),e.jsx(j,{children:e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:b.total_vocabularios})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(o,{className:r.estado==="borrador"?"border-orange-300 bg-orange-50":"border-green-300 bg-green-50",children:[e.jsx(d,{children:e.jsx(x,{className:"flex items-center gap-2",children:r.estado==="borrador"?e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"h-5 w-5 text-orange-600"}),e.jsx("span",{className:"text-orange-800",children:"Versión en Borrador"})]}):e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"h-5 w-5 text-green-600"}),e.jsx("span",{className:"text-green-800",children:"Versión Aprobada"})]})})}),e.jsx(j,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Versión:"}),e.jsxs(h,{className:"bg-purple-100 text-purple-800 text-lg px-3",children:["v",r.version]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Estado:"}),e.jsx(h,{className:oe(r.estado),children:r.estado==="borrador"?"Pendiente de Aprobación":r.estado})]}),r.fecha_aprobacion&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Fecha Aprobación:"}),e.jsx("span",{className:"text-sm",children:new Date(r.fecha_aprobacion).toLocaleDateString("es-ES")})]}),r.aprobador&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Aprobado por:"}),e.jsx("span",{className:"text-sm",children:r.aprobador.name})]}),r.estado==="borrador"&&e.jsx("div",{className:"mt-4 p-3 bg-orange-100 rounded-lg",children:e.jsxs("p",{className:"text-sm text-orange-800",children:[e.jsx("strong",{children:"⚠️ Esta versión requiere aprobación."})," Una vez aprobada, estará disponible para su uso en el sistema."]})})]})})]}),e.jsxs(o,{children:[e.jsx(d,{children:e.jsxs(x,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5 text-[#2a3d83]"}),"Historial de Versiones"]})}),e.jsx(j,{children:r.versiones&&r.versiones.length>0?e.jsx("div",{className:"space-y-3 max-h-80 overflow-y-auto",children:r.versiones.map((s,a)=>e.jsxs("div",{className:`flex items-start gap-3 p-3 rounded-lg ${s.version_nueva===r.version?"bg-orange-50 border border-orange-200":"bg-gray-50"}`,children:[e.jsx("div",{className:`flex-shrink-0 w-8 h-8 text-white rounded-full flex items-center justify-center text-xs font-bold ${s.version_nueva===r.version?"bg-orange-500":"bg-[#2a3d83]"}`,children:a+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(h,{variant:"outline",className:"text-xs",children:["v",s.version_anterior," → v",s.version_nueva]}),s.version_nueva===r.version&&e.jsx(h,{className:"bg-orange-100 text-orange-800 text-xs",children:"Actual"}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(s.created_at).toLocaleDateString("es-ES")})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(i,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 text-blue-600 hover:text-blue-800 hover:bg-blue-50",onClick:()=>Je(s.id,s.version_anterior),title:`Revertir a v${s.version_anterior}`,children:e.jsx(ue,{className:"h-3.5 w-3.5"})}),e.jsx(i,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 text-red-600 hover:text-red-800 hover:bg-red-50",onClick:()=>Be(s.id,s.version_nueva),title:"Eliminar versión",children:e.jsx(ve,{className:"h-3.5 w-3.5"})})]})]}),e.jsx("p",{className:"text-sm text-gray-700 mt-1",children:s.cambios}),s.modificador&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Por: ",s.modificador.name]})]})]},s.id))}):e.jsxs("div",{className:"text-center py-6 text-gray-500",children:[e.jsx(R,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No hay historial de versiones"}),e.jsx("p",{className:"text-xs",children:"Esta es la versión inicial del CCD"})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(o,{children:[e.jsx(d,{className:"flex flex-row items-center justify-between",children:e.jsxs("div",{children:[e.jsxs(x,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5 text-[#2a3d83]"}),"TRDs Relacionadas"]}),e.jsxs(se,{children:["Tablas de Retención vinculadas a este CCD (",f.length,")"]})]})}),e.jsx(j,{children:f.length>0?e.jsx("div",{className:"space-y-2",children:f.map(s=>e.jsxs("a",{href:`/admin/trd/${s.id}`,className:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50 hover:border-[#2a3d83] transition-all",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.nombre}),e.jsxs("div",{className:"text-sm text-gray-500",children:[s.codigo," • v",s.version]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(h,{variant:"secondary",className:"text-xs",children:[s.series_count," series"]}),e.jsx(h,{className:s.estado==="vigente"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800",children:s.estado})]})]},s.id))}):e.jsxs("div",{className:"text-center py-6 text-gray-500",children:[e.jsx(M,{className:"h-8 w-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"No hay TRDs relacionadas"}),e.jsx("a",{href:"/admin/trd",className:"text-[#2a3d83] text-sm hover:underline mt-1 inline-block",children:"Ver todas las TRDs"})]})})]}),e.jsxs(o,{children:[e.jsx(d,{className:"flex flex-row items-center justify-between",children:e.jsxs("div",{children:[e.jsxs(x,{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-5 w-5 text-purple-600"}),"Series Relacionadas"]}),e.jsxs(se,{children:["Series documentales vinculadas a este CCD (",I.length,")"]})]})}),e.jsx(j,{children:I.length>0?e.jsx("div",{className:"space-y-2 max-h-80 overflow-y-auto",children:I.map(s=>e.jsxs("a",{href:`/admin/series/${s.id}`,className:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50 hover:border-purple-300 transition-all",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.nombre}),e.jsxs("div",{className:"text-sm text-gray-500",children:[s.codigo," • ",s.trd_nombre]})]}),e.jsxs(h,{variant:"secondary",className:"text-xs",children:[s.subseries_count," subseries"]})]},s.id))}):e.jsxs("div",{className:"text-center py-6 text-gray-500",children:[e.jsx(Z,{className:"h-8 w-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"No hay series relacionadas"}),e.jsx("a",{href:"/admin/series",className:"text-purple-600 text-sm hover:underline mt-1 inline-block",children:"Ver todas las series"})]})})]})]}),e.jsx(o,{children:e.jsx(d,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(x,{children:"Acciones"}),e.jsxs("div",{className:"flex items-center gap-2",children:[r.estado==="borrador"&&u.length===0&&e.jsxs(i,{onClick:Me,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),r.versiones&&r.versiones.length>0?"Aprobar Versión":"Aprobar CCD"]}),e.jsxs(i,{variant:"outline",onClick:()=>B(!0),children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Importar Excel"]}),e.jsxs(i,{variant:"outline",onClick:()=>O(!0),children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Exportar"]}),e.jsxs(i,{variant:"outline",onClick:Oe,children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Nueva Versión"]})]})]})})}),e.jsxs(o,{children:[e.jsx(d,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(x,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-5 w-5"}),"Estructura Jerárquica"]}),e.jsx(se,{children:"Gestione la estructura del cuadro de clasificación documental"})]}),e.jsxs(i,{onClick:()=>de(null),className:"bg-[#2a3d83] hover:bg-[#1e2b5f]",children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"Agregar Nivel Raíz"]})]})}),e.jsx(j,{children:T.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(xe,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No hay niveles configurados aún"}),e.jsx("p",{className:"text-sm",children:"Comience agregando un nivel raíz (Fondo)"})]}):e.jsx("div",{className:"space-y-1",children:T.map(s=>e.jsx(Ne,{node:s,onEdit:Ve,onDelete:_e,onAddChild:de},s.id))})})]}),e.jsx(w,{open:K,onOpenChange:V,children:e.jsxs(S,{children:[e.jsxs(D,{children:[e.jsx(E,{children:"Agregar Nuevo Nivel"}),e.jsx(k,{children:W?`Agregar nivel hijo a: ${W.nombre}`:"Agregar nivel raíz al CCD"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Código*"}),e.jsx($,{value:l.codigo,onChange:s=>c({...l,codigo:s.target.value}),placeholder:"Ej: FOND-01"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Tipo*"}),e.jsxs(me,{value:l.tipo_nivel,onValueChange:s=>c({...l,tipo_nivel:s}),children:[e.jsx(he,{children:e.jsx(je,{})}),e.jsxs(pe,{children:[e.jsx(p,{value:"fondo",children:"Fondo"}),e.jsx(p,{value:"seccion",children:"Sección"}),e.jsx(p,{value:"subseccion",children:"Subsección"}),e.jsx(p,{value:"serie",children:"Serie"}),e.jsx(p,{value:"subserie",children:"Subserie"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Nombre*"}),e.jsx($,{value:l.nombre,onChange:s=>c({...l,nombre:s.target.value}),placeholder:"Nombre del nivel"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Descripción"}),e.jsx(re,{value:l.descripcion,onChange:s=>c({...l,descripcion:s.target.value}),placeholder:"Descripción opcional",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Orden"}),e.jsx($,{type:"number",value:l.orden,onChange:s=>c({...l,orden:parseInt(s.target.value)||0})})]})]}),e.jsxs(F,{children:[e.jsx(i,{variant:"outline",onClick:()=>V(!1),children:"Cancelar"}),e.jsx(i,{onClick:Ae,className:"bg-[#2a3d83] hover:bg-[#1e2b5f]",children:"Agregar Nivel"})]})]})}),e.jsx(w,{open:g,onOpenChange:z,children:e.jsxs(S,{children:[e.jsxs(D,{children:[e.jsx(E,{children:"Editar Nivel"}),e.jsxs(k,{children:["Modificar información del nivel ",Y?.nombre]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Código*"}),e.jsx($,{value:l.codigo,onChange:s=>c({...l,codigo:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Tipo*"}),e.jsxs(me,{value:l.tipo_nivel,onValueChange:s=>c({...l,tipo_nivel:s}),children:[e.jsx(he,{children:e.jsx(je,{})}),e.jsxs(pe,{children:[e.jsx(p,{value:"fondo",children:"Fondo"}),e.jsx(p,{value:"seccion",children:"Sección"}),e.jsx(p,{value:"subseccion",children:"Subsección"}),e.jsx(p,{value:"serie",children:"Serie"}),e.jsx(p,{value:"subserie",children:"Subserie"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Nombre*"}),e.jsx($,{value:l.nombre,onChange:s=>c({...l,nombre:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Descripción"}),e.jsx(re,{value:l.descripcion,onChange:s=>c({...l,descripcion:s.target.value}),rows:3})]})]}),e.jsxs(F,{children:[e.jsx(i,{variant:"outline",onClick:()=>z(!1),children:"Cancelar"}),e.jsx(i,{onClick:$e,className:"bg-[#2a3d83] hover:bg-[#1e2b5f]",children:"Actualizar Nivel"})]})]})}),e.jsx(w,{open:be,onOpenChange:O,children:e.jsxs(S,{className:"sm:max-w-md",children:[e.jsxs(D,{children:[e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-5 w-5 text-[#2a3d83]"}),"Exportar CCD"]}),e.jsx(k,{children:"Seleccione el formato en el que desea exportar el Cuadro de Clasificación Documental"})]}),e.jsx("div",{className:"grid gap-3 py-4",children:Pe.map(s=>{const a=s.icon;return e.jsxs("button",{onClick:()=>Te(s.id),disabled:Ce,className:"flex items-start gap-4 p-4 border rounded-lg hover:border-[#2a3d83] hover:bg-gray-50 transition-all text-left disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("div",{className:`p-2 rounded-lg ${s.color}`,children:e.jsx(a,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.name}),e.jsx("div",{className:"text-sm text-gray-500",children:s.description})]})]},s.id)})}),e.jsx(F,{children:e.jsx(i,{variant:"outline",onClick:()=>O(!1),children:"Cancelar"})})]})}),e.jsx(w,{open:ye,onOpenChange:B,children:e.jsxs(S,{className:"sm:max-w-lg",children:[e.jsxs(D,{children:[e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-5 w-5 text-[#2a3d83]"}),"Importar Series desde Excel"]}),e.jsx(k,{children:"Cargue un archivo Excel con la estructura de series y subseries documentales"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${we?"border-[#2a3d83] bg-blue-50":"border-gray-300 hover:border-gray-400"}`,onDragEnter:ee,onDragLeave:ee,onDragOver:ee,onDrop:Le,children:[e.jsx(le,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),_?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm font-medium text-green-600",children:[e.jsx(X,{className:"h-4 w-4"}),"Archivo seleccionado"]}),e.jsx("div",{className:"text-sm text-gray-600",children:_.name}),e.jsxs("div",{className:"text-xs text-gray-500",children:[(_.size/1024/1024).toFixed(2)," MB"]}),e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>L(null),className:"text-red-600 hover:text-red-700",children:"Eliminar"})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Arrastre y suelte su archivo Excel aquí"}),e.jsx("p",{className:"text-xs text-gray-500",children:"o"}),e.jsxs("label",{className:"cursor-pointer",children:[e.jsxs("span",{className:"inline-flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50",children:[e.jsx(P,{className:"h-4 w-4"}),"Seleccionar archivo"]}),e.jsx("input",{type:"file",className:"hidden",accept:".xlsx,.xls,.csv",onChange:ze})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Formatos aceptados: .xlsx, .xls, .csv (Máx. 10MB)"})]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(le,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-1",children:"¿No tiene una plantilla?"}),e.jsx("p",{className:"text-sm text-blue-700 mb-3",children:"Descargue nuestra plantilla Excel con el formato correcto y ejemplos"}),e.jsxs(i,{variant:"outline",size:"sm",onClick:Re,className:"border-blue-300 text-blue-700 hover:bg-blue-100",children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Descargar Plantilla"]})]})]})}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-2",children:[e.jsx("p",{className:"font-medium",children:"Instrucciones:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-xs",children:[e.jsx("li",{children:"El archivo debe tener las columnas: codigo_serie, nombre_serie, codigo_subserie, nombre_subserie"}),e.jsx("li",{children:"Campos opcionales: descripcion, tipo_documental, soporte, retencion_ag, retencion_ac, disposicion_final"}),e.jsx("li",{children:"Las series se crean automáticamente si no existen"}),e.jsx("li",{children:"Las subseries se asocian a su serie correspondiente"})]})]})]}),e.jsxs(F,{children:[e.jsx(i,{variant:"outline",onClick:()=>{B(!1),L(null)},children:"Cancelar"}),e.jsx(i,{onClick:Ie,disabled:!_||te,className:"bg-[#2a3d83] hover:bg-[#1e2b5f]",children:te?e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"h-4 w-4 mr-2 animate-pulse"}),"Importando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Importar"]})})]})]})}),e.jsx(w,{open:fe,onOpenChange:q,children:e.jsxs(S,{className:"sm:max-w-md",children:[e.jsxs(D,{children:[e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5 text-[#2a3d83]"}),"Crear Nueva Versión"]}),e.jsxs(k,{children:['Cree una nueva versión del CCD "',r.nombre,'". La versión actual es ',r.version,"."]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"version",children:"Nueva Versión *"}),e.jsx($,{id:"version",value:y.version,onChange:s=>G({...y,version:s.target.value}),placeholder:"Ej: 2.0, 1.1, etc."}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Versión actual: ",r.version]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"cambios",children:"Descripción de Cambios *"}),e.jsx(re,{id:"cambios",value:y.cambios,onChange:s=>G({...y,cambios:s.target.value}),placeholder:"Describa los cambios realizados en esta versión...",rows:4})]})]}),e.jsxs(F,{children:[e.jsx(i,{variant:"outline",onClick:()=>q(!1),children:"Cancelar"}),e.jsxs(i,{onClick:qe,className:"bg-[#2a3d83] hover:bg-[#1e2b5f]",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Crear Versión"]})]})]})}),e.jsx(w,{open:Ee,onOpenChange:H,children:e.jsxs(S,{children:[e.jsxs(D,{children:[e.jsxs(E,{className:"flex items-center gap-2 text-red-600",children:[e.jsx(ae,{className:"h-5 w-5"}),"Eliminar Versión"]}),e.jsxs(k,{children:["¿Está seguro de eliminar la versión ",e.jsx("strong",{children:N?.version}),"?",e.jsx("br",{}),e.jsx("br",{}),"Esta acción no se puede deshacer. Si es la versión actual, el CCD volverá al estado de la versión anterior."]})]}),e.jsxs(F,{children:[e.jsx(i,{variant:"outline",onClick:()=>H(!1),children:"Cancelar"}),e.jsx(i,{onClick:He,variant:"destructive",children:"Sí, eliminar versión"})]})]})}),e.jsx(w,{open:ke,onOpenChange:J,children:e.jsxs(S,{children:[e.jsxs(D,{children:[e.jsxs(E,{className:"flex items-center gap-2 text-blue-600",children:[e.jsx(ue,{className:"h-5 w-5"}),"Revertir a Versión Anterior"]}),e.jsxs(k,{children:["¿Está seguro de revertir a la versión ",e.jsx("strong",{children:N?.version}),"?",e.jsx("br",{}),e.jsx("br",{}),"Se creará un nuevo registro de versión. El CCD volverá a estado ",e.jsx("strong",{children:"borrador"})," y requerirá nueva aprobación."]})]}),e.jsxs(F,{children:[e.jsx(i,{variant:"outline",onClick:()=>J(!1),children:"Cancelar"}),e.jsx(i,{onClick:Ue,className:"bg-blue-600 hover:bg-blue-700",children:"Sí, revertir versión"})]})]})})]})]})}export{Rs as default};
