import{r as C,u as O,j as e,H as V,L as _}from"./app-B0qTBAke.js";import{A as k,T as H,a as A,v as D,Z as P}from"./app-sidebar-layout-DFKjANJB.js";import{B as y}from"./app-logo-icon-BPz3oRny.js";import{C as m,a as u,b as j,c as f,d as b}from"./card-D4UBhCKF.js";import{L as d,I as q}from"./label-CjHZv5e4.js";import{S as R,a as J,b as $,c as U,d as X}from"./select-bkkBUc_4.js";import{C as G}from"./checkbox-vAynjuAI.js";import{A as c,a as n}from"./alert-D_YNC9Mv.js";import{T as Z,a as K,b as v,c as g}from"./tabs-CT2fp8nO.js";import{B as F}from"./badge-BfEjTxB-.js";import{A as Q}from"./arrow-left-DojSOgLu.js";import{I as N}from"./info-LDuxxin2.js";import{U as T}from"./upload-CrgsxyHP.js";import{C as W}from"./circle-check-big-CLyWiRXH.js";import{P as Y}from"./plus-ElTEKlBd.js";/* empty css            */import"./index-DDzTzhRc.js";import"./index-D-todNvr.js";import"./index-C5MwE6sO.js";import"./check-dE-FsShf.js";const ee={expedientes:"📁",documentos:"📄",series:"📚",subseries:"📖",usuarios:"👥",trd:"📋",certificados:"🔐",mixto:"🔄"},se={csv:{icon:"📊",descripcion:"Archivos separados por comas",ejemplos:["datos.csv","expedientes.csv"],tamanoMax:"10 MB"},excel:{icon:"📈",descripcion:"Hojas de cálculo Excel",ejemplos:["datos.xlsx","documentos.xls"],tamanoMax:"20 MB"},json:{icon:"⚙️",descripcion:"Archivos de intercambio JSON",ejemplos:["datos.json","usuarios.json"],tamanoMax:"15 MB"},xml:{icon:"🏷️",descripcion:"Documentos XML estructurados",ejemplos:["datos.xml","series.xml"],tamanoMax:"15 MB"}},ae={expedientes:[{campo:"codigo",nombre:"Código",requerido:!0},{campo:"nombre",nombre:"Nombre",requerido:!0},{campo:"descripcion",nombre:"Descripción",requerido:!1},{campo:"fecha_inicio",nombre:"Fecha Inicio",requerido:!1},{campo:"fecha_fin",nombre:"Fecha Fin",requerido:!1},{campo:"estado",nombre:"Estado",requerido:!1},{campo:"nivel_acceso",nombre:"Nivel de Acceso",requerido:!1}],documentos:[{campo:"nombre",nombre:"Nombre",requerido:!0},{campo:"descripcion",nombre:"Descripción",requerido:!1},{campo:"ruta_archivo",nombre:"Ruta del Archivo",requerido:!1},{campo:"tipo_archivo",nombre:"Tipo de Archivo",requerido:!1},{campo:"tamaño_archivo",nombre:"Tamaño",requerido:!1}],series:[{campo:"codigo",nombre:"Código",requerido:!0},{campo:"nombre",nombre:"Nombre",requerido:!0},{campo:"descripcion",nombre:"Descripción",requerido:!1},{campo:"tiempo_archivo_central",nombre:"Tiempo Archivo Central",requerido:!1},{campo:"tiempo_archivo_gestion",nombre:"Tiempo Archivo Gestión",requerido:!1},{campo:"disposicion_final",nombre:"Disposición Final",requerido:!1}],usuarios:[{campo:"name",nombre:"Nombre",requerido:!0},{campo:"email",nombre:"Email",requerido:!0},{campo:"password",nombre:"Contraseña",requerido:!1}],certificados:[{campo:"nombre_certificado",nombre:"Nombre",requerido:!0},{campo:"numero_serie",nombre:"Número de Serie",requerido:!0},{campo:"fecha_vencimiento",nombre:"Fecha Vencimiento",requerido:!1},{campo:"tipo_certificado",nombre:"Tipo",requerido:!1}]};function we({tipos:p,formatosPermitidos:M}){const[i,I]=C.useState(null),[re,ie]=C.useState(null),[l,w]=C.useState({mapeo:{},actualizar_existentes:!1,validaciones_personalizadas:[]}),{data:r,setData:x,post:B,processing:S,errors:o}=O({nombre:"",descripcion:"",tipo:"",archivo:null,configuracion:l}),z=s=>{const a=s.target.files?.[0];a&&(I(a),x("archivo",a))},E=s=>{s.preventDefault();const a=new FormData;a.append("nombre",r.nombre),a.append("descripcion",r.descripcion),a.append("tipo",r.tipo),r.archivo&&a.append("archivo",r.archivo),a.append("configuracion",JSON.stringify(l)),B("/admin/importaciones",{data:a,forceFormData:!0})},L=(s,a)=>{w(t=>({...t,mapeo:{...t.mapeo,[s]:a}}))},h=r.tipo?ae[r.tipo]||[]:[];return e.jsxs(k,{children:[e.jsx(V,{title:"Nueva Importación"}),e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(y,{variant:"outline",asChild:!0,children:e.jsxs(_,{href:"/admin/importaciones",children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Volver"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Nueva Importación"}),e.jsx("p",{className:"text-muted-foreground",children:"Configura una nueva importación de datos al sistema"})]})]}),e.jsxs("form",{onSubmit:E,className:"space-y-6",children:[e.jsxs(Z,{defaultValue:"basicos",className:"space-y-6",children:[e.jsxs(K,{className:"grid w-full grid-cols-4",children:[e.jsx(v,{value:"basicos",children:"Datos Básicos"}),e.jsx(v,{value:"archivo",disabled:!r.nombre||!r.tipo,children:"Archivo"}),e.jsx(v,{value:"mapeo",disabled:!i,children:"Mapeo"}),e.jsx(v,{value:"configuracion",disabled:!i,children:"Configuración"})]}),e.jsx(g,{value:"basicos",children:e.jsxs(m,{children:[e.jsxs(u,{children:[e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(N,{className:"h-5 w-5"}),"Información Básica"]}),e.jsx(f,{children:"Define la información general de la importación"})]}),e.jsxs(b,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"nombre",children:"Nombre de la Importación *"}),e.jsx(q,{id:"nombre",value:r.nombre,onChange:s=>x("nombre",s.target.value),placeholder:"Ej: Importación expedientes 2024",className:o.nombre?"border-red-500":""}),o.nombre&&e.jsx("p",{className:"text-sm text-red-600",children:o.nombre})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"tipo",children:"Tipo de Datos *"}),e.jsxs(R,{value:r.tipo,onValueChange:s=>x("tipo",s),children:[e.jsx(J,{className:o.tipo?"border-red-500":"",children:e.jsx($,{placeholder:"Selecciona el tipo de datos"})}),e.jsx(U,{children:Object.entries(p).map(([s,a])=>e.jsx(X,{value:s,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:ee[s]}),e.jsx("span",{children:a})]})},s))})]}),o.tipo&&e.jsx("p",{className:"text-sm text-red-600",children:o.tipo})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"descripcion",children:"Descripción"}),e.jsx(H,{id:"descripcion",value:r.descripcion,onChange:s=>x("descripcion",s.target.value),placeholder:"Describe el propósito y contenido de esta importación...",rows:3})]}),r.tipo&&e.jsxs(c,{children:[e.jsx(N,{className:"h-4 w-4"}),e.jsxs(n,{children:[e.jsx("strong",{children:"Tipo seleccionado:"})," ",p[r.tipo],e.jsx("br",{}),"Este tipo de importación procesará datos relacionados con ",p[r.tipo].toLowerCase(),".",h.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("strong",{children:"Campos principales:"})," ",h.filter(s=>s.requerido).map(s=>s.nombre).join(", ")]})]})]})]})]})}),e.jsx(g,{value:"archivo",children:e.jsxs(m,{children:[e.jsxs(u,{children:[e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-5 w-5"}),"Selección de Archivo"]}),e.jsx(f,{children:"Sube el archivo que contiene los datos a importar"})]}),e.jsxs(b,{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:Object.entries(M).map(([s,a])=>{const t=se[s];return e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("div",{className:"text-2xl",children:t?.icon}),e.jsx("div",{className:"font-medium",children:a}),e.jsx("div",{className:"text-xs text-muted-foreground",children:t?.descripcion}),e.jsx("div",{className:"text-xs",children:e.jsxs(F,{variant:"outline",children:["Max: ",t?.tamanoMax]})})]})},s)})}),e.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(T,{className:"h-12 w-12 mx-auto text-gray-400"}),e.jsxs("div",{children:[e.jsxs(d,{htmlFor:"archivo",className:"cursor-pointer",children:[e.jsx("span",{className:"text-lg font-medium text-blue-600 hover:text-blue-500",children:"Seleccionar archivo"}),e.jsx(q,{id:"archivo",type:"file",className:"hidden",onChange:z,accept:".csv,.xlsx,.xls,.json,.xml"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"o arrastra y suelta tu archivo aquí"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Formatos soportados: CSV, Excel, JSON, XML (máximo 50MB)"})]})}),i&&e.jsxs(c,{children:[e.jsx(W,{className:"h-4 w-4"}),e.jsxs(n,{children:[e.jsx("strong",{children:"Archivo seleccionado:"})," ",i.name,e.jsx("br",{}),e.jsx("strong",{children:"Tamaño:"})," ",(i.size/1024/1024).toFixed(2)," MB",e.jsx("br",{}),e.jsx("strong",{children:"Tipo:"})," ",i.type]})]}),o.archivo&&e.jsxs(c,{variant:"destructive",children:[e.jsx(A,{className:"h-4 w-4"}),e.jsx(n,{children:o.archivo})]})]})]})}),e.jsx(g,{value:"mapeo",children:e.jsxs(m,{children:[e.jsxs(u,{children:[e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5"}),"Mapeo de Campos"]}),e.jsx(f,{children:"Define cómo se corresponden los campos del archivo con los campos del sistema"})]}),e.jsx(b,{className:"space-y-6",children:h.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsxs(c,{children:[e.jsx(N,{className:"h-4 w-4"}),e.jsx(n,{children:"Configura cómo los campos de tu archivo se mapean a los campos del sistema. Los campos marcados con * son obligatorios."})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:h.map(s=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:`mapeo_${s.campo}`,children:[s.nombre,s.requerido&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx(q,{id:`mapeo_${s.campo}`,placeholder:`Nombre de columna para ${s.nombre.toLowerCase()}`,value:l.mapeo[s.campo]||"",onChange:a=>L(s.campo,a.target.value)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Campo del sistema: ",e.jsx("code",{className:"bg-gray-100 px-1 rounded",children:s.campo})]})]},s.campo))}),e.jsxs(c,{children:[e.jsx(P,{className:"h-4 w-4"}),e.jsxs(n,{children:[e.jsx("strong",{children:"Ejemplo:"}),' Si tu archivo CSV tiene una columna llamada "Código Expediente", debes escribir "Código Expediente" en el campo de mapeo correspondiente a "Código".']})]})]}):e.jsxs(c,{children:[e.jsx(A,{className:"h-4 w-4"}),e.jsx(n,{children:'Primero debes seleccionar un tipo de datos en la pestaña "Datos Básicos".'})]})})]})}),e.jsx(g,{value:"configuracion",children:e.jsxs(m,{children:[e.jsxs(u,{children:[e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5"}),"Configuración Avanzada"]}),e.jsx(f,{children:"Opciones adicionales para el procesamiento de la importación"})]}),e.jsxs(b,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{id:"actualizar_existentes",checked:l.actualizar_existentes,onCheckedChange:s=>w(a=>({...a,actualizar_existentes:s}))}),e.jsx(d,{htmlFor:"actualizar_existentes",className:"text-sm font-medium",children:"Actualizar registros existentes"})]}),e.jsx("p",{className:"text-sm text-muted-foreground ml-6",children:"Si está marcado, los registros que ya existan en el sistema serán actualizados con los nuevos datos. Si no, se omitirán los duplicados."})]}),e.jsxs(c,{children:[e.jsx(N,{className:"h-4 w-4"}),e.jsxs(n,{children:[e.jsx("strong",{children:"Recomendación:"})," Ejecuta primero una importación de prueba con pocos registros para verificar que el mapeo y la configuración sean correctos."]})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h4",{className:"font-medium mb-4",children:"Resumen de Configuración"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Tipo de datos:"}),e.jsx(F,{variant:"outline",children:r.tipo?p[r.tipo]:"No seleccionado"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Archivo:"}),e.jsx("span",{children:i?.name||"No seleccionado"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Campos mapeados:"}),e.jsx("span",{children:Object.keys(l.mapeo).length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Actualizar existentes:"}),e.jsx("span",{children:l.actualizar_existentes?"Sí":"No"})]})]})]})]})]})})]}),e.jsxs("div",{className:"flex items-center justify-between pt-6 border-t",children:[e.jsx(y,{variant:"outline",asChild:!0,children:e.jsx(_,{href:"/admin/importaciones",children:"Cancelar"})}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx(y,{type:"submit",disabled:S||!r.nombre||!r.tipo||!i,className:"min-w-[150px]",children:S?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Creando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Crear Importación"]})})})]})]})]})]})}export{we as default};
