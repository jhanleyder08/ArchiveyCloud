import{r as N,j as e,H as re,b as ie}from"./app-PjT1iryK.js";import{A as le}from"./app-layout-B8yH-w41.js";import{B as l}from"./button-Cm9JNphY.js";import{C as t,a as c,b as o,c as j,d as T}from"./card-Co6Hd2mM.js";import{B as p}from"./badge-DbeYhTsH.js";import{G as ne,F,D as M,a as V,b as $,c as z,d as I,T as R,e as B,t as P,f as te}from"./app-sidebar-layout-CwtDgbRQ.js";import{I as C}from"./input-D1CzKmS6.js";import{L as d}from"./label-D-XtUnrF.js";import{S as O,a as H,b as L,c as q,d as n,e as ce}from"./select-CT7DStWF.js";import{u as oe}from"./useInertiaActions-0ImT4Sdq.js";import{A as de}from"./arrow-left-nBEtwD7M.js";import{C as G}from"./circle-check-big-PCF33TY9.js";import{C as xe}from"./circle-alert-CpKL6dyE.js";import{F as w}from"./Combination-D9Z0pBWt.js";import{F as S}from"./folder-CRD69BSn.js";import{D as me}from"./users--70s-uSq.js";import{P as J}from"./plus-CICtD8me.js";import{S as he}from"./square-pen-CxRRcXBP.js";import{T as je}from"./trash-2-BlEI8d1F.js";import{F as ge}from"./folder-open-DsxySXFX.js";/* empty css            */import"./index-CZ_pd2E1.js";import"./index-cbXV-n8a.js";import"./index-DhjpsedO.js";import"./x-BzfNQRjC.js";import"./app-logo-icon-MQmYQbHr.js";import"./user-DdNuv-nc.js";import"./mail-Df4Yzh_7.js";import"./triangle-alert-8-FZxcpm.js";import"./search-Cv_ItJ_l.js";import"./index-1M4rcJkl.js";import"./check-D71jOTwn.js";const K=({node:a,onEdit:b,onDelete:g,onAddChild:x})=>{const[u,f]=N.useState(!0),m=a.hijos&&a.hijos.length>0,D=h=>{switch(h){case"fondo":return e.jsx(ge,{className:"h-4 w-4 text-blue-600"});case"seccion":return e.jsx(S,{className:"h-4 w-4 text-green-600"});case"subseccion":return e.jsx(S,{className:"h-4 w-4 text-yellow-600"});case"serie":return e.jsx(w,{className:"h-4 w-4 text-purple-600"});case"subserie":return e.jsx(w,{className:"h-4 w-4 text-pink-600"});default:return e.jsx(w,{className:"h-4 w-4 text-gray-600"})}},v=h=>({fondo:"bg-blue-100 text-blue-800",seccion:"bg-green-100 text-green-800",subseccion:"bg-yellow-100 text-yellow-800",serie:"bg-purple-100 text-purple-800",subserie:"bg-pink-100 text-pink-800"})[h]||"bg-gray-100 text-gray-800";return e.jsxs("div",{className:"ml-4",children:[e.jsxs("div",{className:"flex items-center gap-2 py-2 group hover:bg-gray-50 rounded-md px-2",children:[e.jsx("button",{onClick:()=>f(!u),className:"p-0.5 hover:bg-gray-200 rounded",disabled:!m,children:m?u?e.jsx(ce,{className:"h-4 w-4"}):e.jsx(te,{className:"h-4 w-4"}):e.jsx("div",{className:"w-4 h-4"})}),D(a.tipo_nivel),e.jsxs("div",{className:"flex-1 flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-sm",children:a.nombre}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",a.codigo,")"]}),e.jsx(p,{variant:"outline",className:`text-xs ${v(a.tipo_nivel)}`,children:a.tipo_nivel}),!a.activo&&e.jsx(p,{variant:"outline",className:"text-xs bg-red-100 text-red-800",children:"Inactivo"})]}),e.jsxs("div",{className:"hidden group-hover:flex items-center gap-1",children:[e.jsx(l,{size:"sm",variant:"ghost",onClick:()=>x(a),className:"h-7 w-7 p-0",children:e.jsx(J,{className:"h-3 w-3"})}),e.jsx(l,{size:"sm",variant:"ghost",onClick:()=>b(a),className:"h-7 w-7 p-0",children:e.jsx(he,{className:"h-3 w-3"})}),e.jsx(l,{size:"sm",variant:"ghost",onClick:()=>g(a),className:"h-7 w-7 p-0 hover:bg-red-100 hover:text-red-600",children:e.jsx(je,{className:"h-3 w-3"})})]})]}),u&&m&&e.jsx("div",{className:"border-l-2 border-gray-200 ml-2",children:a.hijos.map(h=>e.jsx(K,{node:h,onEdit:b,onDelete:g,onAddChild:x},h.id))})]})};function Qe({ccd:a,estructura:b,estadisticas:g,errores_validacion:x,trds_relacionadas:u=[],series_relacionadas:f=[]}){const m=oe({only:["ccd","estructura","estadisticas","errores_validacion","trds_relacionadas","series_relacionadas"]}),[D,v]=N.useState(!1),[h,y]=N.useState(!1),[A,Q]=N.useState(null),[E,U]=N.useState(null),[r,i]=N.useState({codigo:"",nombre:"",descripcion:"",tipo_nivel:"fondo",orden:0,activo:!0}),W=[{title:"Dashboard",href:"/admin"},{title:"CCD",href:"/admin/ccd"},{title:a.nombre,href:`/admin/ccd/${a.id}`}],X=s=>({borrador:"bg-gray-100 text-gray-800",activo:"bg-green-100 text-green-800",inactivo:"bg-red-100 text-red-800",archivado:"bg-yellow-100 text-yellow-800"})[s]||"bg-gray-100 text-gray-800",k=(s=null)=>{Q(s),i({codigo:"",nombre:"",descripcion:"",tipo_nivel:s?"seccion":"fondo",orden:0,activo:!0}),v(!0)},Y=s=>{U(s),i({codigo:s.codigo,nombre:s.nombre,descripcion:s.descripcion||"",tipo_nivel:s.tipo_nivel,orden:s.orden,activo:s.activo}),y(!0)},Z=s=>{if(s.hijos&&s.hijos.length>0){P.error("No se puede eliminar un nivel que tiene hijos");return}m.destroy(`/admin/ccd/nivel/${s.id}`,{confirmMessage:`¿Está seguro de eliminar el nivel "${s.nombre}"?`,successMessage:"Nivel eliminado exitosamente",errorMessage:"Error al eliminar el nivel"})},ee=()=>{m.create(`/admin/ccd/${a.id}/nivel`,{...r,parent_id:A?.id||null},{successMessage:"Nivel agregado exitosamente",errorMessage:"Error al agregar nivel",onSuccess:()=>{v(!1),i({codigo:"",nombre:"",descripcion:"",tipo_nivel:"fondo",orden:0,activo:!0})}})},se=()=>{E&&m.update(`/admin/ccd/nivel/${E.id}`,r,{successMessage:"Nivel actualizado exitosamente",errorMessage:"Error al actualizar nivel",onSuccess:()=>{y(!1)}})},ae=()=>{if(x.length>0){P.error("No se puede aprobar: "+x.join(", "));return}m.create(`/admin/ccd/${a.id}/aprobar`,{},{successMessage:"CCD aprobado exitosamente",errorMessage:"Error al aprobar el CCD"})};return e.jsxs(le,{breadcrumbs:W,children:[e.jsx(re,{title:`CCD - ${a.nombre}`}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(l,{variant:"outline",onClick:()=>ie.visit("/admin/ccd"),children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Volver"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:a.nombre}),e.jsxs("p",{className:"text-sm text-gray-500",children:[a.codigo," • Versión ",a.version]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{className:X(a.estado),children:a.estado}),a.vigente&&e.jsxs(p,{className:"bg-green-100 text-green-800",children:[e.jsx(G,{className:"h-3 w-3 mr-1"}),"Vigente"]})]})]}),x.length>0&&e.jsxs(t,{className:"border-red-200 bg-red-50",children:[e.jsx(c,{children:e.jsxs(o,{className:"text-red-800 flex items-center gap-2",children:[e.jsx(xe,{className:"h-5 w-5"}),"Errores de Validación"]})}),e.jsx(j,{children:e.jsx("ul",{className:"list-disc list-inside space-y-1",children:x.map((s,_)=>e.jsx("li",{className:"text-sm text-red-700",children:s},_))})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(t,{children:[e.jsx(c,{className:"pb-2",children:e.jsx(o,{className:"text-sm font-medium text-gray-600",children:"Total Niveles"})}),e.jsx(j,{children:e.jsx("div",{className:"text-2xl font-bold text-[#2a3d83]",children:g.total_niveles})})]}),e.jsxs(t,{children:[e.jsx(c,{className:"pb-2",children:e.jsx(o,{className:"text-sm font-medium text-gray-600",children:"Niveles Activos"})}),e.jsx(j,{children:e.jsx("div",{className:"text-2xl font-bold text-green-600",children:g.niveles_activos})})]}),e.jsxs(t,{children:[e.jsx(c,{className:"pb-2",children:e.jsx(o,{className:"text-sm font-medium text-gray-600",children:"Profundidad Máxima"})}),e.jsx(j,{children:e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:g.profundidad_maxima})})]}),e.jsxs(t,{children:[e.jsx(c,{className:"pb-2",children:e.jsx(o,{className:"text-sm font-medium text-gray-600",children:"Vocabularios"})}),e.jsx(j,{children:e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:g.total_vocabularios})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(t,{children:[e.jsx(c,{className:"flex flex-row items-center justify-between",children:e.jsxs("div",{children:[e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-5 w-5 text-[#2a3d83]"}),"TRDs Relacionadas"]}),e.jsxs(T,{children:["Tablas de Retención vinculadas a este CCD (",u.length,")"]})]})}),e.jsx(j,{children:u.length>0?e.jsx("div",{className:"space-y-2",children:u.map(s=>e.jsxs("a",{href:`/admin/trd/${s.id}`,className:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50 hover:border-[#2a3d83] transition-all",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.nombre}),e.jsxs("div",{className:"text-sm text-gray-500",children:[s.codigo," • v",s.version]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(p,{variant:"secondary",className:"text-xs",children:[s.series_count," series"]}),e.jsx(p,{className:s.estado==="vigente"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800",children:s.estado})]})]},s.id))}):e.jsxs("div",{className:"text-center py-6 text-gray-500",children:[e.jsx(w,{className:"h-8 w-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"No hay TRDs relacionadas"}),e.jsx("a",{href:"/admin/trd",className:"text-[#2a3d83] text-sm hover:underline mt-1 inline-block",children:"Ver todas las TRDs"})]})})]}),e.jsxs(t,{children:[e.jsx(c,{className:"flex flex-row items-center justify-between",children:e.jsxs("div",{children:[e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-5 w-5 text-purple-600"}),"Series Relacionadas"]}),e.jsxs(T,{children:["Series documentales vinculadas a este CCD (",f.length,")"]})]})}),e.jsx(j,{children:f.length>0?e.jsx("div",{className:"space-y-2 max-h-80 overflow-y-auto",children:f.map(s=>e.jsxs("a",{href:`/admin/series/${s.id}`,className:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50 hover:border-purple-300 transition-all",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.nombre}),e.jsxs("div",{className:"text-sm text-gray-500",children:[s.codigo," • ",s.trd_nombre]})]}),e.jsxs(p,{variant:"secondary",className:"text-xs",children:[s.subseries_count," subseries"]})]},s.id))}):e.jsxs("div",{className:"text-center py-6 text-gray-500",children:[e.jsx(S,{className:"h-8 w-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"No hay series relacionadas"}),e.jsx("a",{href:"/admin/series",className:"text-purple-600 text-sm hover:underline mt-1 inline-block",children:"Ver todas las series"})]})})]})]}),e.jsx(t,{children:e.jsx(c,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(o,{children:"Acciones"}),e.jsxs("div",{className:"flex items-center gap-2",children:[a.estado==="borrador"&&x.length===0&&e.jsxs(l,{onClick:ae,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Aprobar CCD"]}),e.jsxs(l,{variant:"outline",children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Exportar"]}),e.jsxs(l,{variant:"outline",children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Nueva Versión"]})]})]})})}),e.jsxs(t,{children:[e.jsx(c,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(F,{className:"h-5 w-5"}),"Estructura Jerárquica"]}),e.jsx(T,{children:"Gestione la estructura del cuadro de clasificación documental"})]}),e.jsxs(l,{onClick:()=>k(null),className:"bg-[#2a3d83] hover:bg-[#1e2b5f]",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Agregar Nivel Raíz"]})]})}),e.jsx(j,{children:b.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(F,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No hay niveles configurados aún"}),e.jsx("p",{className:"text-sm",children:"Comience agregando un nivel raíz (Fondo)"})]}):e.jsx("div",{className:"space-y-1",children:b.map(s=>e.jsx(K,{node:s,onEdit:Y,onDelete:Z,onAddChild:k},s.id))})})]}),e.jsx(M,{open:D,onOpenChange:v,children:e.jsxs(V,{children:[e.jsxs($,{children:[e.jsx(z,{children:"Agregar Nuevo Nivel"}),e.jsx(I,{children:A?`Agregar nivel hijo a: ${A.nombre}`:"Agregar nivel raíz al CCD"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Código*"}),e.jsx(C,{value:r.codigo,onChange:s=>i({...r,codigo:s.target.value}),placeholder:"Ej: FOND-01"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Tipo*"}),e.jsxs(O,{value:r.tipo_nivel,onValueChange:s=>i({...r,tipo_nivel:s}),children:[e.jsx(H,{children:e.jsx(L,{})}),e.jsxs(q,{children:[e.jsx(n,{value:"fondo",children:"Fondo"}),e.jsx(n,{value:"seccion",children:"Sección"}),e.jsx(n,{value:"subseccion",children:"Subsección"}),e.jsx(n,{value:"serie",children:"Serie"}),e.jsx(n,{value:"subserie",children:"Subserie"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Nombre*"}),e.jsx(C,{value:r.nombre,onChange:s=>i({...r,nombre:s.target.value}),placeholder:"Nombre del nivel"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Descripción"}),e.jsx(R,{value:r.descripcion,onChange:s=>i({...r,descripcion:s.target.value}),placeholder:"Descripción opcional",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Orden"}),e.jsx(C,{type:"number",value:r.orden,onChange:s=>i({...r,orden:parseInt(s.target.value)||0})})]})]}),e.jsxs(B,{children:[e.jsx(l,{variant:"outline",onClick:()=>v(!1),children:"Cancelar"}),e.jsx(l,{onClick:ee,className:"bg-[#2a3d83] hover:bg-[#1e2b5f]",children:"Agregar Nivel"})]})]})}),e.jsx(M,{open:h,onOpenChange:y,children:e.jsxs(V,{children:[e.jsxs($,{children:[e.jsx(z,{children:"Editar Nivel"}),e.jsxs(I,{children:["Modificar información del nivel ",E?.nombre]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Código*"}),e.jsx(C,{value:r.codigo,onChange:s=>i({...r,codigo:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Tipo*"}),e.jsxs(O,{value:r.tipo_nivel,onValueChange:s=>i({...r,tipo_nivel:s}),children:[e.jsx(H,{children:e.jsx(L,{})}),e.jsxs(q,{children:[e.jsx(n,{value:"fondo",children:"Fondo"}),e.jsx(n,{value:"seccion",children:"Sección"}),e.jsx(n,{value:"subseccion",children:"Subsección"}),e.jsx(n,{value:"serie",children:"Serie"}),e.jsx(n,{value:"subserie",children:"Subserie"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Nombre*"}),e.jsx(C,{value:r.nombre,onChange:s=>i({...r,nombre:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Descripción"}),e.jsx(R,{value:r.descripcion,onChange:s=>i({...r,descripcion:s.target.value}),rows:3})]})]}),e.jsxs(B,{children:[e.jsx(l,{variant:"outline",onClick:()=>y(!1),children:"Cancelar"}),e.jsx(l,{onClick:se,className:"bg-[#2a3d83] hover:bg-[#1e2b5f]",children:"Actualizar Nivel"})]})]})})]})]})}export{Qe as default};
