import{r as h,u as se,j as e,H as ae,L as re}from"./app-91m9kwyU.js";import{A as ie,T as k}from"./app-sidebar-layout-CLv5ko0D.js";import{c as le,B as r}from"./button-CoFcodqQ.js";import{C as n,c,a as p,b as u,d as P}from"./card-3q9vKs-A.js";import{I as g}from"./input-JBRHZ7QZ.js";import{L as N}from"./label-BZUr6K3X.js";import{S as T,a as L,b as z,c as A,d as M}from"./select-Wrwv2RZt.js";import{B as te}from"./badge-Dw7CG6bs.js";import{A as _,a as y}from"./alert-KwJoiGEv.js";import{S as oe}from"./switch-Bl3QU1vF.js";import{A as ne}from"./arrow-left-DkpxaxLU.js";import{C as ce}from"./check-Cn3I3pUy.js";import{E as q}from"./eye-xXNHm9-c.js";import{S as de}from"./save-CttH1uaj.js";import{F as D}from"./Combination-CDT0PLPo.js";import{X as me}from"./x-CyP9uxNW.js";import{P as I}from"./plus-B3qVF68_.js";import{S as xe}from"./square-pen-Ctxckn8q.js";import{T as he}from"./trash-2-D_q2qeTI.js";import{D as F}from"./users-DKdb_1gz.js";import{U as je}from"./upload-Difg_CqQ.js";/* empty css            */import"./index-CGEZD_4Y.js";import"./index-Dc4Xr8Yn.js";import"./index-Dt_6hCNO.js";import"./index-Baz-24-5.js";import"./app-logo-icon-CUlPqTXW.js";import"./user-aQnMVpKS.js";import"./mail-CViPbZpD.js";import"./folder-C92Ox93S.js";import"./triangle-alert-B8VDP-oe.js";import"./search-DaK7IuzH.js";import"./index-CeBSh6Va.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]],ue=le("Code",pe);function Ze({plantilla:i,categorias:H,series:ve,tipos_campo:B,estadisticas_uso:j}){const[f,b]=h.useState("visual"),[w,G]=h.useState(""),[o,R]=h.useState(null),[ge,$]=h.useState(null),[l,m]=h.useState({nombre:"",marcador:"",tipo:"text",requerido:!0,valor_default:""}),{data:t,setData:d,post:O,put:U,processing:E,errors:v,reset:Ne}=se({nombre:i?.nombre||"",descripcion:i?.descripcion||"",categoria:i?.categoria||"",serie_documental_id:"",contenido_html:i?.contenido_html||"",campos_variables:i?.campos_variables||[],metadatos_predefinidos:i?.metadatos_predefinidos||{},configuracion_formato:i?.configuracion_formato||{},tags:i?.tags||[],es_publica:!1}),J=()=>{i?U(route("admin.plantillas.update",i.id)):O(route("admin.plantillas.store"))},S=async()=>{try{const a=await(await fetch(route("admin.plantillas.validar-estructura"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({contenido_html:t.contenido_html})})).json();R(a)}catch(s){console.error("Error al validar estructura:",s)}},X=()=>{let s=t.contenido_html;t.campos_variables.forEach(a=>{const x=K(a);s=s.replace(new RegExp(Q(a.marcador),"g"),x)}),G(s)},K=s=>{switch(s.tipo){case"date":return new Date().toLocaleDateString();case"number":return"123";case"email":return"ejemplo@correo.com";case"tel":return"+57 300 123 4567";default:return s.valor_default||`[${s.nombre}]`}},Q=s=>s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),W=()=>{if(!l.nombre)return;const s=l.marcador||`{${l.nombre}}`,a={...l,marcador:s};d("campos_variables",[...t.campos_variables,a]),m({nombre:"",marcador:"",tipo:"text",requerido:!0,valor_default:""})},Y=s=>{const a=t.campos_variables.filter((x,C)=>C!==s);d("campos_variables",a)},Z=s=>{const a=document.getElementById("contenido_html");if(a){const x=a.selectionStart,C=a.selectionEnd,V=t.contenido_html,ee=V.substring(0,x)+s+V.substring(C);d("contenido_html",ee),setTimeout(()=>{a.focus(),a.setSelectionRange(x+s.length,x+s.length)},0)}};return h.useEffect(()=>{t.contenido_html&&S()},[t.contenido_html]),e.jsxs(ie,{children:[e.jsx(ae,{title:`Editor - ${i?.nombre||"Nueva Plantilla"}`}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(re,{href:route("admin.plantillas.index"),children:e.jsxs(r,{variant:"outline",size:"sm",children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Volver"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:i?`Editar: ${i.nombre}`:"Nueva Plantilla"}),e.jsx("p",{className:"text-muted-foreground",children:"Editor avanzado de plantillas documentales"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(r,{variant:"outline",onClick:S,children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Validar"]}),e.jsxs(r,{variant:"outline",onClick:X,children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Vista Previa"]}),e.jsxs(r,{onClick:J,disabled:E,children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),E?"Guardando...":"Guardar"]})]})]}),j&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(n,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:j.documentos_generados}),e.jsx("p",{className:"text-sm text-gray-600",children:"Documentos Generados"})]})})}),e.jsx(n,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:j.uso_ultimo_mes}),e.jsx("p",{className:"text-sm text-gray-600",children:"Uso Último Mes"})]})})}),e.jsx(n,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:j.usuarios_distintos}),e.jsx("p",{className:"text-sm text-gray-600",children:"Usuarios Únicos"})]})})}),e.jsx(n,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:j.promedio_uso_mensual}),e.jsx("p",{className:"text-sm text-gray-600",children:"Promedio Mensual"})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(n,{children:[e.jsx(p,{children:e.jsx(u,{children:"Información Básica"})}),e.jsxs(c,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"nombre",children:"Nombre de la Plantilla"}),e.jsx(g,{id:"nombre",value:t.nombre,onChange:s=>d("nombre",s.target.value),placeholder:"Ej: Memorando Interno"}),v.nombre&&e.jsx("p",{className:"text-sm text-red-600",children:v.nombre})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"categoria",children:"Categoría"}),e.jsxs(T,{value:t.categoria,onValueChange:s=>d("categoria",s),children:[e.jsx(L,{children:e.jsx(z,{placeholder:"Seleccionar categoría"})}),e.jsx(A,{children:H.map(s=>e.jsx(M,{value:s.value,children:s.label},s.value))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"descripcion",children:"Descripción"}),e.jsx(k,{id:"descripcion",value:t.descripcion,onChange:s=>d("descripcion",s.target.value),placeholder:"Describe el propósito y uso de esta plantilla...",rows:3})]})]})]}),e.jsxs(n,{children:[e.jsx(p,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{children:"Contenido de la Plantilla"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(r,{variant:f==="visual"?"default":"outline",size:"sm",onClick:()=>b("visual"),children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Visual"]}),e.jsxs(r,{variant:f==="codigo"?"default":"outline",size:"sm",onClick:()=>b("codigo"),children:[e.jsx(ue,{className:"h-4 w-4 mr-2"}),"Código"]})]})]})}),e.jsxs(c,{children:[f==="codigo"?e.jsxs("div",{className:"space-y-4",children:[e.jsx(k,{id:"contenido_html",value:t.contenido_html,onChange:s=>d("contenido_html",s.target.value),placeholder:"Escribe el contenido HTML de tu plantilla aquí...",rows:20,className:"font-mono text-sm"}),v.contenido_html&&e.jsx("p",{className:"text-sm text-red-600",children:v.contenido_html})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs(_,{children:[e.jsx(D,{className:"h-4 w-4"}),e.jsx(y,{children:"El editor visual estará disponible en la próxima actualización. Por ahora, usa el modo código para editar el contenido HTML."})]}),e.jsx(r,{onClick:()=>b("codigo"),className:"w-full",children:"Cambiar a Modo Código"})]}),o&&e.jsxs("div",{className:"mt-4 space-y-2",children:[!o.valida&&o.errores.length>0&&e.jsxs(_,{variant:"destructive",children:[e.jsx(me,{className:"h-4 w-4"}),e.jsxs(y,{children:[e.jsx("strong",{children:"Errores encontrados:"}),e.jsx("ul",{className:"list-disc list-inside mt-1",children:o.errores.map((s,a)=>e.jsx("li",{children:s},a))})]})]}),o.advertencias.length>0&&e.jsx(_,{children:e.jsxs(y,{children:[e.jsx("strong",{children:"Advertencias:"}),e.jsx("ul",{className:"list-disc list-inside mt-1",children:o.advertencias.map((s,a)=>e.jsx("li",{children:s},a))})]})}),o.estadisticas&&e.jsxs("div",{className:"text-sm text-gray-600",children:["Tamaño: ",o.estadisticas.tamaño_bytes," bytes | Campos variables: ",o.estadisticas.campos_variables," | Elementos HTML: ",o.estadisticas.elementos_html]})]})]})]}),w&&e.jsxs(n,{children:[e.jsxs(p,{children:[e.jsx(u,{children:"Vista Previa"}),e.jsx(P,{children:"Visualización de la plantilla con valores de ejemplo"})]}),e.jsx(c,{children:e.jsx("div",{className:"border p-4 bg-white min-h-[300px]",dangerouslySetInnerHTML:{__html:w}})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(n,{children:[e.jsxs(p,{children:[e.jsx(u,{children:"Campos Variables"}),e.jsx(P,{children:"Gestiona los campos que pueden ser reemplazados dinámicamente"})]}),e.jsxs(c,{className:"space-y-4",children:[t.campos_variables.length>0&&e.jsx("div",{className:"space-y-2",children:t.campos_variables.map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:s.nombre}),e.jsxs("div",{className:"text-sm text-gray-500",children:[s.marcador," • ",s.tipo,s.requerido&&e.jsx(te,{variant:"outline",className:"ml-1",children:"Requerido"})]})]}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(r,{size:"sm",variant:"outline",onClick:()=>Z(s.marcador),children:e.jsx(I,{className:"h-3 w-3"})}),e.jsx(r,{size:"sm",variant:"outline",onClick:()=>$(a),children:e.jsx(xe,{className:"h-3 w-3"})}),e.jsx(r,{size:"sm",variant:"outline",onClick:()=>Y(a),children:e.jsx(he,{className:"h-3 w-3"})})]})]},a))}),e.jsxs("div",{className:"space-y-3 p-3 border rounded bg-gray-50",children:[e.jsx("h4",{className:"font-medium",children:"Agregar Campo"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{placeholder:"Nombre del campo",value:l.nombre,onChange:s=>m({...l,nombre:s.target.value})}),e.jsx(g,{placeholder:"Marcador (ej: {nombre})",value:l.marcador,onChange:s=>m({...l,marcador:s.target.value})}),e.jsxs(T,{value:l.tipo,onValueChange:s=>m({...l,tipo:s}),children:[e.jsx(L,{children:e.jsx(z,{})}),e.jsx(A,{children:B.map(s=>e.jsx(M,{value:s.value,children:s.label},s.value))})]}),e.jsx(g,{placeholder:"Valor por defecto",value:l.valor_default,onChange:s=>m({...l,valor_default:s.target.value})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(oe,{checked:l.requerido,onCheckedChange:s=>m({...l,requerido:s})}),e.jsx(N,{children:"Campo requerido"})]}),e.jsxs(r,{onClick:W,className:"w-full",size:"sm",children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Agregar Campo"]})]})]})]})]}),e.jsxs(n,{children:[e.jsx(p,{children:e.jsx(u,{children:"Acciones"})}),e.jsxs(c,{className:"space-y-2",children:[i&&e.jsxs(e.Fragment,{children:[e.jsxs(r,{variant:"outline",className:"w-full",children:[e.jsx(F,{className:"h-4 w-4 mr-2"}),"Exportar JSON"]}),e.jsxs(r,{variant:"outline",className:"w-full",children:[e.jsx(F,{className:"h-4 w-4 mr-2"}),"Exportar HTML"]}),e.jsxs(r,{variant:"outline",className:"w-full",children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Nueva Versión"]})]}),e.jsxs(r,{variant:"outline",className:"w-full",children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),"Importar Plantilla"]})]})]})]})]})]})]})}export{Ze as default};
