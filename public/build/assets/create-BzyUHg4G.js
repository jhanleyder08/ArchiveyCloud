import{r as f,u as R,j as e,H as U,L as D}from"./app-tMaUuF3G.js";import{A as G}from"./app-layout-Do2Eb3Sk.js";import{B as o}from"./button-b2NvRhsY.js";import{C as d,a as m,b as x,d as N,c as h}from"./card-B1dP6K0M.js";import{L as p}from"./label-Bqu3HQD6.js";import{I as k}from"./input-BUbi3POq.js";import{G as X,T as $}from"./app-sidebar-layout-DrvTFVRU.js";import{S as L,a as B,b as F,c as I,d as T}from"./select-CdhdgJ0w.js";import{C as J}from"./checkbox-C304e6F8.js";import{F as E,B as b}from"./Combination-CgNv0oAU.js";import{A as K,a as O}from"./alert-DhY9P36X.js";import{C as Q}from"./circle-check-big-V33kOqFh.js";import{S as Y}from"./search-a-c68EbR.js";import{P as Z}from"./plus-bKOZofE8.js";import{U as ee}from"./users-0BijOv_M.js";import{X as se}from"./x-B3QVzJhq.js";import{C as ae}from"./circle-alert-B-OTrNj1.js";import{C as re}from"./folder-CyeXS8Xg.js";/* empty css            */import"./index-BqccPZiJ.js";import"./index-gcMQB5yO.js";import"./index-DReOSayN.js";import"./app-logo-icon-DkUm7hxR.js";import"./user-BK5OEaM4.js";import"./mail-CwCHIGE1.js";import"./triangle-alert-JjU49oaO.js";import"./BrandingProvider-DUeywemA.js";import"./index-CWm8oeKh.js";import"./check-CjMGlCJz.js";function Fe({documento:g,usuarios_disponibles:V=[],documentos_disponibles:j=[]}){const y=V,[r,w]=f.useState([]),[i,C]=f.useState(g||null),[u,S]=f.useState(""),{data:n,setData:c,post:W,processing:_,errors:t}=R({documento_id:g?.id.toString()||"",aprobadores:[],descripcion:"",prioridad:2,requiere_unanime:!1,dias_vencimiento:7}),v=f.useMemo(()=>{if(!u.trim())return j.slice(0,20);const s=u.toLowerCase();return j.filter(a=>a.nombre.toLowerCase().includes(s)||a.codigo.toLowerCase().includes(s)||a.expediente?.titulo?.toLowerCase().includes(s)||a.expediente?.numero?.toLowerCase().includes(s)).slice(0,20)},[j,u]),P=s=>{C(s),c("documento_id",s.id.toString()),S("")},q=[{valor:4,etiqueta:"Crítica",color:"text-red-600"},{valor:3,etiqueta:"Alta",color:"text-orange-600"},{valor:2,etiqueta:"Media",color:"text-blue-600"},{valor:1,etiqueta:"Baja",color:"text-gray-600"}],z=s=>{s.preventDefault(),!(r.length===0||!i)&&W("/admin/workflow",{preserveScroll:!0,onBefore:()=>{}})},H=s=>{if(!r.find(a=>a.id===s.id)){const a=[...r,s];w(a),c("aprobadores",a.map(l=>l.id))}},M=s=>{const a=r.filter(l=>l.id!==s);w(a),c("aprobadores",a.map(l=>l.id))},A=q.find(s=>s.valor===n.prioridad);return e.jsxs(G,{children:[e.jsx(U,{title:"Nuevo Workflow de Aprobación"}),e.jsxs("div",{className:"container mx-auto py-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(X,{className:"w-8 h-8 text-blue-600"}),"Nuevo Workflow de Aprobación"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Inicia un proceso de aprobación para un documento"})]}),e.jsx(D,{href:"/admin/workflow",children:e.jsx(o,{variant:"outline",children:"Volver a Workflows"})})]}),e.jsx("form",{onSubmit:z,className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(d,{children:[e.jsxs(m,{children:[e.jsxs(x,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5"}),"Documento a Aprobar"]}),e.jsx(N,{children:"Selecciona el documento que necesita aprobación"})]}),e.jsx(h,{children:i?e.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Q,{className:"w-5 h-5 text-green-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-green-900",children:i.nombre}),e.jsxs("p",{className:"text-sm text-green-700",children:["Código: ",i.codigo]}),i.expediente&&e.jsxs("p",{className:"text-sm text-green-600 mt-1",children:["Expediente: ",i.expediente.numero," - ",i.expediente.titulo]})]})]}),e.jsx(o,{type:"button",variant:"outline",size:"sm",onClick:()=>{C(null),c("documento_id","")},children:"Cambiar"})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Y,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(k,{placeholder:"Buscar documento por nombre, código o expediente...",value:u,onChange:s=>S(s.target.value),className:`pl-10 ${t.documento_id?"border-red-500":""}`})]}),t.documento_id&&e.jsx("p",{className:"text-sm text-red-600",children:t.documento_id}),e.jsx("div",{className:"max-h-64 overflow-y-auto border rounded-lg divide-y",children:v.length>0?v.map(s=>e.jsx("div",{className:"p-3 hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>P(s),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.nombre}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(b,{variant:"outline",className:"text-xs",children:s.codigo}),s.expediente&&e.jsxs("span",{className:"text-xs text-gray-500",children:["Exp: ",s.expediente.numero]}),s.fecha&&e.jsx("span",{className:"text-xs text-gray-400",children:s.fecha})]})]}),e.jsx(o,{type:"button",variant:"ghost",size:"sm",children:e.jsx(Z,{className:"w-4 h-4"})})]})},s.id)):e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx(E,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"No se encontraron documentos"}),e.jsx("p",{className:"text-sm",children:"Intenta con otra búsqueda"})]})}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Mostrando ",v.length," de ",j.length," documentos disponibles"]})]})})]}),e.jsxs(d,{children:[e.jsxs(m,{children:[e.jsxs(x,{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5"}),"Aprobadores"]}),e.jsx(N,{children:"Selecciona los usuarios que deben aprobar este documento"})]}),e.jsxs(h,{className:"space-y-4",children:[r.length>0&&e.jsxs("div",{children:[e.jsxs(p,{className:"text-sm font-medium",children:["Aprobadores Seleccionados (",r.length,")"]}),e.jsx("div",{className:"space-y-2 mt-2",children:r.map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center text-sm font-medium text-blue-600",children:a+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.cargo})]})]}),e.jsx(o,{type:"button",variant:"ghost",size:"sm",onClick:()=>M(s.id),children:e.jsx(se,{className:"w-4 h-4"})})]},s.id))})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"nuevo_aprobador",children:"Agregar Aprobador"}),e.jsxs(L,{onValueChange:s=>{const a=y.find(l=>l.id.toString()===s);a&&H(a)},children:[e.jsx(B,{children:e.jsx(F,{placeholder:"Seleccionar usuario..."})}),e.jsx(I,{children:y.filter(s=>!r.find(a=>a.id===s.id)).map(s=>e.jsx(T,{value:s.id.toString(),children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.cargo," - ",s.email]})]})},s.id))})]})]}),r.length===0&&e.jsxs(K,{children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsx(O,{children:"Debes seleccionar al menos un aprobador para continuar."})]}),r.length>1&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(J,{id:"requiere_unanime",checked:n.requiere_unanime,onCheckedChange:s=>c("requiere_unanime",!!s)}),e.jsx(p,{htmlFor:"requiere_unanime",className:"text-sm",children:"Requiere aprobación unánime (todos deben aprobar)"})]})]})]}),e.jsxs(d,{children:[e.jsxs(m,{children:[e.jsx(x,{children:"Descripción de la Solicitud"}),e.jsx(N,{children:"Explica por qué este documento necesita aprobación"})]}),e.jsxs(h,{children:[e.jsx($,{placeholder:"Describe el motivo de la aprobación, contexto adicional, o instrucciones específicas...",value:n.descripcion,onChange:s=>c("descripcion",s.target.value),rows:4,className:t.descripcion?"border-red-500":""}),t.descripcion&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:t.descripcion})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(d,{children:[e.jsx(m,{children:e.jsxs(x,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5"}),"Configuración"]})}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(p,{children:"Prioridad *"}),e.jsxs(L,{value:n.prioridad.toString(),onValueChange:s=>c("prioridad",parseInt(s)),children:[e.jsx(B,{children:e.jsx(F,{})}),e.jsx(I,{children:q.map(s=>e.jsx(T,{value:s.valor.toString(),children:e.jsx("span",{className:s.color,children:s.etiqueta})},s.valor))})]}),t.prioridad&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:t.prioridad})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"dias_vencimiento",children:"Días para vencer *"}),e.jsx(k,{id:"dias_vencimiento",type:"number",min:"1",max:"30",value:n.dias_vencimiento,onChange:s=>c("dias_vencimiento",parseInt(s.target.value)||7),className:t.dias_vencimiento?"border-red-500":""}),t.dias_vencimiento&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:t.dias_vencimiento}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Fecha de vencimiento: ",new Date(Date.now()+n.dias_vencimiento*24*60*60*1e3).toLocaleDateString()]})]})]})]}),e.jsxs(d,{children:[e.jsx(m,{children:e.jsx(x,{children:"Resumen"})}),e.jsxs(h,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Documento:"}),e.jsx("span",{className:"text-sm font-medium",children:g?"✓":"✗"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Aprobadores:"}),e.jsx("span",{className:"text-sm font-medium",children:r.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Prioridad:"}),e.jsx(b,{variant:"outline",className:A?.color,children:A?.etiqueta})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Vencimiento:"}),e.jsxs("span",{className:"text-sm font-medium",children:[n.dias_vencimiento," días"]})]}),n.requiere_unanime&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Tipo:"}),e.jsx(b,{variant:"outline",className:"text-orange-600",children:"Unánime"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(o,{type:"submit",className:"w-full",disabled:_||!i||r.length===0,children:_?"Creando...":"Iniciar Workflow"}),e.jsx(D,{href:"/admin/workflow",children:e.jsx(o,{variant:"outline",className:"w-full",children:"Cancelar"})})]})]})]})})]})]})}export{Fe as default};
