import{r as _,j as e,H as K,L as j,b as i}from"./app-DOeYTPnE.js";import{A as J,f as u,s as Q,u as W,v as Y,w as Z,x,y as T}from"./app-sidebar-layout-83PL_wom.js";import{c as ee,B as d}from"./button-BB3j1qH9.js";import{C as c,a as I,b as E,c as n,d as se}from"./card-BEZSel9K.js";import{I as F}from"./index-C7D1JV-H.js";import{S,a as M,b as $,c as L,d as f}from"./select-D2zOlv3c.js";import{B as ae}from"./badge-BDHWk-Qv.js";import{T as te,a as le,b as P,c as l,d as re,e as r}from"./table-TW3yL78Z.js";import{P as de}from"./progress-Dx-cP85h.js";import{R as ie}from"./refresh-cw-B3OjpzJz.js";import{F as ce}from"./filter-kze0nvip.js";import{S as k,F as ne}from"./index-Cl_hWV--.js";import{X as B}from"./x-BHxLkKP3.js";import{P as N}from"./play-DLz3MKrv.js";import{C as A}from"./circle-check-big-BQYxJNiA.js";import{C as q}from"./circle-x-CwiZ-nCX.js";import{T as oe}from"./triangle-alert-B7e9hRq_.js";import{C as z,U as xe}from"./user-BiSWd6pJ.js";import{E as me}from"./eye-I-PfQi00.js";import{T as he}from"./trash-2-COYRgziV.js";/* empty css            */import"./index-B5i9qy2Y.js";import"./index-BuQaqXjb.js";import"./index-sj4qH-fg.js";import"./app-logo-icon-BTiqVlKS.js";import"./label-BvABT9uR.js";import"./index-pqvegj4w.js";import"./check-C4IDWgVr.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],ue=ee("Ellipsis",je),D={expedientes:"📁",documentos:"📄",series:"📚",subseries:"📖",usuarios:"👥",trd:"📋",certificados:"🔐",mixto:"🔄"},fe={csv:"📊",excel:"📈",json:"⚙️",xml:"🏷️",sql:"🗄️",zip:"📦"},pe={pendiente:{icon:z,color:"bg-yellow-100 text-yellow-800",label:"Pendiente"},procesando:{icon:N,color:"bg-blue-100 text-blue-800",label:"Procesando"},completada:{icon:A,color:"bg-green-100 text-green-800",label:"Completada"},fallida:{icon:q,color:"bg-red-100 text-red-800",label:"Fallida"},cancelada:{icon:oe,color:"bg-gray-100 text-gray-800",label:"Cancelada"}};function Oe({importaciones:t,filtros:g,tipos:v,estados:H}){const[b,w]=_.useState(g.buscar||""),[m,h]=_.useState(g),C=()=>{i.get("/admin/importaciones/listado",{...m,buscar:b})},R=()=>{w(""),h({}),i.get("/admin/importaciones/listado")},U=s=>{i.post(`/admin/importaciones/${s}/procesar`,{},{onSuccess:()=>{}})},V=s=>{confirm("¿Estás seguro de que deseas cancelar esta importación?")&&i.post(`/admin/importaciones/${s}/cancelar`)},G=s=>{confirm("¿Estás seguro de que deseas eliminar esta importación? Esta acción no se puede deshacer.")&&i.delete(`/admin/importaciones/${s}`)},O=s=>{if(!s)return"-";if(s<60)return`${s}s`;if(s<3600){const o=Math.floor(s/60),X=s%60;return`${o}m ${X}s`}const a=Math.floor(s/3600),p=Math.floor(s%3600/60);return`${a}h ${p}m`},y=s=>new Date(s).toLocaleString("es-ES",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsxs(J,{children:[e.jsx(K,{title:"Gestión de Importaciones"}),e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold tracking-tight flex items-center gap-2",children:[e.jsx(u,{className:"h-8 w-8 text-blue-600"}),"Gestión de Importaciones"]}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Administra todas las importaciones de datos del sistema"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(d,{variant:"outline",onClick:()=>window.location.reload(),children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Actualizar"]}),e.jsx(d,{asChild:!0,children:e.jsxs(j,{href:"/admin/importaciones/crear",children:[e.jsx(u,{className:"h-4 w-4 mr-2"}),"Nueva Importación"]})})]})]}),e.jsxs(c,{children:[e.jsx(I,{children:e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-5 w-5"}),"Filtros de Búsqueda"]})}),e.jsxs(n,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Buscar"}),e.jsxs("div",{className:"relative",children:[e.jsx(k,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(F,{placeholder:"Nombre de importación...",value:b,onChange:s=>w(s.target.value),className:"pl-10",onKeyPress:s=>s.key==="Enter"&&C()})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Tipo"}),e.jsxs(S,{value:m.tipo||"",onValueChange:s=>h(a=>({...a,tipo:s||void 0})),children:[e.jsx(M,{children:e.jsx($,{placeholder:"Todos los tipos"})}),e.jsxs(L,{children:[e.jsx(f,{value:"",children:"Todos los tipos"}),Object.entries(v).map(([s,a])=>e.jsxs(f,{value:s,children:[D[s]," ",a]},s))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Estado"}),e.jsxs(S,{value:m.estado||"",onValueChange:s=>h(a=>({...a,estado:s||void 0})),children:[e.jsx(M,{children:e.jsx($,{placeholder:"Todos los estados"})}),e.jsxs(L,{children:[e.jsx(f,{value:"",children:"Todos los estados"}),Object.entries(H).map(([s,a])=>e.jsx(f,{value:s,children:a},s))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Fecha desde"}),e.jsx(F,{type:"date",value:m.fecha_desde||"",onChange:s=>h(a=>({...a,fecha_desde:s.target.value||void 0}))})]})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-4",children:[e.jsxs(d,{onClick:C,children:[e.jsx(k,{className:"h-4 w-4 mr-2"}),"Aplicar Filtros"]}),e.jsxs(d,{variant:"outline",onClick:R,children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Limpiar"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(c,{children:e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total"}),e.jsx("p",{className:"text-2xl font-bold",children:t.meta.total})]}),e.jsx(ne,{className:"h-8 w-8 text-blue-600"})]})})}),e.jsx(c,{children:e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"En Proceso"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:t.data.filter(s=>s.estado==="procesando").length})]}),e.jsx(N,{className:"h-8 w-8 text-blue-600"})]})})}),e.jsx(c,{children:e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Completadas"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:t.data.filter(s=>s.estado==="completada").length})]}),e.jsx(A,{className:"h-8 w-8 text-green-600"})]})})}),e.jsx(c,{children:e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Fallidas"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:t.data.filter(s=>s.estado==="fallida").length})]}),e.jsx(q,{className:"h-8 w-8 text-red-600"})]})})})]}),e.jsxs(c,{children:[e.jsxs(I,{children:[e.jsx(E,{children:"Lista de Importaciones"}),e.jsxs(se,{children:["Mostrando ",t.meta.from," - ",t.meta.to," de ",t.meta.total," importaciones"]})]}),e.jsxs(n,{children:[e.jsxs("div",{className:"rounded-md border",children:[e.jsxs(te,{children:[e.jsx(le,{children:e.jsxs(P,{children:[e.jsx(l,{children:"Importación"}),e.jsx(l,{children:"Tipo"}),e.jsx(l,{children:"Estado"}),e.jsx(l,{children:"Progreso"}),e.jsx(l,{children:"Resultados"}),e.jsx(l,{children:"Usuario"}),e.jsx(l,{children:"Tiempo"}),e.jsx(l,{children:"Fecha"}),e.jsx(l,{children:"Acciones"})]})}),e.jsx(re,{children:t.data.map(s=>{const a=pe[s.estado],p=a?.icon||z;return e.jsxs(P,{children:[e.jsx(r,{children:e.jsxs("div",{children:[e.jsx(j,{href:`/admin/importaciones/${s.id}`,className:"font-medium hover:underline",children:s.nombre}),s.descripcion&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.descripcion})]})}),e.jsx(r,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:D[s.tipo]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:v[s.tipo]}),e.jsxs("div",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[fe[s.formato_origen],s.formato_origen.toUpperCase()]})]})]})}),e.jsxs(r,{children:[e.jsxs(ae,{className:a?.color,children:[e.jsx(p,{className:"h-3 w-3 mr-1"}),a?.label||s.estado]}),s.mensaje_error&&e.jsxs("p",{className:"text-xs text-red-600 mt-1",children:[s.mensaje_error.substring(0,50),"..."]})]}),e.jsx(r,{children:s.estado==="procesando"?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{children:[s.registros_procesados," / ",s.total_registros]}),e.jsxs("span",{className:"font-medium",children:[s.porcentaje_avance.toFixed(1),"%"]})]}),e.jsx(de,{value:s.porcentaje_avance,className:"h-2"})]}):s.estado==="completada"?e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"text-green-600",children:"✓ Completada"}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.total_registros," registros"]})]}):e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.total_registros," registros"]})}),e.jsxs(r,{children:[s.estado==="completada"&&e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"text-green-600",children:["✓ ",s.registros_exitosos," exitosos"]}),s.registros_fallidos>0&&e.jsxs("div",{className:"text-red-600",children:["✗ ",s.registros_fallidos," fallidos"]})]}),s.estado==="fallida"&&e.jsx("div",{className:"text-sm text-red-600",children:"Error en procesamiento"})]}),e.jsx(r,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:s.usuario?.name||"Usuario no disponible"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.usuario?.email||"Email no disponible"})]})]})}),e.jsx(r,{children:e.jsx("div",{className:"text-sm",children:O(s.tiempo_procesamiento)})}),e.jsx(r,{children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{children:y(s.created_at)}),s.fecha_finalizacion&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Fin: ",y(s.fecha_finalizacion)]})]})}),e.jsx(r,{children:e.jsxs(Q,{children:[e.jsx(W,{asChild:!0,children:e.jsx(d,{variant:"ghost",className:"h-8 w-8 p-0",children:e.jsx(ue,{className:"h-4 w-4"})})}),e.jsxs(Y,{align:"end",children:[e.jsx(Z,{children:"Acciones"}),e.jsx(x,{asChild:!0,children:e.jsxs(j,{href:`/admin/importaciones/${s.id}`,children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Ver detalles"]})}),s.estado==="pendiente"&&e.jsxs(x,{onClick:()=>U(s.id),children:[e.jsx(N,{className:"h-4 w-4 mr-2"}),"Procesar"]}),(s.estado==="pendiente"||s.estado==="procesando")&&e.jsxs(x,{onClick:()=>V(s.id),children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Cancelar"]}),e.jsx(T,{}),s.archivos_generados.map(o=>e.jsx(x,{asChild:!0,children:e.jsxs("a",{href:`/admin/importaciones/${s.id}/descargar/${o.tipo}`,children:[e.jsx(u,{className:"h-4 w-4 mr-2"}),o.nombre]})},o.tipo)),(s.estado==="pendiente"||s.estado==="fallida"||s.estado==="cancelada")&&e.jsxs(e.Fragment,{children:[e.jsx(T,{}),e.jsxs(x,{onClick:()=>G(s.id),className:"text-red-600",children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Eliminar"]})]})]})]})})]},s.id)})})]}),t.data.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(u,{className:"h-12 w-12 mx-auto text-muted-foreground opacity-50"}),e.jsx("h3",{className:"mt-4 text-lg font-semibold",children:"No hay importaciones"}),e.jsx("p",{className:"text-muted-foreground",children:"No se encontraron importaciones con los filtros aplicados."}),e.jsx(d,{asChild:!0,className:"mt-4",children:e.jsx(j,{href:"/admin/importaciones/crear",children:"Crear primera importación"})})]})]}),t.meta.last_page>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Mostrando ",t.meta.from," a ",t.meta.to," de ",t.meta.total," resultados"]}),e.jsx("div",{className:"flex items-center space-x-2",children:t.links.map((s,a)=>e.jsx(d,{variant:s.active?"default":"outline",size:"sm",disabled:!s.url,onClick:()=>s.url&&i.get(s.url),dangerouslySetInnerHTML:{__html:s.label}},a))})]})]})]})]})]})}export{Oe as default};
