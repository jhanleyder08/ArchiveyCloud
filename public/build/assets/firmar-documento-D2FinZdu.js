import{u as S,j as e,H as A}from"./app-qt2VCSHW.js";import{A as F}from"./app-layout-BCZxZifr.js";import{c as D,B as N}from"./button-DFXYzV2Z.js";import{C as d,a as o,b as n,c as m,d as E}from"./card-DWiMLnI2.js";import{L as s}from"./label-Bpt8UETt.js";import{S as x,a as h,b as j,c as p,d as c}from"./select-Dx62Pp_e.js";import{I as _}from"./input-CfE4Xz_e.js";import{B as H}from"./Combination-CoqYx7MN.js";import{C as w}from"./checkbox-D-70ECyu.js";import{A as k,b as z,a as L}from"./alert-Bnwym567.js";import{A as P}from"./app-sidebar-layout-G6-wDKKL.js";import{C as V}from"./circle-alert-BfA0k-TX.js";/* empty css            */import"./index-VNIC8-9Y.js";import"./index-BZgYwWWx.js";import"./index-DAU4uJyH.js";import"./check-BtaW2LyL.js";import"./index-DnmBUpJw.js";import"./x-BxMqO2Dk.js";import"./app-logo-icon-B2qWlKKR.js";import"./user-DeQjT80T.js";import"./mail-DfyVAEco.js";import"./users-DgarvUGi.js";import"./folder-BdePZ2wi.js";import"./triangle-alert-B9FT7Ibe.js";import"./search-DaadPwJz.js";import"./BrandingProvider-kslcjmn_.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],b=D("ShieldCheck",T);function me({documento:a,certificados:f,firmas_existentes:u,opciones_firma:g}){const{data:r,setData:l,post:C,processing:v,errors:t}=S({certificado_id:"",tipo_firma:g?.tipo_defecto||"PADES",nivel_firma:g?.nivel_defecto||"T",algoritmo_hash:"SHA-256",incluir_sellado_tiempo:!0,razon_firma:"Aprobación de documento",ubicacion_firma:"Bogotá, D.C.",politica_firma:""}),y=i=>{i.preventDefault(),C(route("admin.firmas.documento.procesar",{documento:a.id}))};return e.jsxs(F,{breadcrumbs:[{title:"Firmas Digitales",href:"/admin/firmas"},{title:"Firmar Documento",href:"#"}],children:[e.jsx(A,{title:`Firmar - ${a.codigo_documento}`}),e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Firmar Documento"}),e.jsxs("p",{className:"text-gray-500",children:["Firma digital para ",a.codigo_documento]})]}),e.jsxs(N,{variant:"outline",onClick:()=>window.history.back(),children:[e.jsx(P,{className:"mr-2 h-4 w-4"}),"Volver"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"md:col-span-1 space-y-6",children:[e.jsxs(d,{children:[e.jsx(o,{children:e.jsx(n,{children:"Información del Documento"})}),e.jsxs(m,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(s,{className:"text-xs text-gray-500",children:"Código"}),e.jsx("p",{className:"font-medium",children:a.codigo_documento})]}),e.jsxs("div",{children:[e.jsx(s,{className:"text-xs text-gray-500",children:"Título"}),e.jsx("p",{className:"font-medium",children:a.titulo})]}),e.jsxs("div",{children:[e.jsx(s,{className:"text-xs text-gray-500",children:"Versión"}),e.jsxs("p",{className:"font-medium",children:["v",a.version_mayor,".",a.version_menor]})]}),e.jsxs("div",{children:[e.jsx(s,{className:"text-xs text-gray-500",children:"Estado"}),e.jsx(H,{variant:a.estado_firma==="firmado"?"default":"secondary",children:a.estado_firma==="firmado"?"Firmado":"Pendiente de Firma"})]})]})]}),u.length>0&&e.jsxs(d,{children:[e.jsx(o,{children:e.jsx(n,{children:"Firmas Existentes"})}),e.jsx(m,{children:e.jsx("ul",{className:"space-y-4",children:u.map(i=>e.jsxs("li",{className:"border-b pb-2 last:border-0 last:pb-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"font-medium text-sm",children:i.usuario?.name})]}),e.jsx("p",{className:"text-xs text-gray-500 ml-6",children:new Date(i.fecha_firma).toLocaleString()})]},i.id))})})]})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsxs(d,{children:[e.jsxs(o,{children:[e.jsx(n,{children:"Configuración de Firma"}),e.jsx(E,{children:"Seleccione su certificado y configure los parámetros de la firma digital."})]}),e.jsx(m,{children:e.jsx("form",{onSubmit:y,className:"space-y-6",children:f.length===0?e.jsxs(k,{variant:"destructive",children:[e.jsx(V,{className:"h-4 w-4"}),e.jsx(z,{children:"Sin certificados"}),e.jsx(L,{children:"No tiene certificados digitales válidos para firmar. Por favor, importe o solicite un certificado."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(s,{htmlFor:"certificado",children:"Certificado Digital"}),e.jsxs(x,{value:r.certificado_id,onValueChange:i=>l("certificado_id",i),children:[e.jsx(h,{className:t.certificado_id?"border-red-500":"",children:e.jsx(j,{placeholder:"Seleccione un certificado..."})}),e.jsx(p,{children:f.map(i=>e.jsxs(c,{value:i.id.toString(),children:[i.subject?.CN||i.nombre_certificado||"Certificado sin nombre",e.jsxs("span",{className:"text-xs text-gray-400 ml-2",children:["(Vence: ",new Date(i.fecha_vencimiento).toLocaleDateString(),")"]})]},i.id))})]}),t.certificado_id&&e.jsx("p",{className:"text-sm text-red-500",children:t.certificado_id})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(s,{htmlFor:"tipo_firma",children:"Tipo de Firma"}),e.jsxs(x,{value:r.tipo_firma,onValueChange:i=>l("tipo_firma",i),disabled:!0,children:[e.jsx(h,{children:e.jsx(j,{})}),e.jsxs(p,{children:[e.jsx(c,{value:"PADES",children:"PAdES (PDF)"}),e.jsx(c,{value:"XADES",children:"XAdES (XML)"}),e.jsx(c,{value:"CADES",children:"CAdES (Binario)"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(s,{htmlFor:"algoritmo",children:"Algoritmo Hash"}),e.jsxs(x,{value:r.algoritmo_hash,onValueChange:i=>l("algoritmo_hash",i),children:[e.jsx(h,{children:e.jsx(j,{})}),e.jsxs(p,{children:[e.jsx(c,{value:"SHA-256",children:"SHA-256"}),e.jsx(c,{value:"SHA-384",children:"SHA-384"}),e.jsx(c,{value:"SHA-512",children:"SHA-512"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(s,{htmlFor:"razon",children:"Razón de la Firma"}),e.jsx(_,{id:"razon",value:r.razon_firma,onChange:i=>l("razon_firma",i.target.value),placeholder:"Ej: Aprobación, Revisión, Autoría..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(s,{htmlFor:"ubicacion",children:"Ubicación"}),e.jsx(_,{id:"ubicacion",value:r.ubicacion_firma,onChange:i=>l("ubicacion_firma",i.target.value),placeholder:"Ciudad, País"})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-2",children:[e.jsx(w,{id:"timestamp",checked:r.incluir_sellado_tiempo,onCheckedChange:i=>l("incluir_sellado_tiempo",i)}),e.jsx(s,{htmlFor:"timestamp",className:"font-normal cursor-pointer",children:"Incluir sellado de tiempo (Timestamp)"})]}),e.jsx("div",{className:"pt-4 flex justify-end",children:e.jsx(N,{type:"submit",disabled:v||!r.certificado_id,className:"bg-[#2a3d83] hover:bg-[#1e2b5f]",children:v?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin mr-2",children:"⏳"}),"Procesando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"mr-2 h-4 w-4"}),"Firmar Documento"]})})})]})})})]})})]})]})]})}export{me as default};
