import{r as d,u as R,j as e,H as X,L as q}from"./app-DmFTQNHU.js";import{A as $}from"./app-layout-CF5PBVMg.js";import{B as o}from"./button-B9uqYTIR.js";import{C as m,a as x,b as h,d as b,c as p}from"./card-98qlzFSI.js";import{L as f}from"./label-CYYsus1F.js";import{I as L}from"./input-CXpCTHGE.js";import{G as J,T as K}from"./app-sidebar-layout-B4-tSBlc.js";import{S as B,a as F,b as I,c as W,d as E}from"./select-CTcGm3Mb.js";import{F as T,B as V}from"./Combination-DB4vhy5A.js";import{A as O,a as Q}from"./alert--kr5pmD-.js";import{C as Y}from"./circle-check-big-DyCuRV4E.js";import{S as Z}from"./search-BECONtiU.js";import{P as ee}from"./plus-B4IyCcb9.js";import{U as se}from"./users-CA6jkooN.js";import{X as ae}from"./x-D4OXCe6m.js";import{C as te}from"./circle-alert-DE-KmadQ.js";import{C as re}from"./folder-CyqBlkrb.js";/* empty css            */import"./index-BBDU3XkM.js";import"./index-6lxVY5DU.js";import"./index-D6-3VAHV.js";import"./app-logo-icon-B1r3bsQj.js";import"./user-2vHAz8tr.js";import"./mail-i7usF0Qz.js";import"./triangle-alert-Qv0vinvY.js";import"./BrandingProvider-BKZadETt.js";import"./index-_200N-9v.js";import"./check-kl6Xjmwn.js";function Ie({documento:N,usuarios_disponibles:y=[],documentos_disponibles:j=[],workflows_disponibles:u=[],tipo_entidad:P="documento"}){const[r,w]=d.useState([]),[i,S]=d.useState(N||null),[C,ie]=d.useState(u.length>0?u[0]:null),[g,A]=d.useState(""),{data:c,setData:n,post:z,processing:D,errors:t}=R({workflow_id:u.length>0?u[0].id.toString():"",entidad_tipo:P,entidad_id:N?.id.toString()||"",aprobadores:[],prioridad:"normal",dias_limite:7,comentarios:""}),v=d.useMemo(()=>{if(!g.trim())return j.slice(0,20);const s=g.toLowerCase();return j.filter(a=>a.nombre.toLowerCase().includes(s)||a.codigo.toLowerCase().includes(s)||a.expediente?.titulo?.toLowerCase().includes(s)||a.expediente?.numero?.toLowerCase().includes(s)).slice(0,20)},[j,g]),H=s=>{S(s),n("entidad_id",s.id.toString()),A("")},k=[{valor:"urgente",etiqueta:"Urgente",color:"text-red-600"},{valor:"alta",etiqueta:"Alta",color:"text-orange-600"},{valor:"normal",etiqueta:"Normal",color:"text-blue-600"},{valor:"baja",etiqueta:"Baja",color:"text-gray-600"}],U=s=>{s.preventDefault(),!(!i||!C)&&z("/admin/workflow",{preserveScroll:!0,onSuccess:()=>{}})},G=s=>{if(!r.find(a=>a.id===s.id)){const a=[...r,s];w(a),n("aprobadores",a.map(l=>l.id))}},M=s=>{const a=r.filter(l=>l.id!==s);w(a),n("aprobadores",a.map(l=>l.id))},_=k.find(s=>s.valor===c.prioridad);return e.jsxs($,{children:[e.jsx(X,{title:"Nuevo Workflow de Aprobación"}),e.jsxs("div",{className:"container mx-auto py-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(J,{className:"w-8 h-8 text-blue-600"}),"Nuevo Workflow de Aprobación"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Inicia un proceso de aprobación para un documento"})]}),e.jsx(q,{href:"/admin/workflow",children:e.jsx(o,{variant:"outline",children:"Volver a Workflows"})})]}),e.jsx("form",{onSubmit:U,className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(m,{children:[e.jsxs(x,{children:[e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5"}),"Documento a Aprobar"]}),e.jsx(b,{children:"Selecciona el documento que necesita aprobación"})]}),e.jsx(p,{children:i?e.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Y,{className:"w-5 h-5 text-green-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-green-900",children:i.nombre}),e.jsxs("p",{className:"text-sm text-green-700",children:["Código: ",i.codigo]}),i.expediente&&e.jsxs("p",{className:"text-sm text-green-600 mt-1",children:["Expediente: ",i.expediente.numero," - ",i.expediente.titulo]})]})]}),e.jsx(o,{type:"button",variant:"outline",size:"sm",onClick:()=>{S(null),n("entidad_id","")},children:"Cambiar"})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(L,{placeholder:"Buscar documento por nombre, código o expediente...",value:g,onChange:s=>A(s.target.value),className:`pl-10 ${t.entidad_id?"border-red-500":""}`})]}),t.entidad_id&&e.jsx("p",{className:"text-sm text-red-600",children:t.entidad_id}),e.jsx("div",{className:"max-h-64 overflow-y-auto border rounded-lg divide-y",children:v.length>0?v.map(s=>e.jsx("div",{className:"p-3 hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>H(s),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.nombre}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(V,{variant:"outline",className:"text-xs",children:s.codigo}),s.expediente&&e.jsxs("span",{className:"text-xs text-gray-500",children:["Exp: ",s.expediente.numero]}),s.fecha&&e.jsx("span",{className:"text-xs text-gray-400",children:s.fecha})]})]}),e.jsx(o,{type:"button",variant:"ghost",size:"sm",children:e.jsx(ee,{className:"w-4 h-4"})})]})},s.id)):e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx(T,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"No se encontraron documentos"}),e.jsx("p",{className:"text-sm",children:"Intenta con otra búsqueda"})]})}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Mostrando ",v.length," de ",j.length," documentos disponibles"]})]})})]}),e.jsxs(m,{children:[e.jsxs(x,{children:[e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-5 h-5"}),"Aprobadores"]}),e.jsx(b,{children:"Selecciona los usuarios que deben aprobar este documento"})]}),e.jsxs(p,{className:"space-y-4",children:[r.length>0&&e.jsxs("div",{children:[e.jsxs(f,{className:"text-sm font-medium",children:["Aprobadores Seleccionados (",r.length,")"]}),e.jsx("div",{className:"space-y-2 mt-2",children:r.map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center text-sm font-medium text-blue-600",children:a+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.cargo})]})]}),e.jsx(o,{type:"button",variant:"ghost",size:"sm",onClick:()=>M(s.id),children:e.jsx(ae,{className:"w-4 h-4"})})]},s.id))})]}),e.jsxs("div",{children:[e.jsx(f,{htmlFor:"nuevo_aprobador",children:"Agregar Aprobador"}),e.jsxs(B,{onValueChange:s=>{const a=y.find(l=>l.id.toString()===s);a&&G(a)},children:[e.jsx(F,{children:e.jsx(I,{placeholder:"Seleccionar usuario..."})}),e.jsx(W,{children:y.filter(s=>!r.find(a=>a.id===s.id)).map(s=>e.jsx(E,{value:s.id.toString(),children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.cargo," - ",s.email]})]})},s.id))})]})]}),r.length===0&&e.jsxs(O,{children:[e.jsx(te,{className:"h-4 w-4"}),e.jsx(Q,{children:"Debes seleccionar al menos un aprobador para continuar."})]})]})]}),e.jsxs(m,{children:[e.jsxs(x,{children:[e.jsx(h,{children:"Descripción de la Solicitud"}),e.jsx(b,{children:"Explica por qué este documento necesita aprobación"})]}),e.jsxs(p,{children:[e.jsx(K,{placeholder:"Describe el motivo de la aprobación, contexto adicional, o instrucciones específicas...",value:c.comentarios,onChange:s=>n("comentarios",s.target.value),rows:4,className:t.comentarios?"border-red-500":""}),t.comentarios&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:t.comentarios})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(m,{children:[e.jsx(x,{children:e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5"}),"Configuración"]})}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(f,{children:"Prioridad *"}),e.jsxs(B,{value:c.prioridad.toString(),onValueChange:s=>n("prioridad",s),children:[e.jsx(F,{children:e.jsx(I,{})}),e.jsx(W,{children:k.map(s=>e.jsx(E,{value:s.valor.toString(),children:e.jsx("span",{className:s.color,children:s.etiqueta})},s.valor))})]}),t.prioridad&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:t.prioridad})]}),e.jsxs("div",{children:[e.jsx(f,{htmlFor:"dias_limite",children:"Días para vencer *"}),e.jsx(L,{id:"dias_limite",type:"number",min:"1",max:"30",value:c.dias_limite,onChange:s=>n("dias_limite",parseInt(s.target.value)||7),className:t.dias_limite?"border-red-500":""}),t.dias_limite&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:t.dias_limite}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Fecha de vencimiento: ",new Date(Date.now()+c.dias_limite*24*60*60*1e3).toLocaleDateString()]})]})]})]}),e.jsxs(m,{children:[e.jsx(x,{children:e.jsx(h,{children:"Resumen"})}),e.jsxs(p,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Documento:"}),e.jsx("span",{className:"text-sm font-medium",children:N?"✓":"✗"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Aprobadores:"}),e.jsx("span",{className:"text-sm font-medium",children:r.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Prioridad:"}),e.jsx(V,{variant:"outline",className:_?.color,children:_?.etiqueta})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Vencimiento:"}),e.jsxs("span",{className:"text-sm font-medium",children:[c.dias_limite," días"]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(o,{type:"submit",className:"w-full",disabled:D||!i||!C,children:D?"Creando...":"Iniciar Workflow"}),e.jsx(q,{href:"/admin/workflow",children:e.jsx(o,{variant:"outline",className:"w-full",children:"Cancelar"})})]})]})]})})]})]})}export{Ie as default};
