import{r as g,j as e,H as M,L as O,a as m}from"./app-B-PXR1Ni.js";import{a as D,C as v,A as X,X as z,F as d,d as _,r as G,p as N}from"./app-sidebar-layout-D9ulO2li.js";import{B as c}from"./app-logo-icon-BLsuM4IN.js";import{C as t,d as l,a as n,b as o,c as J}from"./card-Dmlm_cpt.js";import{B as K}from"./badge-CNo-IL5x.js";import{P as T}from"./progress-CUNoMPit.js";import{T as Q,a as W,b as h,c as j}from"./tabs-Dnq90kir.js";import{A as Y,a as Z}from"./alert-CjcJnkq6.js";import{T as ee,a as se,b as A,c as I,d as ae,e as E}from"./table-DYV7DOqP.js";import{C as F}from"./circle-x-D_Rev0Iw.js";import{C as P}from"./circle-check-big-vwlwSDoT.js";import{P as L}from"./play-CZ6B1VkI.js";import{A as re}from"./arrow-left-DbMIHj5m.js";import{A as S}from"./activity-C6UpYrzU.js";import{T as te}from"./trash-2-v8S4Iyw0.js";import{C as le}from"./calendar-CQqh5lbn.js";/* empty css            */import"./index-DsJw0RIA.js";import"./label-CcIhawib.js";import"./index-DARluDlH.js";const $={expedientes:"Expedientes",documentos:"Documentos",series:"Series Documentales",usuarios:"Usuarios",certificados:"Certificados"},ie={pendiente:{icon:v,color:"bg-yellow-100 text-yellow-800",label:"Pendiente"},procesando:{icon:L,color:"bg-blue-100 text-blue-800",label:"Procesando"},completada:{icon:P,color:"bg-green-100 text-green-800",label:"Completada"},fallida:{icon:F,color:"bg-red-100 text-red-800",label:"Fallida"},cancelada:{icon:D,color:"bg-gray-100 text-gray-800",label:"Cancelada"}};function Ae({importacion:s,archivosGenerados:b,puedeEditar:w,puedeEliminar:U}){const[a,k]=g.useState(s),[p,u]=g.useState(s.estado==="procesando");g.useEffect(()=>{if(!p||s.estado!=="procesando")return;const r=setInterval(async()=>{try{const x=await(await fetch(`/admin/importaciones/${s.id}/progreso`)).json();k(q=>({...q,...x})),x.estado!=="procesando"&&(u(!1),window.location.reload())}catch(i){console.error("Error obteniendo progreso:",i)}},5e3);return()=>clearInterval(r)},[p,s.id,s.estado]);const B=()=>{m.post(`/admin/importaciones/${s.id}/procesar`,{},{onSuccess:()=>u(!0)})},R=()=>{confirm("¿Estás seguro de que deseas cancelar esta importación?")&&m.post(`/admin/importaciones/${s.id}/cancelar`,{},{onSuccess:()=>u(!1)})},H=()=>{confirm("¿Estás seguro de que deseas eliminar esta importación?")&&m.delete(`/admin/importaciones/${s.id}`,{onSuccess:()=>m.visit("/admin/importaciones/listado")})},C=r=>{if(!r)return"-";if(r<60)return`${r}s`;const i=Math.floor(r/60),x=r%60;return`${i}m ${x}s`},y=r=>new Date(r).toLocaleString(),f=ie[s.estado],V=f?.icon||v;return e.jsxs(X,{children:[e.jsx(M,{title:`Importación: ${s.nombre}`}),e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(c,{variant:"outline",asChild:!0,children:e.jsxs(O,{href:"/admin/importaciones/listado",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Volver"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:s.nombre}),e.jsx("p",{className:"text-muted-foreground",children:s.descripcion||"Sin descripción"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[p&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(S,{className:"h-4 w-4 text-green-500 animate-pulse"}),"Auto-actualizando..."]}),s.estado==="pendiente"&&w&&e.jsxs(c,{onClick:B,children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Procesar"]}),(s.estado==="pendiente"||s.estado==="procesando")&&w&&e.jsxs(c,{variant:"outline",onClick:R,children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Cancelar"]}),U&&e.jsxs(c,{variant:"destructive",onClick:H,children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Eliminar"]})]})]}),e.jsx(t,{children:e.jsxs(l,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(V,{className:"h-8 w-8"}),e.jsxs("div",{children:[e.jsx(K,{className:`${f?.color} text-lg px-3 py-1`,children:f?.label||s.estado}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[$[s.tipo]," • ",s.formato_origen.toUpperCase()]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold",children:[a.registros_procesados," / ",a.total_registros]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"registros procesados"})]})]}),s.estado==="procesando"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Progreso general"}),e.jsxs("span",{className:"font-medium",children:[a.porcentaje_avance.toFixed(1),"%"]})]}),e.jsx(T,{value:a.porcentaje_avance,className:"h-3"}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[e.jsxs("span",{children:["Iniciado: ",a.fecha_inicio?y(a.fecha_inicio):"-"]}),e.jsxs("span",{children:["Tiempo: ",C(a.tiempo_procesamiento)]})]})]}),s.mensaje_error&&e.jsxs(Y,{variant:"destructive",className:"mt-4",children:[e.jsx(D,{className:"h-4 w-4"}),e.jsxs(Z,{children:[e.jsx("strong",{children:"Error:"})," ",s.mensaje_error]})]})]})}),e.jsxs(Q,{defaultValue:"detalles",className:"space-y-6",children:[e.jsxs(W,{children:[e.jsx(h,{value:"detalles",children:"Detalles"}),e.jsx(h,{value:"estadisticas",children:"Estadísticas"}),e.jsx(h,{value:"configuracion",children:"Configuración"}),e.jsx(h,{value:"archivos",children:"Archivos"})]}),e.jsx(j,{value:"detalles",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(t,{children:[e.jsx(n,{children:e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(d,{className:"h-5 w-5"}),"Información General"]})}),e.jsx(l,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"ID:"}),e.jsx("p",{children:s.id})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Tipo:"}),e.jsx("p",{children:$[s.tipo]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Formato:"}),e.jsx("p",{children:s.formato_origen.toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Total registros:"}),e.jsx("p",{children:s.total_registros.toLocaleString()})]})]})})]}),e.jsxs(t,{children:[e.jsx(n,{children:e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"h-5 w-5"}),"Usuario y Fechas"]})}),e.jsx(l,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-sm",children:"Creado por:"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(_,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.usuario?.name||"Usuario no disponible"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.usuario?.email||"Email no disponible"})]})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-sm",children:"Fecha de creación:"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(le,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("p",{children:y(s.created_at)})]})]}),s.tiempo_procesamiento&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-sm",children:"Tiempo de procesamiento:"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(v,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("p",{children:C(s.tiempo_procesamiento)})]})]})]})})]})]})}),e.jsxs(j,{value:"estadisticas",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6",children:[e.jsx(t,{children:e.jsx(l,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total"}),e.jsx("p",{className:"text-2xl font-bold",children:s.total_registros})]}),e.jsx(d,{className:"h-8 w-8 text-blue-600"})]})})}),e.jsx(t,{children:e.jsx(l,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Procesados"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:a.registros_procesados})]}),e.jsx(S,{className:"h-8 w-8 text-blue-600"})]})})}),e.jsx(t,{children:e.jsx(l,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Exitosos"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:a.registros_exitosos})]}),e.jsx(P,{className:"h-8 w-8 text-green-600"})]})})}),e.jsx(t,{children:e.jsx(l,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Fallidos"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:a.registros_fallidos})]}),e.jsx(F,{className:"h-8 w-8 text-red-600"})]})})})]}),s.estado==="completada"&&e.jsxs(t,{children:[e.jsx(n,{children:e.jsx(o,{children:"Resumen de Resultados"})}),e.jsx(l,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Tasa de éxito:"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:[(a.registros_exitosos/a.total_registros*100).toFixed(1),"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Tasa de error:"}),e.jsxs("p",{className:"text-2xl font-bold text-red-600",children:[(a.registros_fallidos/a.total_registros*100).toFixed(1),"%"]})]})]}),e.jsx(T,{value:a.registros_exitosos/a.total_registros*100,className:"h-4"})]})})]})]}),e.jsx(j,{value:"configuracion",children:e.jsxs(t,{children:[e.jsx(n,{children:e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5"}),"Configuración de Importación"]})}),e.jsx(l,{children:s.configuracion?e.jsx("div",{className:"space-y-6",children:s.configuracion.mapeo&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-3",children:"Mapeo de Campos"}),e.jsxs(ee,{children:[e.jsx(se,{children:e.jsxs(A,{children:[e.jsx(I,{children:"Campo del Sistema"}),e.jsx(I,{children:"Campo del Archivo"})]})}),e.jsx(ae,{children:Object.entries(s.configuracion.mapeo).map(([r,i])=>e.jsxs(A,{children:[e.jsx(E,{className:"font-medium",children:r}),e.jsx(E,{children:i})]},r))})]})]})}):e.jsx("p",{className:"text-muted-foreground",children:"No hay configuración específica disponible."})})]})}),e.jsx(j,{value:"archivos",children:e.jsxs(t,{children:[e.jsxs(n,{children:[e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(N,{className:"h-5 w-5"}),"Archivos de la Importación"]}),e.jsx(J,{children:"Descarga los archivos originales y generados durante el procesamiento"})]}),e.jsx(l,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(d,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Archivo Original"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.archivo_origen," • ",s.formato_origen.toUpperCase()]})]})]}),e.jsx(c,{variant:"outline",asChild:!0,children:e.jsxs("a",{href:`/admin/importaciones/${s.id}/descargar/original`,children:[e.jsx(N,{className:"h-4 w-4 mr-2"}),"Descargar"]})})]}),b.map(r=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(d,{className:"h-8 w-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:r.nombre}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Generado durante el procesamiento"})]})]}),e.jsx(c,{variant:"outline",asChild:!0,children:e.jsxs("a",{href:`/admin/importaciones/${s.id}/descargar/${r.tipo}`,children:[e.jsx(N,{className:"h-4 w-4 mr-2"}),"Descargar"]})})]},r.tipo)),b.length===0&&s.estado!=="pendiente"&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(d,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No hay archivos generados disponibles"})]})]})})]})})]})]})]})}export{Ae as default};
