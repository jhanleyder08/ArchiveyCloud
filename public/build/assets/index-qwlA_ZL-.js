import{r as F,j as e,H as W,L as N,a as u}from"./app-B-PXR1Ni.js";import{A as J,e as Q,b as Z,c as v,a as y,S as p,d as b,C as ee}from"./app-sidebar-layout-D9ulO2li.js";import{B as m}from"./app-logo-icon-BLsuM4IN.js";import{C as l,d as r,a as h,b as j,c as se}from"./card-Dmlm_cpt.js";import{I as _}from"./label-CcIhawib.js";import{S as w,a as C,b as T,c as A,d as o}from"./select-B6s0-YwG.js";import{B as ae}from"./badge-CNo-IL5x.js";import{T as ie,a as le,b as E,c as n,d as re,e as d}from"./table-DYV7DOqP.js";import{T as te,a as ce,b as S,c as R}from"./tabs-Dnq90kir.js";import{R as ne}from"./refresh-cw-3XorCIzG.js";import{G as D}from"./globe-kxoIynx8.js";import{F as de}from"./filter-CRdJDhgp.js";import{E as oe}from"./eye-m25VD-li.js";import{R as L,T as B}from"./CategoricalChart-CH0D5Ee9.js";import{P as xe,a as me}from"./PieChart-B11HO8ai.js";import{C as he}from"./tooltipContext-A_zzaiNE.js";import{B as je}from"./BarChart-BF04k3Nq.js";import{C as M,X as z,Y as U}from"./CartesianChart-NCe_zQZc.js";import{B as ue}from"./barSelectors-DPP-5Sbk.js";import{L as pe}from"./LineChart-CfePpTbR.js";import{L as ge}from"./Line-DrhZ3KW9.js";import{M as fe}from"./monitor-BguHF5kV.js";/* empty css            */import"./index-DsJw0RIA.js";import"./index-DARluDlH.js";import"./index-CQZ_TJph.js";import"./check-BUuVkhmq.js";import"./ActivePoints-guwd7fUl.js";const Ne={crítico:"#dc2626",alto:"#ea580c",medio:"#d97706",bajo:"#16a34a"};function qe({eventos:a,estadisticas:c,usuarios:V,acciones:H,filtros:t,niveles_riesgo:P,categorias_evento:ve}){const[g,K]=F.useState(!1),G=s=>{switch(s){case"crítico":return"destructive";case"alto":return"destructive";case"medio":return"default";case"bajo":return"secondary";default:return"outline"}},O=s=>{switch(s){case"crítico":return e.jsx(y,{className:"h-4 w-4 text-red-500"});case"alto":return e.jsx(y,{className:"h-4 w-4 text-orange-500"});case"medio":return e.jsx(ee,{className:"h-4 w-4 text-yellow-500"});case"bajo":return e.jsx(p,{className:"h-4 w-4 text-green-500"});default:return e.jsx(p,{className:"h-4 w-4 text-gray-500"})}},$=s=>{const f={autenticacion:b,gestion_usuarios:b,gestion_documentos:FileText,gestion_expedientes:Briefcase,seguridad:p,sistema:fe,general:D}[s]||D;return e.jsx(f,{className:"h-4 w-4"})},x=(s,i)=>{const f=route("admin.auditoria.index",{...t,[s]:i==="all"?"":i,page:1});u.get(f)},X=s=>{const i=route("admin.auditoria.index",{...t,buscar:s,page:1});u.get(i)},I=()=>{u.reload()};F.useEffect(()=>{let s;return g&&(s=setInterval(I,3e4)),()=>{s&&clearInterval(s)}},[g]);const k=c.distribucion_riesgos.map(s=>({name:s.nivel_riesgo,value:s.total,color:Ne[s.nivel_riesgo]||"#gray"})),Y=c.actividad_por_dia.slice(-7).map(s=>({fecha:new Date(s.fecha).toLocaleDateString("es-ES",{month:"short",day:"numeric"}),eventos:s.total})),q=c.acciones_mas_frecuentes.map(s=>({accion:s.accion.replace("_"," "),total:s.total}));return e.jsxs(J,{children:[e.jsx(W,{title:"Auditoría y Trazabilidad Avanzada"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Auditoría y Trazabilidad Avanzada"}),e.jsx("p",{className:"text-muted-foreground",children:"Monitoreo y análisis de actividad del sistema en tiempo real"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"autoRefresh",checked:g,onChange:s=>K(s.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"autoRefresh",className:"text-sm",children:"Auto-refresh"})]}),e.jsxs(m,{variant:"outline",size:"sm",onClick:I,children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Actualizar"]}),e.jsx(N,{href:route("admin.auditoria.analytics"),children:e.jsxs(m,{variant:"outline",children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Analytics"]})}),e.jsx(N,{href:route("admin.auditoria.patrones"),children:e.jsxs(m,{children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Patrones"]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsx(l,{children:e.jsx(r,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(v,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Eventos"}),e.jsx("p",{className:"text-2xl font-bold",children:c.total_eventos.toLocaleString()})]})]})})}),e.jsx(l,{children:e.jsx(r,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(y,{className:"h-8 w-8 text-red-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Eventos Críticos"}),e.jsx("p",{className:"text-2xl font-bold",children:c.eventos_criticos})]})]})})}),e.jsx(l,{children:e.jsx(r,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(p,{className:"h-8 w-8 text-orange-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Alto Riesgo"}),e.jsx("p",{className:"text-2xl font-bold",children:c.eventos_alto_riesgo})]})]})})}),e.jsx(l,{children:e.jsx(r,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(b,{className:"h-8 w-8 text-green-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Usuarios Únicos"}),e.jsx("p",{className:"text-2xl font-bold",children:c.usuarios_unicos})]})]})})}),e.jsx(l,{children:e.jsx(r,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(D,{className:"h-8 w-8 text-purple-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"IPs Únicas"}),e.jsx("p",{className:"text-2xl font-bold",children:c.ips_unicas})]})]})})})]}),e.jsxs(te,{defaultValue:"eventos",className:"space-y-4",children:[e.jsxs(ce,{children:[e.jsx(S,{value:"eventos",children:"Eventos"}),e.jsx(S,{value:"estadisticas",children:"Estadísticas"}),e.jsx(S,{value:"tendencias",children:"Tendencias"})]}),e.jsxs(R,{value:"eventos",className:"space-y-4",children:[e.jsxs(l,{children:[e.jsx(h,{children:e.jsxs(j,{className:"flex items-center",children:[e.jsx(de,{className:"h-5 w-5 mr-2"}),"Filtros de Auditoría"]})}),e.jsx(r,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 xl:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Búsqueda"}),e.jsxs("div",{className:"relative",children:[e.jsx(v,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(_,{placeholder:"Buscar eventos...",defaultValue:t.buscar,className:"pl-9",onChange:s=>{clearTimeout(window.searchTimeout),window.searchTimeout=setTimeout(()=>{X(s.target.value)},500)}})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Usuario"}),e.jsxs(w,{value:t.usuario_id||"all",onValueChange:s=>x("usuario_id",s),children:[e.jsx(C,{children:e.jsx(T,{placeholder:"Todos los usuarios"})}),e.jsxs(A,{children:[e.jsx(o,{value:"all",children:"Todos los usuarios"}),V.map(s=>e.jsx(o,{value:s.id.toString(),children:s.name},s.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Acción"}),e.jsxs(w,{value:t.accion||"all",onValueChange:s=>x("accion",s),children:[e.jsx(C,{children:e.jsx(T,{placeholder:"Todas las acciones"})}),e.jsxs(A,{children:[e.jsx(o,{value:"all",children:"Todas las acciones"}),H.map(s=>e.jsx(o,{value:s,children:s.replace("_"," ")},s))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Nivel de Riesgo"}),e.jsxs(w,{value:t.nivel_riesgo||"all",onValueChange:s=>x("nivel_riesgo",s),children:[e.jsx(C,{children:e.jsx(T,{placeholder:"Todos los niveles"})}),e.jsxs(A,{children:[e.jsx(o,{value:"all",children:"Todos los niveles"}),P.map(s=>e.jsx(o,{value:s,children:s},s))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Fecha Inicio"}),e.jsx(_,{type:"date",value:t.fecha_inicio||"",onChange:s=>x("fecha_inicio",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Fecha Fin"}),e.jsx(_,{type:"date",value:t.fecha_fin||"",onChange:s=>x("fecha_fin",s.target.value)})]})]})})]}),e.jsxs(l,{children:[e.jsxs(h,{children:[e.jsxs(j,{children:["Eventos de Auditoría (",a.meta?.total||0,")"]}),e.jsxs(se,{children:["Mostrando ",a.meta?.from||0," a ",a.meta?.to||0," de ",a.meta?.total||0," eventos"]})]}),e.jsxs(r,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ie,{children:[e.jsx(le,{children:e.jsxs(E,{children:[e.jsx(n,{children:"Riesgo"}),e.jsx(n,{children:"Fecha/Hora"}),e.jsx(n,{children:"Usuario"}),e.jsx(n,{children:"Acción"}),e.jsx(n,{children:"Descripción"}),e.jsx(n,{children:"IP / Ubicación"}),e.jsx(n,{children:"Acciones"})]})}),e.jsx(re,{children:a.data.map(s=>e.jsxs(E,{children:[e.jsx(d,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[O(s.nivel_riesgo),e.jsx(ae,{variant:G(s.nivel_riesgo),children:s.nivel_riesgo})]})}),e.jsx(d,{children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{children:new Date(s.fecha_hora).toLocaleDateString()}),e.jsx("div",{className:"text-gray-500",children:new Date(s.fecha_hora).toLocaleTimeString()})]})}),e.jsx(d,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.usuario?.name||"Sistema"}),e.jsx("div",{className:"text-sm text-gray-500",children:s.usuario?.email})]})}),e.jsx(d,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[$(s.categoria_evento),e.jsx("span",{className:"font-medium",children:s.accion.replace("_"," ")})]})}),e.jsx(d,{children:e.jsx("div",{className:"max-w-xs truncate",title:s.descripcion,children:s.descripcion})}),e.jsx(d,{children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-mono",children:s.ip_address}),e.jsxs("div",{className:"text-gray-500",children:[s.ciudad,", ",s.pais]}),e.jsxs("div",{className:"text-xs text-gray-400",children:[s.dispositivo_tipo," • ",s.navegador]})]})}),e.jsx(d,{children:e.jsx(N,{href:route("admin.auditoria.show",s.id),children:e.jsxs(m,{variant:"outline",size:"sm",children:[e.jsx(oe,{className:"h-4 w-4 mr-1"}),"Ver"]})})})]},s.id))})]})}),a.data.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(v,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No hay eventos"}),e.jsx("p",{className:"text-gray-600",children:Object.keys(t).length>0?"No se encontraron eventos con los filtros aplicados":"No hay eventos de auditoría registrados"})]}),(a.meta?.last_page||0)>1&&e.jsxs("div",{className:"flex items-center justify-between mt-6",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Mostrando ",a.meta?.from||0," a ",a.meta?.to||0," de ",a.meta?.total||0," resultados"]}),e.jsx("div",{className:"flex space-x-1",children:(a.links||[]).map((s,i)=>e.jsx(m,{variant:s.active?"default":"outline",size:"sm",onClick:()=>s.url&&u.get(s.url),disabled:!s.url,dangerouslySetInnerHTML:{__html:s.label}},i))})]})]})]})]}),e.jsx(R,{value:"estadisticas",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(l,{children:[e.jsx(h,{children:e.jsx(j,{children:"Distribución por Nivel de Riesgo"})}),e.jsx(r,{children:e.jsx(L,{width:"100%",height:300,children:e.jsxs(xe,{children:[e.jsx(me,{data:k,cx:"50%",cy:"50%",labelLine:!1,label:({name:s,percent:i})=>`${s} ${(i*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:k.map((s,i)=>e.jsx(he,{fill:s.color},`cell-${i}`))}),e.jsx(B,{})]})})})]}),e.jsxs(l,{children:[e.jsx(h,{children:e.jsx(j,{children:"Acciones Más Frecuentes"})}),e.jsx(r,{children:e.jsx(L,{width:"100%",height:300,children:e.jsxs(je,{data:q,children:[e.jsx(M,{strokeDasharray:"3 3"}),e.jsx(z,{dataKey:"accion"}),e.jsx(U,{}),e.jsx(B,{}),e.jsx(ue,{dataKey:"total",fill:"#3b82f6"})]})})})]})]})}),e.jsx(R,{value:"tendencias",className:"space-y-4",children:e.jsxs(l,{children:[e.jsx(h,{children:e.jsx(j,{children:"Actividad por Día (Últimos 7 días)"})}),e.jsx(r,{children:e.jsx(L,{width:"100%",height:300,children:e.jsxs(pe,{data:Y,children:[e.jsx(M,{strokeDasharray:"3 3"}),e.jsx(z,{dataKey:"fecha"}),e.jsx(U,{}),e.jsx(B,{}),e.jsx(ge,{type:"monotone",dataKey:"eventos",stroke:"#8884d8",strokeWidth:2})]})})})]})})]})]})]})}export{qe as default};
