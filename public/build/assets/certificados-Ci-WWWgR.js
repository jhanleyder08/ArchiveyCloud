import{r as N,j as e,H as X,a as n,L as G}from"./app-bdRnt6Sf.js";import{A as O}from"./app-layout-BYiALk1Q.js";import{c as Z,B as l}from"./app-logo-icon-DuPl4Vop.js";import{C as m,a as h,b as j,c as u,d as J}from"./card-CWT2CaIV.js";import{B as d}from"./badge-D-wVoLf4.js";import{I as Q}from"./label-eR3fV_fB.js";import{S as y,a as C,b as _,c as w,d as t}from"./select-DzSk6AMJ.js";import{T as W,a as Y,b as S,c as g,d as ee,e as o}from"./table-C2WP41hp.js";import{S as se,a as T,D as ae,c as re,d as te,e as le,f as ie,r as ce}from"./app-sidebar-layout-DoFu3WNo.js";import{A as ne,a as de}from"./alert-Bx_vX4ph.js";import{U as oe}from"./upload-J9xdwdAd.js";import{F as xe}from"./filter-C2Iv5b05.js";import{S as V}from"./search-BaIThYiF.js";import{R as me}from"./refresh-cw-COHn_MDI.js";import{C as he}from"./calendar-DzJZtfmj.js";import{E as je}from"./eye-CfI6NocG.js";import{D as R}from"./download-97E7p8pE.js";import{T as ue}from"./trash-2-BpKIrCvl.js";import{C as D}from"./circle-x-CuXE_gGg.js";import{C as ge}from"./circle-check-big-B2fc7sYA.js";/* empty css            */import"./index-Cfqs0Bea.js";import"./index-Bno0nWC5.js";import"./check-DaE5z30e.js";import"./index-Dem53vWf.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["circle",{cx:"10",cy:"16",r:"2",key:"4ckbqe"}],["path",{d:"m16 10-4.5 4.5",key:"7p3ebg"}],["path",{d:"m15 11 1 1",key:"1bsyx3"}]],ve=Z("FileKey",pe);function Ke({certificados:r,filtros:z,usuarios:B,estadisticas:x}){const[c,k]=N.useState(z),[a,H]=N.useState(null),[I,b]=N.useState(!1),[L,A]=N.useState(!1),U=()=>{n.get(route("admin.firmas.certificados"),c,{preserveState:!0,preserveScroll:!0})},P=()=>{k({}),n.get(route("admin.firmas.certificados"))},v=(s,i)=>{const p={...c};p[s]=i,(!i||i==="all")&&delete p[s],k(p)},E=(s,i)=>{if(!i)return e.jsx(d,{variant:"destructive",children:"Vencido"});switch(s){case"activo":return e.jsx(d,{className:"bg-green-500 text-white",children:"Activo"});case"vencido":return e.jsx(d,{variant:"destructive",children:"Vencido"});case"revocado":return e.jsx(d,{className:"bg-red-600 text-white",children:"Revocado"});case"suspendido":return e.jsx(d,{className:"bg-orange-500 text-white",children:"Suspendido"});default:return e.jsx(d,{variant:"secondary",children:s})}},F=s=>{const p={usuario:{color:"bg-blue-500 text-white",label:"Usuario"},servidor:{color:"bg-purple-500 text-white",label:"Servidor"},autoridad_certificadora:{color:"bg-indigo-600 text-white",label:"AC"},sello_tiempo:{color:"bg-teal-500 text-white",label:"TSA"}}[s]||{color:"bg-gray-500 text-white",label:s};return e.jsx(d,{className:p.color,children:p.label})},q=(s,i)=>{if(!i)return e.jsx(D,{className:"w-4 h-4 text-red-600"});switch(s){case"activo":return e.jsx(ge,{className:"w-4 h-4 text-green-600"});case"vencido":return e.jsx(D,{className:"w-4 h-4 text-red-600"});case"revocado":return e.jsx(D,{className:"w-4 h-4 text-red-600"});case"suspendido":return e.jsx(T,{className:"w-4 h-4 text-orange-600"});default:return e.jsx(T,{className:"w-4 h-4 text-gray-600"})}},f=s=>new Date(s).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"}),M=s=>s<0?"Vencido":s===0?"Hoy":s===1?"Mañana":`${s} días`,K=async s=>{if(confirm(`¿Estás seguro de revocar el certificado ${s.nombre_certificado}?`)){A(!0);try{await n.post(route("admin.firmas.certificado.revocar",s.id),{razon:"Revocación manual por administrador"})}finally{A(!1)}}},$=s=>{H(s),b(!0)};return e.jsxs(O,{children:[e.jsx(X,{title:"Certificados Digitales"}),e.jsx("div",{className:"py-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"md:flex md:items-center md:justify-between mb-6",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h2",{className:"text-2xl font-bold leading-7 text-gray-900 sm:text-3xl sm:truncate",children:"Certificados Digitales PKI 🔐"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Gestión de certificados X.509 para firma electrónica"})]}),e.jsxs("div",{className:"mt-4 flex md:mt-0 md:ml-4 space-x-3",children:[e.jsxs(l,{onClick:()=>n.get(route("admin.firmas.certificado.crear")),children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"Importar Certificado"]}),e.jsx(G,{href:route("admin.firmas.dashboard"),children:e.jsxs(l,{variant:"outline",children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Dashboard"]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-6",children:[e.jsxs(m,{children:[e.jsx(h,{className:"pb-2",children:e.jsx(j,{className:"text-sm font-medium",children:"Total"})}),e.jsxs(u,{children:[e.jsx("div",{className:"text-2xl font-bold",children:x.total}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"certificados"})]})]}),e.jsxs(m,{children:[e.jsx(h,{className:"pb-2",children:e.jsx(j,{className:"text-sm font-medium",children:"Activos"})}),e.jsxs(u,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:x.activos}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"vigentes"})]})]}),e.jsxs(m,{children:[e.jsx(h,{className:"pb-2",children:e.jsx(j,{className:"text-sm font-medium",children:"Próximos a Vencer"})}),e.jsxs(u,{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:x.proximos_vencer}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["<"," 30 días"]})]})]}),e.jsxs(m,{children:[e.jsx(h,{className:"pb-2",children:e.jsx(j,{className:"text-sm font-medium",children:"Vencidos"})}),e.jsxs(u,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:x.vencidos}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"inválidos"})]})]}),e.jsxs(m,{children:[e.jsx(h,{className:"pb-2",children:e.jsx(j,{className:"text-sm font-medium",children:"Revocados"})}),e.jsxs(u,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-800",children:x.revocados}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"cancelados"})]})]})]}),x.proximos_vencer>0&&e.jsxs(ne,{className:"mb-6 border-orange-200 bg-orange-50",children:[e.jsx(T,{className:"h-4 w-4 text-orange-600"}),e.jsxs(de,{className:"text-orange-800",children:["Tienes ",x.proximos_vencer," certificado(s) que vencerán en los próximos 30 días. Es recomendable renovarlos o generar nuevos certificados."]})]}),e.jsxs(m,{className:"mb-6",children:[e.jsx(h,{children:e.jsxs(j,{className:"text-lg flex items-center",children:[e.jsx(xe,{className:"w-5 h-5 mr-2"}),"Filtros de Búsqueda"]})}),e.jsx(u,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Buscar"}),e.jsxs("div",{className:"relative",children:[e.jsx(V,{className:"w-4 h-4 absolute left-3 top-3 text-gray-400"}),e.jsx(Q,{placeholder:"Nombre, serie, emisor...",value:c.search||"",onChange:s=>v("search",s.target.value),className:"pl-10"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Estado"}),e.jsxs(y,{value:c.estado||"all",onValueChange:s=>v("estado",s),children:[e.jsx(C,{children:e.jsx(_,{placeholder:"Todos los estados"})}),e.jsxs(w,{children:[e.jsx(t,{value:"all",children:"Todos los estados"}),e.jsx(t,{value:"activo",children:"Activo"}),e.jsx(t,{value:"vencido",children:"Vencido"}),e.jsx(t,{value:"revocado",children:"Revocado"}),e.jsx(t,{value:"suspendido",children:"Suspendido"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Tipo"}),e.jsxs(y,{value:c.tipo||"all",onValueChange:s=>v("tipo",s),children:[e.jsx(C,{children:e.jsx(_,{placeholder:"Todos los tipos"})}),e.jsxs(w,{children:[e.jsx(t,{value:"all",children:"Todos los tipos"}),e.jsx(t,{value:"usuario",children:"Usuario"}),e.jsx(t,{value:"servidor",children:"Servidor"}),e.jsx(t,{value:"autoridad_certificadora",children:"Autoridad Certificadora"}),e.jsx(t,{value:"sello_tiempo",children:"Sello de Tiempo"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Usuario"}),e.jsxs(y,{value:c.usuario_id?.toString()||"all",onValueChange:s=>v("usuario_id",s==="all"?null:parseInt(s)),children:[e.jsx(C,{children:e.jsx(_,{placeholder:"Todos los usuarios"})}),e.jsxs(w,{children:[e.jsx(t,{value:"all",children:"Todos los usuarios"}),B.map(s=>e.jsx(t,{value:s.id.toString(),children:s.name},s.id))]})]})]}),e.jsxs("div",{className:"flex items-end space-x-2",children:[e.jsxs(l,{onClick:U,className:"flex-1",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Filtrar"]}),e.jsx(l,{onClick:P,variant:"outline",children:e.jsx(me,{className:"w-4 h-4"})})]})]})})]}),e.jsxs(m,{children:[e.jsxs(h,{children:[e.jsx(j,{children:"Certificados Digitales"}),e.jsxs(J,{children:[r.meta.total," certificado(s) encontrado(s)"]})]}),e.jsxs(u,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(W,{children:[e.jsx(Y,{children:e.jsxs(S,{children:[e.jsx(g,{children:"Estado"}),e.jsx(g,{children:"Certificado"}),e.jsx(g,{children:"Tipo"}),e.jsx(g,{children:"Usuario"}),e.jsx(g,{children:"Emisor"}),e.jsx(g,{children:"Vencimiento"}),e.jsx(g,{children:"Acciones"})]})}),e.jsx(ee,{children:r.data.length===0?e.jsx(S,{children:e.jsxs(o,{colSpan:7,className:"text-center py-8",children:[e.jsx(ve,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-gray-500",children:"No se encontraron certificados"})]})}):r.data.map(s=>e.jsxs(S,{children:[e.jsx(o,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[q(s.estado,s.vigente),E(s.estado,s.vigente)]})}),e.jsx(o,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.nombre_certificado}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Serie: ",s.numero_serie]}),e.jsxs("div",{className:"text-xs text-gray-400",children:[s.algoritmo_firma," (",s.longitud_clave," bits)"]})]})}),e.jsx(o,{children:F(s.tipo_certificado)}),e.jsx(o,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.usuario.name}),e.jsx("div",{className:"text-sm text-gray-500",children:s.usuario.email})]})}),e.jsx(o,{children:e.jsx("div",{className:"text-sm",children:s.emisor})}),e.jsx(o,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(he,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm",children:f(s.fecha_vencimiento)})]}),e.jsx("div",{className:`text-xs ${s.dias_restantes<30?"text-orange-600":"text-gray-500"}`,children:M(s.dias_restantes)})]})}),e.jsx(o,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(l,{size:"sm",variant:"outline",onClick:()=>$(s),children:e.jsx(je,{className:"w-4 h-4"})}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>n.get(route("admin.firmas.certificado.descargar",s.id)),children:e.jsx(R,{className:"w-4 h-4"})}),s.estado==="activo"&&e.jsx(l,{size:"sm",variant:"destructive",onClick:()=>K(s),disabled:L,children:e.jsx(ue,{className:"w-4 h-4"})})]})})]},s.id))})]})}),r.meta.last_page>1&&e.jsxs("div",{className:"flex items-center justify-between mt-6 pt-4 border-t",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Mostrando ",r.meta.from," a ",r.meta.to," de ",r.meta.total," certificados"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[r.meta.current_page>1&&e.jsx(l,{variant:"outline",size:"sm",onClick:()=>n.get(route("admin.firmas.certificados"),{...c,page:r.meta.current_page-1}),children:"Anterior"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["Página ",r.meta.current_page," de ",r.meta.last_page]}),r.meta.current_page<r.meta.last_page&&e.jsx(l,{variant:"outline",size:"sm",onClick:()=>n.get(route("admin.firmas.certificados"),{...c,page:r.meta.current_page+1}),children:"Siguiente"})]})]})]})]})]})}),e.jsx(ae,{open:I,onOpenChange:b,children:e.jsxs(re,{className:"max-w-2xl",children:[e.jsxs(te,{children:[e.jsx(le,{children:"Detalles del Certificado"}),e.jsx(ie,{children:"Información completa del certificado digital"})]}),a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Nombre"}),e.jsx("p",{className:"text-sm",children:a.nombre_certificado})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Número de Serie"}),e.jsx("p",{className:"text-sm font-mono",children:a.numero_serie})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Estado"}),e.jsx("div",{className:"flex items-center space-x-2",children:E(a.estado,a.vigente)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Tipo"}),e.jsx("div",{children:F(a.tipo_certificado)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Algoritmo"}),e.jsx("p",{className:"text-sm",children:a.algoritmo_firma})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Longitud de Clave"}),e.jsxs("p",{className:"text-sm",children:[a.longitud_clave," bits"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Emisor"}),e.jsx("p",{className:"text-sm bg-gray-50 p-2 rounded text-wrap",children:a.emisor})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Sujeto"}),e.jsx("p",{className:"text-sm bg-gray-50 p-2 rounded text-wrap",children:a.sujeto})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Huella Digital (SHA-256)"}),e.jsx("p",{className:"text-xs font-mono bg-gray-50 p-2 rounded break-all",children:a.huella_digital})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Fecha de Emisión"}),e.jsx("p",{className:"text-sm",children:f(a.fecha_emision)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Fecha de Vencimiento"}),e.jsx("p",{className:"text-sm",children:f(a.fecha_vencimiento)})]})]}),a.uso_permitido&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Uso Permitido"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:a.uso_permitido.map((s,i)=>e.jsx(d,{variant:"outline",className:"text-xs",children:s},i))})]}),a.revocado_en&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Revocado"}),e.jsxs("p",{className:"text-sm text-red-600",children:[f(a.revocado_en),a.razon_revocacion&&e.jsxs("span",{className:"block text-xs text-gray-500 mt-1",children:["Razón: ",a.razon_revocacion]})]})]})]}),e.jsxs(ce,{children:[e.jsx(l,{variant:"outline",onClick:()=>b(!1),children:"Cerrar"}),a&&e.jsxs(l,{onClick:()=>n.get(route("admin.firmas.certificado.descargar",a.id)),children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"Descargar"]})]})]})})]})}export{Ke as default};
