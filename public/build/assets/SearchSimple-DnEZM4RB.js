import{j as e,c as R,g as Te,r as d,a as re}from"./app-DOeYTPnE.js";import{C as L,c as D}from"./card-BEZSel9K.js";import{I as _e}from"./index-C7D1JV-H.js";import{a as we,B as E}from"./button-BB3j1qH9.js";import{B as te}from"./badge-BDHWk-Qv.js";import{S as se,a as ne,b as ae,c as ie,d as q,C as qe,e as Oe}from"./select-D2zOlv3c.js";import{S as ke,F as Ce}from"./index-Cl_hWV--.js";import{F as Ie,C as Re,U as Ee}from"./user-BiSWd6pJ.js";import{f as Fe,e as Be}from"./es-tlGrzipH.js";/* empty css            */import"./index-B5i9qy2Y.js";import"./index-pqvegj4w.js";import"./check-C4IDWgVr.js";function M({className:n,...t}){return e.jsx("div",{"data-slot":"skeleton",className:we("bg-primary/10 animate-pulse rounded-md",n),...t})}var P,oe;function Se(){if(oe)return P;oe=1;function n(t){var i=typeof t;return t!=null&&(i=="object"||i=="function")}return P=n,P}var A,ce;function Ge(){if(ce)return A;ce=1;var n=typeof R=="object"&&R&&R.Object===Object&&R;return A=n,A}var U,le;function ye(){if(le)return U;le=1;var n=Ge(),t=typeof self=="object"&&self&&self.Object===Object&&self,i=n||t||Function("return this")();return U=i,U}var W,ue;function Le(){if(ue)return W;ue=1;var n=ye(),t=function(){return n.Date.now()};return W=t,W}var z,de;function De(){if(de)return z;de=1;var n=/\s/;function t(i){for(var a=i.length;a--&&n.test(i.charAt(a)););return a}return z=t,z}var H,me;function Me(){if(me)return H;me=1;var n=De(),t=/^\s+/;function i(a){return a&&a.slice(0,n(a)+1).replace(t,"")}return H=i,H}var V,fe;function Ne(){if(fe)return V;fe=1;var n=ye(),t=n.Symbol;return V=t,V}var $,he;function Pe(){if(he)return $;he=1;var n=Ne(),t=Object.prototype,i=t.hasOwnProperty,a=t.toString,l=n?n.toStringTag:void 0;function p(m){var c=i.call(m,l),f=m[l];try{m[l]=void 0;var s=!0}catch{}var h=a.call(m);return s&&(c?m[l]=f:delete m[l]),h}return $=p,$}var X,xe;function Ae(){if(xe)return X;xe=1;var n=Object.prototype,t=n.toString;function i(a){return t.call(a)}return X=i,X}var J,ge;function Ue(){if(ge)return J;ge=1;var n=Ne(),t=Pe(),i=Ae(),a="[object Null]",l="[object Undefined]",p=n?n.toStringTag:void 0;function m(c){return c==null?c===void 0?l:a:p&&p in Object(c)?t(c):i(c)}return J=m,J}var K,be;function We(){if(be)return K;be=1;function n(t){return t!=null&&typeof t=="object"}return K=n,K}var Q,je;function ze(){if(je)return Q;je=1;var n=Ue(),t=We(),i="[object Symbol]";function a(l){return typeof l=="symbol"||t(l)&&n(l)==i}return Q=a,Q}var Y,pe;function He(){if(pe)return Y;pe=1;var n=Me(),t=Se(),i=ze(),a=NaN,l=/^[-+]0x[0-9a-f]+$/i,p=/^0b[01]+$/i,m=/^0o[0-7]+$/i,c=parseInt;function f(s){if(typeof s=="number")return s;if(i(s))return a;if(t(s)){var h=typeof s.valueOf=="function"?s.valueOf():s;s=t(h)?h+"":h}if(typeof s!="string")return s===0?s:+s;s=n(s);var b=p.test(s);return b||m.test(s)?c(s.slice(2),b?2:8):l.test(s)?a:+s}return Y=f,Y}var Z,ve;function Ve(){if(ve)return Z;ve=1;var n=Se(),t=Le(),i=He(),a="Expected a function",l=Math.max,p=Math.min;function m(c,f,s){var h,b,w,x,u,g,v=0,C=!1,j=!1,O=!0;if(typeof c!="function")throw new TypeError(a);f=i(f)||0,n(s)&&(C=!!s.leading,j="maxWait"in s,w=j?l(i(s.maxWait)||0,f):w,O="trailing"in s?!!s.trailing:O);function y(r){var o=h,k=b;return h=b=void 0,v=r,x=c.apply(k,o),x}function I(r){return v=r,u=setTimeout(N,f),C?y(r):x}function F(r){var o=r-g,k=r-v,ee=f-o;return j?p(ee,w-k):ee}function S(r){var o=r-g,k=r-v;return g===void 0||o>=f||o<0||j&&k>=w}function N(){var r=t();if(S(r))return T(r);u=setTimeout(N,F(r))}function T(r){return u=void 0,O&&h?y(r):(h=b=void 0,x)}function B(){u!==void 0&&clearTimeout(u),v=0,h=g=b=u=void 0}function G(){return u===void 0?x:T(t())}function _(){var r=t(),o=S(r);if(h=arguments,b=this,g=r,o){if(u===void 0)return I(g);if(j)return clearTimeout(u),u=setTimeout(N,f),y(g)}return u===void 0&&(u=setTimeout(N,f)),x}return _.cancel=B,_.flush=G,_}return Z=m,Z}var $e=Ve();const Xe=Te($e);function cr({initialQuery:n=""}){const[t,i]=d.useState(n),[a,l]=d.useState("documentos"),[p,m]=d.useState([]),[c,f]=d.useState(0),[s,h]=d.useState(!1),[b,w]=d.useState(0),[x,u]=d.useState(0),[g]=d.useState(20),[v,C]=d.useState("_score"),[j,O]=d.useState("desc"),[y,I]=d.useState([]),[F,S]=d.useState(!1),N=d.useCallback(Xe(async r=>{if(r.length<2){I([]);return}try{const o=await re.get("/search/autocomplete",{params:{q:r,field:"nombre",type:a}});I(o.data.suggestions||[]),S(!0)}catch(o){console.error("Error en autocompletado:",o)}},300),[a]),T=d.useCallback(async()=>{if(!t.trim()){m([]),f(0);return}h(!0);try{const r=await re.post("/search/simple",{q:t,type:a,size:g,from:x*g,sort:{[v]:j}});if(r.data.success){const o=r.data.data;m(o.results),f(o.total),w(o.took)}}catch(r){console.error("Error en búsqueda:",r)}finally{h(!1)}},[t,a,g,x,v,j]);d.useEffect(()=>{N(t)},[t,N]),d.useEffect(()=>{t.trim()&&T()},[a,x,v,j,T,t]);const B=r=>{r.preventDefault(),u(0),T(),S(!1)},G=r=>{i(r),S(!1),u(0),T()},_=r=>e.jsx("span",{dangerouslySetInnerHTML:{__html:r}});return e.jsxs("div",{className:"space-y-6",children:[e.jsx(L,{children:e.jsx(D,{className:"pt-6",children:e.jsxs("form",{onSubmit:B,className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(_e,{type:"text",value:t,onChange:r=>i(r.target.value),placeholder:"Buscar documentos, expedientes...",className:"pr-10",onFocus:()=>y.length>0&&S(!0),onBlur:()=>setTimeout(()=>S(!1),200)}),e.jsx(ke,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),F&&y.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-background border rounded-md shadow-lg max-h-60 overflow-auto",children:y.map((r,o)=>e.jsx("button",{type:"button",onClick:()=>G(r),className:"w-full text-left px-4 py-2 hover:bg-accent transition-colors",children:r},o))})]}),e.jsxs(se,{value:a,onValueChange:r=>l(r),children:[e.jsx(ne,{className:"w-[180px]",children:e.jsx(ae,{})}),e.jsxs(ie,{children:[e.jsx(q,{value:"documentos",children:"Documentos"}),e.jsx(q,{value:"expedientes",children:"Expedientes"})]})]}),e.jsx(E,{type:"submit",disabled:s,children:s?"Buscando...":"Buscar"})]}),e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Ordenar por:"}),e.jsxs(se,{value:v,onValueChange:C,children:[e.jsx(ne,{className:"w-[200px]",children:e.jsx(ae,{})}),e.jsxs(ie,{children:[e.jsx(q,{value:"_score",children:"Relevancia"}),e.jsx(q,{value:"fecha_creacion",children:"Fecha de Creación"}),e.jsx(q,{value:"nombre.keyword",children:"Nombre"}),e.jsx(q,{value:"usuario_creador",children:"Usuario"})]})]}),e.jsx(E,{variant:"outline",size:"sm",onClick:()=>O(j==="asc"?"desc":"asc"),children:j==="asc"?e.jsx(qe,{className:"h-4 w-4"}):e.jsx(Oe,{className:"h-4 w-4"})})]})]})})}),t&&e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:c>0?e.jsxs(e.Fragment,{children:["Se encontraron ",e.jsx("strong",{children:c})," resultados en ",e.jsxs("strong",{children:[b,"ms"]})]}):"No se encontraron resultados"})}),e.jsx("div",{className:"space-y-4",children:s?Array.from({length:5}).map((r,o)=>e.jsx(L,{children:e.jsxs(D,{className:"pt-6",children:[e.jsx(M,{className:"h-6 w-3/4 mb-2"}),e.jsx(M,{className:"h-4 w-full mb-2"}),e.jsx(M,{className:"h-4 w-2/3"})]})},o)):p.map(r=>e.jsx(L,{className:"hover:shadow-md transition-shadow",children:e.jsx(D,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:a==="documentos"?e.jsx(Ce,{className:"h-6 w-6 text-primary"}):e.jsx(Ie,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:r.highlights?.nombre?.[0]?_(r.highlights.nombre[0]):r.source.nombre}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.source.codigo})]}),e.jsxs(te,{variant:"outline",children:["Score: ",r.score.toFixed(2)]})]}),r.highlights?.descripcion&&e.jsx("p",{className:"text-sm",children:_(r.highlights.descripcion[0])}),r.highlights?.contenido&&e.jsx("div",{className:"bg-accent/50 p-3 rounded-md",children:e.jsx("p",{className:"text-sm italic",children:_(r.highlights.contenido[0])})}),e.jsxs("div",{className:"flex gap-4 text-xs text-muted-foreground",children:[r.source.fecha_creacion&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Re,{className:"h-3 w-3"}),Fe(new Date(r.source.fecha_creacion),{addSuffix:!0,locale:Be})]}),r.source.usuario_creador&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ee,{className:"h-3 w-3"}),r.source.usuario_creador]}),r.source.serie_documental_nombre&&e.jsx(te,{variant:"secondary",className:"text-xs",children:r.source.serie_documental_nombre})]})]})]})})},r.id))}),c>g&&e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(E,{variant:"outline",onClick:()=>u(x-1),disabled:x===0||s,children:"Anterior"}),e.jsxs("span",{className:"flex items-center px-4",children:["Página ",x+1," de ",Math.ceil(c/g)]}),e.jsx(E,{variant:"outline",onClick:()=>u(x+1),disabled:x>=Math.ceil(c/g)-1||s,children:"Siguiente"})]})]})}export{cr as default};
