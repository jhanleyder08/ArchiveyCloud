import{r as c,j as e,H as V,b as x,a as d}from"./app-DOeYTPnE.js";import{A as M}from"./app-layout-CKT_ksyH.js";import{C as S,a as R,b as G,d as O,c as D}from"./card-BEZSel9K.js";import{B as l}from"./button-BB3j1qH9.js";import{B as j}from"./badge-BDHWk-Qv.js";import{I as p}from"./index-C7D1JV-H.js";import{L as o}from"./label-BvABT9uR.js";import{S as _,a as E,b as A,c as k,d as u}from"./select-D2zOlv3c.js";import{S as X,D as J,a as K,b as Q,c as U,d as W,g as Y}from"./app-sidebar-layout-83PL_wom.js";import{A as Z,a as ee}from"./alert-Dl-auDCw.js";import{R as ae}from"./refresh-cw-B3OjpzJz.js";import{P}from"./plus-Dfkec5yu.js";import{M as T}from"./triangle-alert-B7e9hRq_.js";import{C as se}from"./circle-check-big-BQYxJNiA.js";import{C as re}from"./circle-x-CwiZ-nCX.js";import{C as te}from"./circle-play-DpgZ0R5x.js";import{T as ie}from"./trash-2-COYRgziV.js";/* empty css            */import"./index-B5i9qy2Y.js";import"./index-Cl_hWV--.js";import"./index-pqvegj4w.js";import"./check-C4IDWgVr.js";import"./index-BuQaqXjb.js";import"./x-BHxLkKP3.js";import"./index-sj4qH-fg.js";import"./app-logo-icon-BTiqVlKS.js";import"./user-BiSWd6pJ.js";function ze({accounts:g}){const[z,m]=c.useState(!1),[n,v]=c.useState(null),[s,i]=c.useState({nombre:"",email:"",password:"",host:"imap.gmail.com",port:993,encryption:"ssl",protocol:"imap",auto_capture:!0,serie_documental_id:""}),[h,t]=c.useState(null),[C,f]=c.useState({}),[N,y]=c.useState({}),I=async a=>{a.preventDefault(),t(null);try{n?(await d.patch(`/email-accounts/${n.id}`,s),t({type:"success",message:"Cuenta actualizada correctamente"})):(await d.post("/email-accounts",s),t({type:"success",message:"Cuenta creada correctamente"})),m(!1),b(),x.reload()}catch(r){t({type:"error",message:r.response?.data?.message||"Error al guardar la cuenta"})}},H=async a=>{f(r=>({...r,[a.id]:!0})),t(null);try{const r=await d.post(`/email-accounts/${a.id}/test`);t({type:"success",message:"Conexión exitosa con el servidor de correo"})}catch(r){t({type:"error",message:r.response?.data?.message||"Error al conectar con el servidor"})}finally{f(r=>({...r,[a.id]:!1}))}},L=async a=>{y(r=>({...r,[a.id]:!0})),t(null);try{const r=await d.post(`/email-accounts/${a.id}/capture`,{async:!0,limit:100});t({type:"success",message:"Captura iniciada. Se procesarán en segundo plano."})}catch(r){t({type:"error",message:r.response?.data?.message||"Error al iniciar captura"})}finally{y(r=>({...r,[a.id]:!1}))}},$=async()=>{t(null);try{await d.post("/email-accounts/capture-all"),t({type:"success",message:"Captura masiva iniciada para todas las cuentas activas"})}catch(a){t({type:"error",message:a.response?.data?.message||"Error al iniciar captura masiva"})}},q=async a=>{if(confirm(`¿Eliminar la cuenta ${a.email}?`))try{await d.delete(`/email-accounts/${a.id}`),t({type:"success",message:"Cuenta eliminada correctamente"}),x.reload()}catch(r){t({type:"error",message:r.response?.data?.message||"Error al eliminar cuenta"})}},w=()=>{b(),v(null),m(!0)},B=a=>{i({nombre:a.nombre,email:a.email,password:"",host:a.host,port:a.port,encryption:"ssl",protocol:a.protocol,auto_capture:a.auto_capture,serie_documental_id:""}),v(a),m(!0)},b=()=>{i({nombre:"",email:"",password:"",host:"imap.gmail.com",port:993,encryption:"ssl",protocol:"imap",auto_capture:!0,serie_documental_id:""})},F=a=>a?new Date(a).toLocaleString("es-ES"):"Nunca";return e.jsxs(M,{children:[e.jsx(V,{title:"Cuentas de Correo"}),e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Cuentas de Correo"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Gestión de cuentas para captura automática de emails"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(l,{onClick:$,variant:"outline",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Capturar Todas"]}),e.jsxs(l,{onClick:w,children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Nueva Cuenta"]})]})]}),h&&e.jsx(Z,{variant:h.type==="error"?"destructive":"default",children:e.jsx(ee,{children:h.message})}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:g.map(a=>e.jsxs(S,{children:[e.jsx(R,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded",children:e.jsx(T,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx(G,{className:"text-lg",children:a.nombre}),e.jsx(O,{children:a.email})]})]}),e.jsx("div",{className:"flex gap-1",children:a.active?e.jsxs(j,{variant:"default",children:[e.jsx(se,{className:"h-3 w-3 mr-1"}),"Activa"]}):e.jsxs(j,{variant:"secondary",children:[e.jsx(re,{className:"h-3 w-3 mr-1"}),"Inactiva"]})})]})}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Servidor"}),e.jsxs("p",{className:"font-medium",children:[a.host,":",a.port]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Protocolo"}),e.jsx("p",{className:"font-medium uppercase",children:a.protocol})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Emails Capturados"}),e.jsx("p",{className:"font-medium",children:a.total_captured})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Última Captura"}),e.jsx("p",{className:"font-medium text-xs",children:F(a.last_capture_at)})]})]}),a.auto_capture&&e.jsx(j,{variant:"outline",className:"w-full justify-center",children:"Captura Automática Activada"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{onClick:()=>H(a),disabled:C[a.id],size:"sm",variant:"outline",className:"flex-1",children:C[a.id]?"Probando...":"Probar Conexión"}),e.jsxs(l,{onClick:()=>L(a),disabled:N[a.id],size:"sm",className:"flex-1",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),N[a.id]?"Capturando...":"Capturar"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(l,{onClick:()=>x.visit(`/email-accounts/${a.id}/captures`),size:"sm",variant:"ghost",className:"flex-1",children:["Ver Capturas (",a.captures_count,")"]}),e.jsx(l,{onClick:()=>B(a),size:"sm",variant:"ghost",children:e.jsx(X,{className:"h-4 w-4"})}),e.jsx(l,{onClick:()=>q(a),size:"sm",variant:"ghost",className:"text-destructive",children:e.jsx(ie,{className:"h-4 w-4"})})]})]})]},a.id))}),g.length===0&&e.jsx(S,{children:e.jsxs(D,{className:"text-center py-12 text-muted-foreground",children:[e.jsx(T,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"mb-4",children:"No hay cuentas de correo configuradas"}),e.jsxs(l,{onClick:w,children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Crear Primera Cuenta"]})]})})]}),e.jsx(J,{open:z,onOpenChange:m,children:e.jsxs(K,{className:"max-w-2xl",children:[e.jsxs(Q,{children:[e.jsx(U,{children:n?"Editar Cuenta":"Nueva Cuenta de Correo"}),e.jsx(W,{children:"Configura la cuenta de correo para captura automática"})]}),e.jsxs("form",{onSubmit:I,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx(o,{children:"Nombre"}),e.jsx(p,{value:s.nombre,onChange:a=>i({...s,nombre:a.target.value}),placeholder:"Ej: Archivo General",required:!0})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(o,{children:"Email"}),e.jsx(p,{type:"email",value:s.email,onChange:a=>i({...s,email:a.target.value}),placeholder:"archivo@empresa.com",required:!0})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(o,{children:"Contraseña"}),e.jsx(p,{type:"password",value:s.password,onChange:a=>i({...s,password:a.target.value}),placeholder:n?"Dejar vacío para mantener":"",required:!n})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Servidor (Host)"}),e.jsx(p,{value:s.host,onChange:a=>i({...s,host:a.target.value}),placeholder:"imap.gmail.com",required:!0})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Puerto"}),e.jsx(p,{type:"number",value:s.port,onChange:a=>i({...s,port:parseInt(a.target.value)}),required:!0})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Protocolo"}),e.jsxs(_,{value:s.protocol,onValueChange:a=>i({...s,protocol:a}),children:[e.jsx(E,{children:e.jsx(A,{})}),e.jsxs(k,{children:[e.jsx(u,{value:"imap",children:"IMAP"}),e.jsx(u,{value:"pop3",children:"POP3"})]})]})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Encriptación"}),e.jsxs(_,{value:s.encryption,onValueChange:a=>i({...s,encryption:a}),children:[e.jsx(E,{children:e.jsx(A,{})}),e.jsxs(k,{children:[e.jsx(u,{value:"ssl",children:"SSL"}),e.jsx(u,{value:"tls",children:"TLS"}),e.jsx(u,{value:"none",children:"Ninguna"})]})]})]}),e.jsxs("div",{className:"col-span-2 flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"auto_capture",checked:s.auto_capture,onChange:a=>i({...s,auto_capture:a.target.checked}),className:"h-4 w-4"}),e.jsx(o,{htmlFor:"auto_capture",className:"cursor-pointer",children:"Habilitar captura automática programada"})]})]}),e.jsxs(Y,{children:[e.jsx(l,{type:"button",variant:"outline",onClick:()=>m(!1),children:"Cancelar"}),e.jsxs(l,{type:"submit",children:[n?"Actualizar":"Crear"," Cuenta"]})]})]})]})})]})}export{ze as default};
