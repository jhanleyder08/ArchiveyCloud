import{r as g,u as V,j as e,H as W,L as y}from"./app-C5ckqBIp.js";import{A as E}from"./app-layout-DGpHzsZj.js";import{B as d}from"./button-C_wizhg3.js";import{C as m,a as x,b as p,d as j,c as h}from"./card-C_VOERQk.js";import{L as o}from"./label-D9bm4s2r.js";import{I as w}from"./input-DjB33T14.js";import{G as H,T as R}from"./app-sidebar-layout-B-YWzudl.js";import{S as C,a as _,b as S,c as A,d as q}from"./select-CBIPitLz.js";import{C as U}from"./checkbox-BHy_KTKH.js";import{B as D}from"./badge-DL-k3CvS.js";import{A as z,a as G}from"./alert-DyllTe_s.js";import{F as M}from"./Combination-CIeNRLzY.js";import{U as P}from"./users-Bu6eepbM.js";import{X}from"./x-Cc5GKSP1.js";import{C as J}from"./circle-alert-DQBS1bU3.js";import{C as K}from"./folder-9RT5E6CU.js";/* empty css            */import"./index-D_U0JQiI.js";import"./index-C72nIoIT.js";import"./index-z-hyAKzV.js";import"./app-logo-icon-EYLFXuBA.js";import"./user-2UwuEIUF.js";import"./mail-DhzsRTCw.js";import"./triangle-alert-c3kReHiM.js";import"./search-CVtN_EcY.js";import"./BrandingProvider-ZsHKNxl6.js";import"./index-C7J7UiSU.js";import"./check-R7RxhHJy.js";function Ce({documento:t,usuarios_disponibles:k=[]}){const u=k,[r,f]=g.useState([]),[O,B]=g.useState(!t),{data:n,setData:l,post:F,processing:b,errors:i}=V({documento_id:t?.id.toString()||"",aprobadores:[],descripcion:"",prioridad:2,requiere_unanime:!1,dias_vencimiento:7}),v=[{valor:4,etiqueta:"Crítica",color:"text-red-600"},{valor:3,etiqueta:"Alta",color:"text-orange-600"},{valor:2,etiqueta:"Media",color:"text-blue-600"},{valor:1,etiqueta:"Baja",color:"text-gray-600"}],I=s=>{s.preventDefault(),r.length!==0&&F("/admin/workflow",{...n,aprobadores:r.map(a=>a.id)})},L=s=>{if(!r.find(a=>a.id===s.id)){const a=[...r,s];f(a),l("aprobadores",a.map(c=>c.id))}},T=s=>{const a=r.filter(c=>c.id!==s);f(a),l("aprobadores",a.map(c=>c.id))},N=v.find(s=>s.valor===n.prioridad);return e.jsxs(E,{children:[e.jsx(W,{title:"Nuevo Workflow de Aprobación"}),e.jsxs("div",{className:"container mx-auto py-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(H,{className:"w-8 h-8 text-blue-600"}),"Nuevo Workflow de Aprobación"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Inicia un proceso de aprobación para un documento"})]}),e.jsx(y,{href:"/admin/workflow",children:e.jsx(d,{variant:"outline",children:"Volver a Workflows"})})]}),e.jsx("form",{onSubmit:I,className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(m,{children:[e.jsxs(x,{children:[e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-5 h-5"}),"Documento a Aprobar"]}),e.jsx(j,{children:"Selecciona el documento que necesita aprobación"})]}),e.jsx(h,{children:t?e.jsx("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-900",children:t.nombre}),e.jsx("p",{className:"text-sm text-blue-700",children:t.codigo}),t.expediente&&e.jsxs("p",{className:"text-sm text-blue-600 mt-1",children:["Expediente: ",t.expediente.numero," - ",t.expediente.titulo]})]}),e.jsx(d,{type:"button",variant:"outline",size:"sm",onClick:()=>B(!0),children:"Cambiar"})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(o,{htmlFor:"documento_id",children:"Documento *"}),e.jsx(w,{id:"documento_id",placeholder:"Buscar documento por nombre o código...",className:i.documento_id?"border-red-500":""}),i.documento_id&&e.jsx("p",{className:"text-sm text-red-600",children:i.documento_id}),e.jsx("p",{className:"text-sm text-gray-500",children:"Nota: La búsqueda de documentos se implementará próximamente"})]})})]}),e.jsxs(m,{children:[e.jsxs(x,{children:[e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5"}),"Aprobadores"]}),e.jsx(j,{children:"Selecciona los usuarios que deben aprobar este documento"})]}),e.jsxs(h,{className:"space-y-4",children:[r.length>0&&e.jsxs("div",{children:[e.jsxs(o,{className:"text-sm font-medium",children:["Aprobadores Seleccionados (",r.length,")"]}),e.jsx("div",{className:"space-y-2 mt-2",children:r.map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center text-sm font-medium text-blue-600",children:a+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.cargo})]})]}),e.jsx(d,{type:"button",variant:"ghost",size:"sm",onClick:()=>T(s.id),children:e.jsx(X,{className:"w-4 h-4"})})]},s.id))})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"nuevo_aprobador",children:"Agregar Aprobador"}),e.jsxs(C,{onValueChange:s=>{const a=u.find(c=>c.id.toString()===s);a&&L(a)},children:[e.jsx(_,{children:e.jsx(S,{placeholder:"Seleccionar usuario..."})}),e.jsx(A,{children:u.filter(s=>!r.find(a=>a.id===s.id)).map(s=>e.jsx(q,{value:s.id.toString(),children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.cargo," - ",s.email]})]})},s.id))})]})]}),r.length===0&&e.jsxs(z,{children:[e.jsx(J,{className:"h-4 w-4"}),e.jsx(G,{children:"Debes seleccionar al menos un aprobador para continuar."})]}),r.length>1&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{id:"requiere_unanime",checked:n.requiere_unanime,onCheckedChange:s=>l("requiere_unanime",!!s)}),e.jsx(o,{htmlFor:"requiere_unanime",className:"text-sm",children:"Requiere aprobación unánime (todos deben aprobar)"})]})]})]}),e.jsxs(m,{children:[e.jsxs(x,{children:[e.jsx(p,{children:"Descripción de la Solicitud"}),e.jsx(j,{children:"Explica por qué este documento necesita aprobación"})]}),e.jsxs(h,{children:[e.jsx(R,{placeholder:"Describe el motivo de la aprobación, contexto adicional, o instrucciones específicas...",value:n.descripcion,onChange:s=>l("descripcion",s.target.value),rows:4,className:i.descripcion?"border-red-500":""}),i.descripcion&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:i.descripcion})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(m,{children:[e.jsx(x,{children:e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5"}),"Configuración"]})}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Prioridad *"}),e.jsxs(C,{value:n.prioridad.toString(),onValueChange:s=>l("prioridad",parseInt(s)),children:[e.jsx(_,{children:e.jsx(S,{})}),e.jsx(A,{children:v.map(s=>e.jsx(q,{value:s.valor.toString(),children:e.jsx("span",{className:s.color,children:s.etiqueta})},s.valor))})]}),i.prioridad&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:i.prioridad})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"dias_vencimiento",children:"Días para vencer *"}),e.jsx(w,{id:"dias_vencimiento",type:"number",min:"1",max:"30",value:n.dias_vencimiento,onChange:s=>l("dias_vencimiento",parseInt(s.target.value)||7),className:i.dias_vencimiento?"border-red-500":""}),i.dias_vencimiento&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:i.dias_vencimiento}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Fecha de vencimiento: ",new Date(Date.now()+n.dias_vencimiento*24*60*60*1e3).toLocaleDateString()]})]})]})]}),e.jsxs(m,{children:[e.jsx(x,{children:e.jsx(p,{children:"Resumen"})}),e.jsxs(h,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Documento:"}),e.jsx("span",{className:"text-sm font-medium",children:t?"✓":"✗"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Aprobadores:"}),e.jsx("span",{className:"text-sm font-medium",children:r.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Prioridad:"}),e.jsx(D,{variant:"outline",className:N?.color,children:N?.etiqueta})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Vencimiento:"}),e.jsxs("span",{className:"text-sm font-medium",children:[n.dias_vencimiento," días"]})]}),n.requiere_unanime&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Tipo:"}),e.jsx(D,{variant:"outline",className:"text-orange-600",children:"Unánime"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(d,{type:"submit",className:"w-full",disabled:b||!t||r.length===0,children:b?"Creando...":"Iniciar Workflow"}),e.jsx(y,{href:"/admin/workflow",children:e.jsx(d,{variant:"outline",className:"w-full",children:"Cancelar"})})]})]})]})})]})]})}export{Ce as default};
