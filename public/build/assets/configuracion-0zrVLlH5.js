import{r as d,j as e,H,L as I,e as S}from"./app-B-PXR1Ni.js";import{A as F}from"./app-layout-DJutQZnN.js";import{C as m,a as x,b as h,c as u,d as j}from"./card-Dmlm_cpt.js";import{B as p}from"./app-logo-icon-BLsuM4IN.js";import{L as r,I as C}from"./label-CcIhawib.js";import{S as w}from"./switch-CfV8eshZ.js";import{S as P,a as T,b as V,c as Q,d as t}from"./select-B6s0-YwG.js";import{A as U,a as $}from"./alert-CjcJnkq6.js";import{B as l}from"./badge-CNo-IL5x.js";import{S as _}from"./separator-Dj1fNbOj.js";import{A as G}from"./arrow-left-DbMIHj5m.js";import{r as J,a as A,S as M,M as W,a9 as K,C as O,a7 as X}from"./app-sidebar-layout-D9ulO2li.js";import{C as L}from"./circle-check-big-vwlwSDoT.js";import{U as Y}from"./user-check-DDkzZB-x.js";import{L as k}from"./loader-circle-D35SGm7F.js";import{S as Z}from"./save-CZYiVBmQ.js";/* empty css            */import"./index-DsJw0RIA.js";import"./index-CQZ_TJph.js";import"./check-BUuVkhmq.js";import"./index-DARluDlH.js";function ye({configuracion_actual:E,usuarios_admin:g}){const[a,R]=d.useState(E),[f,v]=d.useState(!1),[N,y]=d.useState(!1),[o,c]=d.useState(null),z=async()=>{v(!0),c(null);try{const s=await S.post("/admin/servicios-externos/configuracion",a);c({success:!0,message:"Configuración actualizada exitosamente"})}catch(s){c({success:!1,message:s.response?.data?.message||"Error actualizando configuración"})}finally{v(!1)}},D=async()=>{y(!0),c(null);try{const s=await S.post("/admin/servicios-externos/forzar-resumenes");c({success:!0,message:"Resúmenes enviados exitosamente a todos los usuarios administrativos"})}catch(s){c({success:!1,message:s.response?.data?.message||"Error enviando resúmenes"})}finally{y(!1)}},n=(s,i)=>{R(b=>({...b,[s]:i}))},q=s=>{const i=a.destinatarios_resumen||[];i.includes(s)?n("destinatarios_resumen",i.filter(B=>B!==s)):n("destinatarios_resumen",[...i,s])};return e.jsxs(F,{children:[e.jsx(H,{title:"Configuración - Servicios Externos - ArchiveyCloud"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(I,{href:"/admin/servicios-externos",children:e.jsxs(p,{variant:"outline",size:"sm",children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Volver"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Configuración de Servicios Externos"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Configurar parámetros de email, SMS y notificaciones automáticas"})]})]}),e.jsx(J,{className:"h-8 w-8 text-blue-600"})]}),o&&e.jsx(U,{className:o.success?"border-green-200 bg-green-50":"border-red-200 bg-red-50",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[o.success?e.jsx(L,{className:"h-4 w-4 text-green-600"}):e.jsx(A,{className:"h-4 w-4 text-red-600"}),e.jsx($,{className:o.success?"text-green-800":"text-red-800",children:o.message})]})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6",children:[e.jsxs(m,{children:[e.jsxs(x,{children:[e.jsxs(h,{className:"flex items-center space-x-2",children:[e.jsx(M,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{children:"Configuración de Servicios"})]}),e.jsx(u,{children:"Habilitar o deshabilitar servicios de notificación"})]}),e.jsxs(j,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(W,{className:"h-4 w-4 text-blue-600"}),e.jsx(r,{className:"text-sm font-medium",children:"Servicio de Email"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Notificaciones por correo electrónico"})]}),e.jsx(w,{checked:a.email_habilitado,onCheckedChange:s=>n("email_habilitado",s)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-xs text-gray-600",children:"Driver actual"}),e.jsx(l,{variant:"outline",className:"mt-1",children:a.mail_driver})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-xs text-gray-600",children:"Queue"}),e.jsx(l,{variant:"outline",className:"mt-1",children:a.queue_connection})]})]})]}),e.jsx(_,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(K,{className:"h-4 w-4 text-green-600"}),e.jsx(r,{className:"text-sm font-medium",children:"Servicio de SMS"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Mensajes de texto para alertas críticas"})]}),e.jsx(w,{checked:a.sms_habilitado,onCheckedChange:s=>n("sms_habilitado",s)})]}),e.jsxs("div",{className:"text-sm",children:[e.jsxs(l,{variant:"outline",className:"bg-orange-50 text-orange-700",children:["Ambiente: ",a.ambiente]}),a.ambiente==="local"&&e.jsx("p",{className:"text-xs text-orange-600 mt-1",children:"En desarrollo los SMS se simulan"})]})]})]})]}),e.jsxs(m,{children:[e.jsxs(x,{children:[e.jsxs(h,{className:"flex items-center space-x-2",children:[e.jsx(M,{className:"h-5 w-5 text-orange-600"}),e.jsx("span",{children:"Límites y Throttling"})]}),e.jsx(u,{children:"Controlar la frecuencia de envío de notificaciones"})]}),e.jsx(j,{className:"space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"throttling-email",className:"text-sm font-medium",children:"Límite de Emails por hora (por usuario)"}),e.jsx(C,{id:"throttling-email",type:"number",min:"1",max:"20",value:a.throttling_email,onChange:s=>n("throttling_email",parseInt(s.target.value)),className:"mt-1"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Recomendado: 5 emails por hora"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"throttling-sms",className:"text-sm font-medium",children:"Límite de SMS por día (por usuario)"}),e.jsx(C,{id:"throttling-sms",type:"number",min:"1",max:"10",value:a.throttling_sms,onChange:s=>n("throttling_sms",parseInt(s.target.value)),className:"mt-1"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Recomendado: 3 SMS por día (solo críticos)"})]})]})})]}),e.jsxs(m,{children:[e.jsxs(x,{children:[e.jsxs(h,{className:"flex items-center space-x-2",children:[e.jsx(O,{className:"h-5 w-5 text-purple-600"}),e.jsx("span",{children:"Resúmenes Diarios"})]}),e.jsx(u,{children:"Configurar el envío automático de resúmenes diarios"})]}),e.jsxs(j,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"hora-resumen",className:"text-sm font-medium",children:"Hora de envío (formato 24h)"}),e.jsxs(P,{value:a.resumen_diario_hora,onValueChange:s=>n("resumen_diario_hora",s),children:[e.jsx(T,{className:"mt-1",children:e.jsx(V,{})}),e.jsxs(Q,{children:[e.jsx(t,{value:"06:00",children:"06:00 AM"}),e.jsx(t,{value:"07:00",children:"07:00 AM"}),e.jsx(t,{value:"08:00",children:"08:00 AM"}),e.jsx(t,{value:"09:00",children:"09:00 AM"}),e.jsx(t,{value:"10:00",children:"10:00 AM"}),e.jsx(t,{value:"18:00",children:"06:00 PM"}),e.jsx(t,{value:"19:00",children:"07:00 PM"}),e.jsx(t,{value:"20:00",children:"08:00 PM"})]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Los resúmenes se envían solo si hay actividad pendiente"})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx(r,{className:"text-sm font-medium",children:"Destinatarios de Resúmenes"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1 mb-3",children:"Selecciona usuarios específicos para recibir resúmenes diarios"}),e.jsx("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:g.map(s=>{const i=(a.destinatarios_resumen||[]).includes(s.id);return e.jsxs("div",{className:`flex items-center justify-between p-2 rounded-md border cursor-pointer transition-colors ${i?"bg-blue-50 border-blue-200":"bg-gray-50 border-gray-200 hover:bg-gray-100"}`,onClick:()=>q(s.id),children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Y,{className:`h-3 w-3 ${i?"text-blue-600":"text-gray-400"}`}),e.jsx("span",{className:"text-sm",children:s.name}),e.jsx(l,{variant:"outline",className:"text-xs",children:s.email})]}),i&&e.jsx(L,{className:"h-4 w-4 text-blue-600"})]},s.id)})}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-xs text-gray-500",children:[e.jsxs("span",{children:[(a.destinatarios_resumen||[]).length," de ",g.length," seleccionados"]}),(a.destinatarios_resumen||[]).length===0&&e.jsx("span",{className:"text-orange-600",children:"⚠️ Sin destinatarios específicos, se enviará a todos los admin"})]})]}),e.jsxs(p,{onClick:D,disabled:N,className:"w-full",variant:"outline",children:[N?e.jsx(k,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(X,{className:"h-4 w-4 mr-2"}),"Enviar Resúmenes Ahora"]})]})]}),e.jsxs(m,{children:[e.jsx(x,{children:e.jsxs(h,{className:"flex items-center space-x-2",children:[e.jsx(A,{className:"h-5 w-5 text-yellow-600"}),e.jsx("span",{children:"Información del Sistema"})]})}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Cron Jobs:"}),e.jsx(l,{variant:"outline",children:"Configurado"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Queue Workers:"}),e.jsx(l,{variant:"outline",children:a.queue_connection})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Ambiente:"}),e.jsx(l,{variant:a.ambiente==="production"?"default":"secondary",children:a.ambiente})]})]}),e.jsx(_,{}),e.jsxs("div",{className:"space-y-2 text-xs text-gray-500",children:[e.jsx("p",{children:e.jsx("strong",{children:"Notas importantes:"})}),e.jsxs("ul",{className:"space-y-1 ml-4 list-disc",children:[e.jsx("li",{children:"Los cambios requieren restart del queue worker"}),e.jsx("li",{children:"SMS solo funciona en producción con API key válida"}),e.jsx("li",{children:"Los límites de throttling usan caché de Laravel"}),e.jsx("li",{children:"Los resúmenes se procesan por cron job diario"})]})]})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(p,{onClick:z,disabled:f,size:"lg",children:[f?e.jsx(k,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Guardar Configuración"]})})]})]})}export{ye as default};
