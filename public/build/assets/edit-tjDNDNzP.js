import{r as u,j as e,H as I,L as y,a as B}from"./app-DPEjwQT9.js";import{A as V}from"./app-layout-DJGC0aA3.js";import{B as g}from"./app-logo-icon-H_IL7Yv2.js";import{L as c,I as b}from"./label-D3CTh0Ka.js";import{a as z,g as D,T as f}from"./app-sidebar-layout-IbwrykLk.js";import{S as C,a as _,b as S,c as T,d}from"./select-B4hnYyfD.js";import{C as n,c as m,a as E,b as w,d as R}from"./card-wRfpXQ5K.js";import{B as A}from"./badge-q1UJX4yT.js";import{A as F,a as L}from"./alert-NgRWBvCT.js";import{C as k}from"./checkbox-CX7ziD7t.js";import{A as X}from"./arrow-left-9haSPNE8.js";import{S as $}from"./save-C-ngTTFd.js";/* empty css            */import"./index-hKtuufHU.js";import"./index-BV2fi4LF.js";import"./index-BO3vD0Rq.js";import"./check-CGvMzkbK.js";const G=[{title:"Dashboard",href:"/dashboard"},{title:"Administración",href:"#"},{title:"Tablas de Retención Documental",href:"/admin/trd"},{title:"Editar TRD",href:"#"}];function de({trd:a,estados:v,tieneDocumentosAsociados:q}){const[r,J]=u.useState({codigo:a.codigo||"",nombre:a.nombre||"",descripcion:a.descripcion||"",justificacion:a.justificacion||"",version:a.version||"",estado:a.estado||"borrador",vigente:a.vigente||!1,formato_archivo:a.formato_archivo||"XML",metadatos_asociados:a.metadatos_asociados?JSON.stringify(a.metadatos_asociados,null,2):""}),[i,x]=u.useState({}),[j,h]=u.useState(!1),O=s=>{s.preventDefault(),h(!0),x({});let o=null;if(r.metadatos_asociados.trim())try{o=JSON.parse(r.metadatos_asociados)}catch{x({metadatos_asociados:"Formato JSON inválido"}),h(!1);return}const l={...r,metadatos_asociados:o};B.put(`/admin/trd/${a.id}`,l,{onError:N=>{x(N),h(!1)},onFinish:()=>{h(!1)}})},t=(s,o)=>{J(l=>({...l,[s]:o})),i[s]&&x(l=>({...l,[s]:""}))},p=s=>new Date(s).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),M=s=>{const o={borrador:"bg-gray-100 text-gray-800",revision:"bg-yellow-100 text-yellow-800",aprobada:"bg-green-100 text-green-800",vigente:"bg-blue-100 text-blue-800",historica:"bg-purple-100 text-purple-800"}[s]||"bg-gray-100 text-gray-800";return e.jsx(A,{className:`${o} font-medium`,children:v[s]||s})};return e.jsxs(V,{breadcrumbItems:G,children:[e.jsx(I,{title:`Editar TRD: ${a.nombre} - Tablas de Retención Documental`}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(y,{href:"/admin/trd",children:e.jsxs(g,{variant:"outline",size:"sm",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Volver"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Editar TRD"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Modificar información de la Tabla de Retención Documental"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[M(a.estado),a.vigente&&e.jsx(A,{className:"bg-blue-100 text-blue-800 font-medium",children:"Vigente"})]})]}),e.jsx(n,{className:"bg-gray-50 border-gray-200",children:e.jsx(m,{className:"pt-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"ID Único:"}),e.jsx("p",{className:"text-gray-600 font-mono",children:a.identificador_unico})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Creado:"}),e.jsx("p",{className:"text-gray-600",children:p(a.created_at)}),a.creador&&e.jsxs("p",{className:"text-xs text-gray-500",children:["por ",a.creador.name]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Última Actualización:"}),e.jsx("p",{className:"text-gray-600",children:p(a.fecha_actualizacion)}),a.modificador&&e.jsxs("p",{className:"text-xs text-gray-500",children:["por ",a.modificador.name]})]})]})})}),q&&e.jsxs(F,{className:"border-yellow-200 bg-yellow-50",children:[e.jsx(z,{className:"h-4 w-4"}),e.jsxs(L,{className:"text-yellow-800",children:[e.jsx("strong",{children:"Atención:"})," Esta TRD tiene documentos asociados. Algunos cambios pueden requerir análisis de impacto antes de ser aplicados."]})]}),a.fecha_aprobacion&&e.jsx(F,{className:"border-blue-200 bg-blue-50",children:e.jsxs(L,{className:"text-blue-800",children:[e.jsx("strong",{children:"TRD Aprobada:"})," Aprobada el ",p(a.fecha_aprobacion),". Los cambios de estado requieren autorización especial."]})}),e.jsxs("form",{onSubmit:O,className:"space-y-6",children:[e.jsxs(n,{children:[e.jsxs(E,{children:[e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5 text-[#2a3d83]"}),"Información Básica"]}),e.jsx(R,{children:"Datos principales de la Tabla de Retención Documental"})]}),e.jsxs(m,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"codigo",children:"Código *"}),e.jsx(b,{id:"codigo",type:"text",value:r.codigo,onChange:s=>t("codigo",s.target.value),placeholder:"Ej: TRD-2024-001",required:!0,className:i.codigo?"border-red-500":""}),i.codigo&&e.jsx("p",{className:"text-sm text-red-600",children:i.codigo})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"version",children:"Versión *"}),e.jsx(b,{id:"version",type:"text",value:r.version,onChange:s=>t("version",s.target.value),placeholder:"Ej: 1.0, 2.1",required:!0,className:i.version?"border-red-500":""}),i.version&&e.jsx("p",{className:"text-sm text-red-600",children:i.version})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"nombre",children:"Nombre de la TRD *"}),e.jsx(b,{id:"nombre",type:"text",value:r.nombre,onChange:s=>t("nombre",s.target.value),placeholder:"Ej: TRD General Administrativa 2024",required:!0,className:i.nombre?"border-red-500":""}),i.nombre&&e.jsx("p",{className:"text-sm text-red-600",children:i.nombre})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"descripcion",children:"Descripción"}),e.jsx(f,{id:"descripcion",value:r.descripcion,onChange:s=>t("descripcion",s.target.value),placeholder:"Describa el propósito y alcance de esta TRD",rows:4,className:i.descripcion?"border-red-500":""}),i.descripcion&&e.jsx("p",{className:"text-sm text-red-600",children:i.descripcion})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"justificacion",children:"Justificación"}),e.jsx(f,{id:"justificacion",value:r.justificacion,onChange:s=>t("justificacion",s.target.value),placeholder:"Justifique la modificación de esta TRD",rows:3,className:i.justificacion?"border-red-500":""}),i.justificacion&&e.jsx("p",{className:"text-sm text-red-600",children:i.justificacion})]})]})]}),e.jsxs(n,{children:[e.jsxs(E,{children:[e.jsx(w,{children:"Configuración y Estado"}),e.jsx(R,{children:"Modifique el estado y configuraciones técnicas"})]}),e.jsxs(m,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"estado",children:"Estado *"}),e.jsxs(C,{value:r.estado,onValueChange:s=>t("estado",s),children:[e.jsx(_,{className:i.estado?"border-red-500":"",children:e.jsx(S,{placeholder:"Selecciona un estado"})}),e.jsx(T,{children:Object.entries(v).map(([s,o])=>e.jsx(d,{value:s,children:o},s))})]}),i.estado&&e.jsx("p",{className:"text-sm text-red-600",children:i.estado})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"formato_archivo",children:"Formato de Archivo"}),e.jsxs(C,{value:r.formato_archivo,onValueChange:s=>t("formato_archivo",s),children:[e.jsx(_,{children:e.jsx(S,{placeholder:"Selecciona formato"})}),e.jsxs(T,{children:[e.jsx(d,{value:"XML",children:"XML"}),e.jsx(d,{value:"JSON",children:"JSON"}),e.jsx(d,{value:"PDF",children:"PDF"}),e.jsx(d,{value:"EXCEL",children:"Excel"})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{id:"vigente",checked:r.vigente,onCheckedChange:s=>t("vigente",!!s),disabled:r.estado!=="aprobada"&&!r.vigente}),e.jsx(c,{htmlFor:"vigente",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Marcar como vigente"})]}),r.estado!=="aprobada"&&!a.vigente&&e.jsx("p",{className:"text-xs text-gray-500",children:"Solo las TRDs aprobadas pueden marcarse como vigentes"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"metadatos_asociados",children:"Metadatos Asociados (JSON)"}),e.jsx(f,{id:"metadatos_asociados",value:r.metadatos_asociados,onChange:s=>t("metadatos_asociados",s.target.value),placeholder:'{"categoria": "administrativa", "nivel_acceso": "publico", "palabras_clave": ["gestion", "documental"]}',rows:6,className:`font-mono text-sm ${i.metadatos_asociados?"border-red-500":""}`}),e.jsx("p",{className:"text-xs text-gray-500",children:"Opcional: Metadatos adicionales en formato JSON válido"}),i.metadatos_asociados&&e.jsx("p",{className:"text-sm text-red-600",children:i.metadatos_asociados})]})]})]}),e.jsx(n,{children:e.jsx(m,{className:"pt-6",children:e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(y,{href:"/admin/trd",children:e.jsx(g,{type:"button",variant:"outline",disabled:j,children:"Cancelar"})}),e.jsx(g,{type:"submit",className:"bg-[#2a3d83] hover:bg-[#1e2b5f]",disabled:j,children:j?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx($,{className:"h-4 w-4 mr-2"}),"Guardar Cambios"]})})]})})})]}),e.jsx(n,{className:"bg-blue-50 border-blue-200",children:e.jsx(m,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"bg-blue-100 rounded-full p-2 flex-shrink-0",children:e.jsx(D,{className:"h-4 w-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-blue-900 mb-2",children:"Notas importantes sobre la edición"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[e.jsx("li",{children:"• Los cambios en TRDs aprobadas pueden requerir re-aprobación"}),e.jsx("li",{children:"• El código debe mantenerse único en el sistema"}),e.jsx("li",{children:"• Los cambios de estado siguen el flujo: borrador → revisión → aprobada → vigente"}),e.jsx("li",{children:"• TRDs con documentos asociados requieren análisis de impacto"}),e.jsx("li",{children:"• La fecha de actualización se registra automáticamente"})]})]})]})})})]})]})}export{de as default};
