import{r as l,j as e,a as re}from"./app-Dzr76Hsd.js";import{C as t,a as o,b as n,d as p,c as i}from"./card-tzDn5fcm.js";import{I as d}from"./input-CLK_5OW0.js";import{B as c}from"./button-2TlPkYFS.js";import{L as z}from"./label-CJpZ1OKU.js";import{B as v,F as ce}from"./Combination-DW5lnY8d.js";import{S as M,a as B,b as O,c as E,d as m}from"./select-BUh-Ge6l.js";import{A as le,a as te}from"./alert-Cz3Kn31L.js";import{C as ie}from"./circle-alert-DAHh9vOZ.js";import{X as f}from"./x-DereeiwP.js";import{P as N}from"./plus-CjpGTSg1.js";import{S as oe}from"./search-CcVBS-ta.js";/* empty css            */import"./index-Cij-lt6V.js";import"./index-ClD50zlH.js";import"./index-DBCcPtr9.js";import"./check-uQw81wWn.js";function be(){const[h,C]=l.useState([""]),[x,S]=l.useState([]),[j,y]=l.useState([]),[u,T]=l.useState([]),[g,w]=l.useState([]),[b,q]=l.useState(""),[A,k]=l.useState(!1),[L,I]=l.useState([]),[D,P]=l.useState(0),[R,V]=l.useState(null),H=()=>C([...h,""]),U=(a,r)=>{const s=[...h];s[a]=r,C(s)},K=a=>{C(h.filter((r,s)=>s!==a))},X=()=>S([...x,""]),G=(a,r)=>{const s=[...x];s[a]=r,S(s)},J=a=>{S(x.filter((r,s)=>s!==a))},Q=()=>y([...j,""]),W=(a,r)=>{const s=[...j];s[a]=r,y(s)},Y=a=>{y(j.filter((r,s)=>s!==a))},Z=()=>{T([...u,{id:Date.now().toString(),field:"nombre",value:""}])},F=(a,r)=>{T(u.map(s=>s.id===a?{...s,...r}:s))},$=a=>{T(u.filter(r=>r.id!==a))},ee=()=>{w([...g,{field:"fecha_creacion",from:"",to:""}])},_=(a,r)=>{const s=[...g];s[a]={...s[a],...r},w(s)},se=a=>{w(g.filter((r,s)=>s!==a))},ae=async()=>{k(!0);try{const a={must:h.filter(s=>s.trim()!==""),should:x.filter(s=>s.trim()!==""),must_not:j.filter(s=>s.trim()!==""),fields:{},date_range:{}};u.forEach(s=>{s.value.trim()&&(a.fields[s.field]=s.value)}),g.forEach(s=>{(s.from||s.to)&&(a.date_range[s.field]={from:s.from||void 0,to:s.to||void 0})}),b.trim()&&(a.keywords=b.split(",").map(s=>s.trim()));const r=await re.post("/search/advanced",{...a,type:"documentos",size:20,aggregations:["tipo_documento","serie_documental_nombre","estado"]});if(r.data.success){const s=r.data.data;I(s.results),P(s.total),V(s.aggregations)}}catch(a){console.error("Error en búsqueda avanzada:",a)}finally{k(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(le,{children:[e.jsx(ie,{className:"h-4 w-4"}),e.jsxs(te,{children:[e.jsx("strong",{children:"Operadores disponibles:"})," Use ",e.jsx("code",{children:"*"})," y ",e.jsx("code",{children:"?"})," como comodines, ",e.jsx("code",{children:"=término"})," para búsqueda exacta. Los campos se combinan con lógica booleana (AND, OR, NOT)."]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(t,{children:[e.jsxs(o,{children:[e.jsxs(n,{className:"flex items-center gap-2",children:[e.jsx(v,{variant:"default",children:"AND"}),"Términos que DEBEN estar"]}),e.jsx(p,{children:"Todos estos términos deben aparecer en los resultados"})]}),e.jsxs(i,{className:"space-y-2",children:[h.map((a,r)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{value:a,onChange:s=>U(r,s.target.value),placeholder:"ej: contrato, doc-2024-*"}),h.length>1&&e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>K(r),children:e.jsx(f,{className:"h-4 w-4"})})]},r)),e.jsxs(c,{variant:"outline",size:"sm",onClick:H,className:"w-full",children:[e.jsx(N,{className:"h-4 w-4 mr-2"}),"Agregar término AND"]})]})]}),e.jsxs(t,{children:[e.jsxs(o,{children:[e.jsxs(n,{className:"flex items-center gap-2",children:[e.jsx(v,{variant:"secondary",children:"OR"}),"Términos opcionales"]}),e.jsx(p,{children:"Al menos uno de estos términos debe aparecer"})]}),e.jsxs(i,{className:"space-y-2",children:[x.map((a,r)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{value:a,onChange:s=>G(r,s.target.value),placeholder:"ej: 2024, 2025"}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>J(r),children:e.jsx(f,{className:"h-4 w-4"})})]},r)),x.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No hay términos opcionales"}),e.jsxs(c,{variant:"outline",size:"sm",onClick:X,className:"w-full",children:[e.jsx(N,{className:"h-4 w-4 mr-2"}),"Agregar término OR"]})]})]}),e.jsxs(t,{children:[e.jsxs(o,{children:[e.jsxs(n,{className:"flex items-center gap-2",children:[e.jsx(v,{variant:"destructive",children:"NOT"}),"Términos excluidos"]}),e.jsx(p,{children:"Estos términos NO deben aparecer en los resultados"})]}),e.jsxs(i,{className:"space-y-2",children:[j.map((a,r)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{value:a,onChange:s=>W(r,s.target.value),placeholder:"ej: borrador, cancelado"}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>Y(r),children:e.jsx(f,{className:"h-4 w-4"})})]},r)),j.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No hay términos excluidos"}),e.jsxs(c,{variant:"outline",size:"sm",onClick:Q,className:"w-full",children:[e.jsx(N,{className:"h-4 w-4 mr-2"}),"Agregar término NOT"]})]})]}),e.jsxs(t,{children:[e.jsxs(o,{children:[e.jsx(n,{children:"Búsqueda por campos"}),e.jsx(p,{children:"Buscar en campos específicos del documento"})]}),e.jsxs(i,{className:"space-y-2",children:[u.map(a=>e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(M,{value:a.field,onValueChange:r=>F(a.id,{field:r}),children:[e.jsx(B,{className:"w-[180px]",children:e.jsx(O,{})}),e.jsxs(E,{children:[e.jsx(m,{value:"nombre",children:"Nombre"}),e.jsx(m,{value:"codigo",children:"Código"}),e.jsx(m,{value:"descripcion",children:"Descripción"}),e.jsx(m,{value:"contenido",children:"Contenido"}),e.jsx(m,{value:"usuario_creador",children:"Usuario"})]})]}),e.jsx(d,{value:a.value,onChange:r=>F(a.id,{value:r.target.value}),placeholder:"Valor a buscar..."}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>$(a.id),children:e.jsx(f,{className:"h-4 w-4"})})]},a.id)),u.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No hay búsquedas por campo"}),e.jsxs(c,{variant:"outline",size:"sm",onClick:Z,className:"w-full",children:[e.jsx(N,{className:"h-4 w-4 mr-2"}),"Agregar campo"]})]})]})]}),e.jsxs(t,{children:[e.jsxs(o,{children:[e.jsx(n,{children:"Rangos de Fecha"}),e.jsx(p,{children:"Filtrar por períodos de tiempo"})]}),e.jsxs(i,{className:"space-y-4",children:[g.map((a,r)=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 items-end",children:[e.jsxs("div",{children:[e.jsx(z,{children:"Campo"}),e.jsxs(M,{value:a.field,onValueChange:s=>_(r,{field:s}),children:[e.jsx(B,{children:e.jsx(O,{})}),e.jsxs(E,{children:[e.jsx(m,{value:"fecha_creacion",children:"Fecha Creación"}),e.jsx(m,{value:"fecha_modificacion",children:"Fecha Modificación"})]})]})]}),e.jsxs("div",{children:[e.jsx(z,{children:"Desde"}),e.jsx(d,{type:"date",value:a.from,onChange:s=>_(r,{from:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(z,{children:"Hasta"}),e.jsx(d,{type:"date",value:a.to,onChange:s=>_(r,{to:s.target.value})})]}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>se(r),children:e.jsx(f,{className:"h-4 w-4"})})]},r)),e.jsxs(c,{variant:"outline",size:"sm",onClick:ee,className:"w-full",children:[e.jsx(N,{className:"h-4 w-4 mr-2"}),"Agregar rango de fecha"]})]})]}),e.jsxs(t,{children:[e.jsxs(o,{children:[e.jsx(n,{children:"Palabras Clave"}),e.jsx(p,{children:"Separadas por comas"})]}),e.jsx(i,{children:e.jsx(d,{value:b,onChange:a=>q(a.target.value),placeholder:"ej: contrato, servicios profesionales, consultoría"})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(c,{onClick:ae,disabled:A,size:"lg",children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),A?"Buscando...":"Realizar Búsqueda Avanzada"]})}),D>0&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[R&&e.jsxs(t,{className:"lg:col-span-1",children:[e.jsx(o,{children:e.jsx(n,{children:"Filtros"})}),e.jsx(i,{className:"space-y-4",children:Object.entries(R).map(([a,r])=>e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm mb-2 capitalize",children:a.replace(/_/g," ")}),e.jsx("div",{className:"space-y-1",children:r.buckets?.slice(0,5).map(s=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:s.key}),e.jsx(v,{variant:"secondary",children:s.doc_count})]},s.key))})]},a))})]}),e.jsxs("div",{className:"lg:col-span-3 space-y-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Se encontraron ",e.jsx("strong",{children:D})," resultados"]}),L.map(a=>e.jsx(t,{children:e.jsx(i,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(ce,{className:"h-6 w-6 text-primary"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold",children:a.source.nombre}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.source.codigo}),a.highlights?.contenido&&e.jsx("p",{className:"text-sm mt-2",dangerouslySetInnerHTML:{__html:a.highlights.contenido[0]}})]}),e.jsxs(v,{children:["Score: ",a.score.toFixed(2)]})]})})},a.id))]})]})]})}export{be as default};
