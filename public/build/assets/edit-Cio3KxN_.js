import{u as J,r as j,j as e,H as Q,L as P}from"./app-B0qTBAke.js";import{A as X}from"./app-layout-DHqjcPJw.js";import{C as p,a as g,b as v,d as b,c as B}from"./card-D4UBhCKF.js";import{B as d}from"./app-logo-icon-BPz3oRny.js";import{L as c,I as m}from"./label-CjHZv5e4.js";import{T}from"./app-sidebar-layout-DFKjANJB.js";import{S as f,a as N,b as C,c as _,d as o}from"./select-bkkBUc_4.js";import{S as F}from"./switch-DM46ZHy3.js";import{B as k}from"./badge-BfEjTxB-.js";import{T as Y,a as Z,b as y,c as S}from"./tabs-CT2fp8nO.js";import{P as H}from"./plus-ElTEKlBd.js";import{T as ee}from"./trash-2-DsuLBN5D.js";import{S as se}from"./save-QBoNNjtv.js";import{A as ae}from"./arrow-left-DojSOgLu.js";import{C as ie}from"./circle-alert-D1kK7GTM.js";/* empty css            */import"./index-DDzTzhRc.js";import"./index-D-todNvr.js";import"./index-C5MwE6sO.js";import"./check-dE-FsShf.js";function ye({plantilla:a,series:w,categorias:I}){const{data:i,setData:r,put:M,processing:q,errors:h,isDirty:A}=J({nombre:a.nombre||"",descripcion:a.descripcion||"",categoria:a.categoria||"otro",tipo_documento:a.tipo_documento||"",serie_documental_id:a.serie_documental_id?.toString()||"",subserie_documental_id:a.subserie_documental_id?.toString()||"",contenido_html:a.contenido_html||"",campos_variables:a.campos_variables||[],metadatos_predefinidos:a.metadatos_predefinidos||{},configuracion_formato:a.configuracion_formato||{},es_publica:a.es_publica||!1,tags:a.tags||[],observaciones:a.observaciones||""}),[D,U]=j.useState(w.find(s=>s.id.toString()===i.serie_documental_id)||null),[u,E]=j.useState(""),[n,t]=j.useState({nombre:"",tipo:"texto",etiqueta:"",requerido:!1,valor_defecto:"",opciones:[]}),[G,L]=j.useState(!1),R=s=>{s.preventDefault(),M(route("admin.plantillas.update",a.id))},z=s=>{const l=w.find(x=>x.id.toString()===s);U(l||null),r("serie_documental_id",s),r("subserie_documental_id","")},V=()=>{u.trim()&&!i.tags.includes(u.trim())&&(r("tags",[...i.tags,u.trim()]),E(""))},W=s=>{r("tags",i.tags.filter((l,x)=>x!==s))},K=()=>{n.nombre&&n.etiqueta&&(r("campos_variables",[...i.campos_variables,{...n}]),t({nombre:"",tipo:"texto",etiqueta:"",requerido:!1,valor_defecto:"",opciones:[]}))},$=s=>{r("campos_variables",i.campos_variables.filter((l,x)=>x!==s))},O=s=>{A&&(s.preventDefault(),L(!0))};return e.jsxs(X,{header:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(P,{href:route("admin.plantillas.show",a.id),className:"text-gray-500 hover:text-gray-700",onClick:O,children:e.jsx(ae,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-800",children:["Editar Plantilla: ",a.nombre]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600 mt-1",children:[e.jsx("span",{children:a.codigo}),e.jsxs("span",{children:["v",a.version]}),e.jsx(k,{className:"text-xs",children:a.estado})]})]})]}),A&&e.jsxs("div",{className:"flex items-center space-x-2 text-amber-600",children:[e.jsx(ie,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Cambios sin guardar"})]})]}),children:[e.jsx(Q,{title:`Editar: ${a.nombre}`}),e.jsx("div",{className:"py-6",children:e.jsx("div",{className:"max-w-4xl mx-auto sm:px-6 lg:px-8",children:e.jsxs("form",{onSubmit:R,className:"space-y-6",children:[e.jsxs(Y,{defaultValue:"basicos",className:"w-full",children:[e.jsxs(Z,{className:"grid w-full grid-cols-4",children:[e.jsx(y,{value:"basicos",children:"Datos Básicos"}),e.jsx(y,{value:"contenido",children:"Contenido"}),e.jsx(y,{value:"variables",children:"Variables"}),e.jsx(y,{value:"configuracion",children:"Configuración"})]}),e.jsx(S,{value:"basicos",className:"space-y-6",children:e.jsxs(p,{children:[e.jsx(g,{children:e.jsx(v,{children:"Información General"})}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"nombre",children:"Nombre de la Plantilla *"}),e.jsx(m,{id:"nombre",value:i.nombre,onChange:s=>r("nombre",s.target.value),className:h.nombre?"border-red-500":""}),h.nombre&&e.jsx("p",{className:"text-sm text-red-600",children:h.nombre})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"categoria",children:"Categoría *"}),e.jsxs(f,{value:i.categoria,onValueChange:s=>r("categoria",s),children:[e.jsx(N,{className:h.categoria?"border-red-500":"",children:e.jsx(C,{})}),e.jsx(_,{children:Object.entries(I).map(([s,l])=>e.jsx(o,{value:s,children:l},s))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"descripcion",children:"Descripción"}),e.jsx(T,{id:"descripcion",value:i.descripcion,onChange:s=>r("descripcion",s.target.value),rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"tipo_documento",children:"Tipo de Documento"}),e.jsx(m,{id:"tipo_documento",value:i.tipo_documento,onChange:s=>r("tipo_documento",s.target.value),placeholder:"Ej: Memorando interno, Oficio externo..."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Serie Documental"}),e.jsxs(f,{value:i.serie_documental_id,onValueChange:z,children:[e.jsx(N,{children:e.jsx(C,{placeholder:"Seleccionar serie"})}),e.jsxs(_,{children:[e.jsx(o,{value:"",children:"Sin serie específica"}),w.map(s=>e.jsxs(o,{value:s.id.toString(),children:[s.codigo," - ",s.nombre]},s.id))]})]})]}),D?.subseries&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Subserie Documental"}),e.jsxs(f,{value:i.subserie_documental_id,onValueChange:s=>r("subserie_documental_id",s),children:[e.jsx(N,{children:e.jsx(C,{placeholder:"Seleccionar subserie"})}),e.jsxs(_,{children:[e.jsx(o,{value:"",children:"Sin subserie"}),D.subseries.map(s=>e.jsxs(o,{value:s.id.toString(),children:[s.codigo," - ",s.nombre]},s.id))]})]})]})]})]})]})}),e.jsx(S,{value:"contenido",className:"space-y-6",children:e.jsxs(p,{children:[e.jsxs(g,{children:[e.jsx(v,{children:"Contenido HTML"}),e.jsx(B,{children:"Modifica el contenido base de la plantilla usando HTML"})]}),e.jsxs(b,{children:[e.jsx(T,{value:i.contenido_html,onChange:s=>r("contenido_html",s.target.value),rows:12,placeholder:"Ingresa el contenido HTML de la plantilla...",className:"font-mono text-sm"}),e.jsxs("div",{className:"mt-2 text-sm text-gray-500",children:[e.jsxs("p",{children:["Puedes usar variables con la sintaxis: ",e.jsx("code",{children:"{{VARIABLE_NAME}}"})]}),e.jsxs("p",{children:["Variables del sistema disponibles: ",e.jsx("code",{children:"{{FECHA_ACTUAL}}, {{USUARIO_ACTUAL}}, {{CODIGO_DOCUMENTO}}"})]})]})]})]})}),e.jsx(S,{value:"variables",className:"space-y-6",children:e.jsxs(p,{children:[e.jsxs(g,{children:[e.jsx(v,{children:"Campos Variables"}),e.jsx(B,{children:"Administra los campos que se pueden personalizar al generar documentos"})]}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 p-4 border rounded-lg",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Nombre de la Variable"}),e.jsx(m,{value:n.nombre,onChange:s=>t({...n,nombre:s.target.value}),placeholder:"nombre_variable"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Etiqueta"}),e.jsx(m,{value:n.etiqueta,onChange:s=>t({...n,etiqueta:s.target.value}),placeholder:"Etiqueta visible"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Tipo"}),e.jsxs(f,{value:n.tipo,onValueChange:s=>t({...n,tipo:s}),children:[e.jsx(N,{children:e.jsx(C,{})}),e.jsxs(_,{children:[e.jsx(o,{value:"texto",children:"Texto"}),e.jsx(o,{value:"numero",children:"Número"}),e.jsx(o,{value:"fecha",children:"Fecha"}),e.jsx(o,{value:"email",children:"Email"}),e.jsx(o,{value:"textarea",children:"Texto largo"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Valor por defecto"}),e.jsx(m,{value:n.valor_defecto,onChange:s=>t({...n,valor_defecto:s.target.value}),placeholder:"Valor inicial"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{checked:n.requerido,onCheckedChange:s=>t({...n,requerido:s})}),e.jsx(c,{children:"Campo requerido"})]}),e.jsx("div",{children:e.jsxs(d,{type:"button",onClick:K,variant:"outline",children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Agregar Campo"]})})]}),i.campos_variables.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium",children:"Campos configurados:"}),i.campos_variables.map((s,l)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:s.etiqueta}),e.jsxs("span",{className:"ml-2 text-sm text-gray-500",children:["(",s.nombre," - ",s.tipo,")"]}),s.requerido&&e.jsx(k,{variant:"secondary",className:"ml-2",children:"Requerido"})]}),e.jsx(d,{type:"button",variant:"ghost",size:"sm",onClick:()=>$(l),children:e.jsx(ee,{className:"w-4 h-4"})})]},l))]})]})]})}),e.jsx(S,{value:"configuracion",className:"space-y-6",children:e.jsxs(p,{children:[e.jsx(g,{children:e.jsx(v,{children:"Configuración Adicional"})}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{checked:i.es_publica,onCheckedChange:s=>r("es_publica",s)}),e.jsx(c,{children:"Plantilla pública (disponible para todos los usuarios)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Tags"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(m,{value:u,onChange:s=>E(s.target.value),placeholder:"Agregar tag",onKeyPress:s=>s.key==="Enter"&&(s.preventDefault(),V())}),e.jsx(d,{type:"button",onClick:V,variant:"outline",children:e.jsx(H,{className:"w-4 h-4"})})]}),i.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:i.tags.map((s,l)=>e.jsxs(k,{variant:"secondary",className:"cursor-pointer",onClick:()=>W(l),children:[s," ×"]},l))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Observaciones"}),e.jsx(T,{value:i.observaciones,onChange:s=>r("observaciones",s.target.value),rows:3,placeholder:"Notas adicionales sobre la plantilla"})]})]})]})})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(P,{href:route("admin.plantillas.show",a.id),className:"inline-flex items-center px-4 py-2 bg-gray-300 border border-transparent rounded-md font-semibold text-xs text-gray-700 uppercase tracking-widest hover:bg-gray-400",onClick:O,children:"Cancelar"}),e.jsxs(d,{type:"submit",disabled:q,children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),q?"Guardando...":"Guardar Cambios"]})]})]})})}),G&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg max-w-md",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"¿Descartar cambios?"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Tienes cambios sin guardar. ¿Estás seguro de que quieres salir sin guardar?"}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(d,{variant:"outline",onClick:()=>L(!1),children:"Continuar editando"}),e.jsx(d,{variant:"destructive",onClick:()=>window.history.back(),children:"Descartar cambios"})]})]})})]})}export{ye as default};
