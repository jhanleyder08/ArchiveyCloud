import{r as g,u as $,U as X,j as e,H as G,L as J}from"./app-xP5nJVeF.js";import{f as K,A as Q,D as w,g as S,a as D,b as _,c as F,d as z,T as R}from"./app-sidebar-layout-Bv9w89yC.js";import{B as i}from"./button-B_iUXIQd.js";import{C as d,a as o,b as m,c as x,d as W}from"./card-CWOinnut.js";import{B as v,F as Y}from"./Combination-BMQq9fx8.js";import{S as Z,a as ee,b as se,c as ae,d as re}from"./select-CeZZq-kY.js";import{L as N}from"./label-CXywCScm.js";import{A as L,a as T}from"./alert-BVrZsLZW.js";import{T as ie}from"./triangle-alert-3Hg381hi.js";import{P as A}from"./pen-tool-DBY51gzP.js";import{U as te}from"./user-OU0Y1c1r.js";import{C as ce}from"./calendar-Bn3iJna_.js";import{C as E}from"./circle-x-mSiP6KhD.js";import{C as k}from"./folder-Ck8Tq3sH.js";import{C as le}from"./circle-check-big-C9Zhhz8Y.js";/* empty css            */import"./index-DbDMva29.js";import"./index-D2eHBSbe.js";import"./index-Blg4NNxt.js";import"./x-CBQbsaML.js";import"./app-logo-icon-8EdVYcX9.js";import"./input-DQqwP0kM.js";import"./mail-C5oL3AE1.js";import"./users-DpyCPIO9.js";import"./search-eio2uEn4.js";import"./BrandingProvider-BV5yFGOU.js";import"./index-B00g0JPb.js";import"./check-C5qgcy3h.js";function Me({solicitud:a,firmante_actual:ne,puede_firmar:t,progreso:de,estadisticas:c}){const[V,B]=g.useState([]),[h,j]=g.useState(!1),[P,u]=g.useState(!1),{data:r,setData:f,post:y,processing:l,errors:oe,reset:C}=$({certificado_id:"",comentario:"",razon:""}),M=s=>{switch(s){case"completada":return"secondary";case"en_proceso":return"default";case"pendiente":return"outline";case"cancelada":case"vencida":return"destructive";default:return"outline"}},U=s=>{switch(s){case"urgente":return"text-red-600 bg-red-100";case"alta":return"text-orange-600 bg-orange-100";case"normal":return"text-blue-600 bg-blue-100";case"baja":return"text-gray-600 bg-gray-100";default:return"text-gray-600 bg-gray-100"}},q=s=>{switch(s){case"firmado":return e.jsx(le,{className:"h-4 w-4 text-green-500"});case"rechazado":return e.jsx(E,{className:"h-4 w-4 text-red-500"});case"pendiente":return e.jsx(k,{className:"h-4 w-4 text-yellow-500"});default:return e.jsx(k,{className:"h-4 w-4 text-gray-500"})}},n=s=>new Date(s).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),b=s=>new Date(s)<new Date,H=()=>{r.certificado_id&&y(route("admin.firmas.solicitud.firmar",a.id),{onSuccess:()=>{C(),j(!1)}})},O=()=>{r.comentario.trim()&&y(route("admin.firmas.solicitud.rechazar",a.id),{onSuccess:()=>{C(),u(!1)}})},I=async()=>{try{const p=await(await fetch(route("admin.firmas.api.certificados"))).json();B(p)}catch(s){console.error("Error cargando certificados:",s)}};return X.useEffect(()=>{t&&h&&I()},[t,h]),e.jsxs(K,{children:[e.jsx(G,{title:`Solicitud: ${a.titulo}`}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(J,{href:route("admin.firmas.solicitudes"),children:e.jsxs(i,{variant:"outline",size:"sm",children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Volver"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:a.titulo}),e.jsxs("p",{className:"text-muted-foreground",children:["Solicitud de firma digital - ",n(a.created_at)]})]})]}),e.jsx(v,{variant:M(a.estado),className:"text-base px-3 py-1",children:a.estado.replace("_"," ").toUpperCase()})]}),b(a.fecha_limite)&&a.estado!=="completada"&&e.jsxs(L,{variant:"destructive",children:[e.jsx(ie,{className:"h-4 w-4"}),e.jsxs(T,{children:[e.jsx("strong",{children:"¡Solicitud Vencida!"})," La fecha límite para firmar era el ",n(a.fecha_limite),"."]})]}),t&&e.jsxs(L,{children:[e.jsx(A,{className:"h-4 w-4"}),e.jsxs(T,{children:[e.jsx("strong",{children:"Acción Requerida:"})," Esta solicitud requiere tu firma."]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(d,{children:[e.jsx(o,{children:e.jsx(m,{children:"Detalles de la Solicitud"})}),e.jsxs(x,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Documento"}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx(Y,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium",children:a.documento.nombre})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Solicitante"}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx(te,{className:"h-4 w-4 text-gray-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:a.solicitante.name}),e.jsx("div",{className:"text-sm text-gray-500",children:a.solicitante.email})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Prioridad"}),e.jsx("div",{className:"mt-1",children:e.jsx(v,{className:U(a.prioridad),children:a.prioridad.toUpperCase()})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Fecha Límite"}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx(ce,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:b(a.fecha_limite)?"text-red-600 font-medium":"",children:n(a.fecha_limite)})]})]})]}),a.descripcion&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Descripción"}),e.jsx("p",{className:"mt-1 text-gray-900",children:a.descripcion})]})]})]})}),e.jsxs("div",{children:[e.jsxs(d,{children:[e.jsx(o,{children:e.jsx(m,{children:"Progreso"})}),e.jsxs(x,{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-3xl font-bold text-blue-600",children:[c.porcentaje_avance,"%"]}),e.jsx("div",{className:"text-sm text-gray-500",children:"Completado"})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:"bg-blue-600 h-3 rounded-full transition-all duration-300",style:{width:`${c.porcentaje_avance}%`}})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold text-green-600",children:c.firmantes_completados}),e.jsx("div",{className:"text-gray-500",children:"Firmados"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold text-yellow-600",children:c.firmantes_pendientes}),e.jsx("div",{className:"text-gray-500",children:"Pendientes"})]})]})]})]}),t&&e.jsxs(d,{children:[e.jsx(o,{children:e.jsx(m,{children:"Acciones"})}),e.jsxs(x,{className:"space-y-3",children:[e.jsxs(w,{open:h,onOpenChange:j,children:[e.jsx(S,{asChild:!0,children:e.jsxs(i,{className:"w-full",children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Firmar Documento"]})}),e.jsxs(D,{children:[e.jsxs(_,{children:[e.jsx(F,{children:"Firmar Documento"}),e.jsx(z,{children:"Selecciona un certificado digital para firmar."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Certificado Digital"}),e.jsxs(Z,{value:r.certificado_id,onValueChange:s=>f("certificado_id",s),children:[e.jsx(ee,{children:e.jsx(se,{placeholder:"Selecciona un certificado"})}),e.jsx(ae,{children:V.map(s=>e.jsx(re,{value:s.id.toString(),children:s.nombre_certificado},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Comentario (opcional)"}),e.jsx(R,{placeholder:"Comentario sobre la firma...",value:r.comentario,onChange:s=>f("comentario",s.target.value)})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(i,{variant:"outline",onClick:()=>j(!1),children:"Cancelar"}),e.jsx(i,{onClick:H,disabled:l||!r.certificado_id,children:l?"Firmando...":"Firmar"})]})]})]})]}),e.jsxs(w,{open:P,onOpenChange:u,children:[e.jsx(S,{asChild:!0,children:e.jsxs(i,{variant:"destructive",className:"w-full",children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"Rechazar Firma"]})}),e.jsxs(D,{children:[e.jsxs(_,{children:[e.jsx(F,{children:"Rechazar Firma"}),e.jsx(z,{children:"Explica el motivo del rechazo."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Motivo del Rechazo"}),e.jsx(R,{placeholder:"Describe el motivo...",value:r.comentario,onChange:s=>f("comentario",s.target.value),required:!0})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(i,{variant:"outline",onClick:()=>u(!1),children:"Cancelar"}),e.jsx(i,{variant:"destructive",onClick:O,disabled:l||!r.comentario.trim(),children:l?"Rechazando...":"Rechazar"})]})]})]})]})]})]})]})]}),e.jsxs(d,{children:[e.jsxs(o,{children:[e.jsx(m,{children:"Lista de Firmantes"}),e.jsx(W,{children:"Estado actual de todos los firmantes requeridos"})]}),e.jsx(x,{children:e.jsx("div",{className:"space-y-4",children:a.firmantes.sort((s,p)=>s.orden-p.orden).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-gray-100 rounded-full text-sm font-medium",children:s.orden}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.usuario.name}),e.jsx("div",{className:"text-sm text-gray-500",children:s.usuario.email}),e.jsxs("div",{className:"text-xs text-gray-400",children:["Rol: ",s.rol," • ",s.es_obligatorio?"Obligatorio":"Opcional"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[s.fecha_firma&&e.jsxs("div",{className:"text-right text-sm",children:[e.jsx("div",{className:"text-gray-500",children:"Firmado el"}),e.jsx("div",{children:n(s.fecha_firma)})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[q(s.estado),e.jsx(v,{variant:s.estado==="firmado"?"secondary":s.estado==="rechazado"?"destructive":"outline",children:s.estado})]})]})]},s.id))})})]})]})]})}export{Me as default};
