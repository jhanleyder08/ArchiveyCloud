import{r as d,j as e,H as R,b as m}from"./app-CzZfNEMG.js";import{A as D,h as z,Z as k,S as H}from"./app-sidebar-layout-BH_Z10xo.js";import{C as i,a as r,b as l,c}from"./card-CHF2_ig2.js";import{B as x}from"./badge-RnSsEqGQ.js";import{B as n}from"./button-CZJk1vjh.js";import{T as L,a as B,b as h,c as u}from"./tabs-DzQb_ExH.js";import{A as I,b as M,a as $}from"./alert-B3pnC4qb.js";import{P as G}from"./progress-BTcTT-rF.js";import{R as U}from"./refresh-cw-C33pK0Iv.js";import{S as V}from"./server-DpKffW2m.js";import{C as K}from"./folder-ClID6aRq.js";import{A as X}from"./activity-BES0zmMm.js";import{R as Z,T as q}from"./CategoricalChart-xzkRj9VX.js";import{P as F,a as J}from"./PieChart-DaeBZV29.js";import{C as j}from"./circle-check-big-lJx04cPN.js";import{T as f}from"./triangle-alert-CEYdEpcT.js";import{P as Q}from"./play-tPV5tswQ.js";import{M as W}from"./memory-stick-CiaN_qJn.js";import{T as Y}from"./users-BuwlM3Dr.js";import{H as ee}from"./hard-drive-DWx1ElbB.js";import{C as O}from"./circle-x-DFedB5nM.js";/* empty css            */import"./index-BikH_P-B.js";import"./Combination-CRSv8Un1.js";import"./index-51s4Rglt.js";import"./index-CsouXilf.js";import"./x-Dzj_Otdy.js";import"./index-oNndzBH7.js";import"./app-logo-icon-hcNu0Dj9.js";import"./input-B_he8Fbm.js";import"./label-B8oRZ8zF.js";import"./user-B02Cd3Hv.js";import"./search-grvsL_9-.js";import"./tooltipContext-C5NtLEel.js";function De({systemStatus:T,optimizationHistory:N,cacheStatistics:A,healthStatus:E}){const[o,g]=d.useState(!1),[y,v]=d.useState(!1),[t,_]=d.useState({systemStatus:T,cacheStatistics:A,healthStatus:E});d.useEffect(()=>{const s=setInterval(()=>{b()},3e4);return()=>clearInterval(s)},[]);const b=async()=>{v(!0);try{const s=await fetch(route("admin.optimizacion.system-status"));if(s.ok){const a=await s.json();_({systemStatus:a.system_status,cacheStatistics:a.cache_stats,healthStatus:a.health_status})}}catch(s){console.error("Error refreshing system data:",s)}finally{v(!1)}},p=async(s={})=>{g(!0);try{const C=await(await fetch(route("admin.optimizacion.run-optimization"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify(s)})).json();C.success?(alert("Optimización ejecutada exitosamente"),m.reload()):alert("Error durante la optimización: "+C.message)}catch(a){console.error("Error running optimization:",a),alert("Error interno del servidor")}finally{g(!1)}},P=s=>{switch(s.toLowerCase()){case"healthy":case"ok":return"text-green-600";case"warning":return"text-yellow-600";case"error":case"failed":return"text-red-600";default:return"text-gray-600"}},w=s=>{switch(s.toLowerCase()){case"healthy":case"ok":return e.jsx(j,{className:"h-4 w-4 text-green-600"});case"warning":return e.jsx(f,{className:"h-4 w-4 text-yellow-600"});case"error":case"failed":return e.jsx(O,{className:"h-4 w-4 text-red-600"});default:return e.jsx(f,{className:"h-4 w-4 text-gray-600"})}};t.healthStatus.checks.map(s=>({name:s.name,value:s.status==="ok"?1:0,status:s.status}));const S={ok:"#10b981",error:"#ef4444"};return e.jsxs(D,{children:[e.jsx(R,{title:"Optimización del Sistema"}),e.jsx("div",{className:"py-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between bg-white p-6 rounded-lg shadow",children:[e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Sistema de Optimización y Monitoreo"}),e.jsxs(n,{onClick:b,variant:"outline",size:"sm",disabled:y,className:"flex items-center gap-2",children:[e.jsx(U,{className:`h-4 w-4 ${y?"animate-spin":""}`}),"Actualizar"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(i,{children:[e.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:"Estado del Sistema"}),e.jsx(V,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(c,{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[w(t.healthStatus.status),e.jsx("div",{className:"text-2xl font-bold",children:t.healthStatus.status.toUpperCase()})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[t.systemStatus.environment," • PHP ",t.systemStatus.php_version]})]})]}),e.jsxs(i,{children:[e.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:"Caché"}),e.jsx(z,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold",children:typeof t.cacheStatistics.hit_ratio=="number"?`${t.cacheStatistics.hit_ratio}%`:"N/A"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Hit Ratio • ",t.cacheStatistics.driver]})]})]}),e.jsxs(i,{children:[e.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:"Optimización"}),e.jsx(k,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold",children:e.jsx(x,{variant:t.systemStatus.optimization_enabled?"default":"secondary",children:t.systemStatus.optimization_enabled?"Habilitada":"Deshabilitada"})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t.systemStatus.opcache_enabled?"OPcache activo":"OPcache inactivo"})]})]}),e.jsxs(i,{children:[e.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:"Uptime"}),e.jsx(K,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t.systemStatus.uptime!=="N/A"?t.systemStatus.uptime.replace("up ",""):"N/A"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Sistema activo"})]})]})]}),e.jsxs(L,{defaultValue:"dashboard",className:"space-y-6",children:[e.jsxs(B,{className:"grid w-full grid-cols-4",children:[e.jsx(h,{value:"dashboard",children:"Dashboard"}),e.jsx(h,{value:"optimization",children:"Optimización"}),e.jsx(h,{value:"health",children:"Health Checks"}),e.jsx(h,{value:"history",children:"Historial"})]}),e.jsx(u,{value:"dashboard",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(i,{children:[e.jsx(r,{children:e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5"}),"Estado de Servicios"]})}),e.jsx(c,{children:e.jsx(Z,{width:"100%",height:300,children:e.jsxs(F,{children:[e.jsx(J,{data:[{name:"Saludables",value:t.healthStatus.checks.filter(s=>s.status==="ok").length,fill:S.ok},{name:"Con problemas",value:t.healthStatus.checks.filter(s=>s.status!=="ok").length,fill:S.error}],cx:"50%",cy:"50%",outerRadius:80,dataKey:"value",label:({name:s,value:a})=>`${s}: ${a}`}),e.jsx(q,{})]})})})]}),e.jsxs(i,{children:[e.jsx(r,{children:e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(j,{className:"h-5 w-5"}),"Verificaciones del Sistema"]})}),e.jsxs(c,{className:"space-y-3",children:[t.healthStatus.checks.map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[w(s.status),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),s.message&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.message})]})]}),e.jsx(x,{variant:s.status==="ok"?"default":"destructive",children:s.status})]},a)),t.healthStatus.checks.length===0&&e.jsx("p",{className:"text-center text-muted-foreground py-4",children:"No hay datos de health checks disponibles"})]})]})]})}),e.jsx(u,{value:"optimization",className:"space-y-4",children:e.jsxs(i,{children:[e.jsx(r,{children:e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-5 w-5"}),"Ejecutar Optimización"]})}),e.jsxs(c,{className:"space-y-4",children:[e.jsxs(I,{children:[e.jsx(f,{className:"h-4 w-4"}),e.jsx(M,{children:"Importante"}),e.jsx($,{children:"La optimización mejorará el rendimiento del sistema pero puede tomar varios minutos. Se recomienda ejecutar durante períodos de bajo tráfico."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(n,{onClick:()=>p({dry_run:!0}),disabled:o,variant:"outline",className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-4 w-4"}),"Simular Optimización"]}),e.jsxs(n,{onClick:()=>p(),disabled:o,className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4"}),o?"Ejecutando...":"Optimización Completa"]}),e.jsxs(n,{onClick:()=>p({skip_cache:!0}),disabled:o,variant:"outline",className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4"}),"Sin Caché"]}),e.jsxs(n,{onClick:()=>m.visit(route("admin.optimizacion.cache")),variant:"outline",className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4"}),"Gestión de Caché"]})]}),o&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ejecutando optimización..."}),e.jsx(G,{value:void 0,className:"w-full"})]})]})]})}),e.jsx(u,{value:"health",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(i,{children:[e.jsx(r,{children:e.jsx(l,{children:"Estado General"})}),e.jsx(c,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Estado del Sistema:"}),e.jsx(x,{className:P(t.healthStatus.status),children:t.healthStatus.status})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Tiempo de Respuesta:"}),e.jsx("span",{className:"font-mono text-sm",children:t.healthStatus.response_time})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Servicios Verificados:"}),e.jsx("span",{className:"font-bold",children:t.healthStatus.checks.length})]})]})})]}),e.jsxs(i,{children:[e.jsx(r,{children:e.jsx(l,{children:"Acciones Rápidas"})}),e.jsxs(c,{className:"space-y-2",children:[e.jsxs(n,{onClick:()=>m.visit(route("admin.optimizacion.monitoring")),variant:"outline",className:"w-full justify-start",children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Monitoreo Detallado"]}),e.jsxs(n,{onClick:()=>m.visit(route("admin.optimizacion.backups")),variant:"outline",className:"w-full justify-start",children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Gestión de Backups"]})]})]})]})}),e.jsx(u,{value:"history",className:"space-y-4",children:e.jsxs(i,{children:[e.jsx(r,{children:e.jsx(l,{children:"Historial de Optimizaciones"})}),e.jsx(c,{children:e.jsxs("div",{className:"space-y-4",children:[N.map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[s.success?e.jsx(j,{className:"h-5 w-5 text-green-600"}):e.jsx(O,{className:"h-5 w-5 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.success?"Optimización exitosa":"Optimización fallida"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:new Date(s.timestamp).toLocaleString()}),s.options.length>0&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Opciones: ",s.options.join(", ")]})]})]}),e.jsxs(x,{variant:s.success?"default":"destructive",children:["Código: ",s.exit_code]})]},a)),N.length===0&&e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No hay historial de optimizaciones disponible"})]})})]})})]})]})})]})}export{De as default};
