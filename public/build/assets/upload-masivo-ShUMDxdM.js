import{r as d,u as Z,j as e,H as ee,a as T}from"./app-RHcSxCe3.js";import{A as se,X as ae,t as x,g as z,l as te}from"./app-layout-BOrikycp.js";import{c as re,B as c}from"./app-logo-icon-BF18vCvI.js";import{L as j}from"./label-DKq7ma2U.js";import{S as g,a as v,b,c as N,d as t}from"./select-CLRe-r8w.js";import{C as y,c as _,a as P,b as M}from"./card-By0YNH80.js";import{A as ie,a as ne}from"./alert-B-VMvUbq.js";import{P as V}from"./progress-BZEUKn5X.js";import{B as C}from"./badge-EzLnOWdl.js";import{A as le}from"./arrow-left-DJY94Jjb.js";import{I as oe}from"./info-BNDSLbLX.js";import{T as de}from"./trash-2-BP-ZB4eu.js";import{U as ce,I as me,V as xe,H as ue}from"./video-D2rydBb3.js";import{C as pe}from"./check-gaOx-mbL.js";import{M as he}from"./monitor-Hnj3TCMg.js";/* empty css            */import"./index-D0T5-hCw.js";import"./index-DY0oTJvG.js";import"./index-YNofFhZl.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]],L=re("CloudUpload",fe);function Te({expedientes:R}){const[n,u]=d.useState([]),[q,w]=d.useState(!1),[o,I]=d.useState(!1),[F,m]=d.useState(0),[S,k]=d.useState(null),E=d.useRef(null),{data:r,setData:p}=Z({expediente_id:"",estado_default:"borrador",confidencialidad_default:"interna",tipo_soporte_default:"electronico"}),H=[{title:"Inicio",href:"/dashboard"},{title:"Administración",href:"/admin"},{title:"Documentos",href:"/admin/documentos"},{title:"Subida Masiva",href:"/admin/documentos/upload/masivo"}],O=()=>Math.random().toString(36).substr(2,9),A=s=>{s.preventDefault(),s.stopPropagation(),s.type==="dragenter"||s.type==="dragover"?w(!0):s.type==="dragleave"&&w(!1)},U=s=>{s.preventDefault(),s.stopPropagation(),w(!1);const a=Array.from(s.dataTransfer.files);B(a)},G=s=>{if(s.target.files){const a=Array.from(s.target.files);B(a)}},B=s=>{const a=s.map(i=>({file:i,id:O(),status:"pending",progress:0}));u(i=>[...i,...a])},X=s=>{u(a=>a.filter(i=>i.id!==s))},$=()=>{u([]),k(null),m(0)},K=async()=>{if(n.length===0){x.error("No hay archivos seleccionados");return}if(!r.expediente_id){x.error("Selecciona un expediente");return}I(!0),m(0);const s=new FormData;n.forEach((a,i)=>{s.append(`archivos[${i}]`,a.file)}),s.append("expediente_id",r.expediente_id),s.append("configuracion[estado_default]",r.estado_default),s.append("configuracion[confidencialidad_default]",r.confidencialidad_default),s.append("configuracion[tipo_soporte_default]",r.tipo_soporte_default);try{const a=setInterval(()=>{m(h=>h>=90?(clearInterval(a),90):h+10)},300),l=await(await fetch("/admin/documentos/upload/masivo",{method:"POST",body:s,headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}})).json();clearInterval(a),m(100),l.success?(k(l.resultados),x.success(l.mensaje),u(h=>h.map(D=>{const f=l.resultados.detalles.find(Y=>Y.archivo===D.file.name);return f?{...D,status:f.estado==="exitoso"?"success":"error",progress:100,error:f.mensaje,codigo:f.codigo}:D}))):x.error(l.mensaje)}catch{m(0),x.error("Error en la subida masiva")}finally{I(!1)}},J=s=>{const a=s.split(".").pop()?.toLowerCase();return a?["jpg","jpeg","png","gif","bmp","svg","webp"].includes(a)?e.jsx(me,{className:"h-5 w-5 text-blue-500"}):["mp4","avi","mov","wmv","flv","webm"].includes(a)?e.jsx(xe,{className:"h-5 w-5 text-purple-500"}):["mp3","wav","ogg","flac","m4a"].includes(a)?e.jsx(ue,{className:"h-5 w-5 text-green-500"}):["zip","rar","7z","tar","gz"].includes(a)?e.jsx(te,{className:"h-5 w-5 text-orange-500"}):["xls","xlsx","ppt","pptx"].includes(a)?e.jsx(he,{className:"h-5 w-5 text-indigo-500"}):e.jsx(z,{className:"h-5 w-5 text-gray-500"}):e.jsx(z,{className:"h-5 w-5"})},Q=s=>{if(s===0)return"0 Bytes";const a=1024,i=["Bytes","KB","MB","GB"],l=Math.floor(Math.log(s)/Math.log(a));return parseFloat((s/Math.pow(a,l)).toFixed(2))+" "+i[l]},W=(s,a)=>{switch(s){case"pending":return e.jsx(C,{variant:"secondary",children:"Pendiente"});case"uploading":return e.jsx(C,{variant:"default",children:"Subiendo..."});case"success":return e.jsx(C,{variant:"default",className:"bg-green-100 text-green-800",children:"Exitoso"});case"error":return e.jsx(C,{variant:"destructive",title:a,className:"cursor-help",children:"Error"});default:return null}};return e.jsxs(se,{breadcrumbs:H,children:[e.jsx(ee,{title:"Subida Masiva de Documentos"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(L,{className:"h-6 w-6 text-[#2a3d83]"}),e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Subida Masiva de Documentos"})]}),e.jsxs(c,{type:"button",variant:"outline",onClick:()=>T.visit("/admin/documentos"),className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4"}),"Volver"]})]}),o&&e.jsx(y,{children:e.jsx(_,{className:"pt-6",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Procesando documentos..."}),e.jsxs("span",{children:[F,"%"]})]}),e.jsx(V,{value:F,className:"w-full"})]})})}),e.jsxs(y,{children:[e.jsx(P,{children:e.jsx(M,{children:"Configuración de Subida"})}),e.jsxs(_,{className:"space-y-4",children:[e.jsxs(ie,{children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsx(ne,{children:"Configura las opciones predeterminadas que se aplicarán a todos los documentos que subas de forma masiva."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(j,{htmlFor:"expediente_id",children:"Expediente *"}),e.jsxs(g,{value:r.expediente_id,onValueChange:s=>p("expediente_id",s),children:[e.jsx(v,{id:"expediente_id",children:e.jsx(b,{placeholder:"Seleccionar expediente"})}),e.jsx(N,{children:R.map(s=>e.jsxs(t,{value:s.id.toString(),children:[s.codigo," - ",s.nombre]},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"estado_default",children:"Estado por Defecto"}),e.jsxs(g,{value:r.estado_default,onValueChange:s=>p("estado_default",s),children:[e.jsx(v,{id:"estado_default",children:e.jsx(b,{})}),e.jsxs(N,{children:[e.jsx(t,{value:"borrador",children:"Borrador"}),e.jsx(t,{value:"pendiente",children:"Pendiente"}),e.jsx(t,{value:"activo",children:"Activo"})]})]})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"confidencialidad_default",children:"Confidencialidad"}),e.jsxs(g,{value:r.confidencialidad_default,onValueChange:s=>p("confidencialidad_default",s),children:[e.jsx(v,{id:"confidencialidad_default",children:e.jsx(b,{})}),e.jsxs(N,{children:[e.jsx(t,{value:"publica",children:"Pública"}),e.jsx(t,{value:"interna",children:"Interna"}),e.jsx(t,{value:"confidencial",children:"Confidencial"}),e.jsx(t,{value:"reservada",children:"Reservada"})]})]})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"tipo_soporte_default",children:"Tipo de Soporte"}),e.jsxs(g,{value:r.tipo_soporte_default,onValueChange:s=>p("tipo_soporte_default",s),children:[e.jsx(v,{id:"tipo_soporte_default",children:e.jsx(b,{})}),e.jsxs(N,{children:[e.jsx(t,{value:"electronico",children:"Electrónico"}),e.jsx(t,{value:"fisico",children:"Físico"}),e.jsx(t,{value:"hibrido",children:"Híbrido"})]})]})]})]})]})]}),e.jsxs(y,{children:[e.jsx(P,{children:e.jsxs(M,{className:"flex items-center justify-between",children:["Archivos (",n.length,")",n.length>0&&e.jsxs(c,{variant:"outline",size:"sm",onClick:$,disabled:o,children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Limpiar Todo"]})]})}),e.jsxs(_,{children:[e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-colors mb-6 ${q?"border-blue-400 bg-blue-50":"border-gray-300 hover:border-gray-400"}`,onDragEnter:A,onDragLeave:A,onDragOver:A,onDrop:U,children:[e.jsx(L,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-lg font-medium text-gray-900 mb-2",children:"Arrastra múltiples archivos aquí o haz clic para seleccionar"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Máximo 50 archivos. Formatos soportados: PDF, DOC, DOCX, JPG, PNG, MP4, MP3 y más"}),e.jsx(c,{type:"button",variant:"outline",onClick:()=>E.current?.click(),disabled:o,children:"Seleccionar Archivos"}),e.jsx("input",{ref:E,type:"file",className:"hidden",onChange:G,multiple:!0,accept:"*/*"})]}),n.length>0&&e.jsx("div",{className:"space-y-2 mb-6",children:n.map(s=>e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg",children:[e.jsx("div",{className:"flex-shrink-0",children:J(s.file.name)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:s.file.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[Q(s.file.size),s.codigo&&e.jsxs("span",{className:"ml-2 text-green-600",children:["→ ",s.codigo]})]}),s.status==="uploading"&&e.jsx("div",{className:"mt-1",children:e.jsx(V,{value:s.progress,className:"h-1"})})]}),e.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2",children:[W(s.status,s.error),s.status==="pending"&&e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>X(s.id),disabled:o,children:e.jsx(ae,{className:"h-4 w-4"})})]})]},s.id))}),n.length>0&&e.jsx("div",{className:"flex justify-center",children:e.jsxs(c,{onClick:K,disabled:o||!r.expediente_id,className:"bg-[#2a3d83] hover:bg-[#1e2b5f] flex items-center gap-2",children:[e.jsx(ce,{className:"h-4 w-4"}),o?"Procesando...":`Procesar ${n.length} Archivos`]})})]})]}),S&&e.jsxs(y,{children:[e.jsx(P,{children:e.jsxs(M,{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-5 w-5 text-green-500"}),"Resultados del Procesamiento"]})}),e.jsxs(_,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:S.exitosos}),e.jsx("p",{className:"text-sm text-green-700",children:"Documentos Creados"})]}),e.jsxs("div",{className:"text-center p-4 bg-red-50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-red-600",children:S.errores}),e.jsx("p",{className:"text-sm text-red-700",children:"Errores"})]}),e.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-600",children:n.length}),e.jsx("p",{className:"text-sm text-gray-700",children:"Total Procesados"})]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(c,{onClick:()=>T.visit("/admin/documentos"),className:"flex items-center gap-2",children:"Ver Documentos Creados"})})]})]})]})]})}export{Te as default};
