import{r as h,j as e,H as B,b as D}from"./app-xP5nJVeF.js";import{A as E}from"./app-layout-52tIb-IE.js";import{B as p}from"./button-B_iUXIQd.js";import{C as u,a as y,b as v,d as C,c as j}from"./card-CWOinnut.js";import{C as S}from"./checkbox-ljtehwW8.js";import{A as f,a as b}from"./alert-BVrZsLZW.js";import{T as H,a as O,b as _,c as q}from"./tabs-BrUZeGY9.js";import{L as w}from"./label-CXywCScm.js";import{B as d}from"./Combination-BMQq9fx8.js";import{S as A}from"./triangle-alert-3Hg381hi.js";import{S as k}from"./save-C_03Hu9q.js";import{C as T}from"./circle-alert-B5N4zVfx.js";import{U}from"./users-DpyCPIO9.js";/* empty css            */import"./app-sidebar-layout-Bv9w89yC.js";import"./index-DbDMva29.js";import"./index-D2eHBSbe.js";import"./index-Blg4NNxt.js";import"./x-CBQbsaML.js";import"./app-logo-icon-8EdVYcX9.js";import"./input-DQqwP0kM.js";import"./user-OU0Y1c1r.js";import"./mail-C5oL3AE1.js";import"./folder-Ck8Tq3sH.js";import"./search-eio2uEn4.js";import"./BrandingProvider-BV5yFGOU.js";import"./index-B00g0JPb.js";import"./check-C5qgcy3h.js";const $=[{title:"Dashboard",href:"/dashboard"},{title:"Administración",href:"#"},{title:"Gestión de Roles",href:"/admin/roles"}];function fe({roles:g,permisos:t}){const[m,n]=h.useState(!1),[r,P]=h.useState(g[0]||null),[i,o]=h.useState(r?.permisos||[]),R=s=>{m&&!confirm("Tienes cambios sin guardar. ¿Deseas continuar sin guardar?")||(P(s),o(s.permisos),n(!1))},G=s=>{if(r?.name==="Super Administrador")return;const l=i.includes(s)?i.filter(a=>a!==s):[...i,s];o(l),n(!0)},L=s=>{if(r?.name==="Super Administrador")return;const l=t[s].map(c=>c.id),a=l.every(c=>i.includes(c));let x;a?x=i.filter(c=>!l.includes(c)):x=[...new Set([...i,...l])],o(x),n(!0)},N=()=>{r&&D.put(`/admin/roles/${r.id}/permissions`,{permisos:i},{preserveScroll:!0,onSuccess:()=>{n(!1)}})},z=s=>t[s].map(a=>a.id).every(a=>i.includes(a));return e.jsxs(E,{breadcrumbs:$,children:[e.jsx(B,{title:"Gestión de Roles y Permisos"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between pt-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-6 w-6 text-[#2a3d83]"}),e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Gestión de Roles y Permisos"})]}),m&&e.jsxs(p,{onClick:N,className:"bg-[#2a3d83] hover:bg-[#1e2b5f]",children:[e.jsx(k,{className:"h-4 w-4 mr-2"}),"Guardar Cambios"]})]}),e.jsxs(f,{className:"border-blue-200 bg-blue-50",children:[e.jsx(T,{className:"h-4 w-4 text-blue-600"}),e.jsxs(b,{className:"text-blue-800",children:[e.jsx("strong",{children:"Atención:"})," Solo el Super Administrador puede modificar los permisos de los roles. Los cambios afectarán a todos los usuarios con ese rol."]})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-6",children:[e.jsx("div",{className:"col-span-12 lg:col-span-4",children:e.jsxs(u,{children:[e.jsxs(y,{children:[e.jsx(v,{children:"Roles del Sistema"}),e.jsx(C,{children:"Selecciona un rol para gestionar sus permisos"})]}),e.jsx(j,{className:"space-y-2",children:g.map(s=>e.jsx("button",{onClick:()=>R(s),className:`w-full text-left p-4 rounded-lg border-2 transition-all ${r?.id===s.id?"border-[#2a3d83] bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:s.name}),s.name==="Super Administrador"&&e.jsx(d,{className:"bg-yellow-100 text-yellow-800 hover:bg-yellow-100",children:"Protegido"})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.description}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:["Nivel ",s.nivel_jerarquico]}),e.jsxs("span",{className:"text-xs text-gray-500",children:[s.permisos_count," permisos"]})]})]})})},s.id))})]})}),e.jsx("div",{className:"col-span-12 lg:col-span-8",children:r?e.jsxs(u,{children:[e.jsx(y,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(v,{children:["Permisos de: ",r.name]}),e.jsx(C,{children:r.name==="Super Administrador"?"Este rol tiene todos los permisos y no puede ser modificado":"Selecciona los permisos que tendrá este rol"})]}),e.jsxs(d,{variant:"outline",className:"text-lg",children:[i.length," / ",Object.values(t).flat().length]})]})}),e.jsx(j,{children:r.name==="Super Administrador"?e.jsxs(f,{className:"border-yellow-200 bg-yellow-50",children:[e.jsx(A,{className:"h-4 w-4 text-yellow-600"}),e.jsx(b,{className:"text-yellow-800",children:"El rol Super Administrador tiene acceso completo al sistema y no puede ser modificado."})]}):e.jsxs(H,{defaultValue:Object.keys(t)[0],className:"w-full",children:[e.jsx(O,{className:"flex flex-wrap h-auto",children:Object.keys(t).map(s=>e.jsxs(_,{value:s,className:"capitalize",children:[s,e.jsxs(d,{variant:"secondary",className:"ml-2",children:[t[s].filter(l=>i.includes(l.id)).length,"/",t[s].length]})]},s))}),Object.entries(t).map(([s,l])=>e.jsxs(q,{value:s,className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs(w,{className:"font-semibold capitalize",children:["Todos los permisos de ",s]}),e.jsx(S,{checked:z(s),onCheckedChange:()=>L(s)})]}),e.jsx("div",{className:"space-y-2",children:l.map(a=>e.jsxs("div",{className:"flex items-start justify-between p-3 border rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(w,{className:"font-medium text-gray-900",children:a.nombre}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:a.descripcion}),a.subcategoria&&e.jsx(d,{variant:"outline",className:"mt-1",children:a.subcategoria})]}),e.jsx(S,{checked:i.includes(a.id),onCheckedChange:()=>G(a.id),className:"ml-4"})]},a.id))})]},s))]})})]}):e.jsx(u,{children:e.jsx(j,{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(U,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Selecciona un rol para gestionar sus permisos"})]})})})})]}),m&&e.jsxs(f,{className:"border-amber-200 bg-amber-50",children:[e.jsx(T,{className:"h-4 w-4 text-amber-600"}),e.jsxs(b,{className:"text-amber-800 flex items-center justify-between",children:[e.jsxs("span",{children:["Tienes cambios sin guardar en el rol ",e.jsx("strong",{children:r?.name})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{variant:"outline",size:"sm",onClick:()=>{r&&(o(r.permisos),n(!1))},children:"Cancelar"}),e.jsxs(p,{size:"sm",onClick:N,className:"bg-[#2a3d83] hover:bg-[#1e2b5f]",children:[e.jsx(k,{className:"h-4 w-4 mr-2"}),"Guardar"]})]})]})]})]})]})}export{fe as default};
