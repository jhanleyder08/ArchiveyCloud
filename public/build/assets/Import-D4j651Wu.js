import{r as j,u as K,j as e,a as E,H as Z}from"./app-BAaRFKCE.js";import{A as G,U as R,F as J,S as b}from"./app-layout-BkZKgO0H.js";import{b as U,B as n}from"./app-logo-icon-CRu_6WDm.js";import{I as d}from"./input-BbBpRMsa.js";import{L as l}from"./label-D08h-VMZ.js";import{S as O,a as Q,b as W,c as X,d as Y}from"./select-COydJ_1f.js";import{C as o,a as m,b as x,c as C,d as h}from"./card-CrHy-fHD.js";import{T as ee,a as se,b as w,c as S}from"./tabs-BxZhJoWE.js";import{B as c}from"./badge-CYpmu6Aj.js";import{S as ae}from"./separator-BrPQWlfD.js";import{A as te}from"./arrow-left-Bo6AaNur.js";import{C as A}from"./clock-B-h1W_zW.js";import{C as ie,a as re}from"./circle-check-big-C4SeEZDM.js";/* empty css            */import"./index-D2AugiGI.js";import"./index-DZ-wJQli.js";import"./index-B8KDMt0s.js";import"./index-D8C8_OyU.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]],M=U("Download",ne);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]],z=U("FileSpreadsheet",le);function Se({configurations:p,importLogs:g=[]}){const[P,D]=j.useState("upload"),[u,T]=j.useState(null),[I,v]=j.useState(0),[f,y]=j.useState(!1),{data:a,setData:r,post:H,processing:k,errors:t,reset:B}=K({configuration_id:"",file:null,entity_name:"",entity_code:"",trd_name:"",trd_description:"",override_existing:!1}),L=s=>{const i=s.target.files?.[0];i&&(T(i),r("file",i))},V=s=>{if(s.preventDefault(),!a.file||!a.configuration_id)return;y(!0);const i=new FormData;i.append("file",a.file),i.append("configuration_id",a.configuration_id),i.append("entity_name",a.entity_name),i.append("entity_code",a.entity_code),i.append("trd_name",a.trd_name),i.append("trd_description",a.trd_description),i.append("override_existing",a.override_existing?"1":"0");const N=setInterval(()=>{v(_=>_>=90?(clearInterval(N),_):_+10)},200);H("/trd/import",{onSuccess:()=>{v(100),clearInterval(N),y(!1),B(),T(null)},onError:()=>{clearInterval(N),y(!1),v(0)}})},F=s=>{window.open(`/trd/import/template/${s}`,"_blank")},q=s=>{switch(s){case"completed":return e.jsx(re,{className:"w-4 h-4 text-green-600"});case"failed":return e.jsx(ie,{className:"w-4 h-4 text-red-600"});case"processing":return e.jsx(A,{className:"w-4 h-4 text-blue-600 animate-spin"});default:return e.jsx(A,{className:"w-4 h-4 text-gray-400"})}},$=s=>{switch(s){case"completed":return"bg-green-100 text-green-800";case"failed":return"bg-red-100 text-red-800";case"processing":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}};return e.jsxs(G,{children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs(n,{variant:"ghost",size:"sm",onClick:()=>E.get("/trd"),children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),"Volver a TRD"]}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Importar TRD"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Importe Tablas de Retención Documental desde archivos CSV o Excel"})]})]}),e.jsx(Z,{title:"Importar TRD"}),e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"max-w-4xl mx-auto sm:px-6 lg:px-8",children:e.jsxs(ee,{value:P,onValueChange:D,className:"space-y-6",children:[e.jsxs(se,{className:"grid w-full grid-cols-3",children:[e.jsx(w,{value:"upload",children:"Cargar Archivo"}),e.jsx(w,{value:"history",children:"Historial"}),e.jsx(w,{value:"configurations",children:"Configuraciones"})]}),e.jsxs(S,{value:"upload",className:"space-y-6",children:[e.jsxs(o,{children:[e.jsxs(m,{children:[e.jsxs(x,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5"}),"Importar TRD desde Archivo"]}),e.jsx(C,{children:"Seleccione una configuración y cargue su archivo para importar la estructura TRD"})]}),e.jsx(h,{children:e.jsxs("form",{onSubmit:V,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"configuration_id",children:"Configuración de Importación *"}),e.jsxs(O,{value:a.configuration_id,onValueChange:s=>r("configuration_id",s),children:[e.jsx(Q,{className:t.configuration_id?"border-red-500":"",children:e.jsx(W,{placeholder:"Seleccione una configuración"})}),e.jsx(X,{children:p.map(s=>e.jsx(Y,{value:s.id.toString(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4"}),e.jsx("span",{children:s.name}),e.jsx(c,{variant:"outline",className:"ml-2",children:s.file_type.toUpperCase()})]})},s.id))})]}),t.configuration_id&&e.jsx("p",{className:"text-sm text-red-600",children:t.configuration_id})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"entity_name",children:"Nombre de la Entidad *"}),e.jsx(d,{id:"entity_name",value:a.entity_name,onChange:s=>r("entity_name",s.target.value),placeholder:"Ej: Ministerio de Educación",className:t.entity_name?"border-red-500":""}),t.entity_name&&e.jsx("p",{className:"text-sm text-red-600",children:t.entity_name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"entity_code",children:"Código de la Entidad *"}),e.jsx(d,{id:"entity_code",value:a.entity_code,onChange:s=>r("entity_code",s.target.value),placeholder:"Ej: MINED",className:t.entity_code?"border-red-500":""}),t.entity_code&&e.jsx("p",{className:"text-sm text-red-600",children:t.entity_code})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"trd_name",children:"Nombre de la TRD *"}),e.jsx(d,{id:"trd_name",value:a.trd_name,onChange:s=>r("trd_name",s.target.value),placeholder:"Ej: TRD Ministerio de Educación 2024",className:t.trd_name?"border-red-500":""}),t.trd_name&&e.jsx("p",{className:"text-sm text-red-600",children:t.trd_name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"trd_description",children:"Descripción"}),e.jsx(d,{id:"trd_description",value:a.trd_description,onChange:s=>r("trd_description",s.target.value),placeholder:"Descripción opcional de la TRD"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"file",children:"Archivo TRD *"}),e.jsx(d,{id:"file",type:"file",accept:".csv,.xlsx,.xls",onChange:L,className:t.file?"border-red-500":""}),t.file&&e.jsx("p",{className:"text-sm text-red-600",children:t.file}),u&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600",children:[e.jsx(J,{className:"w-4 h-4"}),e.jsx("span",{children:u.name}),e.jsxs(c,{variant:"outline",children:[(u.size/1024).toFixed(1)," KB"]})]})]}),f&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Procesando archivo..."}),e.jsxs("span",{children:[I,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${I}%`}})})]}),e.jsx(ae,{}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"flex gap-2",children:a.configuration_id&&e.jsxs(n,{type:"button",variant:"outline",size:"sm",onClick:()=>F(parseInt(a.configuration_id)),children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Descargar Plantilla"]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{type:"button",variant:"outline",onClick:()=>E.get("/trd"),children:"Cancelar"}),e.jsxs(n,{type:"submit",disabled:k||f||!u||!a.configuration_id,children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),k||f?"Procesando...":"Importar TRD"]})]})]})]})})]}),a.configuration_id&&e.jsxs(o,{children:[e.jsx(m,{children:e.jsx(x,{className:"text-lg",children:"Detalles de la Configuración"})}),e.jsx(h,{children:(()=>{const s=p.find(i=>i.id.toString()===a.configuration_id);return s?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"font-medium",children:s.name}),e.jsx(c,{variant:s.is_active?"default":"secondary",children:s.is_active?"Activa":"Inactiva"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:s.description}),s.column_mappings&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 text-sm",children:[e.jsx("div",{className:"font-medium text-gray-500",children:"Tipo de Archivo:"}),e.jsx("div",{children:s.file_type.toUpperCase()})]})]}):null})()})]})]}),e.jsx(S,{value:"history",className:"space-y-6",children:e.jsxs(o,{children:[e.jsxs(m,{children:[e.jsx(x,{children:"Historial de Importaciones"}),e.jsx(C,{children:"Últimas importaciones realizadas"})]}),e.jsx(h,{children:g&&g.length>0?e.jsx("div",{className:"space-y-4",children:g.map((s,i)=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[q(s.status),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.filename}),e.jsx("div",{className:"text-sm text-gray-500",children:new Date(s.created_at).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right text-sm",children:[e.jsxs("div",{className:"font-medium",children:[s.success_records,"/",s.total_records," exitosos"]}),e.jsxs("div",{className:"text-gray-500",children:[s.failed_records," errores"]})]}),e.jsx(c,{className:$(s.status),children:s.status==="completed"?"Completado":s.status==="failed"?"Fallido":s.status==="processing"?"Procesando":"Pendiente"})]})]},i))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(z,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 mb-2",children:"No hay importaciones previas"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Las importaciones aparecerán aquí una vez que procese archivos"})]})})]})}),e.jsx(S,{value:"configurations",className:"space-y-6",children:e.jsxs(o,{children:[e.jsxs(m,{children:[e.jsx(x,{children:"Configuraciones de Importación"}),e.jsx(C,{children:"Configuraciones disponibles para importar archivos TRD"})]}),e.jsx(h,{children:p.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:p.map(s=>e.jsxs(o,{className:"border border-gray-200",children:[e.jsx(m,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(x,{className:"text-base flex items-center gap-2",children:[e.jsx(b,{className:"w-4 h-4"}),s.name]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{variant:"outline",children:s.file_type.toUpperCase()}),e.jsx(c,{variant:s.is_active?"default":"secondary",children:s.is_active?"Activa":"Inactiva"})]})]})}),e.jsxs(h,{className:"pt-0",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:s.description}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>F(s.id),disabled:!s.is_active,children:[e.jsx(M,{className:"w-3 h-3 mr-1"}),"Plantilla"]}),e.jsx(n,{variant:"default",size:"sm",onClick:()=>{r("configuration_id",s.id.toString()),D("upload")},disabled:!s.is_active,children:"Usar"})]})]})]},s.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(b,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 mb-2",children:"No hay configuraciones disponibles"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Contacte al administrador para configurar opciones de importación"})]})})]})})]})})})]})}export{Se as default};
