import{e as ae,r as o,b as f,j as e,H as re,L as A}from"./app-Cl0FOawM.js";import{A as te}from"./app-layout-DmBWywAa.js";import{B as p}from"./button-DtR6BkFB.js";import{I as j}from"./input-BIaS0EAz.js";import{S as F,a as T,b as P,c as I,d as g}from"./select-CRHmP9X5.js";import{D as L,g as le,a as q,b as M,c as $,d as R,e as k,k as ie,l as O,m as V,n as B}from"./app-sidebar-layout-C6Q0w7Bq.js";import{L as d}from"./label-CbT9r7o4.js";import{C as oe}from"./checkbox-BOuh6J-e.js";import{I as N}from"./input-error-Bg2W7YE-.js";import{A as Q,a as X}from"./alert-DaSpqLgo.js";import{U as z}from"./users-D2N-KHHv.js";import{P as ne}from"./plus-BKC1dWv8.js";import{C as G}from"./circle-alert-CUWjiY4Z.js";import{S as de}from"./search-Dy3uqUBg.js";import{S as ce}from"./square-pen-D_2v4yPQ.js";import{U as me}from"./user-x-B-W2skcG.js";import{U as xe}from"./user-check-D1qH4Oks.js";import{T as he}from"./trash-2-DJ1KrITR.js";/* empty css            */import"./index-D7qm94Yl.js";import"./index-BO3GgK9t.js";import"./Combination-C5IUXXYh.js";import"./index-BI--RP87.js";import"./check-B0U8qkUS.js";import"./index-exm1JAg4.js";import"./x-RnAAca9d.js";import"./index-BBKsozoC.js";import"./app-logo-icon-DhSh7KcS.js";import"./user-CFwvzY-o.js";import"./mail-DXR72C52.js";import"./folder-WM0Q2jqL.js";import"./triangle-alert-DMJQlJHA.js";const ue=[{title:"Dashboard",href:"/dashboard"},{title:"Administración",href:"#"},{title:"Gestión de usuarios",href:"/admin/users"}];function Je({users:n,stats:x,roles:C,filters:S}){const{flash:b}=ae().props,[pe,je]=o.useState(S.search||""),[v,y]=o.useState(null),[J,E]=o.useState(!1),[h,w]=o.useState(null),[a,c]=o.useState({name:"",email:"",role_id:"",password:"",password_confirmation:"",verify_email:!1}),[r,m]=o.useState({}),[t,u]=o.useState({name:"",email:"",role_id:"",active:!0}),[D,K]=o.useState(S.search||""),[U,W]=o.useState(S.status||"");o.useEffect(()=>{const s=setTimeout(()=>{f.get("/admin/users",{search:D||void 0,status:U||void 0},{preserveState:!0,replace:!0})},500);return()=>clearTimeout(s)},[D,U]),o.useEffect(()=>{},[h]);const Y=s=>{f.patch(`/admin/users/${s.id}/toggle-status`,{},{preserveState:!0})},Z=s=>new Date(s).toLocaleDateString("es-ES"),ee=s=>s.active?s.email_verified_at?{text:"Activo",color:"bg-green-100 text-green-800"}:{text:"Pendiente",color:"bg-yellow-100 text-yellow-800"}:{text:"Inactivo",color:"bg-red-100 text-red-800"};return e.jsxs(te,{breadcrumbs:ue,children:[e.jsx(re,{title:"Gestión de Usuarios"}),e.jsxs("div",{className:"space-y-6",children:[b?.success&&e.jsx("div",{className:"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg",children:b.success}),b?.error&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:b.error}),e.jsxs("div",{className:"flex items-center justify-between pt-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-6 w-6 text-[#2a3d83]"}),e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Gestión de Usuarios"})]}),e.jsxs(L,{open:J,onOpenChange:E,children:[e.jsx(le,{asChild:!0,children:e.jsxs(p,{className:"flex items-center gap-2 px-4 py-2 bg-[#2a3d83] text-white rounded-lg hover:bg-[#1e2b5f] transition-colors",children:[e.jsx(ne,{className:"h-4 w-4"}),"Nuevo Usuario"]})}),e.jsxs(q,{className:"sm:max-w-[425px]",children:[e.jsxs(M,{children:[e.jsx($,{className:"text-xl font-semibold text-gray-900",children:"Crear Nuevo Usuario"}),e.jsx(R,{className:"text-sm text-gray-600",children:"Complete los siguientes datos para crear un nuevo usuario en el sistema."})]}),Object.keys(r).length>0&&e.jsxs(Q,{variant:"destructive",className:"mb-4",children:[e.jsx(G,{className:"h-4 w-4"}),e.jsxs(X,{children:[e.jsx("strong",{children:"Por favor corrija los siguientes errores:"}),e.jsx("ul",{className:"list-disc list-inside mt-2 space-y-1",children:Object.entries(r).map(([s,l])=>e.jsx("li",{className:"text-sm",children:l},s))})]})]}),e.jsxs("form",{onSubmit:s=>{if(s.preventDefault(),!a.name||!a.email||!a.role_id||!a.password||!a.password_confirmation){alert("Por favor complete todos los campos requeridos");return}if(a.password!==a.password_confirmation){alert("Las contraseñas no coinciden");return}const l={name:a.name.trim(),email:a.email.trim().toLowerCase(),password:a.password,password_confirmation:a.password_confirmation,role_id:a.role_id?parseInt(a.role_id):null,verify_email:!!a.verify_email};f.post("/admin/users",l,{onSuccess:()=>{E(!1),c({name:"",email:"",role_id:"",password:"",password_confirmation:"",verify_email:!1}),m({})},onError:i=>{console.error("Error al crear usuario:",i);const H={};i&&Object.keys(i).forEach(_=>{const se=Array.isArray(i[_])?i[_][0]:i[_];H[_]=se}),m(H)}})},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"create-name",children:"Nombre Completo"}),e.jsx(j,{id:"create-name",type:"text",value:a.name,onChange:s=>{c({...a,name:s.target.value}),r.name&&m({...r,name:""})},placeholder:"Nombre completo del usuario",required:!0,className:r.name?"border-red-500":""}),e.jsx(N,{message:r.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"create-email",children:"Email"}),e.jsx(j,{id:"create-email",type:"email",value:a.email,onChange:s=>{c({...a,email:s.target.value}),r.email&&m({...r,email:""})},placeholder:"usuario@ejemplo.com",required:!0,className:r.email?"border-red-500":""}),e.jsx(N,{message:r.email})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"create-password",children:"Contraseña"}),e.jsx(j,{id:"create-password",type:"password",value:a.password,onChange:s=>{c({...a,password:s.target.value}),r.password&&m({...r,password:""})},placeholder:"Contraseña temporal",required:!0,minLength:8,className:r.password?"border-red-500":""}),e.jsx(N,{message:r.password})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"create-password-confirmation",children:"Confirmar Contraseña"}),e.jsx(j,{id:"create-password-confirmation",type:"password",value:a.password_confirmation,onChange:s=>{c({...a,password_confirmation:s.target.value}),r.password_confirmation&&m({...r,password_confirmation:""})},placeholder:"Confirmar contraseña",required:!0,minLength:8,className:r.password_confirmation?"border-red-500":""}),e.jsx(N,{message:r.password_confirmation})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"create-role",children:"Rol"}),e.jsxs(F,{value:a.role_id,onValueChange:s=>{c({...a,role_id:s}),r.role_id&&m({...r,role_id:""})},children:[e.jsx(T,{className:r.role_id?"border-red-500":"",children:e.jsx(P,{placeholder:"Selecciona un rol"})}),e.jsx(I,{children:C.map(s=>e.jsx(g,{value:s.id.toString(),children:s.name},s.id))})]}),e.jsx(N,{message:r.role_id})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(oe,{id:"verify-email",checked:a.verify_email,onCheckedChange:s=>c({...a,verify_email:s===!0})}),e.jsx(d,{htmlFor:"verify-email",className:"text-sm font-normal cursor-pointer",children:"Verificar email automáticamente (no enviar correo de verificación)"})]}),e.jsx("div",{className:"text-xs text-gray-500",children:"Si no marca esta opción, se enviará un correo de verificación al usuario."}),e.jsxs(k,{children:[e.jsx(p,{type:"button",variant:"outline",onClick:()=>{E(!1),c({name:"",email:"",role_id:"",password:"",password_confirmation:"",verify_email:!1}),m({})},children:"Cancelar"}),e.jsx(p,{type:"submit",className:"bg-[#2a3d83] hover:bg-[#1e2b5f]",children:"Crear Usuario"})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg border p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Usuarios"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:x.total})]}),e.jsx("div",{className:"p-3 bg-blue-100 rounded-full",children:e.jsx(z,{className:"h-6 w-6 text-[#2a3d83]"})})]})}),e.jsx("div",{className:"bg-white rounded-lg border p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Usuarios Activos"}),e.jsx("p",{className:"text-2xl font-semibold text-[#2a3d83]",children:x.active})]}),e.jsx("div",{className:"p-3 bg-blue-100 rounded-full",children:e.jsx("div",{className:"h-6 w-6 bg-[#2a3d83] rounded-full flex items-center justify-center",children:e.jsx("div",{className:"h-2 w-2 bg-white rounded-full"})})})]})}),e.jsx("div",{className:"bg-white rounded-lg border p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Pendientes"}),e.jsx("p",{className:"text-2xl font-semibold text-[#2a3d83]",children:x.pending})]}),e.jsx("div",{className:"p-3 bg-blue-100 rounded-full",children:e.jsx("div",{className:"h-6 w-6 bg-[#2a3d83] rounded-full flex items-center justify-center",children:e.jsx("div",{className:"h-2 w-2 bg-white rounded-full"})})})]})}),x.without_role>0&&e.jsx("div",{className:"bg-white rounded-lg border border-red-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-600 font-medium",children:"⚠️ Sin Rol"}),e.jsx("p",{className:"text-2xl font-semibold text-red-700",children:x.without_role})]}),e.jsx("div",{className:"p-3 bg-red-100 rounded-full",children:e.jsx(G,{className:"h-6 w-6 text-red-600"})})]})})]}),e.jsx("div",{className:"bg-white rounded-lg border p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-4 w-full sm:w-auto",children:e.jsxs("div",{className:"relative flex-1 sm:w-80",children:[e.jsx(de,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(j,{type:"text",value:D,onChange:s=>K(s.target.value),placeholder:"Buscar usuarios...",className:"pl-10"})]})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(F,{value:U||"all",onValueChange:s=>W(s==="all"?"":s),children:[e.jsx(T,{className:"w-[180px]",children:e.jsx(P,{placeholder:"Todos los estados"})}),e.jsxs(I,{children:[e.jsx(g,{value:"all",children:"Todos los estados"}),e.jsx(g,{value:"active",children:"Activos"}),e.jsx(g,{value:"inactive",children:"Inactivos"}),e.jsx(g,{value:"pending",children:"Pendientes"}),x.without_role>0&&e.jsxs(g,{value:"without_role",className:"text-red-600 font-medium",children:["⚠️ Sin Rol (",x.without_role,")"]})]})]})})]})}),e.jsx("div",{className:"bg-white rounded-lg border overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left py-3 px-6 text-sm font-medium text-gray-900",children:"Usuario"}),e.jsx("th",{className:"text-left py-3 px-6 text-sm font-medium text-gray-900",children:"Email"}),e.jsx("th",{className:"text-left py-3 px-6 text-sm font-medium text-gray-900",children:"Rol"}),e.jsx("th",{className:"text-left py-3 px-6 text-sm font-medium text-gray-900",children:"Estado"}),e.jsx("th",{className:"text-left py-3 px-6 text-sm font-medium text-gray-900",children:"Registro"}),e.jsx("th",{className:"text-left py-3 px-6 text-sm font-medium text-gray-900",children:"Acciones"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:n.data.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"py-8 px-6 text-center text-gray-500",children:"No se encontraron usuarios."})}):n.data.map(s=>{const l=ee(s);return e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"py-4 px-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-8 w-8 bg-[#2a3d83] rounded-full flex items-center justify-center text-white text-sm font-medium",children:s.name.charAt(0).toUpperCase()}),e.jsx("span",{className:"font-medium text-gray-900",children:s.name})]})}),e.jsx("td",{className:"py-4 px-6 text-gray-600",children:s.email}),e.jsx("td",{className:"py-4 px-6",children:s.role?.name?e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-[#2a3d83]",children:s.role.name}):e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:"⚠️ Sin rol asignado"})}),e.jsx("td",{className:"py-4 px-6",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${l.color}`,children:l.text})}),e.jsx("td",{className:"py-4 px-6 text-gray-600",children:Z(s.created_at)}),e.jsx("td",{className:"py-4 px-6",children:e.jsx(ie,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(O,{children:[e.jsx(V,{asChild:!0,children:e.jsx("button",{onClick:()=>{const i=s.role?.id||s.role_id;u({name:s.name,email:s.email,role_id:i?i.toString():"",active:s.active!==void 0?s.active:!0}),w(s)},className:"p-2 rounded-md text-[#2a3d83] hover:text-[#1e2b5f] hover:bg-blue-50 transition-colors",children:e.jsx(ce,{className:"h-4 w-4"})})}),e.jsx(B,{children:e.jsx("p",{children:"Editar usuario"})})]}),e.jsxs(O,{children:[e.jsx(V,{asChild:!0,children:e.jsx("button",{onClick:()=>Y(s),className:`p-2 rounded-md transition-colors ${s.active?"text-orange-600 hover:text-orange-800 hover:bg-orange-50":"text-green-600 hover:text-green-800 hover:bg-green-50"}`,children:s.active?e.jsx(me,{className:"h-4 w-4"}):e.jsx(xe,{className:"h-4 w-4"})})}),e.jsx(B,{children:e.jsx("p",{children:s.active?"Desactivar usuario":"Activar usuario"})})]}),e.jsxs(O,{children:[e.jsx(V,{asChild:!0,children:e.jsx("button",{onClick:()=>y(s),className:"p-2 rounded-md text-red-600 hover:text-red-800 hover:bg-red-50 transition-colors",children:e.jsx(he,{className:"h-4 w-4"})})}),e.jsx(B,{children:e.jsx("p",{children:"Eliminar usuario"})})]})]})})})]},s.id)})})]})})}),n.data.length>0&&e.jsxs("div",{className:"flex items-center justify-between bg-white border rounded-lg px-6 py-3",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Mostrando ",e.jsx("span",{className:"font-medium",children:n.meta?.from||n.from||0})," a"," ",e.jsx("span",{className:"font-medium",children:n.meta?.to||n.to||0})," de"," ",e.jsx("span",{className:"font-medium",children:n.meta?.total||n.total||0})," usuarios"]}),e.jsx("div",{className:"flex items-center gap-2",children:n.links.map((s,l)=>s.label.includes("Previous")?e.jsx(A,{href:s.url||"#",preserveState:!0,className:`px-3 py-2 border border-gray-300 rounded-md text-sm font-medium ${s.url?"text-gray-700 hover:bg-gray-50":"text-gray-300 cursor-not-allowed"}`,children:"Anterior"},l):s.label.includes("Next")?e.jsx(A,{href:s.url||"#",preserveState:!0,className:`px-3 py-2 border border-gray-300 rounded-md text-sm font-medium ${s.url?"text-gray-700 hover:bg-gray-50":"text-gray-300 cursor-not-allowed"}`,children:"Siguiente"},l):isNaN(Number(s.label))?null:e.jsx(A,{href:s.url||"#",preserveState:!0,className:`px-3 py-2 rounded-md text-sm font-medium ${s.active?"bg-[#2a3d83] text-white":"border border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:s.label},l))})]}),e.jsx(L,{open:!!h,onOpenChange:s=>{s||(w(null),u({name:"",email:"",role_id:"",active:!0}))},children:e.jsxs(q,{className:"sm:max-w-[425px]",children:[e.jsxs(M,{children:[e.jsx($,{className:"text-xl font-semibold text-gray-900",children:"Editar Usuario"}),e.jsx(R,{className:"text-sm text-gray-600",children:"Modifique los datos del usuario según sea necesario."})]}),h&&!h.role_id&&e.jsxs(Q,{className:"mb-4 border-yellow-500 bg-yellow-50",children:[e.jsx(G,{className:"h-4 w-4 text-yellow-600"}),e.jsxs(X,{className:"text-yellow-800",children:[e.jsx("strong",{children:"Atención:"})," Este usuario actualmente no tiene un rol asignado. Por favor, seleccione un rol antes de guardar."]})]}),e.jsxs("form",{onSubmit:s=>{if(s.preventDefault(),!t.role_id||t.role_id===""){alert("Por favor seleccione un rol para el usuario. El rol es obligatorio.");return}if(h){const l={name:t.name.trim(),email:t.email.trim().toLowerCase(),role_id:t.role_id?parseInt(t.role_id):null,active:t.active};f.put(`/admin/users/${h.id}`,l,{onSuccess:()=>{w(null),u({name:"",email:"",role_id:"",active:!0}),f.reload({only:["users","stats","auth"]})},onError:i=>{console.error("Errores de validación:",i)}})}},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"edit-name",children:"Nombre Completo"}),e.jsx(j,{id:"edit-name",type:"text",value:t.name,onChange:s=>u({...t,name:s.target.value}),placeholder:"Nombre completo del usuario",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"edit-email",children:"Email"}),e.jsx(j,{id:"edit-email",type:"email",value:t.email,onChange:s=>u({...t,email:s.target.value}),placeholder:"usuario@ejemplo.com",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"edit-role",children:"Rol"}),e.jsxs(F,{value:t.role_id,onValueChange:s=>{u({...t,role_id:s})},children:[e.jsx(T,{children:e.jsx(P,{placeholder:"Selecciona un rol"})}),e.jsx(I,{children:C.map(s=>e.jsx(g,{value:s.id.toString(),children:s.name},s.id))})]},`edit-role-${h?.id}-${t.role_id}`),t.role_id&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Rol actual: ",C.find(s=>s.id.toString()===t.role_id)?.name]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"edit-active",checked:t.active,onChange:s=>u({...t,active:s.target.checked}),className:"h-4 w-4 rounded border-gray-300 text-[#2a3d83] focus:ring-[#2a3d83]"}),e.jsx("label",{htmlFor:"edit-active",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Usuario Activo"})]}),e.jsxs(k,{children:[e.jsx(p,{type:"button",variant:"outline",onClick:()=>w(null),children:"Cancelar"}),e.jsx(p,{type:"submit",className:"bg-[#2a3d83] hover:bg-[#1e2b5f]",children:"Guardar Cambios"})]})]})]})}),e.jsx(L,{open:!!v,onOpenChange:s=>{s||y(null)},children:e.jsxs(q,{className:"sm:max-w-[425px]",children:[e.jsxs(M,{children:[e.jsx($,{className:"text-xl font-semibold text-gray-900",children:"Eliminar Usuario"}),e.jsx(R,{className:"text-sm text-gray-600",children:"Esta acción no se puede deshacer. El usuario será eliminado permanentemente del sistema."})]}),e.jsxs("div",{className:"py-4",children:[e.jsxs("p",{className:"text-gray-700",children:["¿Estás seguro de que deseas eliminar al usuario ",e.jsx("strong",{children:v?.name}),"?"]}),e.jsxs("p",{className:"text-gray-600 mt-2",children:["Email: ",e.jsx("strong",{children:v?.email})]})]}),e.jsxs(k,{children:[e.jsx(p,{type:"button",variant:"outline",onClick:()=>y(null),children:"Cancelar"}),e.jsx(p,{type:"button",variant:"destructive",onClick:()=>{v&&f.delete(`/admin/users/${v.id}`,{onSuccess:()=>{y(null)}})},children:"Eliminar Usuario"})]})]})})]})]})}export{Je as default};
