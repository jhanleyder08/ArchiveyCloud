import{r as S,u as R,j as e,H as te,L as T,b as le}from"./app-DmFTQNHU.js";import{f as ne,A as ce,D as F,g as A,a as L,b as z,c as E,d as k,e as V,T as oe,K as de}from"./app-sidebar-layout-B4-tSBlc.js";import{B as c}from"./button-B9uqYTIR.js";import{C as l,c as n,a as d,b as m,d as H}from"./card-98qlzFSI.js";import{B as x,F as me}from"./Combination-DB4vhy5A.js";import{T as xe,a as he,b as j,c as p}from"./tabs-Ds3NAHk9.js";import{T as je,a as pe,b as O,c as u,d as ue,e as v}from"./table-EXaSuLM9.js";import{A as U,a as B}from"./alert--kr5pmD-.js";import{L as i}from"./label-CYYsus1F.js";import{S as ve,a as ge,c as Ne,d as f}from"./select-CTcGm3Mb.js";import{D as fe}from"./users-CA6jkooN.js";import{R as ye}from"./refresh-cw-BZG3D1r5.js";import{C as I}from"./circle-x-Cbxwk3Mf.js";import{T as y}from"./triangle-alert-Qv0vinvY.js";import{U as _e}from"./user-2vHAz8tr.js";import{A as P}from"./activity-aaTAv_6A.js";import{C as be}from"./folder-CyqBlkrb.js";import{C as Ce}from"./circle-check-big-DyCuRV4E.js";/* empty css            */import"./index-6lxVY5DU.js";import"./index-D6-3VAHV.js";import"./index-BBDU3XkM.js";import"./x-D4OXCe6m.js";import"./app-logo-icon-B1r3bsQj.js";import"./input-CXpCTHGE.js";import"./mail-i7usF0Qz.js";import"./search-BECONtiU.js";import"./BrandingProvider-BKZadETt.js";import"./index-_200N-9v.js";import"./check-kl6Xjmwn.js";function ss({certificado:a,estadisticas_uso:t,validez:h,historial_auditoria:_}){const[M,g]=S.useState(!1),[K,N]=S.useState(!1),{data:$,setData:q,post:X,processing:b,errors:C}=R({razon_revocacion:""}),{data:G,setData:J,post:Q,processing:w,errors:D}=R({nueva_fecha_vencimiento:"",mantener_configuracion:!0}),W=s=>{switch(s){case"activo":return"default";case"vencido":return"destructive";case"revocado":return"secondary";case"suspendido":return"outline";default:return"secondary"}},Y=()=>a.estado==="revocado"?e.jsx(I,{className:"h-5 w-5 text-red-500"}):a.vigente?a.proximo_a_vencer?e.jsx(be,{className:"h-5 w-5 text-yellow-500"}):e.jsx(Ce,{className:"h-5 w-5 text-green-500"}):e.jsx(y,{className:"h-5 w-5 text-orange-500"}),Z=s=>({usuario:"Usuario",servidor:"Servidor",autoridad_certificadora:"Autoridad CA",sello_tiempo:"Sello de Tiempo"})[s]||s,ee=s=>({firma_digital:"Firma Digital",autenticacion:"Autenticación",cifrado:"Cifrado",sello_tiempo:"Sello de Tiempo"})[s]||s,se=s=>{const r=route("admin.certificados.descargar",{certificado:a.id,formato:s}),o=document.createElement("a");o.href=r,o.setAttribute("download",""),document.body.appendChild(o),o.click(),document.body.removeChild(o)},ae=()=>{X(route("admin.certificados.revocar",a.id),{onSuccess:()=>{g(!1),le.reload()}})},re=()=>{Q(route("admin.certificados.renovar",a.id),{onSuccess:()=>{N(!1)}})},ie=()=>{const s=new Date;return s.setDate(s.getDate()+1),s.toISOString().split("T")[0]};return e.jsxs(ne,{children:[e.jsx(te,{title:`Certificado: ${a.nombre_certificado}`}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(T,{href:route("admin.certificados.index"),children:e.jsxs(c,{variant:"outline",size:"sm",children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Volver"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:a.nombre_certificado}),e.jsxs("p",{className:"text-muted-foreground",children:["Serie: ",a.numero_serie]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(ve,{onValueChange:se,children:[e.jsxs(ge,{className:"w-auto",children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),"Descargar"]}),e.jsxs(Ne,{children:[e.jsx(f,{value:"pem",children:"Formato PEM"}),e.jsx(f,{value:"der",children:"Formato DER"}),e.jsx(f,{value:"crt",children:"Formato CRT"})]})]}),a.vigente&&e.jsxs(e.Fragment,{children:[e.jsxs(F,{open:K,onOpenChange:N,children:[e.jsx(A,{asChild:!0,children:e.jsxs(c,{variant:"outline",children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Renovar"]})}),e.jsxs(L,{children:[e.jsxs(z,{children:[e.jsx(E,{children:"Renovar Certificado"}),e.jsx(k,{children:"Se creará un nuevo certificado basado en la configuración actual. El certificado actual será marcado como vencido."})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"nueva_fecha_vencimiento",children:"Nueva Fecha de Vencimiento"}),e.jsx("input",{id:"nueva_fecha_vencimiento",type:"date",value:G.nueva_fecha_vencimiento,onChange:s=>J("nueva_fecha_vencimiento",s.target.value),min:ie(),className:"w-full px-3 py-2 border border-gray-300 rounded-md"}),D.nueva_fecha_vencimiento&&e.jsx("p",{className:"text-sm text-red-600",children:D.nueva_fecha_vencimiento})]})}),e.jsxs(V,{children:[e.jsx(c,{variant:"outline",onClick:()=>N(!1),children:"Cancelar"}),e.jsx(c,{onClick:re,disabled:w,children:w?"Renovando...":"Renovar Certificado"})]})]})]}),e.jsxs(F,{open:M,onOpenChange:g,children:[e.jsx(A,{asChild:!0,children:e.jsxs(c,{variant:"destructive",children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Revocar"]})}),e.jsxs(L,{children:[e.jsxs(z,{children:[e.jsx(E,{children:"Revocar Certificado"}),e.jsx(k,{children:"Esta acción no se puede deshacer. El certificado será marcado como revocado y todas las firmas realizadas con él serán inválidas."})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"razon_revocacion",children:"Razón de Revocación"}),e.jsx(oe,{id:"razon_revocacion",value:$.razon_revocacion,onChange:s=>q("razon_revocacion",s.target.value),placeholder:"Especifique la razón por la cual se revoca el certificado...",rows:3}),C.razon_revocacion&&e.jsx("p",{className:"text-sm text-red-600",children:C.razon_revocacion})]})}),e.jsxs(V,{children:[e.jsx(c,{variant:"outline",onClick:()=>g(!1),children:"Cancelar"}),e.jsx(c,{variant:"destructive",onClick:ae,disabled:b,children:b?"Revocando...":"Revocar Certificado"})]})]})]})]})]})]}),e.jsx(l,{children:e.jsx(n,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[Y(),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(x,{variant:W(a.estado),className:"capitalize",children:a.estado}),e.jsx(x,{variant:"outline",children:Z(a.tipo_certificado)})]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Propietario: ",a.usuario.name," (",a.usuario.email,")"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-medium",children:["Vence: ",new Date(a.fecha_vencimiento).toLocaleDateString()]}),a.vigente&&e.jsxs("p",{className:`text-sm ${a.proximo_a_vencer?"text-orange-600":"text-gray-600"}`,children:[a.dias_restantes," días restantes"]})]})]})})}),!h.valido&&e.jsxs(U,{variant:"destructive",children:[e.jsx(y,{className:"h-4 w-4"}),e.jsxs(B,{children:[e.jsx("strong",{children:"Certificado inválido:"}),e.jsx("ul",{className:"list-disc list-inside mt-1",children:h.errores.map((s,r)=>e.jsx("li",{children:s},r))})]})]}),h.advertencias.length>0&&e.jsxs(U,{children:[e.jsx(y,{className:"h-4 w-4"}),e.jsxs(B,{children:[e.jsx("strong",{children:"Advertencias:"}),e.jsx("ul",{className:"list-disc list-inside mt-1",children:h.advertencias.map((s,r)=>e.jsx("li",{children:s},r))})]})]}),e.jsxs(xe,{defaultValue:"detalles",className:"space-y-4",children:[e.jsxs(he,{children:[e.jsx(j,{value:"detalles",children:"Detalles"}),e.jsx(j,{value:"uso",children:"Estadísticas de Uso"}),e.jsx(j,{value:"firmas",children:"Firmas Realizadas"}),e.jsx(j,{value:"auditoria",children:"Auditoría"})]}),e.jsx(p,{value:"detalles",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(l,{children:[e.jsx(d,{children:e.jsxs(m,{className:"flex items-center",children:[e.jsx(de,{className:"h-5 w-5 mr-2"}),"Información del Certificado"]})}),e.jsxs(n,{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium text-gray-600",children:"Número de Serie"}),e.jsx("p",{className:"font-mono text-sm break-all",children:a.numero_serie})]}),e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium text-gray-600",children:"Algoritmo de Firma"}),e.jsxs("p",{children:[a.algoritmo_firma," (",a.longitud_clave," bits)"]})]}),e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium text-gray-600",children:"Huella Digital (SHA256)"}),e.jsx("p",{className:"font-mono text-sm break-all",children:a.huella_digital})]}),e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium text-gray-600",children:"Fecha de Emisión"}),e.jsx("p",{children:new Date(a.fecha_emision).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium text-gray-600",children:"Fecha de Vencimiento"}),e.jsx("p",{children:new Date(a.fecha_vencimiento).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium text-gray-600",children:"Usos Permitidos"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:a.uso_permitido.map(s=>e.jsx(x,{variant:"outline",className:"text-xs",children:ee(s)},s))})]})]})]}),e.jsxs(l,{children:[e.jsx(d,{children:e.jsxs(m,{className:"flex items-center",children:[e.jsx(_e,{className:"h-5 w-5 mr-2"}),"Sujeto y Emisor"]})}),e.jsxs(n,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium text-gray-600",children:"Sujeto (Subject)"}),e.jsx("p",{className:"text-sm break-all",children:a.sujeto}),a.info_sujeto&&Object.keys(a.info_sujeto).length>0&&e.jsx("div",{className:"mt-2 space-y-1",children:Object.entries(a.info_sujeto).map(([s,r])=>e.jsxs("div",{className:"text-xs",children:[e.jsxs("span",{className:"font-medium",children:[s,":"]})," ",r]},s))})]}),e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium text-gray-600",children:"Emisor (Issuer)"}),e.jsx("p",{className:"text-sm break-all",children:a.emisor}),a.info_emisor&&Object.keys(a.info_emisor).length>0&&e.jsx("div",{className:"mt-2 space-y-1",children:Object.entries(a.info_emisor).map(([s,r])=>e.jsxs("div",{className:"text-xs",children:[e.jsxs("span",{className:"font-medium",children:[s,":"]})," ",r]},s))})]})]})]})]})}),e.jsxs(p,{value:"uso",className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(l,{children:e.jsx(n,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:t.total_firmas}),e.jsx("p",{className:"text-sm text-gray-600",children:"Firmas Totales"})]})})}),e.jsx(l,{children:e.jsx(n,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:t.firmas_validas}),e.jsx("p",{className:"text-sm text-gray-600",children:"Firmas Válidas"})]})})}),e.jsx(l,{children:e.jsx(n,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:t.dias_desde_emision}),e.jsx("p",{className:"text-sm text-gray-600",children:"Días de Uso"})]})})}),e.jsx(l,{children:e.jsx(n,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-2xl font-bold",children:[Math.round(t.porcentaje_vida_util),"%"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Vida Útil Transcurrida"})]})})})]}),(t.primera_firma||t.ultima_firma)&&e.jsxs(l,{children:[e.jsx(d,{children:e.jsx(m,{children:"Historial de Uso"})}),e.jsxs(n,{className:"space-y-3",children:[t.primera_firma&&e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium text-gray-600",children:"Primera Firma"}),e.jsx("p",{children:new Date(t.primera_firma).toLocaleString()})]}),t.ultima_firma&&e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium text-gray-600",children:"Última Firma"}),e.jsx("p",{children:new Date(t.ultima_firma).toLocaleString()})]})]})]})]}),e.jsx(p,{value:"firmas",className:"space-y-6",children:e.jsxs(l,{children:[e.jsxs(d,{children:[e.jsxs(m,{children:["Firmas Realizadas (",a.firmas.length,")"]}),e.jsx(H,{children:"Documentos firmados con este certificado"})]}),e.jsx(n,{children:a.firmas.length>0?e.jsxs(je,{children:[e.jsx(pe,{children:e.jsxs(O,{children:[e.jsx(u,{children:"Documento"}),e.jsx(u,{children:"Fecha"}),e.jsx(u,{children:"Estado"}),e.jsx(u,{children:"Acciones"})]})}),e.jsx(ue,{children:a.firmas.map(s=>e.jsxs(O,{children:[e.jsx(v,{children:e.jsx("div",{className:"font-medium",children:s.documento.nombre})}),e.jsx(v,{children:new Date(s.fecha_firma).toLocaleString()}),e.jsx(v,{children:e.jsx(x,{variant:s.valida?"default":"destructive",children:s.valida?"Válida":"Inválida"})}),e.jsx(v,{children:e.jsx(T,{href:route("admin.documentos.show",s.documento.id),children:e.jsx(c,{variant:"outline",size:"sm",children:"Ver Documento"})})})]},s.id))})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(me,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No se han realizado firmas con este certificado"})]})})]})}),e.jsx(p,{value:"auditoria",className:"space-y-6",children:e.jsxs(l,{children:[e.jsxs(d,{children:[e.jsxs(m,{className:"flex items-center",children:[e.jsx(P,{className:"h-5 w-5 mr-2"}),"Historial de Auditoría"]}),e.jsx(H,{children:"Registro de todas las acciones realizadas sobre este certificado"})]}),e.jsx(n,{children:_.length>0?e.jsx("div",{className:"space-y-4",children:_.map(s=>e.jsxs("div",{className:"border-l-2 border-gray-200 pl-4 pb-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(x,{variant:"outline",className:"capitalize",children:s.accion}),e.jsxs("span",{className:"text-sm text-gray-600",children:["por ",s.usuario?.name||"Sistema"]})]}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(s.created_at).toLocaleString()})]}),s.descripcion&&e.jsx("p",{className:"mt-2 text-sm text-gray-700",children:s.descripcion}),s.contexto_adicional&&Object.keys(s.contexto_adicional).length>0&&e.jsx("div",{className:"mt-2 text-sm text-gray-600",children:Object.entries(s.contexto_adicional).map(([r,o])=>e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[r,":"]})," ",String(o)]},r))})]},s.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(P,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No hay registros de auditoría disponibles"})]})})]})})]})]})]})}export{ss as default};
