import{r,j as e,H as ae,a as h,b as F}from"./app-BuJooCB2.js";import{A as te}from"./app-layout-CSvwa8Xt.js";import{C as u,a as x,b as p,c as g,d as v}from"./card-Dm8Sxxxu.js";import{c as re,B as o}from"./button-o7sDTR10.js";import{I as j}from"./input-BTIJ4r9q.js";import{L as l}from"./label-zUIVNhJD.js";import{S as ce,a as ie,b as ne,c as oe,d as C}from"./select-C_00d0nr.js";import{A as T,a as H}from"./alert-D3DVPO65.js";import{K as I,D as L,a as Q,b as _,c as G,d as V}from"./app-sidebar-layout-CNDt14fj.js";import{S as le,T as N,M as de}from"./triangle-alert-DGPIiAMo.js";import{C as q}from"./circle-check-BZKKzmLt.js";import{S as z}from"./smartphone-BAQVAn3u.js";/* empty css            */import"./index-CCv8Isyn.js";import"./index-Bdl-WcJK.js";import"./Combination-BNwokkeO.js";import"./index-9ThOp0oj.js";import"./check-CSAT8V4U.js";import"./index-DmZWXubS.js";import"./x-BWy7YUo4.js";import"./index-B32rHSx8.js";import"./app-logo-icon-BDSQZXaI.js";import"./user-yB-EHhJt.js";import"./users-B1PaIWsM.js";import"./folder-Cr7M8TWf.js";import"./search-BRBLXc6Q.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]],he=re("QrCode",me);function Ve({enabled:O,confirmed:ue,method:P}){const[b,w]=r.useState(O),[t,B]=r.useState(P),[S,K]=r.useState(null),[A,U]=r.useState(null),[k,D]=r.useState(""),[n,d]=r.useState(""),[M,J]=r.useState(""),[c,i]=r.useState(!1),[W,f]=r.useState(!1),[X,y]=r.useState(!1),[R,E]=r.useState([]),[m,a]=r.useState(null),Y=async()=>{i(!0),a(null);try{const s=await h.post("/two-factor/enable",{method:t,phone_number:t==="sms"?M:null});s.data.success&&(t==="totp"&&(K(s.data.qr_code),U(s.data.secret),f(!0)),a({type:"success",message:s.data.message}))}catch(s){a({type:"error",message:s.response?.data?.message||"Error al habilitar 2FA"})}finally{i(!1)}},Z=async()=>{i(!0),a(null);try{const s=await h.post("/two-factor/confirm",{code:k});s.data.success&&(w(!0),f(!1),D(""),s.data.recovery_codes&&(E(s.data.recovery_codes),y(!0)),a({type:"success",message:s.data.message}),setTimeout(()=>F.reload(),500))}catch(s){a({type:"error",message:s.response?.data?.message||"C贸digo inv谩lido"})}finally{i(!1)}},$=async()=>{if(!n){a({type:"error",message:"Debes ingresar tu contrase帽a"});return}i(!0),a(null);try{const s=await h.post("/two-factor/disable",{password:n});s.data.success&&(w(!1),d(""),a({type:"success",message:s.data.message}),F.reload())}catch(s){a({type:"error",message:s.response?.data?.message||"Error al deshabilitar 2FA"})}finally{i(!1)}},ee=async()=>{if(!n){a({type:"error",message:"Debes ingresar tu contrase帽a"});return}i(!0),a(null);try{const s=await h.post("/two-factor/recovery-codes/regenerate",{password:n});s.data.success&&(E(s.data.codes),y(!0),d(""),a({type:"success",message:s.data.message}))}catch(s){a({type:"error",message:s.response?.data?.message||"Error al regenerar c贸digos"})}finally{i(!1)}};return e.jsxs(te,{children:[e.jsx(ae,{title:"Autenticaci贸n de Dos Factores"}),e.jsxs("div",{className:"container mx-auto py-6 max-w-4xl space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(le,{className:"h-8 w-8 text-primary"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Autenticaci贸n de Dos Factores"}),e.jsx("p",{className:"text-muted-foreground",children:"Agrega una capa adicional de seguridad a tu cuenta"})]})]}),m&&e.jsxs(T,{variant:m.type==="error"?"destructive":"default",children:[m.type==="success"?e.jsx(q,{className:"h-4 w-4"}):e.jsx(N,{className:"h-4 w-4"}),e.jsx(H,{children:m.message})]}),e.jsxs(u,{children:[e.jsx(x,{children:e.jsx(p,{children:"Estado Actual"})}),e.jsx(g,{children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("div",{className:"flex items-center gap-3",children:b?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-5 w-5 text-green-500"}),e.jsxs("span",{className:"font-medium",children:["2FA est谩 ",e.jsx("strong",{children:"habilitado"})," con m茅todo:"," ",t==="totp"&&"Aplicaci贸n de Autenticaci贸n",t==="sms"&&"SMS",t==="email"&&"Email"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"h-5 w-5 text-amber-500"}),e.jsx("span",{className:"font-medium",children:"2FA est谩 deshabilitado"})]})})})})]}),b?e.jsxs(e.Fragment,{children:[e.jsxs(u,{children:[e.jsxs(x,{children:[e.jsx(p,{children:"C贸digos de Recuperaci贸n"}),e.jsx(v,{children:"Guarda estos c贸digos en un lugar seguro. Los necesitar谩s si pierdes acceso a tu m茅todo de 2FA."})]}),e.jsxs(g,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{children:"Contrase帽a (para confirmar)"}),e.jsx(j,{type:"password",value:n,onChange:s=>d(s.target.value),placeholder:"Ingresa tu contrase帽a"})]}),e.jsxs(o,{onClick:ee,disabled:c,variant:"outline",className:"w-full",children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),c?"Generando...":"Regenerar C贸digos de Recuperaci贸n"]})]})]}),e.jsxs(u,{className:"border-destructive",children:[e.jsxs(x,{children:[e.jsx(p,{className:"text-destructive",children:"Deshabilitar 2FA"}),e.jsx(v,{children:"Esto reducir谩 la seguridad de tu cuenta"})]}),e.jsxs(g,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{children:"Confirma tu contrase帽a"}),e.jsx(j,{type:"password",value:n,onChange:s=>d(s.target.value),placeholder:"Ingresa tu contrase帽a"})]}),e.jsx(o,{onClick:$,disabled:c,variant:"destructive",className:"w-full",children:c?"Deshabilitando...":"Deshabilitar 2FA"})]})]})]}):e.jsxs(u,{children:[e.jsxs(x,{children:[e.jsx(p,{children:"Habilitar 2FA"}),e.jsx(v,{children:"Elige un m茅todo de autenticaci贸n de dos factores"})]}),e.jsxs(g,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{children:"M茅todo de Autenticaci贸n"}),e.jsxs(ce,{value:t,onValueChange:s=>B(s),children:[e.jsx(ie,{children:e.jsx(ne,{})}),e.jsxs(oe,{children:[e.jsx(C,{value:"totp",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4"}),"Aplicaci贸n de Autenticaci贸n (TOTP)"]})}),e.jsx(C,{value:"sms",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4"}),"SMS"]})}),e.jsx(C,{value:"email",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-4 w-4"}),"Correo Electr贸nico"]})})]})]})]}),t==="sms"&&e.jsxs("div",{children:[e.jsx(l,{children:"N煤mero de Tel茅fono"}),e.jsx(j,{type:"tel",value:M,onChange:s=>J(s.target.value),placeholder:"+57 300 123 4567"})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-950 p-4 rounded-lg",children:[e.jsxs("h4",{className:"font-semibold mb-2",children:[t==="totp"&&" Aplicaci贸n de Autenticaci贸n",t==="sms"&&" SMS",t==="email"&&" Correo Electr贸nico"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[t==="totp"&&"Usa aplicaciones como Google Authenticator, Microsoft Authenticator o Authy",t==="sms"&&"Recibir谩s un c贸digo de 6 d铆gitos v铆a SMS",t==="email"&&"Recibir谩s un c贸digo de verificaci贸n en tu correo"]})]}),e.jsx(o,{onClick:Y,disabled:c,className:"w-full",children:c?"Configurando...":"Habilitar 2FA"})]})]})]}),e.jsx(L,{open:W,onOpenChange:f,children:e.jsxs(Q,{className:"max-w-md",children:[e.jsxs(_,{children:[e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-5 w-5"}),"Escanea el C贸digo QR"]}),e.jsx(V,{children:"Usa tu aplicaci贸n de autenticaci贸n para escanear este c贸digo"})]}),e.jsxs("div",{className:"space-y-4",children:[S&&e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:S,alt:"QR Code",className:"w-64 h-64"})}),A&&e.jsxs("div",{className:"bg-muted p-3 rounded-lg",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"O ingresa este c贸digo manualmente:"}),e.jsx("code",{className:"text-sm font-mono",children:A})]}),e.jsxs("div",{children:[e.jsx(l,{children:"C贸digo de Verificaci贸n"}),e.jsx(j,{type:"text",value:k,onChange:s=>D(s.target.value),placeholder:"000000",maxLength:6})]}),e.jsx(o,{onClick:Z,disabled:c,className:"w-full",children:c?"Verificando...":"Confirmar y Activar"})]})]})}),e.jsx(L,{open:X,onOpenChange:y,children:e.jsxs(Q,{className:"max-w-md",children:[e.jsxs(_,{children:[e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-5 w-5"}),"C贸digos de Recuperaci贸n"]}),e.jsx(V,{children:"Guarda estos c贸digos en un lugar seguro. Solo se mostrar谩n una vez."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(T,{children:[e.jsx(N,{className:"h-4 w-4"}),e.jsx(H,{children:"Cada c贸digo solo puede usarse una vez. Gu谩rdalos en un lugar seguro."})]}),e.jsx("div",{className:"bg-muted p-4 rounded-lg font-mono text-sm grid grid-cols-2 gap-2",children:R.map((s,se)=>e.jsx("div",{className:"bg-background p-2 rounded",children:s},se))}),e.jsx(o,{onClick:()=>{const s=R.join(`
`);navigator.clipboard.writeText(s),a({type:"success",message:"C贸digos copiados al portapapeles"})},variant:"outline",className:"w-full",children:"Copiar C贸digos"})]})]})})]})}export{Ve as default};
