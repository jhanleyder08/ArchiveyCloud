import{r as g,j as e,H as M,L as O,b as x}from"./app-1TbR1aNv.js";import{A as X,S as z}from"./app-sidebar-layout-EVqXnw4l.js";import{B as c}from"./button-Bh8HL4t-.js";import{C as t,c as i,a as d,b as n,d as G}from"./card-CjIDma1Z.js";import{B as J}from"./badge-CahYhPrs.js";import{P as _}from"./progress-B-ZTswY9.js";import{T as K,a as Q,b as h,c as j}from"./tabs-CJemOyIC.js";import{A as W,a as Y}from"./alert-a9IGCIbG.js";import{T as Z,a as ee,b as T,c as A,d as se,e as I}from"./table-YDxgXg6u.js";import{T as $}from"./triangle-alert-Csu15FGV.js";import{C as F}from"./circle-x-BIuE7i2F.js";import{C as P}from"./circle-check-big-C8qeYor2.js";import{P as L}from"./play-DMyHmCmM.js";import{C as v}from"./folder-BrHeBlTR.js";import{A as ae}from"./arrow-left-D4dywRtW.js";import{A as S}from"./activity-CN6ZfQfI.js";import{X as re}from"./x-BA_bLoEE.js";import{T as te}from"./trash-2-CJKPg-zO.js";import{F as o}from"./Combination-Bg4lGtaS.js";import{U as D}from"./user-Eo78Nm40.js";import{C as ie}from"./calendar-CgCzJ12r.js";import{D as N}from"./users-KtdTbN4b.js";/* empty css            */import"./index-DaDMCySO.js";import"./index-12rucE5D.js";import"./index-DV8Rt-0p.js";import"./index-B37z7FM4.js";import"./app-logo-icon-D5sKSL8w.js";import"./input-B9S_DJNe.js";import"./label-CB51Zwfa.js";import"./mail-Dw8iYVcL.js";import"./search-BY4VdWrh.js";const E={expedientes:"Expedientes",documentos:"Documentos",series:"Series Documentales",usuarios:"Usuarios",certificados:"Certificados"},le={pendiente:{icon:v,color:"bg-yellow-100 text-yellow-800",label:"Pendiente"},procesando:{icon:L,color:"bg-blue-100 text-blue-800",label:"Procesando"},completada:{icon:P,color:"bg-green-100 text-green-800",label:"Completada"},fallida:{icon:F,color:"bg-red-100 text-red-800",label:"Fallida"},cancelada:{icon:$,color:"bg-gray-100 text-gray-800",label:"Cancelada"}};function Re({importacion:s,archivosGenerados:b,puedeEditar:w,puedeEliminar:U}){const[a,k]=g.useState(s),[p,f]=g.useState(s.estado==="procesando");g.useEffect(()=>{if(!p||s.estado!=="procesando")return;const r=setInterval(async()=>{try{const m=await(await fetch(`/admin/importaciones/${s.id}/progreso`)).json();k(q=>({...q,...m})),m.estado!=="procesando"&&(f(!1),window.location.reload())}catch(l){console.error("Error obteniendo progreso:",l)}},5e3);return()=>clearInterval(r)},[p,s.id,s.estado]);const B=()=>{x.post(`/admin/importaciones/${s.id}/procesar`,{},{onSuccess:()=>f(!0)})},R=()=>{confirm("¿Estás seguro de que deseas cancelar esta importación?")&&x.post(`/admin/importaciones/${s.id}/cancelar`,{},{onSuccess:()=>f(!1)})},H=()=>{confirm("¿Estás seguro de que deseas eliminar esta importación?")&&x.delete(`/admin/importaciones/${s.id}`,{onSuccess:()=>x.visit("/admin/importaciones/listado")})},C=r=>{if(!r)return"-";if(r<60)return`${r}s`;const l=Math.floor(r/60),m=r%60;return`${l}m ${m}s`},y=r=>new Date(r).toLocaleString(),u=le[s.estado],V=u?.icon||v;return e.jsxs(X,{children:[e.jsx(M,{title:`Importación: ${s.nombre}`}),e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(c,{variant:"outline",asChild:!0,children:e.jsxs(O,{href:"/admin/importaciones/listado",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Volver"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:s.nombre}),e.jsx("p",{className:"text-muted-foreground",children:s.descripcion||"Sin descripción"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[p&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(S,{className:"h-4 w-4 text-green-500 animate-pulse"}),"Auto-actualizando..."]}),s.estado==="pendiente"&&w&&e.jsxs(c,{onClick:B,children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Procesar"]}),(s.estado==="pendiente"||s.estado==="procesando")&&w&&e.jsxs(c,{variant:"outline",onClick:R,children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Cancelar"]}),U&&e.jsxs(c,{variant:"destructive",onClick:H,children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Eliminar"]})]})]}),e.jsx(t,{children:e.jsxs(i,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(V,{className:"h-8 w-8"}),e.jsxs("div",{children:[e.jsx(J,{className:`${u?.color} text-lg px-3 py-1`,children:u?.label||s.estado}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[E[s.tipo]," • ",s.formato_origen.toUpperCase()]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold",children:[a.registros_procesados," / ",a.total_registros]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"registros procesados"})]})]}),s.estado==="procesando"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Progreso general"}),e.jsxs("span",{className:"font-medium",children:[a.porcentaje_avance.toFixed(1),"%"]})]}),e.jsx(_,{value:a.porcentaje_avance,className:"h-3"}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[e.jsxs("span",{children:["Iniciado: ",a.fecha_inicio?y(a.fecha_inicio):"-"]}),e.jsxs("span",{children:["Tiempo: ",C(a.tiempo_procesamiento)]})]})]}),s.mensaje_error&&e.jsxs(W,{variant:"destructive",className:"mt-4",children:[e.jsx($,{className:"h-4 w-4"}),e.jsxs(Y,{children:[e.jsx("strong",{children:"Error:"})," ",s.mensaje_error]})]})]})}),e.jsxs(K,{defaultValue:"detalles",className:"space-y-6",children:[e.jsxs(Q,{children:[e.jsx(h,{value:"detalles",children:"Detalles"}),e.jsx(h,{value:"estadisticas",children:"Estadísticas"}),e.jsx(h,{value:"configuracion",children:"Configuración"}),e.jsx(h,{value:"archivos",children:"Archivos"})]}),e.jsx(j,{value:"detalles",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(t,{children:[e.jsx(d,{children:e.jsxs(n,{className:"flex items-center gap-2",children:[e.jsx(o,{className:"h-5 w-5"}),"Información General"]})}),e.jsx(i,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"ID:"}),e.jsx("p",{children:s.id})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Tipo:"}),e.jsx("p",{children:E[s.tipo]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Formato:"}),e.jsx("p",{children:s.formato_origen.toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Total registros:"}),e.jsx("p",{children:s.total_registros.toLocaleString()})]})]})})]}),e.jsxs(t,{children:[e.jsx(d,{children:e.jsxs(n,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5"}),"Usuario y Fechas"]})}),e.jsx(i,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-sm",children:"Creado por:"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(D,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.usuario?.name||"Usuario no disponible"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.usuario?.email||"Email no disponible"})]})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-sm",children:"Fecha de creación:"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(ie,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("p",{children:y(s.created_at)})]})]}),s.tiempo_procesamiento&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-sm",children:"Tiempo de procesamiento:"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(v,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("p",{children:C(s.tiempo_procesamiento)})]})]})]})})]})]})}),e.jsxs(j,{value:"estadisticas",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6",children:[e.jsx(t,{children:e.jsx(i,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total"}),e.jsx("p",{className:"text-2xl font-bold",children:s.total_registros})]}),e.jsx(o,{className:"h-8 w-8 text-blue-600"})]})})}),e.jsx(t,{children:e.jsx(i,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Procesados"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:a.registros_procesados})]}),e.jsx(S,{className:"h-8 w-8 text-blue-600"})]})})}),e.jsx(t,{children:e.jsx(i,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Exitosos"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:a.registros_exitosos})]}),e.jsx(P,{className:"h-8 w-8 text-green-600"})]})})}),e.jsx(t,{children:e.jsx(i,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Fallidos"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:a.registros_fallidos})]}),e.jsx(F,{className:"h-8 w-8 text-red-600"})]})})})]}),s.estado==="completada"&&e.jsxs(t,{children:[e.jsx(d,{children:e.jsx(n,{children:"Resumen de Resultados"})}),e.jsx(i,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Tasa de éxito:"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:[(a.registros_exitosos/a.total_registros*100).toFixed(1),"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Tasa de error:"}),e.jsxs("p",{className:"text-2xl font-bold text-red-600",children:[(a.registros_fallidos/a.total_registros*100).toFixed(1),"%"]})]})]}),e.jsx(_,{value:a.registros_exitosos/a.total_registros*100,className:"h-4"})]})})]})]}),e.jsx(j,{value:"configuracion",children:e.jsxs(t,{children:[e.jsx(d,{children:e.jsxs(n,{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-5 w-5"}),"Configuración de Importación"]})}),e.jsx(i,{children:s.configuracion?e.jsx("div",{className:"space-y-6",children:s.configuracion.mapeo&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-3",children:"Mapeo de Campos"}),e.jsxs(Z,{children:[e.jsx(ee,{children:e.jsxs(T,{children:[e.jsx(A,{children:"Campo del Sistema"}),e.jsx(A,{children:"Campo del Archivo"})]})}),e.jsx(se,{children:Object.entries(s.configuracion.mapeo).map(([r,l])=>e.jsxs(T,{children:[e.jsx(I,{className:"font-medium",children:r}),e.jsx(I,{children:l})]},r))})]})]})}):e.jsx("p",{className:"text-muted-foreground",children:"No hay configuración específica disponible."})})]})}),e.jsx(j,{value:"archivos",children:e.jsxs(t,{children:[e.jsxs(d,{children:[e.jsxs(n,{className:"flex items-center gap-2",children:[e.jsx(N,{className:"h-5 w-5"}),"Archivos de la Importación"]}),e.jsx(G,{children:"Descarga los archivos originales y generados durante el procesamiento"})]}),e.jsx(i,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(o,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Archivo Original"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.archivo_origen," • ",s.formato_origen.toUpperCase()]})]})]}),e.jsx(c,{variant:"outline",asChild:!0,children:e.jsxs("a",{href:`/admin/importaciones/${s.id}/descargar/original`,children:[e.jsx(N,{className:"h-4 w-4 mr-2"}),"Descargar"]})})]}),b.map(r=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(o,{className:"h-8 w-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:r.nombre}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Generado durante el procesamiento"})]})]}),e.jsx(c,{variant:"outline",asChild:!0,children:e.jsxs("a",{href:`/admin/importaciones/${s.id}/descargar/${r.tipo}`,children:[e.jsx(N,{className:"h-4 w-4 mr-2"}),"Descargar"]})})]},r.tipo)),b.length===0&&s.estado!=="pendiente"&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(o,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No hay archivos generados disponibles"})]})]})})]})})]})]})]})}export{Re as default};
