import{r as o,j as e,H as K,b as T}from"./app-BcZLevcf.js";import{A as G,h as y,D as X,f as q,a as V,b as W,c as Y,d as J,e as Q}from"./app-sidebar-layout-7SHWFfjl.js";import{C as t,a as l,b as n,c as i}from"./card-BqVwVAoc.js";import{B as L}from"./badge-DiWZNKOt.js";import{c as Z,B as j}from"./button-BsM685ds.js";import{I as S}from"./input-CjLt5s7n.js";import{L as C}from"./label-C1ipmG6c.js";import{T as I,a as ee,b as p,c as u}from"./tabs-BOpw0F5k.js";import{A as D,b as _,a as A}from"./alert-oAPGg03b.js";import{T as se}from"./users-Bv3mV0mG.js";import{M as ae}from"./memory-stick-DHLknzF3.js";import{A as re}from"./activity-C9fVGoSK.js";import{R as E,T as k}from"./CategoricalChart-hTToOwI_.js";import{P as te,a as ie}from"./PieChart-CN-yivcj.js";import{C as le}from"./circle-check-big-_dCpeuxN.js";import{T as P}from"./triangle-alert-CQqqJdBk.js";import{I as ne}from"./info-BpkFcz9m.js";import{T as R}from"./trash-2-DU1nDpte.js";import{C as ce}from"./folder-DShUzZue.js";import{B as de}from"./BarChart-DDB3SN0-.js";import{C as oe,X as me,Y as xe}from"./CartesianChart-CRUSpkQ_.js";import{L as he}from"./Legend-BAfIZkCN.js";import{B as je}from"./barSelectors-Ch17ts3z.js";/* empty css            */import"./index-BVTixdOX.js";import"./Combination-CLJ78jdy.js";import"./index-CNi2YxxG.js";import"./index-CIYEUQm3.js";import"./x-BL4iRsR5.js";import"./index-5AsEmbjk.js";import"./app-logo-icon-Bh6iRABb.js";import"./user-BKj-bQyT.js";import"./mail-J2AKm0cb.js";import"./search-D5mRg5FV.js";import"./tooltipContext-D0QJULvJ.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]],F=Z("Flame",pe);function Qe({cacheInfo:r,cacheStats:m,ttlConfig:M}){const[x,h]=o.useState(!1),[c,z]=o.useState("all"),[f,B]=o.useState(""),[g,O]=o.useState(""),[$,N]=o.useState(!1),H=async()=>{h(!0);try{const a=await(await fetch(route("admin.optimizacion.cache.warmup"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}})).json();a.success?(alert(`Warmup exitoso en ${a.execution_time}`),T.reload()):alert("Error durante warmup: "+a.message)}catch(s){console.error("Error during cache warmup:",s),alert("Error interno del servidor")}finally{h(!1)}},U=async()=>{h(!0);try{const s={type:c};c==="user"&&f?s.user_id=f:c==="pattern"&&g&&(s.pattern=g);const d=await(await fetch(route("admin.optimizacion.cache.flush"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify(s)})).json();d.success?(alert(d.message),T.reload()):alert("Error durante limpieza: "+d.message)}catch(s){console.error("Error during cache flush:",s),alert("Error interno del servidor")}finally{h(!1),N(!1)}},b=s=>{if(s<60)return`${s}s`;if(s<3600)return`${Math.floor(s/60)}m`;{const a=Math.floor(s/3600),d=Math.floor(s%3600/60);return d>0?`${a}h ${d}m`:`${a}h`}};m.map(s=>({name:s.description,cached:s.exists?1:0,not_cached:s.exists?0:1}));const v=Object.entries(M).map(([s,a])=>({name:s.replace("_"," ").toUpperCase(),ttl:a,duration:b(a)})),w=["#10b981","#ef4444"];return e.jsxs(G,{children:[e.jsx(K,{title:"Gestión de Caché"}),e.jsx("div",{className:"py-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8 space-y-6",children:[e.jsx("div",{className:"bg-white p-6 rounded-lg shadow",children:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Gestión de Caché"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(t,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"Driver de Caché"}),e.jsx(y,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold",children:r.driver}),e.jsx(L,{variant:r.status==="healthy"?"default":"destructive",className:"mt-1",children:r.status})]})]}),r.redis&&e.jsxs(e.Fragment,{children:[e.jsxs(t,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"Hit Ratio"}),e.jsx(se,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(i,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[r.redis.hit_ratio,"%"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[r.redis.keyspace_hits.toLocaleString()," hits"]})]})]}),e.jsxs(t,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"Memoria Usada"}),e.jsx(ae,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold",children:r.redis.used_memory}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Redis v",r.redis.version]})]})]}),e.jsxs(t,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"Clientes"}),e.jsx(re,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold",children:r.redis.connected_clients}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Conectados"})]})]})]})]}),e.jsxs(I,{defaultValue:"overview",className:"space-y-6",children:[e.jsxs(ee,{className:"grid w-full grid-cols-4",children:[e.jsx(p,{value:"overview",children:"Resumen"}),e.jsx(p,{value:"management",children:"Gestión"}),e.jsx(p,{value:"config",children:"Configuración TTL"}),e.jsx(p,{value:"stats",children:"Estadísticas"})]}),e.jsx(u,{value:"overview",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(t,{children:[e.jsx(l,{children:e.jsxs(n,{className:"flex items-center gap-2",children:[e.jsx(y,{className:"h-5 w-5"}),"Estado de Cachés Críticos"]})}),e.jsx(i,{children:e.jsx(E,{width:"100%",height:300,children:e.jsxs(te,{children:[e.jsx(ie,{data:[{name:"En Caché",value:m.filter(s=>s.exists).length,fill:w[0]},{name:"Sin Caché",value:m.filter(s=>!s.exists).length,fill:w[1]}],cx:"50%",cy:"50%",outerRadius:80,dataKey:"value",label:({name:s,value:a})=>`${s}: ${a}`}),e.jsx(k,{})]})})})]}),e.jsxs(t,{children:[e.jsx(l,{children:e.jsx(n,{children:"Cachés del Sistema"})}),e.jsx(i,{className:"space-y-3",children:m.map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[s.exists?e.jsx(le,{className:"h-4 w-4 text-green-600"}):e.jsx(P,{className:"h-4 w-4 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.description}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.key})]})]}),e.jsx(L,{variant:s.exists?"default":"secondary",children:s.exists?"En Caché":"No Cacheado"})]},a))})]})]})}),e.jsx(u,{value:"management",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(t,{children:[e.jsx(l,{children:e.jsxs(n,{className:"flex items-center gap-2",children:[e.jsx(F,{className:"h-5 w-5"}),"Precalentamiento de Caché"]})}),e.jsxs(i,{className:"space-y-4",children:[e.jsxs(D,{children:[e.jsx(ne,{className:"h-4 w-4"}),e.jsx(_,{children:"Warmup de Caché"}),e.jsx(A,{children:"Precalienta los cachés críticos del sistema para mejorar el rendimiento."})]}),e.jsxs(j,{onClick:H,disabled:x,className:"w-full flex items-center gap-2",children:[e.jsx(F,{className:"h-4 w-4"}),x?"Precalentando...":"Precalentar Cachés"]})]})]}),e.jsxs(t,{children:[e.jsx(l,{children:e.jsxs(n,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5"}),"Limpieza de Caché"]})}),e.jsxs(i,{className:"space-y-4",children:[e.jsxs(D,{children:[e.jsx(P,{className:"h-4 w-4"}),e.jsx(_,{children:"Precaución"}),e.jsx(A,{children:"La limpieza de caché puede afectar temporalmente el rendimiento."})]}),e.jsxs(X,{open:$,onOpenChange:N,children:[e.jsx(q,{asChild:!0,children:e.jsxs(j,{variant:"destructive",className:"w-full flex items-center gap-2",children:[e.jsx(R,{className:"h-4 w-4"}),"Limpiar Caché"]})}),e.jsxs(V,{children:[e.jsxs(W,{children:[e.jsx(Y,{children:"Limpiar Caché"}),e.jsx(J,{children:"Selecciona el tipo de limpieza de caché que deseas realizar."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{children:"Tipo de Limpieza"}),e.jsxs("select",{value:c,onChange:s=>z(s.target.value),className:"w-full p-2 border rounded-md",children:[e.jsx("option",{value:"all",children:"Todo el caché"}),e.jsx("option",{value:"user",children:"Caché de usuario específico"}),e.jsx("option",{value:"pattern",children:"Por patrón"})]})]}),c==="user"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"userId",children:"ID del Usuario"}),e.jsx(S,{id:"userId",value:f,onChange:s=>B(s.target.value),placeholder:"ID del usuario",type:"number"})]}),c==="pattern"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"pattern",children:"Patrón"}),e.jsx(S,{id:"pattern",value:g,onChange:s=>O(s.target.value),placeholder:"user_*, document_*, etc."})]})]}),e.jsxs(Q,{children:[e.jsx(j,{variant:"outline",onClick:()=>N(!1),children:"Cancelar"}),e.jsx(j,{variant:"destructive",onClick:U,disabled:x,children:x?"Limpiando...":"Limpiar"})]})]})]})]})]})]})}),e.jsx(u,{value:"config",className:"space-y-4",children:e.jsxs(t,{children:[e.jsx(l,{children:e.jsxs(n,{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-5 w-5"}),"Configuración de TTL (Time To Live)"]})}),e.jsx(i,{children:v.length>0?e.jsxs(e.Fragment,{children:[e.jsx(E,{width:"100%",height:400,children:e.jsxs(de,{data:v,children:[e.jsx(oe,{strokeDasharray:"3 3"}),e.jsx(me,{dataKey:"name",angle:-45,textAnchor:"end",height:100}),e.jsx(xe,{}),e.jsx(k,{formatter:(s,a)=>[b(s),"TTL"],labelFormatter:s=>`Tipo: ${s}`}),e.jsx(he,{}),e.jsx(je,{dataKey:"ttl",fill:"#3b82f6",name:"TTL (segundos)"})]})}),e.jsx("div",{className:"mt-6 space-y-3",children:v.map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsx("span",{className:"font-medium",children:s.name}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-mono text-sm",children:s.duration}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.ttl.toLocaleString()," segundos"]})]})]},a))})]}):e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No hay configuración TTL disponible"})})]})}),e.jsx(u,{value:"stats",className:"space-y-4",children:r.redis?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(t,{children:[e.jsx(l,{children:e.jsx(n,{children:"Métricas de Redis"})}),e.jsxs(i,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:r.redis.keyspace_hits.toLocaleString()}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Cache Hits"})]}),e.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:r.redis.keyspace_misses.toLocaleString()}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Cache Misses"})]})]}),e.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[e.jsxs("div",{className:"text-3xl font-bold text-blue-600",children:[r.redis.hit_ratio,"%"]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Hit Ratio"})]})]})]}),e.jsxs(t,{children:[e.jsx(l,{children:e.jsx(n,{children:"Información del Sistema"})}),e.jsxs(i,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Versión Redis:"}),e.jsx("span",{className:"font-mono",children:r.redis.version})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Memoria Usada:"}),e.jsx("span",{className:"font-mono",children:r.redis.used_memory})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Clientes Conectados:"}),e.jsx("span",{className:"font-mono",children:r.redis.connected_clients})]})]})]})]}):e.jsx(t,{children:e.jsxs(i,{className:"text-center py-8",children:[e.jsx(y,{className:"h-16 w-16 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Estadísticas detalladas solo disponibles para Redis"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:["Driver actual: ",r.driver]})]})})})]})]})})]})}export{Qe as default};
