import{r as F,j as e,H as W,L as N,b as u}from"./app-PjT1iryK.js";import{A as J,C as Q}from"./app-sidebar-layout-CwtDgbRQ.js";import{B as m}from"./button-Cm9JNphY.js";import{C as l,c as r,a as h,b as j,d as Z}from"./card-Co6Hd2mM.js";import{I as v}from"./input-D1CzKmS6.js";import{S as y,a as b,b as _,c as w,d as o}from"./select-CT7DStWF.js";import{B as ee}from"./badge-DbeYhTsH.js";import{T as se,a as ae,b as E,c as n,d as ie,e as d}from"./table-B1EJWOOl.js";import{T as le,a as re,b as T,c as C}from"./tabs-Buf1DGN1.js";import{R as te}from"./refresh-cw-DLTO509H.js";import{T as ce}from"./users--70s-uSq.js";import{S as A}from"./search-Cv_ItJ_l.js";import{T as S,S as p}from"./triangle-alert-8-FZxcpm.js";import{U as R}from"./user-DdNuv-nc.js";import{G as D}from"./globe-DWxerxxf.js";import{F as ne}from"./filter-BUw1SQDE.js";import{E as de}from"./eye-LuU56YO9.js";import{R as L,T as B}from"./CategoricalChart-CfuxcaGp.js";import{P as oe,a as xe}from"./PieChart-MrDQpD_7.js";import{C as me}from"./tooltipContext-B2G0fCpD.js";import{B as he}from"./BarChart-BlmaitZU.js";import{C as M,X as U,Y as z}from"./CartesianChart-B7FLbKPN.js";import{B as je}from"./barSelectors-DmNIjp_C.js";import{L as ue}from"./LineChart-DngmTSXE.js";import{L as pe}from"./Line-pyvrs5I9.js";import{C as fe}from"./folder-CRD69BSn.js";import{M as ge}from"./monitor-BsgtwHT2.js";/* empty css            */import"./index-CZ_pd2E1.js";import"./Combination-D9Z0pBWt.js";import"./index-DhjpsedO.js";import"./index-cbXV-n8a.js";import"./x-BzfNQRjC.js";import"./app-logo-icon-MQmYQbHr.js";import"./label-D-XtUnrF.js";import"./mail-Df4Yzh_7.js";import"./index-1M4rcJkl.js";import"./check-D71jOTwn.js";import"./ActivePoints-BvS_968z.js";const Ne={crítico:"#dc2626",alto:"#ea580c",medio:"#d97706",bajo:"#16a34a"};function ts({eventos:a,estadisticas:c,usuarios:V,acciones:H,filtros:t,niveles_riesgo:P,categorias_evento:ve}){const[f,K]=F.useState(!1),G=s=>{switch(s){case"crítico":return"destructive";case"alto":return"destructive";case"medio":return"default";case"bajo":return"secondary";default:return"outline"}},O=s=>{switch(s){case"crítico":return e.jsx(S,{className:"h-4 w-4 text-red-500"});case"alto":return e.jsx(S,{className:"h-4 w-4 text-orange-500"});case"medio":return e.jsx(fe,{className:"h-4 w-4 text-yellow-500"});case"bajo":return e.jsx(p,{className:"h-4 w-4 text-green-500"});default:return e.jsx(p,{className:"h-4 w-4 text-gray-500"})}},$=s=>{const g={autenticacion:R,gestion_usuarios:R,gestion_documentos:FileText,gestion_expedientes:Briefcase,seguridad:p,sistema:ge,general:D}[s]||D;return e.jsx(g,{className:"h-4 w-4"})},x=(s,i)=>{const g=route("admin.auditoria.index",{...t,[s]:i==="all"?"":i,page:1});u.get(g)},X=s=>{const i=route("admin.auditoria.index",{...t,buscar:s,page:1});u.get(i)},I=()=>{u.reload()};F.useEffect(()=>{let s;return f&&(s=setInterval(I,3e4)),()=>{s&&clearInterval(s)}},[f]);const k=c.distribucion_riesgos.map(s=>({name:s.nivel_riesgo,value:s.total,color:Ne[s.nivel_riesgo]||"#gray"})),Y=c.actividad_por_dia.slice(-7).map(s=>({fecha:new Date(s.fecha).toLocaleDateString("es-ES",{month:"short",day:"numeric"}),eventos:s.total})),q=c.acciones_mas_frecuentes.map(s=>({accion:s.accion.replace("_"," "),total:s.total}));return e.jsxs(J,{children:[e.jsx(W,{title:"Auditoría y Trazabilidad Avanzada"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Auditoría y Trazabilidad Avanzada"}),e.jsx("p",{className:"text-muted-foreground",children:"Monitoreo y análisis de actividad del sistema en tiempo real"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"autoRefresh",checked:f,onChange:s=>K(s.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"autoRefresh",className:"text-sm",children:"Auto-refresh"})]}),e.jsxs(m,{variant:"outline",size:"sm",onClick:I,children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Actualizar"]}),e.jsx(N,{href:route("admin.auditoria.analytics"),children:e.jsxs(m,{variant:"outline",children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Analytics"]})}),e.jsx(N,{href:route("admin.auditoria.patrones"),children:e.jsxs(m,{children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Patrones"]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsx(l,{children:e.jsx(r,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(A,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Eventos"}),e.jsx("p",{className:"text-2xl font-bold",children:c.total_eventos.toLocaleString()})]})]})})}),e.jsx(l,{children:e.jsx(r,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(S,{className:"h-8 w-8 text-red-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Eventos Críticos"}),e.jsx("p",{className:"text-2xl font-bold",children:c.eventos_criticos})]})]})})}),e.jsx(l,{children:e.jsx(r,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(p,{className:"h-8 w-8 text-orange-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Alto Riesgo"}),e.jsx("p",{className:"text-2xl font-bold",children:c.eventos_alto_riesgo})]})]})})}),e.jsx(l,{children:e.jsx(r,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(R,{className:"h-8 w-8 text-green-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Usuarios Únicos"}),e.jsx("p",{className:"text-2xl font-bold",children:c.usuarios_unicos})]})]})})}),e.jsx(l,{children:e.jsx(r,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(D,{className:"h-8 w-8 text-purple-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"IPs Únicas"}),e.jsx("p",{className:"text-2xl font-bold",children:c.ips_unicas})]})]})})})]}),e.jsxs(le,{defaultValue:"eventos",className:"space-y-4",children:[e.jsxs(re,{children:[e.jsx(T,{value:"eventos",children:"Eventos"}),e.jsx(T,{value:"estadisticas",children:"Estadísticas"}),e.jsx(T,{value:"tendencias",children:"Tendencias"})]}),e.jsxs(C,{value:"eventos",className:"space-y-4",children:[e.jsxs(l,{children:[e.jsx(h,{children:e.jsxs(j,{className:"flex items-center",children:[e.jsx(ne,{className:"h-5 w-5 mr-2"}),"Filtros de Auditoría"]})}),e.jsx(r,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 xl:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Búsqueda"}),e.jsxs("div",{className:"relative",children:[e.jsx(A,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(v,{placeholder:"Buscar eventos...",defaultValue:t.buscar,className:"pl-9",onChange:s=>{clearTimeout(window.searchTimeout),window.searchTimeout=setTimeout(()=>{X(s.target.value)},500)}})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Usuario"}),e.jsxs(y,{value:t.usuario_id||"all",onValueChange:s=>x("usuario_id",s),children:[e.jsx(b,{children:e.jsx(_,{placeholder:"Todos los usuarios"})}),e.jsxs(w,{children:[e.jsx(o,{value:"all",children:"Todos los usuarios"}),V.map(s=>e.jsx(o,{value:s.id.toString(),children:s.name},s.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Acción"}),e.jsxs(y,{value:t.accion||"all",onValueChange:s=>x("accion",s),children:[e.jsx(b,{children:e.jsx(_,{placeholder:"Todas las acciones"})}),e.jsxs(w,{children:[e.jsx(o,{value:"all",children:"Todas las acciones"}),H.map(s=>e.jsx(o,{value:s,children:s.replace("_"," ")},s))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Nivel de Riesgo"}),e.jsxs(y,{value:t.nivel_riesgo||"all",onValueChange:s=>x("nivel_riesgo",s),children:[e.jsx(b,{children:e.jsx(_,{placeholder:"Todos los niveles"})}),e.jsxs(w,{children:[e.jsx(o,{value:"all",children:"Todos los niveles"}),P.map(s=>e.jsx(o,{value:s,children:s},s))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Fecha Inicio"}),e.jsx(v,{type:"date",value:t.fecha_inicio||"",onChange:s=>x("fecha_inicio",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Fecha Fin"}),e.jsx(v,{type:"date",value:t.fecha_fin||"",onChange:s=>x("fecha_fin",s.target.value)})]})]})})]}),e.jsxs(l,{children:[e.jsxs(h,{children:[e.jsxs(j,{children:["Eventos de Auditoría (",a.meta?.total||0,")"]}),e.jsxs(Z,{children:["Mostrando ",a.meta?.from||0," a ",a.meta?.to||0," de ",a.meta?.total||0," eventos"]})]}),e.jsxs(r,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(se,{children:[e.jsx(ae,{children:e.jsxs(E,{children:[e.jsx(n,{children:"Riesgo"}),e.jsx(n,{children:"Fecha/Hora"}),e.jsx(n,{children:"Usuario"}),e.jsx(n,{children:"Acción"}),e.jsx(n,{children:"Descripción"}),e.jsx(n,{children:"IP / Ubicación"}),e.jsx(n,{children:"Acciones"})]})}),e.jsx(ie,{children:a.data.map(s=>e.jsxs(E,{children:[e.jsx(d,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[O(s.nivel_riesgo),e.jsx(ee,{variant:G(s.nivel_riesgo),children:s.nivel_riesgo})]})}),e.jsx(d,{children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{children:new Date(s.fecha_hora).toLocaleDateString()}),e.jsx("div",{className:"text-gray-500",children:new Date(s.fecha_hora).toLocaleTimeString()})]})}),e.jsx(d,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.usuario?.name||"Sistema"}),e.jsx("div",{className:"text-sm text-gray-500",children:s.usuario?.email})]})}),e.jsx(d,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[$(s.categoria_evento),e.jsx("span",{className:"font-medium",children:s.accion.replace("_"," ")})]})}),e.jsx(d,{children:e.jsx("div",{className:"max-w-xs truncate",title:s.descripcion,children:s.descripcion})}),e.jsx(d,{children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-mono",children:s.ip_address}),e.jsxs("div",{className:"text-gray-500",children:[s.ciudad,", ",s.pais]}),e.jsxs("div",{className:"text-xs text-gray-400",children:[s.dispositivo_tipo," • ",s.navegador]})]})}),e.jsx(d,{children:e.jsx(N,{href:route("admin.auditoria.show",s.id),children:e.jsxs(m,{variant:"outline",size:"sm",children:[e.jsx(de,{className:"h-4 w-4 mr-1"}),"Ver"]})})})]},s.id))})]})}),a.data.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(A,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No hay eventos"}),e.jsx("p",{className:"text-gray-600",children:Object.keys(t).length>0?"No se encontraron eventos con los filtros aplicados":"No hay eventos de auditoría registrados"})]}),(a.meta?.last_page||0)>1&&e.jsxs("div",{className:"flex items-center justify-between mt-6",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Mostrando ",a.meta?.from||0," a ",a.meta?.to||0," de ",a.meta?.total||0," resultados"]}),e.jsx("div",{className:"flex space-x-1",children:(a.links||[]).map((s,i)=>e.jsx(m,{variant:s.active?"default":"outline",size:"sm",onClick:()=>s.url&&u.get(s.url),disabled:!s.url,dangerouslySetInnerHTML:{__html:s.label}},i))})]})]})]})]}),e.jsx(C,{value:"estadisticas",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(l,{children:[e.jsx(h,{children:e.jsx(j,{children:"Distribución por Nivel de Riesgo"})}),e.jsx(r,{children:e.jsx(L,{width:"100%",height:300,children:e.jsxs(oe,{children:[e.jsx(xe,{data:k,cx:"50%",cy:"50%",labelLine:!1,label:({name:s,percent:i})=>`${s} ${(i*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:k.map((s,i)=>e.jsx(me,{fill:s.color},`cell-${i}`))}),e.jsx(B,{})]})})})]}),e.jsxs(l,{children:[e.jsx(h,{children:e.jsx(j,{children:"Acciones Más Frecuentes"})}),e.jsx(r,{children:e.jsx(L,{width:"100%",height:300,children:e.jsxs(he,{data:q,children:[e.jsx(M,{strokeDasharray:"3 3"}),e.jsx(U,{dataKey:"accion"}),e.jsx(z,{}),e.jsx(B,{}),e.jsx(je,{dataKey:"total",fill:"#3b82f6"})]})})})]})]})}),e.jsx(C,{value:"tendencias",className:"space-y-4",children:e.jsxs(l,{children:[e.jsx(h,{children:e.jsx(j,{children:"Actividad por Día (Últimos 7 días)"})}),e.jsx(r,{children:e.jsx(L,{width:"100%",height:300,children:e.jsxs(ue,{data:Y,children:[e.jsx(M,{strokeDasharray:"3 3"}),e.jsx(U,{dataKey:"fecha"}),e.jsx(z,{}),e.jsx(B,{}),e.jsx(pe,{type:"monotone",dataKey:"eventos",stroke:"#8884d8",strokeWidth:2})]})})})]})})]})]})]})}export{ts as default};
