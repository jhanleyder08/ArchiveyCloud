import{r as A,j as e,H as G,L as P}from"./app-BQTi1tix.js";import{A as K}from"./app-sidebar-layout-BqUV8IOl.js";import{B as S}from"./button-jbMTrknk.js";import{C as l,c as r,a as c,b as n,d as y}from"./card-DT9hPMwR.js";import{B as x}from"./badge-C3VR8LKO.js";import{T as $,a as O,b as R,c as d,d as X,e as o}from"./table-CuGBz4BN.js";import{T as Y,a as J,b as w,c as T}from"./tabs-SdbgyzCY.js";import{A as j,a as p}from"./alert-BsN-LFPU.js";import{A as Q}from"./arrow-left-DgJ-iDIN.js";import{T as t,S as h}from"./triangle-alert-BhoOSpsi.js";import{T as D}from"./users-DiCSiRim.js";import{C as u}from"./folder-PlDrKnWl.js";import{S as _}from"./search-912_Z_K3.js";import{E as W}from"./eye-B2JWY-oK.js";import{R as B,T as L}from"./CategoricalChart-CeKCnDHq.js";import{P as Z,a as ee}from"./PieChart-DzLFISn5.js";import{C as se}from"./tooltipContext-C8hvsWFx.js";import{B as ae}from"./BarChart-C2W7txD9.js";import{C as ie,X as le,Y as re}from"./CartesianChart-DK22leoQ.js";import{B as te}from"./barSelectors-B-Dlt3XR.js";import{G as I}from"./globe-Cg4Ja4bY.js";import{U as ce}from"./user-DhAq0Tlb.js";import{A as ne}from"./activity-pAdlqtfO.js";/* empty css            */import"./index-CG-EXtn0.js";import"./Combination-ChugFezL.js";import"./index-P1psqDm4.js";import"./index-GsiYYk_T.js";import"./x-BCECMJer.js";import"./index-Cr43teK3.js";import"./app-logo-icon-D5w3FSZ6.js";import"./input-Cc9jF3XX.js";import"./label-DM-KQF7g.js";const q=["#dc2626","#ea580c","#d97706","#16a34a","#3b82f6"];function Me({patrones_sospechosos:v,estadisticas_patrones:m,alertas_activas:a}){const[f,E]=A.useState("all"),[N,H]=A.useState("all"),F=s=>{switch(s){case"crítico":return"destructive";case"alto":return"destructive";case"medio":return"default";case"bajo":return"secondary";default:return"outline"}},U=s=>{switch(s){case"crítico":return e.jsx(t,{className:"h-4 w-4 text-red-500"});case"alto":return e.jsx(t,{className:"h-4 w-4 text-orange-500"});case"medio":return e.jsx(u,{className:"h-4 w-4 text-yellow-500"});case"bajo":return e.jsx(h,{className:"h-4 w-4 text-green-500"});default:return e.jsx(h,{className:"h-4 w-4 text-gray-500"})}},k=s=>{const M={accesos_multiples_rapidos:ne,cambios_masivos:D,horarios_inusuales:u,ips_sospechosas:I,acciones_privilegiadas:h,patron_escalada_privilegios:t}[s]||_;return e.jsx(M,{className:"h-4 w-4"})},g=s=>({accesos_multiples_rapidos:"Accesos múltiples rápidos",cambios_masivos:"Cambios masivos en el sistema",horarios_inusuales:"Actividad en horarios inusuales",ips_sospechosas:"IPs sospechosas o prohibidas",acciones_privilegiadas:"Acciones que requieren privilegios",patron_escalada_privilegios:"Escalada de privilegios detectada"})[s]||s.replace("_"," "),b=(s=>s.filter(i=>!(f!=="all"&&i.nivel_riesgo!==f||N!=="all"&&i.detalles.tipo!==N)))(v),C=m.tipos_patrones.map((s,i)=>({name:g(s.tipo),value:s.total,color:q[i%q.length]})),V=m.distribucion_riesgos.map(s=>({name:s.nivel_riesgo,value:s.total})),z=[...new Set(v.map(s=>s.detalles.tipo))];return e.jsxs(K,{children:[e.jsx(G,{title:"Patrones Sospechosos - Auditoría Avanzada"}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(P,{href:route("admin.auditoria.index"),children:e.jsxs(S,{variant:"outline",size:"sm",children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Volver"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Patrones Sospechosos"}),e.jsx("p",{className:"text-muted-foreground",children:"Detección automática de comportamientos anómalos y riesgosos"})]})]})}),a.patrones_criticos>0&&e.jsxs(j,{variant:"destructive",children:[e.jsx(t,{className:"h-4 w-4"}),e.jsxs(p,{children:[e.jsx("strong",{children:"¡Atención!"})," Se han detectado ",a.patrones_criticos," patrones críticos en las últimas 24 horas que requieren investigación inmediata."]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(l,{children:e.jsx(r,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(D,{className:"h-8 w-8 text-red-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Patrones"}),e.jsx("p",{className:"text-2xl font-bold",children:m.total_patrones})]})]})})}),e.jsx(l,{children:e.jsx(r,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(u,{className:"h-8 w-8 text-orange-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Última Semana"}),e.jsx("p",{className:"text-2xl font-bold",children:m.patrones_ultima_semana})]})]})})}),e.jsx(l,{children:e.jsx(r,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(t,{className:"h-8 w-8 text-red-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Críticos Activos"}),e.jsx("p",{className:"text-2xl font-bold",children:a.patrones_criticos})]})]})})}),e.jsx(l,{children:e.jsx(r,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(_,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Investigaciones"}),e.jsx("p",{className:"text-2xl font-bold",children:a.investigaciones_pendientes})]})]})})})]}),e.jsxs(Y,{defaultValue:"patrones",className:"space-y-4",children:[e.jsxs(J,{children:[e.jsx(w,{value:"patrones",children:"Patrones Detectados"}),e.jsx(w,{value:"estadisticas",children:"Estadísticas"}),e.jsx(w,{value:"alertas",children:"Alertas Activas"})]}),e.jsxs(T,{value:"patrones",className:"space-y-4",children:[e.jsxs(l,{children:[e.jsx(c,{children:e.jsx(n,{children:"Filtros"})}),e.jsx(r,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Nivel de Riesgo"}),e.jsxs("select",{value:f,onChange:s=>E(s.target.value),className:"w-full p-2 border rounded-md",children:[e.jsx("option",{value:"all",children:"Todos los niveles"}),e.jsx("option",{value:"crítico",children:"Crítico"}),e.jsx("option",{value:"alto",children:"Alto"}),e.jsx("option",{value:"medio",children:"Medio"}),e.jsx("option",{value:"bajo",children:"Bajo"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Tipo de Patrón"}),e.jsxs("select",{value:N,onChange:s=>H(s.target.value),className:"w-full p-2 border rounded-md",children:[e.jsx("option",{value:"all",children:"Todos los tipos"}),z.map(s=>e.jsx("option",{value:s,children:g(s)},s))]})]})]})})]}),e.jsxs(l,{children:[e.jsxs(c,{children:[e.jsxs(n,{children:["Patrones Sospechosos Detectados (",b.length,")"]}),e.jsx(y,{children:"Comportamientos anómalos identificados automáticamente"})]}),e.jsxs(r,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs($,{children:[e.jsx(O,{children:e.jsxs(R,{children:[e.jsx(d,{children:"Riesgo"}),e.jsx(d,{children:"Tipo"}),e.jsx(d,{children:"Fecha/Hora"}),e.jsx(d,{children:"Usuario"}),e.jsx(d,{children:"Detalles"}),e.jsx(d,{children:"Acciones"})]})}),e.jsx(X,{children:b.map(s=>e.jsxs(R,{children:[e.jsx(o,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[U(s.nivel_riesgo),e.jsx(x,{variant:F(s.nivel_riesgo),children:s.nivel_riesgo})]})}),e.jsx(o,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[k(s.detalles.tipo),e.jsx("span",{className:"font-medium",children:g(s.detalles.tipo)})]})}),e.jsx(o,{children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{children:new Date(s.fecha_hora).toLocaleDateString()}),e.jsx("div",{className:"text-gray-500",children:new Date(s.fecha_hora).toLocaleTimeString()})]})}),e.jsx(o,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.usuario?.name||"Sistema"}),e.jsx("div",{className:"text-sm text-gray-500",children:s.usuario?.email})]})}),e.jsx(o,{children:e.jsxs("div",{className:"text-sm space-y-1",children:[s.detalles.cantidad&&e.jsxs("div",{children:["Cantidad: ",e.jsx("span",{className:"font-medium",children:s.detalles.cantidad})]}),s.detalles.ventana_tiempo&&e.jsxs("div",{children:["Ventana: ",e.jsx("span",{className:"font-medium",children:s.detalles.ventana_tiempo})]}),s.detalles.hora&&e.jsxs("div",{children:["Hora: ",e.jsx("span",{className:"font-medium",children:s.detalles.hora})]}),s.detalles.ip&&e.jsxs("div",{children:["IP: ",e.jsx("span",{className:"font-mono text-xs",children:s.detalles.ip})]})]})}),e.jsx(o,{children:e.jsx(P,{href:route("admin.auditoria.show",s.id),children:e.jsxs(S,{variant:"outline",size:"sm",children:[e.jsx(W,{className:"h-4 w-4 mr-1"}),"Ver"]})})})]},s.id))})]})}),b.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(h,{className:"h-12 w-12 text-green-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No hay patrones sospechosos"}),e.jsx("p",{className:"text-gray-600",children:v.length===0?"No se han detectado patrones sospechosos":"No hay patrones que coincidan con los filtros aplicados"})]})]})]})]}),e.jsx(T,{value:"estadisticas",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(l,{children:[e.jsx(c,{children:e.jsx(n,{children:"Distribución por Tipo de Patrón"})}),e.jsx(r,{children:e.jsx(B,{width:"100%",height:300,children:e.jsxs(Z,{children:[e.jsx(ee,{data:C,cx:"50%",cy:"50%",labelLine:!1,label:({name:s,percent:i})=>`${s} ${(i*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:C.map((s,i)=>e.jsx(se,{fill:s.color},`cell-${i}`))}),e.jsx(L,{})]})})})]}),e.jsxs(l,{children:[e.jsx(c,{children:e.jsx(n,{children:"Distribución por Nivel de Riesgo"})}),e.jsx(r,{children:e.jsx(B,{width:"100%",height:300,children:e.jsxs(ae,{data:V,children:[e.jsx(ie,{strokeDasharray:"3 3"}),e.jsx(le,{dataKey:"name"}),e.jsx(re,{}),e.jsx(L,{}),e.jsx(te,{dataKey:"value",fill:"#3b82f6"})]})})})]})]})}),e.jsx(T,{value:"alertas",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(l,{children:[e.jsxs(c,{children:[e.jsx(n,{children:"Estado de Seguridad"}),e.jsx(y,{children:"Medidas de seguridad activas"})]}),e.jsxs(r,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(I,{className:"h-5 w-5 text-red-500"}),e.jsx("span",{className:"font-medium",children:"IPs Bloqueadas"})]}),e.jsx(x,{variant:"destructive",children:a.ips_bloqueadas.length})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ce,{className:"h-5 w-5 text-orange-500"}),e.jsx("span",{className:"font-medium",children:"Usuarios Suspendidos"})]}),e.jsx(x,{variant:"secondary",children:a.usuarios_suspendidos.length})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(t,{className:"h-5 w-5 text-red-500"}),e.jsx("span",{className:"font-medium",children:"Patrones Críticos"})]}),e.jsx(x,{variant:"destructive",children:a.patrones_criticos})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_,{className:"h-5 w-5 text-blue-500"}),e.jsx("span",{className:"font-medium",children:"Investigaciones Pendientes"})]}),e.jsx(x,{variant:"outline",children:a.investigaciones_pendientes})]})]})]}),e.jsxs(l,{children:[e.jsxs(c,{children:[e.jsx(n,{children:"Recomendaciones"}),e.jsx(y,{children:"Acciones sugeridas basadas en patrones detectados"})]}),e.jsx(r,{children:e.jsxs("div",{className:"space-y-3",children:[a.patrones_criticos>0&&e.jsxs(j,{children:[e.jsx(t,{className:"h-4 w-4"}),e.jsxs(p,{children:["Revisar inmediatamente los ",a.patrones_criticos," patrones críticos detectados"]})]}),m.patrones_ultima_semana>10&&e.jsxs(j,{children:[e.jsx(u,{className:"h-4 w-4"}),e.jsx(p,{children:"Considerar ajustar los controles de seguridad debido al aumento de patrones detectados"})]}),e.jsxs(j,{children:[e.jsx(h,{className:"h-4 w-4"}),e.jsx(p,{children:"Revisar y actualizar las políticas de seguridad basadas en los patrones más frecuentes"})]})]})})]})]})})]})]})]})}export{Me as default};
