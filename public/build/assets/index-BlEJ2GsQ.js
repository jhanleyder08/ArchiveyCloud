import{r as N,j as e,H as W,b as r}from"./app-DmFTQNHU.js";import{f as J,C as Q,B as Z}from"./app-sidebar-layout-B4-tSBlc.js";import{B as l}from"./button-B9uqYTIR.js";import{C as t,c,a as u,b as j,d as ee}from"./card-98qlzFSI.js";import{I as v}from"./input-CXpCTHGE.js";import{S as b,a as _,b as y,c as C,d as n}from"./select-CTcGm3Mb.js";import{B as se,F as ae}from"./Combination-DB4vhy5A.js";import{T as ie,a as re,b as E,c as x,d as le,e as m}from"./table-EXaSuLM9.js";import{T as te,a as ce,b as w,c as T}from"./tabs-Ds3NAHk9.js";import{R as de}from"./refresh-cw-BZG3D1r5.js";import{T as ne}from"./users-CA6jkooN.js";import{S as A}from"./search-BECONtiU.js";import{T as S,S as p}from"./triangle-alert-Qv0vinvY.js";import{U as k}from"./user-2vHAz8tr.js";import{G as R}from"./globe-v0gySOvB.js";import{F as oe}from"./filter-DEn4yiOV.js";import{E as xe}from"./eye-CevU9AUM.js";import{R as z,T as F}from"./CategoricalChart-C2o74iCS.js";import{P as me,a as he}from"./PieChart-DLZrzfgb.js";import{C as ue}from"./tooltipContext-CQNjzPwR.js";import{B as je,a as pe}from"./BarChart-CvMJuLax.js";import{C as L,X as V,Y as M}from"./CartesianChart-CtwGr6lg.js";import{L as ge}from"./LineChart-CjHbXm2v.js";import{L as fe}from"./Line-07DmD2QW.js";import{M as Ne}from"./monitor-B1yeSlgk.js";/* empty css            */import"./index-6lxVY5DU.js";import"./index-D6-3VAHV.js";import"./index-BBDU3XkM.js";import"./x-D4OXCe6m.js";import"./app-logo-icon-B1r3bsQj.js";import"./label-CYYsus1F.js";import"./mail-i7usF0Qz.js";import"./folder-CyqBlkrb.js";import"./BrandingProvider-BKZadETt.js";import"./index-_200N-9v.js";import"./check-kl6Xjmwn.js";import"./ActivePoints-C0ZIXN34.js";function ts({eventos:a,estadisticas:d,usuarios:P,acciones:U,filtros:i,resultados:ve,modulos:be}){const[g,q]=N.useState(!1),[f,D]=N.useState(!1),H=s=>{switch(s){case"bloqueado":return"destructive";case"fallido":return"destructive";case"exitoso":return"secondary";default:return"outline"}},K=s=>{switch(s){case"bloqueado":return e.jsx(S,{className:"h-4 w-4 text-red-500"});case"fallido":return e.jsx(S,{className:"h-4 w-4 text-orange-500"});case"exitoso":return e.jsx(p,{className:"h-4 w-4 text-green-500"});default:return e.jsx(p,{className:"h-4 w-4 text-gray-500"})}},$=s=>{const O={autenticacion:k,gestion_usuarios:k,gestion_documentos:ae,gestion_expedientes:Z,seguridad:p,sistema:Ne,general:R}[s]||R;return e.jsx(O,{className:"h-4 w-4"})},h=(s,o)=>{r.get(route("admin.auditoria.index"),{...i,[s]:o==="all"?"":o,page:1},{preserveState:!0,preserveScroll:!0})},G=s=>{r.get(route("admin.auditoria.index"),{...i,buscar:s,page:1},{preserveState:!0,preserveScroll:!0})},B=()=>{D(!0),r.reload({only:["eventos","estadisticas"],onFinish:()=>D(!1)})};N.useEffect(()=>{let s;return g&&(s=setInterval(B,3e4)),()=>{s&&clearInterval(s)}},[g]);const I=d.distribucion_resultados?.map(s=>({name:s.resultado,value:s.total,color:s.resultado==="fallido"?"#dc2626":s.resultado==="bloqueado"?"#ea580c":"#16a34a"}))||[],X=d.actividad_por_dia?.slice(-7).map(s=>({fecha:new Date(s.fecha).toLocaleDateString("es-ES",{month:"short",day:"numeric"}),eventos:s.total}))||[],Y=d.acciones_mas_frecuentes?.map(s=>({accion:s.accion.replace("_"," "),total:s.total}))||[];return e.jsxs(J,{children:[e.jsx(W,{title:"Auditoría y Trazabilidad Avanzada"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Auditoría y Trazabilidad Avanzada"}),e.jsx("p",{className:"text-muted-foreground",children:"Monitoreo y análisis de actividad del sistema en tiempo real"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"autoRefresh",checked:g,onChange:s=>q(s.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"autoRefresh",className:"text-sm",children:"Auto-refresh"})]}),e.jsxs(l,{variant:"outline",size:"sm",onClick:B,type:"button",disabled:f,children:[e.jsx(de,{className:`h-4 w-4 mr-2 ${f?"animate-spin":""}`}),f?"Actualizando...":"Actualizar"]}),e.jsxs(l,{variant:"outline",onClick:()=>r.visit(route("admin.auditoria.analytics")),type:"button",children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Analytics"]}),e.jsxs(l,{onClick:()=>r.visit(route("admin.auditoria.patrones")),type:"button",children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Patrones"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsx(t,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(A,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Eventos"}),e.jsx("p",{className:"text-2xl font-bold",children:d.total_eventos.toLocaleString()})]})]})})}),e.jsx(t,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(S,{className:"h-8 w-8 text-red-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Eventos Críticos"}),e.jsx("p",{className:"text-2xl font-bold",children:d.eventos_criticos})]})]})})}),e.jsx(t,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(p,{className:"h-8 w-8 text-orange-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Alto Riesgo"}),e.jsx("p",{className:"text-2xl font-bold",children:d.eventos_alto_riesgo})]})]})})}),e.jsx(t,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(k,{className:"h-8 w-8 text-green-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Usuarios Únicos"}),e.jsx("p",{className:"text-2xl font-bold",children:d.usuarios_unicos})]})]})})}),e.jsx(t,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(R,{className:"h-8 w-8 text-purple-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"IPs Únicas"}),e.jsx("p",{className:"text-2xl font-bold",children:d.ips_unicas})]})]})})})]}),e.jsxs(te,{defaultValue:"eventos",className:"space-y-4",children:[e.jsxs(ce,{children:[e.jsx(w,{value:"eventos",children:"Eventos"}),e.jsx(w,{value:"estadisticas",children:"Estadísticas"}),e.jsx(w,{value:"tendencias",children:"Tendencias"})]}),e.jsxs(T,{value:"eventos",className:"space-y-4",children:[e.jsxs(t,{children:[e.jsx(u,{children:e.jsxs(j,{className:"flex items-center",children:[e.jsx(oe,{className:"h-5 w-5 mr-2"}),"Filtros de Auditoría"]})}),e.jsx(c,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 xl:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Búsqueda"}),e.jsxs("div",{className:"relative",children:[e.jsx(A,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(v,{placeholder:"Buscar eventos...",defaultValue:i.buscar,className:"pl-9",onChange:s=>{clearTimeout(window.searchTimeout),window.searchTimeout=setTimeout(()=>{G(s.target.value)},500)}})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Usuario"}),e.jsxs(b,{value:i.usuario_id||"all",onValueChange:s=>h("usuario_id",s),children:[e.jsx(_,{children:e.jsx(y,{placeholder:"Todos los usuarios"})}),e.jsxs(C,{children:[e.jsx(n,{value:"all",children:"Todos los usuarios"}),P.map(s=>e.jsx(n,{value:s.id.toString(),children:s.name},s.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Acción"}),e.jsxs(b,{value:i.accion||"all",onValueChange:s=>h("accion",s),children:[e.jsx(_,{children:e.jsx(y,{placeholder:"Todas las acciones"})}),e.jsxs(C,{children:[e.jsx(n,{value:"all",children:"Todas las acciones"}),U.map(s=>e.jsx(n,{value:s,children:s.replace("_"," ")},s))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Resultado"}),e.jsxs(b,{value:i.resultado||"all",onValueChange:s=>h("resultado",s),children:[e.jsx(_,{children:e.jsx(y,{placeholder:"Todos los resultados"})}),e.jsxs(C,{children:[e.jsx(n,{value:"all",children:"Todos los resultados"}),e.jsx(n,{value:"exitoso",children:"Exitoso"}),e.jsx(n,{value:"fallido",children:"Fallido"}),e.jsx(n,{value:"bloqueado",children:"Bloqueado"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Fecha Inicio"}),e.jsx(v,{type:"date",value:i.fecha_inicio||"",onChange:s=>h("fecha_inicio",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Fecha Fin"}),e.jsx(v,{type:"date",value:i.fecha_fin||"",onChange:s=>h("fecha_fin",s.target.value)})]})]})})]}),e.jsxs(t,{children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-4",children:[e.jsxs("div",{children:[e.jsxs(j,{children:["Eventos de Auditoría (",a.total||0,")"]}),e.jsxs(ee,{children:["Mostrando ",a.from||0," a ",a.to||0," de ",a.total||0," eventos"]})]}),(a.last_page||0)>1&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>a.current_page>1&&r.get(route("admin.auditoria.index"),{...i,page:a.current_page-1}),disabled:a.current_page<=1,children:"← Anterior"}),e.jsxs("span",{className:"text-sm text-muted-foreground px-2",children:["Página ",a.current_page," de ",a.last_page]}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>a.current_page<a.last_page&&r.get(route("admin.auditoria.index"),{...i,page:a.current_page+1}),disabled:a.current_page>=a.last_page,children:"Siguiente →"})]})]}),e.jsxs(c,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ie,{children:[e.jsx(re,{children:e.jsxs(E,{children:[e.jsx(x,{children:"Riesgo"}),e.jsx(x,{children:"Fecha/Hora"}),e.jsx(x,{children:"Usuario"}),e.jsx(x,{children:"Acción"}),e.jsx(x,{children:"Descripción"}),e.jsx(x,{children:"IP / Ubicación"}),e.jsx(x,{children:"Acciones"})]})}),e.jsx(le,{children:a.data.map(s=>e.jsxs(E,{children:[e.jsx(m,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[K(s.resultado),e.jsx(se,{variant:H(s.resultado),children:s.resultado})]})}),e.jsx(m,{children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{children:new Date(s.fecha_hora).toLocaleDateString()}),e.jsx("div",{className:"text-gray-500",children:new Date(s.fecha_hora).toLocaleTimeString()})]})}),e.jsx(m,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.usuario?.name||"Sistema"}),e.jsx("div",{className:"text-sm text-gray-500",children:s.usuario?.email})]})}),e.jsx(m,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[$(s.modulo||"general"),e.jsx("span",{className:"font-medium",children:s.accion.replace("_"," ")})]})}),e.jsx(m,{children:e.jsx("div",{className:"max-w-xs truncate",title:s.descripcion,children:s.descripcion})}),e.jsx(m,{children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-mono",children:s.ip_address}),e.jsx("div",{className:"text-gray-500",children:s.pais||"N/A"}),e.jsxs("div",{className:"text-xs text-gray-400",children:[s.dispositivo||"N/A"," • ",s.navegador||"N/A"]})]})}),e.jsx(m,{children:e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>r.visit(route("admin.auditoria.show",s.id)),type:"button",children:[e.jsx(xe,{className:"h-4 w-4 mr-1"}),"Ver"]})})]},s.id))})]})}),a.data.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(A,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No hay eventos"}),e.jsx("p",{className:"text-gray-600",children:Object.keys(i).length>0?"No se encontraron eventos con los filtros aplicados":"No hay eventos de auditoría registrados"})]}),(a.last_page||0)>1&&e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-4 pt-4 border-t",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>a.current_page>1&&r.get(route("admin.auditoria.index"),{...i,page:a.current_page-1}),disabled:a.current_page<=1,children:"← Anterior"}),e.jsxs("div",{className:"flex items-center gap-1",children:[a.current_page>2&&e.jsxs(e.Fragment,{children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>r.get(route("admin.auditoria.index"),{...i,page:1}),children:"1"}),a.current_page>3&&e.jsx("span",{className:"px-1 text-muted-foreground",children:"..."})]}),a.current_page>1&&e.jsx(l,{variant:"outline",size:"sm",onClick:()=>r.get(route("admin.auditoria.index"),{...i,page:a.current_page-1}),children:a.current_page-1}),e.jsx(l,{variant:"default",size:"sm",children:a.current_page}),a.current_page<a.last_page&&e.jsx(l,{variant:"outline",size:"sm",onClick:()=>r.get(route("admin.auditoria.index"),{...i,page:a.current_page+1}),children:a.current_page+1}),a.current_page<a.last_page-1&&e.jsxs(e.Fragment,{children:[a.current_page<a.last_page-2&&e.jsx("span",{className:"px-1 text-muted-foreground",children:"..."}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>r.get(route("admin.auditoria.index"),{...i,page:a.last_page}),children:a.last_page})]})]}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>a.current_page<a.last_page&&r.get(route("admin.auditoria.index"),{...i,page:a.current_page+1}),disabled:a.current_page>=a.last_page,children:"Siguiente →"})]})]})]})]}),e.jsx(T,{value:"estadisticas",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(t,{children:[e.jsx(u,{children:e.jsx(j,{children:"Distribución por Nivel de Riesgo"})}),e.jsx(c,{children:e.jsx(z,{width:"100%",height:300,children:e.jsxs(me,{children:[e.jsx(he,{data:I,cx:"50%",cy:"50%",labelLine:!1,label:({name:s,percent:o})=>`${s} ${(o*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:I.map((s,o)=>e.jsx(ue,{fill:s.color},`cell-${o}`))}),e.jsx(F,{})]})})})]}),e.jsxs(t,{children:[e.jsx(u,{children:e.jsx(j,{children:"Acciones Más Frecuentes"})}),e.jsx(c,{children:e.jsx(z,{width:"100%",height:300,children:e.jsxs(je,{data:Y,children:[e.jsx(L,{strokeDasharray:"3 3"}),e.jsx(V,{dataKey:"accion"}),e.jsx(M,{}),e.jsx(F,{}),e.jsx(pe,{dataKey:"total",fill:"#3b82f6"})]})})})]})]})}),e.jsx(T,{value:"tendencias",className:"space-y-4",children:e.jsxs(t,{children:[e.jsx(u,{children:e.jsx(j,{children:"Actividad por Día (Últimos 7 días)"})}),e.jsx(c,{children:e.jsx(z,{width:"100%",height:300,children:e.jsxs(ge,{data:X,children:[e.jsx(L,{strokeDasharray:"3 3"}),e.jsx(V,{dataKey:"fecha"}),e.jsx(M,{}),e.jsx(F,{}),e.jsx(fe,{type:"monotone",dataKey:"eventos",stroke:"#8884d8",strokeWidth:2})]})})})]})})]})]})]})}export{ts as default};
