import{r as N,u as se,j as e,H as ie,b as R}from"./app-DOeYTPnE.js";import{A as re}from"./app-layout-CKT_ksyH.js";import{c as ae,B as o}from"./button-BB3j1qH9.js";import{C as b,a as _,b as y,d as w,c as C}from"./card-BEZSel9K.js";import{I as F}from"./index-C7D1JV-H.js";import{L as n}from"./label-BvABT9uR.js";import{T as ce,U as E,D as te,a as le,b as ne,c as oe,d as de,g as me}from"./app-sidebar-layout-83PL_wom.js";import{S as q,a as k,b as D,c as T,d as m}from"./select-D2zOlv3c.js";import{C as S}from"./checkbox-D0kI3b_r.js";import{B as h}from"./badge-BDHWk-Qv.js";import{A as xe,a as ue}from"./alert-Dl-auDCw.js";import{T as he,a as je,b as V,c as j,d as pe,e as p}from"./table-TW3yL78Z.js";import{A as ge}from"./arrow-left-Cvz8oF6O.js";import{F as O,S as fe}from"./index-Cl_hWV--.js";import{U as A,C as ve}from"./user-BiSWd6pJ.js";import{T as Ne}from"./trash-2-COYRgziV.js";import{C as be}from"./circle-alert-Diz-FkUP.js";import{S as _e}from"./save-DHvE8w7l.js";import{P as ye}from"./plus-Dfkec5yu.js";/* empty css            */import"./index-B5i9qy2Y.js";import"./index-BuQaqXjb.js";import"./x-BHxLkKP3.js";import"./index-sj4qH-fg.js";import"./app-logo-icon-BTiqVlKS.js";import"./triangle-alert-B7e9hRq_.js";import"./index-pqvegj4w.js";import"./check-C4IDWgVr.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],Fe=ae("UserPlus",Ce);function ss({documentos:L,usuarios:M}){const[t,g]=N.useState([]),[$,f]=N.useState(!1),[v,U]=N.useState(""),[x,Y]=N.useState(null),{data:a,setData:c,post:G,processing:z,errors:u,reset:Se}=se({documento_id:"",titulo:"",descripcion:"",tipo_flujo:"secuencial",prioridad:"normal",fecha_limite:"",requiere_todos:!1,configuracion:{permitir_comentarios:!0,notificar_cambios:!0,recordatorio_dias:3},firmantes:[]}),B=M.filter(s=>s.name.toLowerCase().includes(v.toLowerCase())||s.email.toLowerCase().includes(v.toLowerCase())||s.cargo&&s.cargo.toLowerCase().includes(v.toLowerCase())),I=s=>{if(t.some(l=>l.usuario_id===s.id))return;const r={usuario_id:s.id,orden:t.length+1,requerido:!0,usuario:s},i=[...t,r];g(i),c("firmantes",i.map(l=>({usuario_id:l.usuario_id,orden:l.orden,requerido:l.requerido}))),f(!1),U("")},J=s=>{const r=t.filter(i=>i.usuario_id!==s).map((i,l)=>({...i,orden:l+1}));g(r),c("firmantes",r.map(i=>({usuario_id:i.usuario_id,orden:i.orden,requerido:i.requerido})))},H=(s,r)=>{if(r<1||r>t.length)return;const i=[...t],l=i.findIndex(d=>d.usuario_id===s),Z=i[l];i.splice(l,1),i.splice(r-1,0,Z);const P=i.map((d,ee)=>({...d,orden:ee+1}));g(P),c("firmantes",P.map(d=>({usuario_id:d.usuario_id,orden:d.orden,requerido:d.requerido})))},K=s=>{const r=t.map(i=>i.usuario_id===s?{...i,requerido:!i.requerido}:i);g(r),c("firmantes",r.map(i=>({usuario_id:i.usuario_id,orden:i.orden,requerido:i.requerido})))},Q=s=>{const r=L.find(i=>i.id===parseInt(s));Y(r||null),c("documento_id",s),!a.titulo&&r&&c("titulo",`Solicitud de firma: ${r.nombre}`)},W=s=>{if(s.preventDefault(),t.length===0){alert("Debe agregar al menos un firmante");return}G(route("admin.firmas.solicitudes.store"),{onSuccess:()=>{},onError:r=>{console.error("Errores de validación:",r)}})},X=new Date().toISOString().split("T")[0];return e.jsxs(re,{children:[e.jsx(ie,{title:"Crear Solicitud de Firma"}),e.jsx("div",{className:"py-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"flex items-center space-x-3 mb-2",children:e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>R.get(route("admin.firmas.solicitudes")),children:[e.jsx(ge,{className:"w-4 h-4 mr-2"}),"Volver"]})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Nueva Solicitud de Firma Digital"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Configura un flujo de firma digital para múltiples usuarios"})]}),e.jsxs("form",{onSubmit:W,className:"space-y-6",children:[e.jsxs(b,{children:[e.jsxs(_,{children:[e.jsxs(y,{className:"flex items-center",children:[e.jsx(O,{className:"w-5 h-5 mr-2"}),"Información de la Solicitud"]}),e.jsx(w,{children:"Datos básicos de la solicitud de firma"})]}),e.jsxs(C,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"documento_id",children:"Documento a Firmar *"}),e.jsxs(q,{value:a.documento_id,onValueChange:Q,children:[e.jsx(k,{children:e.jsx(D,{placeholder:"Selecciona un documento"})}),e.jsx(T,{children:L.map(s=>e.jsx(m,{value:s.id.toString(),children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.nombre}),e.jsxs("div",{className:"text-xs text-gray-500",children:[s.tipo_documento,s.expediente&&e.jsxs("span",{children:[" • Exp: ",s.expediente.numero_expediente]})]})]})},s.id))})]}),u.documento_id&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:u.documento_id})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"prioridad",children:"Prioridad"}),e.jsxs(q,{value:a.prioridad,onValueChange:s=>c("prioridad",s),children:[e.jsx(k,{children:e.jsx(D,{})}),e.jsxs(T,{children:[e.jsx(m,{value:"baja",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{className:"bg-gray-500 text-white",children:"Baja"}),e.jsx("span",{children:"Sin urgencia"})]})}),e.jsx(m,{value:"normal",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{className:"bg-blue-500 text-white",children:"Normal"}),e.jsx("span",{children:"Prioridad estándar"})]})}),e.jsx(m,{value:"alta",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{className:"bg-orange-500 text-white",children:"Alta"}),e.jsx("span",{children:"Requiere atención"})]})}),e.jsx(m,{value:"urgente",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{className:"bg-red-500 text-white",children:"Urgente"}),e.jsx("span",{children:"Crítica"})]})})]})]})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"titulo",children:"Título de la Solicitud *"}),e.jsx(F,{id:"titulo",value:a.titulo,onChange:s=>c("titulo",s.target.value),placeholder:"Ej: Solicitud de firma para contrato de servicios",required:!0}),u.titulo&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:u.titulo})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"descripcion",children:"Descripción"}),e.jsx(ce,{id:"descripcion",value:a.descripcion,onChange:s=>c("descripcion",s.target.value),placeholder:"Descripción detallada de lo que se necesita firmar y el propósito...",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"tipo_flujo",children:"Tipo de Flujo"}),e.jsxs(q,{value:a.tipo_flujo,onValueChange:s=>c("tipo_flujo",s),children:[e.jsx(k,{children:e.jsx(D,{})}),e.jsxs(T,{children:[e.jsx(m,{value:"secuencial",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Secuencial"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Firma en orden específico"})]})}),e.jsx(m,{value:"paralelo",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Paralelo"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Cualquier orden"})]})})]})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"fecha_limite",children:"Fecha Límite"}),e.jsx(F,{id:"fecha_limite",type:"date",min:X,value:a.fecha_limite,onChange:s=>c("fecha_limite",s.target.value)})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(S,{id:"requiere_todos",checked:a.requiere_todos,onCheckedChange:s=>c("requiere_todos",s)}),e.jsx(n,{htmlFor:"requiere_todos",className:"text-sm",children:"Requiere que todos los firmantes obligatorios firmen"})]})]})]}),x&&e.jsxs(b,{children:[e.jsx(_,{children:e.jsx(y,{children:"Documento Seleccionado"})}),e.jsx(C,{children:e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(O,{className:"w-5 h-5 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-blue-900",children:x.nombre}),e.jsxs("p",{className:"text-sm text-blue-700 mt-1",children:["Tipo: ",x.tipo_documento]}),x.expediente&&e.jsxs("p",{className:"text-sm text-blue-700",children:["Expediente: ",x.expediente.numero_expediente," - ",x.expediente.titulo]})]})]})})})]}),e.jsxs(b,{children:[e.jsxs(_,{children:[e.jsxs(y,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(E,{className:"w-5 h-5 mr-2"}),"Firmantes (",t.length,")"]}),e.jsxs(o,{type:"button",variant:"outline",size:"sm",onClick:()=>f(!0),children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),"Agregar Firmante"]})]}),e.jsx(w,{children:a.tipo_flujo==="secuencial"?"Los firmantes deben firmar en el orden especificado":"Los firmantes pueden firmar en cualquier orden"})]}),e.jsxs(C,{children:[t.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(E,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No se han agregado firmantes"}),e.jsx("p",{className:"text-sm",children:'Haz clic en "Agregar Firmante" para comenzar'})]}):e.jsx("div",{className:"space-y-4",children:e.jsxs(he,{children:[e.jsx(je,{children:e.jsxs(V,{children:[a.tipo_flujo==="secuencial"&&e.jsx(j,{children:"Orden"}),e.jsx(j,{children:"Firmante"}),e.jsx(j,{children:"Cargo"}),e.jsx(j,{children:"Requerido"}),e.jsx(j,{children:"Acciones"})]})}),e.jsx(pe,{children:t.sort((s,r)=>s.orden-r.orden).map(s=>e.jsxs(V,{children:[a.tipo_flujo==="secuencial"&&e.jsx(p,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-sm font-medium",children:["#",s.orden]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx(o,{type:"button",variant:"outline",size:"sm",className:"h-6 w-6 p-0",onClick:()=>H(s.usuario_id,s.orden-1),disabled:s.orden===1,children:"↑"}),e.jsx(o,{type:"button",variant:"outline",size:"sm",className:"h-6 w-6 p-0",onClick:()=>H(s.usuario_id,s.orden+1),disabled:s.orden===t.length,children:"↓"})]})]})}),e.jsx(p,{children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(A,{className:"w-4 h-4 text-gray-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.usuario?.name}),e.jsx("div",{className:"text-sm text-gray-500",children:s.usuario?.email})]})]})}),e.jsx(p,{children:e.jsx("span",{className:"text-sm text-gray-600",children:s.usuario?.cargo||"No especificado"})}),e.jsx(p,{children:e.jsx(S,{checked:s.requerido,onCheckedChange:()=>K(s.usuario_id)})}),e.jsx(p,{children:e.jsx(o,{type:"button",variant:"destructive",size:"sm",onClick:()=>J(s.usuario_id),children:e.jsx(Ne,{className:"w-4 h-4"})})})]},s.usuario_id))})]})}),u.firmantes&&e.jsxs(xe,{className:"mt-4",children:[e.jsx(be,{className:"h-4 w-4"}),e.jsx(ue,{className:"text-red-600",children:u.firmantes})]})]})]}),e.jsxs(b,{children:[e.jsxs(_,{children:[e.jsx(y,{children:"Configuración Avanzada"}),e.jsx(w,{children:"Opciones adicionales para la solicitud"})]}),e.jsx(C,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(S,{id:"permitir_comentarios",checked:a.configuracion.permitir_comentarios,onCheckedChange:s=>c("configuracion",{...a.configuracion,permitir_comentarios:s})}),e.jsx(n,{htmlFor:"permitir_comentarios",className:"text-sm",children:"Permitir comentarios"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(S,{id:"notificar_cambios",checked:a.configuracion.notificar_cambios,onCheckedChange:s=>c("configuracion",{...a.configuracion,notificar_cambios:s})}),e.jsx(n,{htmlFor:"notificar_cambios",className:"text-sm",children:"Notificar cambios por email"})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"recordatorio_dias",className:"text-sm",children:"Recordatorio (días)"}),e.jsx(F,{id:"recordatorio_dias",type:"number",min:"1",max:"30",value:a.configuracion.recordatorio_dias,onChange:s=>c("configuracion",{...a.configuracion,recordatorio_dias:parseInt(s.target.value)||3}),className:"mt-1"})]})]})})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-4",children:[e.jsx(o,{type:"button",variant:"outline",onClick:()=>R.get(route("admin.firmas.solicitudes")),children:"Cancelar"}),e.jsx(o,{type:"submit",disabled:z||t.length===0,children:z?e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"w-4 h-4 mr-2 animate-spin"}),"Creando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Crear Solicitud"]})})]})]})]})}),e.jsx(te,{open:$,onOpenChange:f,children:e.jsxs(le,{className:"max-w-2xl",children:[e.jsxs(ne,{children:[e.jsx(oe,{children:"Seleccionar Firmantes"}),e.jsx(de,{children:"Busca y selecciona los usuarios que deben firmar el documento"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(fe,{className:"w-4 h-4 absolute left-3 top-3 text-gray-400"}),e.jsx(F,{placeholder:"Buscar por nombre, email o cargo...",value:v,onChange:s=>U(s.target.value),className:"pl-10"})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto",children:B.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(A,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No se encontraron usuarios"})]}):e.jsx("div",{className:"space-y-2",children:B.map(s=>{const r=t.some(i=>i.usuario_id===s.id);return e.jsxs("div",{className:`flex items-center justify-between p-3 border rounded-lg ${r?"bg-gray-50 border-gray-200":"hover:bg-gray-50 cursor-pointer"}`,onClick:()=>!r&&I(s),children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(A,{className:"w-5 h-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-sm text-gray-500",children:s.email}),s.cargo&&e.jsx("div",{className:"text-xs text-gray-400",children:s.cargo})]})]}),r?e.jsx(h,{variant:"secondary",children:"Ya agregado"}):e.jsx(o,{size:"sm",onClick:()=>I(s),children:e.jsx(ye,{className:"w-4 h-4"})})]},s.id)})})})]}),e.jsx(me,{children:e.jsx(o,{variant:"outline",onClick:()=>f(!1),children:"Cerrar"})})]})})]})}export{ss as default};
