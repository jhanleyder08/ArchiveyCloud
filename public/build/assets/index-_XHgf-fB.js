import{r as m,u as Y,b as D,j as e,H as Z,L as U}from"./app-D_nhLBVs.js";import{A as ee}from"./app-layout-BBCk8sLf.js";import{C as x,a as h,b as u,c as j}from"./card-B0XBXBK_.js";import{B as L}from"./badge-CUC0ivSm.js";import{B as n}from"./button-5PO8E2Gr.js";import{I as M}from"./input-C2DVpLXz.js";import{L as p}from"./label-pwez-fjR.js";import{x as k,D as se,f as ae,a as te,b as re,c as le,d as ce,T as ie,e as ne,t as N}from"./app-sidebar-layout-Ch1OLC1D.js";import{S as b,a as v,b as y,c as _,d as o}from"./select-CTAVPAs1.js";import{P as oe}from"./plus-CZubTfOl.js";import{S as de}from"./save-dTP6nM3L.js";import{U as G}from"./user-yM4TaNEp.js";import{C as me}from"./circle-alert-X_P8kcFn.js";import{T as xe}from"./users-ChWb6yQC.js";import{F as he}from"./Combination-BBrg-2vl.js";import{F as ue}from"./folder-open-BLnAFqup.js";import{E as je}from"./eye-xEYv2O5o.js";import{S as pe}from"./square-pen-B5nyQAIH.js";import{C as ge}from"./copy-TW2SIKRB.js";/* empty css            */import"./index-Cs15bWbc.js";import"./index-BhyfJTRb.js";import"./index-DRZUzGnC.js";import"./x-DhhaTQBb.js";import"./index-DBT7swVZ.js";import"./app-logo-icon-6Gcvl5L8.js";import"./triangle-alert-LpuN_XKs.js";import"./folder-Dj6_UGEO.js";import"./search-CR_HWK70.js";import"./index-BkxHgMIv.js";import"./check-CcswVI2x.js";const fe=t=>({borrador:"bg-gray-100 text-gray-800",revision:"bg-yellow-100 text-yellow-800",activa:"bg-green-100 text-green-800",archivada:"bg-blue-100 text-blue-800",obsoleta:"bg-red-100 text-red-800"})[t]||"bg-gray-100 text-gray-800",z=t=>({memorando:"",oficio:"",resolucion:"锔",acta:"",informe:"",circular:"",comunicacion:"",otro:""})[t]||"";function We({plantillas:t,estadisticas:g,series:B,filtros:P,categorias:F,estados:I}){const O={total:0,activas:0,borradores:0,publicas:0,por_categoria:{},mas_usadas:[]},d=g&&typeof g=="object"?{...O,...g}:O,[C,V]=m.useState(P),[f,q]=m.useState(P.buscar||""),[R,E]=m.useState(!1),[T,S]=m.useState(null),A=m.useRef(!0),{data:c,setData:i,post:K,processing:$,errors:r,reset:H}=Y({nombre:"",descripcion:"",categoria:"otro",tipo_documento:"",serie_documental_id:"",subserie_documental_id:"",contenido_html:"",es_publica:!1});m.useEffect(()=>{if(A.current){A.current=!1;return}if(f===(P.buscar||""))return;const s=setTimeout(()=>{w("buscar",f)},500);return()=>clearTimeout(s)},[f]);const w=(s,a)=>{const l={...C};l[s]=a,(!a||a==="all")&&delete l[s],V(l),D.get("/admin/plantillas",l,{preserveState:!0,preserveScroll:!0})},J=()=>{V({}),q(""),D.get("/admin/plantillas")},Q=s=>{D.post(`/admin/plantillas/${s}/duplicar`,{},{onSuccess:()=>{}})},W=s=>{const a=B.find(l=>l.id.toString()===s);S(a||null),i("serie_documental_id",s),i("subserie_documental_id","")};return e.jsxs(ee,{children:[e.jsx(Z,{title:"Plantillas Documentales"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(k,{className:"h-6 w-6 text-[#2a3d83]"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Plantillas Documentales"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Gesti贸n y creaci贸n de plantillas para documentos estandarizados"})]})]}),e.jsxs(se,{open:R,onOpenChange:E,children:[e.jsx(ae,{asChild:!0,children:e.jsxs(n,{className:"bg-[#2a3d83] hover:bg-[#1e2b5f] flex items-center gap-2",children:[e.jsx(oe,{className:"h-4 w-4"}),"Nueva Plantilla"]})}),e.jsxs(te,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(re,{children:[e.jsx(le,{className:"text-xl font-semibold text-gray-900",children:"Crear Nueva Plantilla Documental"}),e.jsx(ce,{className:"text-sm text-gray-600",children:"Complete los siguientes datos para crear una nueva plantilla."})]}),e.jsxs("form",{onSubmit:s=>{if(s.preventDefault(),!c.nombre||!c.categoria){N.error("Por favor complete los campos requeridos");return}K("/admin/plantillas",{onStart:()=>{},onProgress:()=>{},onSuccess:()=>{E(!1),H(),S(null),N.success("Plantilla creada exitosamente")},onError:a=>{a?typeof a=="object"?Object.keys(a).forEach(l=>{const X=Array.isArray(a[l])?a[l][0]:a[l];N.error(`Error en ${l}: ${X}`)}):N.error(`Error: ${a}`):N.error("Error al crear la plantilla. Por favor, verifique su conexi贸n e intente nuevamente.")},onFinish:()=>{},preserveState:!1,preserveScroll:!1,only:[]})},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"create-nombre",children:"Nombre de la Plantilla *"}),e.jsx(M,{id:"create-nombre",value:c.nombre,onChange:s=>i("nombre",s.target.value),placeholder:"Ej: Memorando Interno",required:!0,className:r.nombre?"border-red-500":""}),r.nombre&&e.jsx("p",{className:"text-sm text-red-600",children:r.nombre})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"create-categoria",children:"Categor铆a *"}),e.jsxs(b,{value:c.categoria,onValueChange:s=>i("categoria",s),children:[e.jsx(v,{className:r.categoria?"border-red-500":"",children:e.jsx(y,{placeholder:"Seleccionar categor铆a"})}),e.jsx(_,{children:Object.entries(F).map(([s,a])=>e.jsxs(o,{value:s,children:[z(s)," ",a]},s))})]}),r.categoria&&e.jsx("p",{className:"text-sm text-red-600",children:r.categoria})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"create-tipo-documento",children:"Tipo de Documento"}),e.jsx(M,{id:"create-tipo-documento",value:c.tipo_documento,onChange:s=>i("tipo_documento",s.target.value),placeholder:"Ej: Memorando interno",className:r.tipo_documento?"border-red-500":""}),r.tipo_documento&&e.jsx("p",{className:"text-sm text-red-600",children:r.tipo_documento})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"create-descripcion",children:"Descripci贸n"}),e.jsx(ie,{id:"create-descripcion",value:c.descripcion,onChange:s=>i("descripcion",s.target.value),placeholder:"Descripci贸n de la plantilla",rows:3,className:r.descripcion?"border-red-500":""}),r.descripcion&&e.jsx("p",{className:"text-sm text-red-600",children:r.descripcion})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Serie Documental"}),e.jsxs(b,{onValueChange:W,value:c.serie_documental_id||"",children:[e.jsx(v,{children:e.jsx(y,{placeholder:"Seleccionar serie"})}),e.jsx(_,{children:B.map(s=>e.jsxs(o,{value:s.id.toString(),children:[s.codigo," - ",s.nombre]},s.id))})]})]}),T?.subseries&&T.subseries.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Subserie Documental"}),e.jsxs(b,{value:c.subserie_documental_id||"",onValueChange:s=>i("subserie_documental_id",s),children:[e.jsx(v,{children:e.jsx(y,{placeholder:"Seleccionar subserie"})}),e.jsx(_,{children:T.subseries.map(s=>e.jsxs(o,{value:s.id.toString(),children:[s.codigo," - ",s.nombre]},s.id))})]})]})]}),(c.serie_documental_id||c.subserie_documental_id)&&e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(n,{type:"button",variant:"ghost",size:"sm",onClick:()=>{i("serie_documental_id",null),i("subserie_documental_id",null),S(null)},className:"text-xs",children:"Limpiar selecci贸n"})}),e.jsxs(ne,{children:[e.jsx(n,{type:"button",variant:"outline",onClick:()=>{E(!1),H(),S(null)},children:"Cancelar"}),e.jsxs(n,{type:"submit",disabled:$,className:"bg-[#2a3d83] hover:bg-[#1e2b5f] flex items-center gap-2",children:[e.jsx(de,{className:"h-4 w-4"}),$?"Guardando...":"Crear Plantilla"]})]})]})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(x,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Total Plantillas"}),e.jsx(k,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(j,{children:[e.jsx("div",{className:"text-2xl font-bold",children:d.total}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[d.activas," activas"]})]})]}),e.jsxs(x,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Plantillas P煤blicas"}),e.jsx(G,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(j,{children:[e.jsx("div",{className:"text-2xl font-bold",children:d.publicas}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Disponibles para todos"})]})]}),e.jsxs(x,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"En Desarrollo"}),e.jsx(me,{className:"h-4 w-4 text-yellow-600"})]}),e.jsxs(j,{children:[e.jsx("div",{className:"text-2xl font-bold",children:d.borradores}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Borradores pendientes"})]})]}),e.jsxs(x,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"M谩s Usada"}),e.jsx(xe,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(j,{children:[e.jsx("div",{className:"text-2xl font-bold",children:d.mas_usadas[0]?.documentos_generados_count||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:d.mas_usadas[0]?.nombre||"Sin uso"})]})]})]}),e.jsxs(x,{children:[e.jsx(h,{children:e.jsx(u,{children:"Filtros"})}),e.jsx(j,{children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(M,{placeholder:"Buscar por nombre, c贸digo o descripci贸n...",value:f,onChange:s=>q(s.target.value),onKeyPress:s=>{s.key==="Enter"&&(s.preventDefault(),w("buscar",f))}})}),e.jsxs(b,{value:C.categoria||"all",onValueChange:s=>w("categoria",s),children:[e.jsx(v,{className:"w-48",children:e.jsx(y,{placeholder:"Categor铆a"})}),e.jsxs(_,{children:[e.jsx(o,{value:"all",children:"Todas las categor铆as"}),Object.entries(F).map(([s,a])=>e.jsxs(o,{value:s,children:[z(s)," ",a]},s))]})]}),e.jsxs(b,{value:C.estado||"all",onValueChange:s=>w("estado",s),children:[e.jsx(v,{className:"w-48",children:e.jsx(y,{placeholder:"Estado"})}),e.jsxs(_,{children:[e.jsx(o,{value:"all",children:"Todos los estados"}),Object.entries(I).map(([s,a])=>e.jsx(o,{value:s,children:a},s))]})]}),Object.keys(C).length>0&&e.jsx(n,{variant:"outline",onClick:J,children:"Limpiar"})]})})]}),e.jsxs(x,{children:[e.jsx(h,{children:e.jsx(u,{children:"Lista de Plantillas"})}),e.jsx(j,{children:t.data.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(he,{className:"mx-auto h-12 w-12 text-muted-foreground"}),e.jsx("h3",{className:"mt-2 text-sm font-semibold text-gray-900",children:"No hay plantillas"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"No se encontraron plantillas documentales."})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left py-3 px-4",children:"Plantilla"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Categor铆a"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Estado"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Serie"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Creador"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Versi贸n"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Fecha"}),e.jsx("th",{className:"text-right py-3 px-4",children:"Acciones"})]})}),e.jsx("tbody",{children:t.data.map(s=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:s.nombre}),s.es_publica&&e.jsx(L,{variant:"secondary",className:"text-xs",children:"P煤blica"})]}),e.jsx("div",{className:"text-sm text-gray-500",children:s.codigo}),s.descripcion&&e.jsx("div",{className:"text-sm text-gray-400 max-w-xs truncate",children:s.descripcion})]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:z(s.categoria)}),e.jsx("span",{className:"capitalize",children:F[s.categoria]})]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx(L,{className:fe(s.estado),children:I[s.estado]})}),e.jsx("td",{className:"py-3 px-4",children:s.serie_documental?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ue,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm",children:s.serie_documental.codigo})]}):e.jsx("span",{className:"text-gray-400 text-sm",children:"Sin serie"})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(G,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm",children:s.usuario_creador.name})]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs(L,{variant:"outline",children:["v",s.version]})}),e.jsx("td",{className:"py-3 px-4 text-sm text-gray-500",children:new Date(s.created_at).toLocaleDateString("es-ES")}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(U,{href:`/admin/plantillas/${s.id}`,children:e.jsx(n,{variant:"outline",size:"sm",children:e.jsx(je,{className:"h-4 w-4"})})}),e.jsx(U,{href:`/admin/plantillas/${s.id}/edit`,children:e.jsx(n,{variant:"outline",size:"sm",children:e.jsx(pe,{className:"h-4 w-4"})})}),e.jsx(n,{variant:"outline",size:"sm",onClick:()=>Q(s.id),children:e.jsx(ge,{className:"h-4 w-4"})})]})})]},s.id))})]})})})]}),t.links&&t.links.length>3&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Mostrando ",t?.meta?.from||0," a ",t?.meta?.to||0," de ",t?.meta?.total||0," resultados"]}),e.jsx("div",{className:"flex gap-2",children:t.links.map((s,a)=>e.jsx(n,{variant:s.active?"default":"outline",size:"sm",disabled:!s.url,onClick:()=>s.url&&D.get(s.url),dangerouslySetInnerHTML:{__html:s.label}},a))})]})]})]})}export{We as default};
