import{e as ee,r as f,t as i,u as z,j as e,H as se,L as G,b as I}from"./app-oNxfBRLg.js";import{A as ae}from"./app-layout-W8X124Ob.js";import{C as o,a as l,b as d,c as x,d as T}from"./card-5vWCNqf9.js";import{B as m}from"./Combination-BdUefnHI.js";import{B as r}from"./button-CK9ZK9IT.js";import{T as re,a as ie,b as N,c as y}from"./tabs-Bsw2nPHv.js";import{I as L}from"./input-BWl1lGsq.js";import{L as v}from"./label-DpUIWM1C.js";import{S as te,a as ce,b as ne,c as oe,d as p}from"./select-B5_eSPQ4.js";import{A as le,D as w,a as C,b as _,c as D,d as E,T as F,g as H,S as de}from"./app-sidebar-layout-prEClG2f.js";import{E as O}from"./eye-FG3_tLCw.js";import{C as B}from"./copy-CdD3DJ_B.js";import{P as xe}from"./play-6kF_C_NU.js";import{S as me}from"./square-pen-BicqG7iV.js";import{U as he}from"./user-8eyzErWJ.js";import{D as S}from"./users-Ccr-Nlma.js";/* empty css            */import"./index-Ba-H6ma3.js";import"./index-C8M5vqBQ.js";import"./index-CoFjjCqG.js";import"./index-pInFw5Lg.js";import"./check-CcUTePir.js";import"./x-iE_t9Cph.js";import"./app-logo-icon-BRcKCqh7.js";import"./mail-D0yVgJcQ.js";import"./folder-B5rwVk21.js";import"./triangle-alert-DUb_Rlxa.js";import"./search-sPxt0Cs4.js";import"./BrandingProvider-1py7QB7p.js";const $=s=>({borrador:"bg-gray-100 text-gray-800",revision:"bg-yellow-100 text-yellow-800",activa:"bg-green-100 text-green-800",archivada:"bg-blue-100 text-blue-800",obsoleta:"bg-red-100 text-red-800"})[s]||"bg-gray-100 text-gray-800",U=s=>({memorando:"",oficio:"",resolucion:"锔",acta:"",informe:"",circular:"",comunicacion:"",otro:""})[s]||"";function Be({plantilla:s,documentos_generados:g,estadisticas_uso:P,puede_editar:A}){const{flash:u}=ee().props,[M,k]=f.useState(!1),[R,q]=f.useState(!1),[J,b]=f.useState(!1);f.useEffect(()=>{u?.success&&i.success(u.success),u?.error&&i.error(u.error)},[u]);const h=z({estado:s.estado,observaciones:s.observaciones||""}),c=z({nombre_documento:"",expediente_id:"",variables:{}}),X=()=>{I.post(`/admin/plantillas/${s.id}/duplicar`,{},{onSuccess:()=>{i.success("Plantilla duplicada exitosamente")},onError:a=>{i.error("Error al duplicar plantilla")}})},K=()=>{I.post(`/admin/plantillas/${s.id}/version`,{},{onSuccess:()=>{i.success("Nueva versi贸n creada exitosamente")},onError:a=>{i.error("Error al crear nueva versi贸n")}})},V=(a="json")=>{window.location.href=`/admin/plantillas/${s.id}/exportar/${a}`},Q=()=>{b(!0)},W=a=>{a.preventDefault();const n={};s.campos_variables&&s.campos_variables.forEach(t=>{const j=document.getElementById(`variable-${t.nombre}`);j&&(n[t.nombre]=j.value||t.valor_defecto||"")}),c.setData("variables",n),c.post(`/admin/plantillas/${s.id}/generar`,{onSuccess:()=>{b(!1),c.reset(),i.success("Documento generado exitosamente")},onError:t=>{console.error("Errores al generar documento:",t),t?Object.keys(t).forEach(j=>{const Z=Array.isArray(t[j])?t[j][0]:t[j];i.error(`Error en ${j}: ${Z}`)}):i.error("Error al generar documento")}})},Y=a=>{a.preventDefault(),h.patch(`/admin/plantillas/${s.id}/estado`,{onSuccess:()=>{q(!1),i.success("Estado actualizado exitosamente")},onError:n=>{i.error("Error al cambiar estado")}})};return e.jsxs(ae,{children:[e.jsx(se,{title:`Plantilla: ${s.nombre}`}),e.jsxs("div",{className:"py-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(G,{href:"/admin/plantillas",className:"text-gray-500 hover:text-gray-700",children:e.jsx(le,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:s.nombre}),e.jsx(m,{className:$(s.estado),children:s.estado.toUpperCase()}),s.es_publica&&e.jsx(m,{variant:"secondary",children:"P煤blica"})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600 mt-1",children:[e.jsx("span",{children:s.codigo}),e.jsxs("span",{children:["v",s.version]}),e.jsxs("span",{children:[U(s.categoria)," ",s.categoria]})]})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(r,{variant:"outline",onClick:()=>k(!0),children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Vista Previa"]}),e.jsxs(r,{variant:"outline",onClick:X,children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Duplicar"]}),e.jsxs(r,{onClick:Q,children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Generar Documento"]}),e.jsx(w,{open:J,onOpenChange:b,children:e.jsxs(C,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(_,{children:[e.jsx(D,{children:"Generar Documento desde Plantilla"}),e.jsx(E,{children:"Completa los datos para generar un nuevo documento"})]}),e.jsxs("form",{onSubmit:W,className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"nombre_documento",children:"Nombre del Documento *"}),e.jsx(L,{id:"nombre_documento",value:c.data.nombre_documento,onChange:a=>c.setData("nombre_documento",a.target.value),placeholder:"Ej: Memorando Interno 001",required:!0}),c.errors.nombre_documento&&e.jsx("p",{className:"text-sm text-red-600",children:c.errors.nombre_documento})]}),s.campos_variables&&s.campos_variables.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(v,{children:"Variables de la Plantilla"}),s.campos_variables.map((a,n)=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs(v,{htmlFor:`variable-${a.nombre}`,children:[a.etiqueta,a.requerido&&e.jsx("span",{className:"text-red-500",children:" *"})]}),a.tipo==="texto"||a.tipo==="text"?e.jsx(L,{id:`variable-${a.nombre}`,defaultValue:a.valor_defecto||"",placeholder:a.etiqueta,required:a.requerido}):a.tipo==="textarea"||a.tipo==="texto_largo"?e.jsx(F,{id:`variable-${a.nombre}`,defaultValue:a.valor_defecto||"",placeholder:a.etiqueta,rows:4,required:a.requerido}):e.jsx(L,{id:`variable-${a.nombre}`,type:a.tipo==="numero"?"number":"text",defaultValue:a.valor_defecto||"",placeholder:a.etiqueta,required:a.requerido})]},n))]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(r,{type:"button",variant:"outline",onClick:()=>b(!1),children:"Cancelar"}),e.jsx(r,{type:"submit",disabled:c.processing,children:c.processing?"Generando...":"Generar Documento"})]})]})]})}),A&&e.jsx(r,{asChild:!0,children:e.jsxs(G,{href:`/admin/plantillas/${s.id}/edit`,children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Editar"]})})]})]}),e.jsx("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs(re,{defaultValue:"informacion",className:"w-full",children:[e.jsxs(ie,{className:"grid w-full grid-cols-4",children:[e.jsx(N,{value:"informacion",children:"Informaci贸n"}),e.jsx(N,{value:"contenido",children:"Contenido"}),e.jsx(N,{value:"variables",children:"Variables"}),e.jsx(N,{value:"documentos",children:"Documentos"})]}),e.jsxs(y,{value:"informacion",className:"space-y-4",children:[e.jsxs(o,{children:[e.jsx(l,{children:e.jsx(d,{children:"Detalles de la Plantilla"})}),e.jsxs(x,{className:"space-y-4",children:[s.descripcion&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Descripci贸n"}),e.jsx("p",{className:"text-gray-900",children:s.descripcion})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Categor铆a"}),e.jsxs("p",{className:"text-gray-900 flex items-center space-x-1",children:[e.jsx("span",{children:U(s.categoria)}),e.jsx("span",{className:"capitalize",children:s.categoria})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Estado"}),e.jsx("div",{className:"mt-1",children:e.jsx(m,{className:$(s.estado),children:s.estado.toUpperCase()})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Visibilidad"}),e.jsx("p",{className:"text-gray-900",children:s.es_publica?"P煤blica":"Privada"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Versi贸n"}),e.jsxs("p",{className:"text-gray-900",children:["v",s.version]})]})]}),s.serie_documental&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Serie Documental"}),e.jsxs("p",{className:"text-gray-900",children:[s.serie_documental.codigo," - ",s.serie_documental.nombre]}),s.subserie_documental&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Subserie: ",s.subserie_documental.codigo," - ",s.subserie_documental.nombre]})]}),s.tags&&s.tags.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Tags"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:s.tags.map((a,n)=>e.jsx(m,{variant:"outline",children:a},n))})]}),s.observaciones&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Observaciones"}),e.jsx("p",{className:"text-gray-900",children:s.observaciones})]})]})]}),s.versiones&&s.versiones.length>1&&e.jsxs(o,{children:[e.jsx(l,{children:e.jsx(d,{children:"Historial de Versiones"})}),e.jsx(x,{children:e.jsx("div",{className:"space-y-2",children:s.versiones.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(m,{variant:"outline",children:["v",a.version]}),e.jsx(m,{className:$(a.estado),children:a.estado})]}),e.jsx("span",{className:"text-sm text-gray-500",children:new Date(a.created_at).toLocaleDateString("es-ES")})]},a.id))})})]})]}),e.jsx(y,{value:"contenido",children:e.jsxs(o,{children:[e.jsxs(l,{children:[e.jsx(d,{children:"Contenido HTML"}),e.jsx(T,{children:"Contenido base de la plantilla"})]}),e.jsx(x,{children:s.contenido_html?e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:e.jsx("pre",{className:"whitespace-pre-wrap text-sm",children:s.contenido_html})}):e.jsx("p",{className:"text-gray-500 italic",children:"Sin contenido definido"})})]})}),e.jsx(y,{value:"variables",children:e.jsxs(o,{children:[e.jsxs(l,{children:[e.jsx(d,{children:"Variables Configuradas"}),e.jsx(T,{children:"Campos que se pueden personalizar al generar documentos"})]}),e.jsx(x,{children:s.campos_variables&&s.campos_variables.length>0?e.jsx("div",{className:"space-y-3",children:s.campos_variables.map((a,n)=>e.jsxs("div",{className:"border rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium",children:a.etiqueta}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(m,{variant:"outline",children:a.tipo}),a.requerido&&e.jsx(m,{variant:"secondary",children:"Requerido"})]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Variable:"})," ",a.nombre]}),a.valor_defecto&&e.jsxs("p",{children:[e.jsx("strong",{children:"Valor por defecto:"})," ",a.valor_defecto]})]})]},n))}):e.jsx("p",{className:"text-gray-500 italic",children:"No hay variables configuradas"})})]})}),e.jsx(y,{value:"documentos",children:e.jsxs(o,{children:[e.jsxs(l,{children:[e.jsx(d,{children:"Documentos Generados"}),e.jsx(T,{children:"Documentos creados usando esta plantilla"})]}),e.jsx(x,{children:g.length>0?e.jsx("div",{className:"space-y-3",children:g.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:a.nombre}),e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsxs("p",{children:["Creado por: ",a.usuario_creador.name]}),e.jsxs("p",{children:["Fecha: ",new Date(a.created_at).toLocaleDateString("es-ES")]}),a.expediente&&e.jsxs("p",{children:["Expediente: ",a.expediente.codigo]})]})]}),e.jsx(r,{variant:"outline",size:"sm",children:e.jsx(O,{className:"w-4 h-4"})})]},a.id))}):e.jsx("p",{className:"text-gray-500 italic",children:"No se han generado documentos con esta plantilla"})})]})})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(o,{children:[e.jsx(l,{children:e.jsx(d,{className:"text-sm",children:"Estad铆sticas de Uso"})}),e.jsxs(x,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Documentos generados"}),e.jsx("span",{className:"font-semibold",children:P.documentos_generados})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"ltimo mes"}),e.jsx("span",{className:"font-semibold",children:P.documentos_ultimo_mes})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Usuarios que la usan"}),e.jsx("span",{className:"font-semibold",children:P.usuarios_utilizan})]})]})]}),e.jsxs(o,{children:[e.jsx(l,{children:e.jsx(d,{className:"text-sm",children:"Informaci贸n del Autor"})}),e.jsxs(x,{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(he,{className:"w-4 h-4 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:s.usuario_creador.name}),e.jsx("p",{className:"text-xs text-gray-500",children:s.usuario_creador.email})]})]}),e.jsxs("div",{className:"mt-3 text-xs text-gray-500",children:[e.jsxs("p",{children:["Creada: ",new Date(s.created_at).toLocaleDateString("es-ES")]}),e.jsxs("p",{children:["Actualizada: ",new Date(s.updated_at).toLocaleDateString("es-ES")]})]})]})]}),A&&e.jsxs(o,{children:[e.jsx(l,{children:e.jsx(d,{className:"text-sm",children:"Acciones R谩pidas"})}),e.jsxs(x,{className:"space-y-2",children:[e.jsxs(w,{open:R,onOpenChange:q,children:[e.jsx(H,{asChild:!0,children:e.jsxs(r,{variant:"outline",size:"sm",className:"w-full justify-start",children:[e.jsx(de,{className:"w-4 h-4 mr-2"}),"Cambiar Estado"]})}),e.jsxs(C,{children:[e.jsxs(_,{children:[e.jsx(D,{children:"Cambiar Estado de la Plantilla"}),e.jsx(E,{children:"Selecciona el nuevo estado para esta plantilla"})]}),e.jsxs("form",{onSubmit:Y,className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"estado",children:"Estado"}),e.jsxs(te,{value:h.data.estado,onValueChange:a=>h.setData("estado",a),children:[e.jsx(ce,{children:e.jsx(ne,{placeholder:"Seleccionar estado"})}),e.jsxs(oe,{children:[e.jsx(p,{value:"borrador",children:"Borrador"}),e.jsx(p,{value:"revision",children:"En Revisi贸n"}),e.jsx(p,{value:"activa",children:"Activa"}),e.jsx(p,{value:"archivada",children:"Archivada"}),e.jsx(p,{value:"obsoleta",children:"Obsoleta"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"observaciones",children:"Observaciones (opcional)"}),e.jsx(F,{id:"observaciones",value:h.data.observaciones,onChange:a=>h.setData("observaciones",a.target.value),placeholder:"Agregar observaciones sobre el cambio de estado...",rows:3})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(r,{type:"button",variant:"outline",onClick:()=>q(!1),children:"Cancelar"}),e.jsx(r,{type:"submit",disabled:h.processing,children:h.processing?"Guardando...":"Guardar Cambios"})]})]})]})]}),e.jsxs(r,{variant:"outline",size:"sm",className:"w-full justify-start",onClick:K,children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Nueva Versi贸n"]}),e.jsxs(w,{children:[e.jsx(H,{asChild:!0,children:e.jsxs(r,{variant:"outline",size:"sm",className:"w-full justify-start",children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"Exportar"]})}),e.jsxs(C,{children:[e.jsxs(_,{children:[e.jsx(D,{children:"Exportar Plantilla"}),e.jsx(E,{children:"Selecciona el formato de exportaci贸n"})]}),e.jsxs("div",{className:"space-y-2 mt-4",children:[e.jsxs(r,{variant:"outline",className:"w-full justify-start",onClick:()=>V("json"),children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"Exportar como JSON"]}),e.jsxs(r,{variant:"outline",className:"w-full justify-start",onClick:()=>V("html"),children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"Exportar como HTML"]}),e.jsxs(r,{variant:"outline",className:"w-full justify-start",onClick:()=>V("xml"),children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"Exportar como XML"]})]})]})]})]})]})]})]})})]}),e.jsx(w,{open:M,onOpenChange:k,children:e.jsxs(C,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(_,{children:[e.jsxs(D,{children:["Vista Previa - ",s.nombre]}),e.jsx(E,{children:"Previsualizaci贸n del contenido de la plantilla"})]}),e.jsx("div",{className:"mt-4",children:s.contenido_html?e.jsx("div",{className:"prose max-w-none",dangerouslySetInnerHTML:{__html:s.contenido_html}}):e.jsx("p",{className:"text-gray-500 italic",children:"Sin contenido para previsualizar"})})]})})]})}export{Be as default};
