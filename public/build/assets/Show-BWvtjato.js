import{r as N,j as e,H as ee,b as w}from"./app-DOeYTPnE.js";import{A as se}from"./app-layout-CKT_ksyH.js";import{B as i}from"./button-BB3j1qH9.js";import{C as m,a as h,b as j,c as v,d as re}from"./card-BEZSel9K.js";import{B as E}from"./badge-BDHWk-Qv.js";import{f as ae,G as ie,F,D as T,a as _,b as z,c as V,d as $,T as I,g as M,t as c,C as le}from"./app-sidebar-layout-83PL_wom.js";import{I as S}from"./index-C7D1JV-H.js";import{L as t}from"./label-BvABT9uR.js";import{S as B,a as O,b as P,c as H,d as n,e as ne}from"./select-D2zOlv3c.js";import{A as ce}from"./arrow-left-Cvz8oF6O.js";import{C as L}from"./circle-check-big-BQYxJNiA.js";import{C as te}from"./circle-alert-Diz-FkUP.js";import{P as G}from"./plus-Dfkec5yu.js";import{S as oe}from"./square-pen-DB43i0-f.js";import{T as de}from"./trash-2-COYRgziV.js";import{F as A}from"./index-Cl_hWV--.js";import{F as q}from"./user-BiSWd6pJ.js";import{F as xe}from"./folder-open-BVhxUPMk.js";/* empty css            */import"./index-B5i9qy2Y.js";import"./index-BuQaqXjb.js";import"./x-BHxLkKP3.js";import"./index-sj4qH-fg.js";import"./app-logo-icon-BTiqVlKS.js";import"./triangle-alert-B7e9hRq_.js";import"./index-pqvegj4w.js";import"./check-C4IDWgVr.js";const R=({node:r,onEdit:b,onDelete:x,onAddChild:o})=>{const[f,g]=N.useState(!0),C=r.hijos&&r.hijos.length>0,u=d=>{switch(d){case"fondo":return e.jsx(xe,{className:"h-4 w-4 text-blue-600"});case"seccion":return e.jsx(q,{className:"h-4 w-4 text-green-600"});case"subseccion":return e.jsx(q,{className:"h-4 w-4 text-yellow-600"});case"serie":return e.jsx(A,{className:"h-4 w-4 text-purple-600"});case"subserie":return e.jsx(A,{className:"h-4 w-4 text-pink-600"});default:return e.jsx(A,{className:"h-4 w-4 text-gray-600"})}},y=d=>({fondo:"bg-blue-100 text-blue-800",seccion:"bg-green-100 text-green-800",subseccion:"bg-yellow-100 text-yellow-800",serie:"bg-purple-100 text-purple-800",subserie:"bg-pink-100 text-pink-800"})[d]||"bg-gray-100 text-gray-800";return e.jsxs("div",{className:"ml-4",children:[e.jsxs("div",{className:"flex items-center gap-2 py-2 group hover:bg-gray-50 rounded-md px-2",children:[e.jsx("button",{onClick:()=>g(!f),className:"p-0.5 hover:bg-gray-200 rounded",disabled:!C,children:C?f?e.jsx(ne,{className:"h-4 w-4"}):e.jsx(le,{className:"h-4 w-4"}):e.jsx("div",{className:"w-4 h-4"})}),u(r.tipo_nivel),e.jsxs("div",{className:"flex-1 flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-sm",children:r.nombre}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",r.codigo,")"]}),e.jsx(E,{variant:"outline",className:`text-xs ${y(r.tipo_nivel)}`,children:r.tipo_nivel}),!r.activo&&e.jsx(E,{variant:"outline",className:"text-xs bg-red-100 text-red-800",children:"Inactivo"})]}),e.jsxs("div",{className:"hidden group-hover:flex items-center gap-1",children:[e.jsx(i,{size:"sm",variant:"ghost",onClick:()=>o(r),className:"h-7 w-7 p-0",children:e.jsx(G,{className:"h-3 w-3"})}),e.jsx(i,{size:"sm",variant:"ghost",onClick:()=>b(r),className:"h-7 w-7 p-0",children:e.jsx(oe,{className:"h-3 w-3"})}),e.jsx(i,{size:"sm",variant:"ghost",onClick:()=>x(r),className:"h-7 w-7 p-0 hover:bg-red-100 hover:text-red-600",children:e.jsx(de,{className:"h-3 w-3"})})]})]}),f&&C&&e.jsx("div",{className:"border-l-2 border-gray-200 ml-2",children:r.hijos.map(d=>e.jsx(R,{node:d,onEdit:b,onDelete:x,onAddChild:o},d.id))})]})};function Oe({ccd:r,estructura:b,estadisticas:x,errores_validacion:o}){const[f,g]=N.useState(!1),[C,u]=N.useState(!1),[y,d]=N.useState(null),[D,J]=N.useState(null),[a,l]=N.useState({codigo:"",nombre:"",descripcion:"",tipo_nivel:"fondo",orden:0,activo:!0}),K=[{title:"Dashboard",href:"/admin"},{title:"CCD",href:"/admin/ccd"},{title:r.nombre,href:`/admin/ccd/${r.id}`}],Q=s=>({borrador:"bg-gray-100 text-gray-800",activo:"bg-green-100 text-green-800",inactivo:"bg-red-100 text-red-800",archivado:"bg-yellow-100 text-yellow-800"})[s]||"bg-gray-100 text-gray-800",k=(s=null)=>{d(s),l({codigo:"",nombre:"",descripcion:"",tipo_nivel:s?"seccion":"fondo",orden:0,activo:!0}),g(!0)},U=s=>{J(s),l({codigo:s.codigo,nombre:s.nombre,descripcion:s.descripcion||"",tipo_nivel:s.tipo_nivel,orden:s.orden,activo:s.activo}),u(!0)},W=s=>{if(s.hijos&&s.hijos.length>0){c.error("No se puede eliminar un nivel que tiene hijos");return}confirm(`¿Está seguro de eliminar el nivel "${s.nombre}"?`)&&w.delete(`/admin/ccd/nivel/${s.id}`,{onSuccess:()=>{c.success("Nivel eliminado exitosamente")},onError:()=>{c.error("Error al eliminar el nivel")}})},X=()=>{w.post(`/admin/ccd/${r.id}/nivel`,{...a,parent_id:y?.id||null},{onSuccess:()=>{g(!1),c.success("Nivel agregado exitosamente")},onError:s=>{const p=Object.values(s)[0];c.error(p||"Error al agregar nivel")}})},Y=()=>{D&&w.put(`/admin/ccd/nivel/${D.id}`,a,{onSuccess:()=>{u(!1),c.success("Nivel actualizado exitosamente")},onError:s=>{const p=Object.values(s)[0];c.error(p||"Error al actualizar nivel")}})},Z=()=>{if(o.length>0){c.error("No se puede aprobar: "+o.join(", "));return}w.post(`/admin/ccd/${r.id}/aprobar`,{},{onSuccess:()=>{c.success("CCD aprobado exitosamente")}})};return e.jsxs(se,{breadcrumbs:K,children:[e.jsx(ee,{title:`CCD - ${r.nombre}`}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(i,{variant:"outline",onClick:()=>w.visit("/admin/ccd"),children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Volver"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:r.nombre}),e.jsxs("p",{className:"text-sm text-gray-500",children:[r.codigo," • Versión ",r.version]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:Q(r.estado),children:r.estado}),r.vigente&&e.jsxs(E,{className:"bg-green-100 text-green-800",children:[e.jsx(L,{className:"h-3 w-3 mr-1"}),"Vigente"]})]})]}),o.length>0&&e.jsxs(m,{className:"border-red-200 bg-red-50",children:[e.jsx(h,{children:e.jsxs(j,{className:"text-red-800 flex items-center gap-2",children:[e.jsx(te,{className:"h-5 w-5"}),"Errores de Validación"]})}),e.jsx(v,{children:e.jsx("ul",{className:"list-disc list-inside space-y-1",children:o.map((s,p)=>e.jsx("li",{className:"text-sm text-red-700",children:s},p))})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(m,{children:[e.jsx(h,{className:"pb-2",children:e.jsx(j,{className:"text-sm font-medium text-gray-600",children:"Total Niveles"})}),e.jsx(v,{children:e.jsx("div",{className:"text-2xl font-bold text-[#2a3d83]",children:x.total_niveles})})]}),e.jsxs(m,{children:[e.jsx(h,{className:"pb-2",children:e.jsx(j,{className:"text-sm font-medium text-gray-600",children:"Niveles Activos"})}),e.jsx(v,{children:e.jsx("div",{className:"text-2xl font-bold text-green-600",children:x.niveles_activos})})]}),e.jsxs(m,{children:[e.jsx(h,{className:"pb-2",children:e.jsx(j,{className:"text-sm font-medium text-gray-600",children:"Profundidad Máxima"})}),e.jsx(v,{children:e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:x.profundidad_maxima})})]}),e.jsxs(m,{children:[e.jsx(h,{className:"pb-2",children:e.jsx(j,{className:"text-sm font-medium text-gray-600",children:"Vocabularios"})}),e.jsx(v,{children:e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:x.total_vocabularios})})]})]}),e.jsx(m,{children:e.jsx(h,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(j,{children:"Acciones"}),e.jsxs("div",{className:"flex items-center gap-2",children:[r.estado==="borrador"&&o.length===0&&e.jsxs(i,{onClick:Z,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Aprobar CCD"]}),e.jsxs(i,{variant:"outline",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Exportar"]}),e.jsxs(i,{variant:"outline",children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Nueva Versión"]})]})]})})}),e.jsxs(m,{children:[e.jsx(h,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(F,{className:"h-5 w-5"}),"Estructura Jerárquica"]}),e.jsx(re,{children:"Gestione la estructura del cuadro de clasificación documental"})]}),e.jsxs(i,{onClick:()=>k(null),className:"bg-[#2a3d83] hover:bg-[#1e2b5f]",children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Agregar Nivel Raíz"]})]})}),e.jsx(v,{children:b.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(F,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No hay niveles configurados aún"}),e.jsx("p",{className:"text-sm",children:"Comience agregando un nivel raíz (Fondo)"})]}):e.jsx("div",{className:"space-y-1",children:b.map(s=>e.jsx(R,{node:s,onEdit:U,onDelete:W,onAddChild:k},s.id))})})]}),e.jsx(T,{open:f,onOpenChange:g,children:e.jsxs(_,{children:[e.jsxs(z,{children:[e.jsx(V,{children:"Agregar Nuevo Nivel"}),e.jsx($,{children:y?`Agregar nivel hijo a: ${y.nombre}`:"Agregar nivel raíz al CCD"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Código*"}),e.jsx(S,{value:a.codigo,onChange:s=>l({...a,codigo:s.target.value}),placeholder:"Ej: FOND-01"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Tipo*"}),e.jsxs(B,{value:a.tipo_nivel,onValueChange:s=>l({...a,tipo_nivel:s}),children:[e.jsx(O,{children:e.jsx(P,{})}),e.jsxs(H,{children:[e.jsx(n,{value:"fondo",children:"Fondo"}),e.jsx(n,{value:"seccion",children:"Sección"}),e.jsx(n,{value:"subseccion",children:"Subsección"}),e.jsx(n,{value:"serie",children:"Serie"}),e.jsx(n,{value:"subserie",children:"Subserie"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Nombre*"}),e.jsx(S,{value:a.nombre,onChange:s=>l({...a,nombre:s.target.value}),placeholder:"Nombre del nivel"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Descripción"}),e.jsx(I,{value:a.descripcion,onChange:s=>l({...a,descripcion:s.target.value}),placeholder:"Descripción opcional",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Orden"}),e.jsx(S,{type:"number",value:a.orden,onChange:s=>l({...a,orden:parseInt(s.target.value)})})]})]}),e.jsxs(M,{children:[e.jsx(i,{variant:"outline",onClick:()=>g(!1),children:"Cancelar"}),e.jsx(i,{onClick:X,className:"bg-[#2a3d83] hover:bg-[#1e2b5f]",children:"Agregar Nivel"})]})]})}),e.jsx(T,{open:C,onOpenChange:u,children:e.jsxs(_,{children:[e.jsxs(z,{children:[e.jsx(V,{children:"Editar Nivel"}),e.jsxs($,{children:["Modificar información del nivel ",D?.nombre]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Código*"}),e.jsx(S,{value:a.codigo,onChange:s=>l({...a,codigo:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Tipo*"}),e.jsxs(B,{value:a.tipo_nivel,onValueChange:s=>l({...a,tipo_nivel:s}),children:[e.jsx(O,{children:e.jsx(P,{})}),e.jsxs(H,{children:[e.jsx(n,{value:"fondo",children:"Fondo"}),e.jsx(n,{value:"seccion",children:"Sección"}),e.jsx(n,{value:"subseccion",children:"Subsección"}),e.jsx(n,{value:"serie",children:"Serie"}),e.jsx(n,{value:"subserie",children:"Subserie"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Nombre*"}),e.jsx(S,{value:a.nombre,onChange:s=>l({...a,nombre:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Descripción"}),e.jsx(I,{value:a.descripcion,onChange:s=>l({...a,descripcion:s.target.value}),rows:3})]})]}),e.jsxs(M,{children:[e.jsx(i,{variant:"outline",onClick:()=>u(!1),children:"Cancelar"}),e.jsx(i,{onClick:Y,className:"bg-[#2a3d83] hover:bg-[#1e2b5f]",children:"Actualizar Nivel"})]})]})})]})]})}export{Oe as default};
