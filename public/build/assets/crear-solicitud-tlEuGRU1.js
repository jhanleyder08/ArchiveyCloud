import{r as N,u as ie,j as e,H as ae,b as H}from"./app-C5ckqBIp.js";import{A as re}from"./app-layout-DGpHzsZj.js";import{c as oe,B as d}from"./button-C_wizhg3.js";import{C as b,a as _,b as C,d as q,c as y}from"./card-C_VOERQk.js";import{I as F}from"./input-DjB33T14.js";import{L as n}from"./label-D9bm4s2r.js";import{A as le,T as te,D as ce,a as ne,b as de,c as me,d as xe,e as he}from"./app-sidebar-layout-B-YWzudl.js";import{S,a as w,b as k,c as D,d as c}from"./select-CBIPitLz.js";import{C as T}from"./checkbox-BHy_KTKH.js";import{B as g}from"./badge-DL-k3CvS.js";import{A as ue,a as je}from"./alert-DyllTe_s.js";import{T as pe,a as ge,b as P,c as u,d as ve,e as j}from"./table-JsbiOfei.js";import{F as V}from"./Combination-CIeNRLzY.js";import{U as O}from"./users-Bu6eepbM.js";import{U as A}from"./user-2UwuEIUF.js";import{T as fe}from"./trash-2-D0tOhHo9.js";import{C as Ne}from"./circle-alert-DQBS1bU3.js";import{C as be}from"./folder-9RT5E6CU.js";import{S as _e}from"./save-C6AcJQoX.js";import{S as Ce}from"./search-CVtN_EcY.js";import{P as ye}from"./plus-CLL6Vylk.js";/* empty css            */import"./index-D_U0JQiI.js";import"./index-C72nIoIT.js";import"./index-z-hyAKzV.js";import"./x-Cc5GKSP1.js";import"./app-logo-icon-EYLFXuBA.js";import"./mail-DhzsRTCw.js";import"./triangle-alert-c3kReHiM.js";import"./BrandingProvider-ZsHKNxl6.js";import"./index-C7J7UiSU.js";import"./check-R7RxhHJy.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],Se=oe("UserPlus",Fe);function ls({documentos:L,usuarios:M}){const[t,p]=N.useState([]),[$,v]=N.useState(!1),[f,U]=N.useState(""),[x,Y]=N.useState(null),{data:o,setData:l,post:G,processing:z,errors:h,reset:we}=ie({documento_id:"",titulo:"",descripcion:"",tipo_flujo:"secuencial",prioridad:"normal",fecha_limite:"",requiere_todos:!1,configuracion:{permitir_comentarios:!0,notificar_cambios:!0,recordatorio_dias:3},firmantes:[]}),B=M.filter(s=>s.name.toLowerCase().includes(f.toLowerCase())||s.email.toLowerCase().includes(f.toLowerCase())||s.cargo&&s.cargo.toLowerCase().includes(f.toLowerCase())),I=s=>{if(t.some(r=>r.usuario_id===s.id))return;const a={usuario_id:s.id,orden:t.length+1,es_obligatorio:!0,rol:"aprobador",usuario:s},i=[...t,a];p(i),l("firmantes",i.map(r=>({usuario_id:r.usuario_id,orden:r.orden,es_obligatorio:r.es_obligatorio,rol:r.rol}))),v(!1),U("")},J=s=>{const a=t.filter(i=>i.usuario_id!==s).map((i,r)=>({...i,orden:r+1}));p(a),l("firmantes",a.map(i=>({usuario_id:i.usuario_id,orden:i.orden,es_obligatorio:i.es_obligatorio,rol:i.rol})))},R=(s,a)=>{if(a<1||a>t.length)return;const i=[...t],r=i.findIndex(m=>m.usuario_id===s),ee=i[r];i.splice(r,1),i.splice(a-1,0,ee);const E=i.map((m,se)=>({...m,orden:se+1}));p(E),l("firmantes",E.map(m=>({usuario_id:m.usuario_id,orden:m.orden,es_obligatorio:m.es_obligatorio,rol:m.rol})))},K=s=>{const a=t.map(i=>i.usuario_id===s?{...i,es_obligatorio:!i.es_obligatorio}:i);p(a),l("firmantes",a.map(i=>({usuario_id:i.usuario_id,orden:i.orden,es_obligatorio:i.es_obligatorio,rol:i.rol})))},Q=(s,a)=>{const i=t.map(r=>r.usuario_id===s?{...r,rol:a}:r);p(i),l("firmantes",i.map(r=>({usuario_id:r.usuario_id,orden:r.orden,es_obligatorio:r.es_obligatorio,rol:r.rol})))},W=s=>{const a=L.find(i=>i.id===parseInt(s));Y(a||null),l("documento_id",s),!o.titulo&&a&&l("titulo",`Solicitud de firma: ${a.titulo}`)},X=s=>{if(s.preventDefault(),t.length===0){alert("Debe agregar al menos un firmante");return}G(route("admin.firmas.solicitudes.store"),{onSuccess:()=>{},onError:a=>{console.error("Errores de validación:",a)}})},Z=new Date(Date.now()+864e5).toISOString().split("T")[0];return e.jsxs(re,{children:[e.jsx(ae,{title:"Crear Solicitud de Firma"}),e.jsx("div",{className:"py-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"flex items-center space-x-3 mb-2",children:e.jsxs(d,{variant:"outline",size:"sm",onClick:()=>H.get(route("admin.firmas.solicitudes")),children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Volver"]})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Nueva Solicitud de Firma Digital"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Configura un flujo de firma digital para múltiples usuarios"})]}),e.jsxs("form",{onSubmit:X,className:"space-y-6",children:[e.jsxs(b,{children:[e.jsxs(_,{children:[e.jsxs(C,{className:"flex items-center",children:[e.jsx(V,{className:"w-5 h-5 mr-2"}),"Información de la Solicitud"]}),e.jsx(q,{children:"Datos básicos de la solicitud de firma"})]}),e.jsxs(y,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"documento_id",children:"Documento a Firmar *"}),e.jsxs(S,{value:o.documento_id,onValueChange:W,children:[e.jsx(w,{children:e.jsx(k,{placeholder:"Selecciona un documento"})}),e.jsx(D,{children:L.map(s=>e.jsx(c,{value:s.id.toString(),children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.titulo}),e.jsxs("div",{className:"text-xs text-gray-500",children:[s.tipo_documento||"Sin tipo",s.expediente&&e.jsxs("span",{children:[" • Exp: ",s.expediente.codigo]})]})]})},s.id))})]}),h.documento_id&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:h.documento_id})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"prioridad",children:"Prioridad"}),e.jsxs(S,{value:o.prioridad,onValueChange:s=>l("prioridad",s),children:[e.jsx(w,{children:e.jsx(k,{})}),e.jsxs(D,{children:[e.jsx(c,{value:"baja",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(g,{className:"bg-gray-500 text-white",children:"Baja"}),e.jsx("span",{children:"Sin urgencia"})]})}),e.jsx(c,{value:"normal",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(g,{className:"bg-blue-500 text-white",children:"Normal"}),e.jsx("span",{children:"Prioridad estándar"})]})}),e.jsx(c,{value:"alta",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(g,{className:"bg-orange-500 text-white",children:"Alta"}),e.jsx("span",{children:"Requiere atención"})]})}),e.jsx(c,{value:"urgente",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(g,{className:"bg-red-500 text-white",children:"Urgente"}),e.jsx("span",{children:"Crítica"})]})})]})]})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"titulo",children:"Título de la Solicitud *"}),e.jsx(F,{id:"titulo",value:o.titulo,onChange:s=>l("titulo",s.target.value),placeholder:"Ej: Solicitud de firma para contrato de servicios",required:!0}),h.titulo&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:h.titulo})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"descripcion",children:"Descripción"}),e.jsx(te,{id:"descripcion",value:o.descripcion,onChange:s=>l("descripcion",s.target.value),placeholder:"Descripción detallada de lo que se necesita firmar y el propósito...",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"tipo_flujo",children:"Tipo de Flujo"}),e.jsxs(S,{value:o.tipo_flujo,onValueChange:s=>l("tipo_flujo",s),children:[e.jsx(w,{children:e.jsx(k,{})}),e.jsxs(D,{children:[e.jsx(c,{value:"secuencial",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Secuencial"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Firma en orden específico"})]})}),e.jsx(c,{value:"paralelo",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Paralelo"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Cualquier orden"})]})})]})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"fecha_limite",children:"Fecha Límite"}),e.jsx(F,{id:"fecha_limite",type:"date",min:Z,value:o.fecha_limite,onChange:s=>l("fecha_limite",s.target.value)})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(T,{id:"requiere_todos",checked:o.requiere_todos,onCheckedChange:s=>l("requiere_todos",s)}),e.jsx(n,{htmlFor:"requiere_todos",className:"text-sm",children:"Requiere que todos los firmantes obligatorios firmen"})]})]})]}),x&&e.jsxs(b,{children:[e.jsx(_,{children:e.jsx(C,{children:"Documento Seleccionado"})}),e.jsx(y,{children:e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(V,{className:"w-5 h-5 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-blue-900",children:x.titulo}),e.jsxs("p",{className:"text-sm text-blue-700 mt-1",children:["Tipo: ",x.tipo_documento||"Sin tipo"]}),x.expediente&&e.jsxs("p",{className:"text-sm text-blue-700",children:["Expediente: ",x.expediente.codigo,x.expediente.titulo?` - ${x.expediente.titulo}`:""]})]})]})})})]}),e.jsxs(b,{children:[e.jsxs(_,{children:[e.jsxs(C,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(O,{className:"w-5 h-5 mr-2"}),"Firmantes (",t.length,")"]}),e.jsxs(d,{type:"button",variant:"outline",size:"sm",onClick:()=>v(!0),children:[e.jsx(Se,{className:"w-4 h-4 mr-2"}),"Agregar Firmante"]})]}),e.jsx(q,{children:o.tipo_flujo==="secuencial"?"Los firmantes deben firmar en el orden especificado":"Los firmantes pueden firmar en cualquier orden"})]}),e.jsxs(y,{children:[t.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(O,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No se han agregado firmantes"}),e.jsx("p",{className:"text-sm",children:'Haz clic en "Agregar Firmante" para comenzar'})]}):e.jsx("div",{className:"space-y-4",children:e.jsxs(pe,{children:[e.jsx(ge,{children:e.jsxs(P,{children:[o.tipo_flujo==="secuencial"&&e.jsx(u,{children:"Orden"}),e.jsx(u,{children:"Firmante"}),e.jsx(u,{children:"Cargo"}),e.jsx(u,{children:"Rol"}),e.jsx(u,{children:"Obligatorio"}),e.jsx(u,{children:"Acciones"})]})}),e.jsx(ve,{children:t.sort((s,a)=>s.orden-a.orden).map(s=>e.jsxs(P,{children:[o.tipo_flujo==="secuencial"&&e.jsx(j,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-sm font-medium",children:["#",s.orden]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx(d,{type:"button",variant:"outline",size:"sm",className:"h-6 w-6 p-0",onClick:()=>R(s.usuario_id,s.orden-1),disabled:s.orden===1,children:"↑"}),e.jsx(d,{type:"button",variant:"outline",size:"sm",className:"h-6 w-6 p-0",onClick:()=>R(s.usuario_id,s.orden+1),disabled:s.orden===t.length,children:"↓"})]})]})}),e.jsx(j,{children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(A,{className:"w-4 h-4 text-gray-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.usuario?.name}),e.jsx("div",{className:"text-sm text-gray-500",children:s.usuario?.email})]})]})}),e.jsx(j,{children:e.jsx("span",{className:"text-sm text-gray-600",children:s.usuario?.cargo||"No especificado"})}),e.jsx(j,{children:e.jsxs(S,{value:s.rol,onValueChange:a=>Q(s.usuario_id,a),children:[e.jsx(w,{className:"w-[140px]",children:e.jsx(k,{})}),e.jsxs(D,{children:[e.jsx(c,{value:"aprobador",children:"Aprobador"}),e.jsx(c,{value:"revisor",children:"Revisor"}),e.jsx(c,{value:"testigo",children:"Testigo"}),e.jsx(c,{value:"autoridad",children:"Autoridad"}),e.jsx(c,{value:"validador",children:"Validador"})]})]})}),e.jsx(j,{children:e.jsx(T,{checked:s.es_obligatorio,onCheckedChange:()=>K(s.usuario_id)})}),e.jsx(j,{children:e.jsx(d,{type:"button",variant:"destructive",size:"sm",onClick:()=>J(s.usuario_id),children:e.jsx(fe,{className:"w-4 h-4"})})})]},s.usuario_id))})]})}),h.firmantes&&e.jsxs(ue,{className:"mt-4",children:[e.jsx(Ne,{className:"h-4 w-4"}),e.jsx(je,{className:"text-red-600",children:h.firmantes})]})]})]}),e.jsxs(b,{children:[e.jsxs(_,{children:[e.jsx(C,{children:"Configuración Avanzada"}),e.jsx(q,{children:"Opciones adicionales para la solicitud"})]}),e.jsx(y,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(T,{id:"permitir_comentarios",checked:o.configuracion.permitir_comentarios,onCheckedChange:s=>l("configuracion",{...o.configuracion,permitir_comentarios:s})}),e.jsx(n,{htmlFor:"permitir_comentarios",className:"text-sm",children:"Permitir comentarios"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(T,{id:"notificar_cambios",checked:o.configuracion.notificar_cambios,onCheckedChange:s=>l("configuracion",{...o.configuracion,notificar_cambios:s})}),e.jsx(n,{htmlFor:"notificar_cambios",className:"text-sm",children:"Notificar cambios por email"})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"recordatorio_dias",className:"text-sm",children:"Recordatorio (días)"}),e.jsx(F,{id:"recordatorio_dias",type:"number",min:"1",max:"30",value:o.configuracion.recordatorio_dias,onChange:s=>l("configuracion",{...o.configuracion,recordatorio_dias:parseInt(s.target.value)||3}),className:"mt-1"})]})]})})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-4",children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>H.get(route("admin.firmas.solicitudes")),children:"Cancelar"}),e.jsx(d,{type:"submit",disabled:z||t.length===0,children:z?e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"w-4 h-4 mr-2 animate-spin"}),"Creando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Crear Solicitud"]})})]})]})]})}),e.jsx(ce,{open:$,onOpenChange:v,children:e.jsxs(ne,{className:"max-w-2xl",children:[e.jsxs(de,{children:[e.jsx(me,{children:"Seleccionar Firmantes"}),e.jsx(xe,{children:"Busca y selecciona los usuarios que deben firmar el documento"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ce,{className:"w-4 h-4 absolute left-3 top-3 text-gray-400"}),e.jsx(F,{placeholder:"Buscar por nombre, email o cargo...",value:f,onChange:s=>U(s.target.value),className:"pl-10"})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto",children:B.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(A,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No se encontraron usuarios"})]}):e.jsx("div",{className:"space-y-2",children:B.map(s=>{const a=t.some(i=>i.usuario_id===s.id);return e.jsxs("div",{className:`flex items-center justify-between p-3 border rounded-lg ${a?"bg-gray-50 border-gray-200":"hover:bg-gray-50 cursor-pointer"}`,onClick:()=>!a&&I(s),children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(A,{className:"w-5 h-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-sm text-gray-500",children:s.email}),s.cargo&&e.jsx("div",{className:"text-xs text-gray-400",children:s.cargo})]})]}),a?e.jsx(g,{variant:"secondary",children:"Ya agregado"}):e.jsx(d,{size:"sm",onClick:()=>I(s),children:e.jsx(ye,{className:"w-4 h-4"})})]},s.id)})})})]}),e.jsx(he,{children:e.jsx(d,{variant:"outline",onClick:()=>v(!1),children:"Cerrar"})})]})})]})}export{ls as default};
