import{r as C,u as B,U as w,j as e,H as $,L as h}from"./app-B_OG_Vza.js";import{A as z}from"./app-layout-DOCwYxKT.js";import{C as j,a as u,b as f,d as N,c as g}from"./card-cumjxZex.js";import{B as d}from"./button-BSbSEU_p.js";import{I as o}from"./input-Dh6-5mRd.js";import{L as l}from"./label-rVSvqjBQ.js";import{A as M,K as H,T as U}from"./app-sidebar-layout-fWJRkDcF.js";import{B as n}from"./badge-DeNNKN-1.js";import{C as q}from"./checkbox-HGtUqf2i.js";import{S as O}from"./switch-CanW81h0.js";import{A,a as E}from"./alert-D93R01ev.js";import{T as S,S as R}from"./triangle-alert-3stdfBS0.js";import{P as V}from"./plus-BlqFA-uA.js";import{N as G}from"./network-DP4O7wtU.js";import{M as K}from"./minus-BDdGgz4y.js";import{S as J}from"./save-DXs1jlgh.js";/* empty css            */import"./index-COOtV0Sn.js";import"./index-CmTcU35r.js";import"./Combination-C0EFkMHe.js";import"./index-CeYb-gwX.js";import"./x-Di-LOll0.js";import"./app-logo-icon-A0O4A2TN.js";import"./user-Bso3zvdg.js";import"./mail-DIqKJEVK.js";import"./users-B-Ei4AUw.js";import"./folder-B9vwnN7g.js";import"./search-CCssNLWg.js";import"./BrandingProvider-BDq7LIZa.js";import"./index-DIzNZfaR.js";import"./check-B3a6KT7v.js";function Se({token:a,usuarios:Q,permisos_disponibles:T}){const[m,v]=C.useState(""),[x,b]=C.useState(!1),{data:r,setData:t,put:I,processing:_,errors:i,reset:W,isDirty:y}=B({nombre:a.nombre||"",descripcion:a.descripcion||"",permisos:a.permisos||[],fecha_expiracion:a.fecha_expiracion?a.fecha_expiracion.split("T")[0]:"",limite_usos:a.limite_usos?a.limite_usos.toString():"",ips_permitidas:a.ips_permitidas||[],activo:a.activo});w.useEffect(()=>{b(y)},[y]);const D=s=>{s.preventDefault(),I(`/admin/api-tokens/${a.id}`,{onSuccess:()=>{b(!1)}})},k=(s,c)=>{c?t("permisos",[...r.permisos,s]):t("permisos",r.permisos.filter(p=>p!==s))},P=()=>{m&&!r.ips_permitidas.includes(m)&&(t("ips_permitidas",[...r.ips_permitidas,m]),v(""))},F=s=>{t("ips_permitidas",r.ips_permitidas.filter(c=>c!==s))},L=s=>{switch(s){case"activo":return e.jsx(n,{className:"bg-green-100 text-green-800",children:"Activo"});case"inactivo":return e.jsx(n,{variant:"secondary",children:"Inactivo"});case"expirado":return e.jsx(n,{className:"bg-red-100 text-red-800",children:"Expirado"});case"limite_alcanzado":return e.jsx(n,{className:"bg-orange-100 text-orange-800",children:"Límite alcanzado"});default:return e.jsx(n,{variant:"outline",children:s})}};return w.useEffect(()=>{const s=c=>{x&&(c.preventDefault(),c.returnValue="")};return window.addEventListener("beforeunload",s),()=>window.removeEventListener("beforeunload",s)},[x]),e.jsxs(z,{children:[e.jsx($,{title:`Editar ${a.nombre} - API Tokens - ArchiveyCloud`}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(h,{href:"/admin/api-tokens",children:e.jsxs(d,{variant:"outline",size:"sm",children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Volver a Tokens"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Editar Token API"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Modifica la configuración del token"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[L(a.estado),e.jsx(h,{href:`/admin/api-tokens/${a.id}`,children:e.jsx(d,{variant:"outline",children:"Ver Detalles"})})]})]}),x&&e.jsxs(A,{className:"border-orange-200 bg-orange-50",children:[e.jsx(S,{className:"h-4 w-4 text-orange-600"}),e.jsx(E,{className:"text-orange-800",children:"Tienes cambios sin guardar. Asegúrate de guardar antes de salir."})]}),e.jsxs("form",{onSubmit:D,className:"space-y-6",children:[e.jsxs(j,{children:[e.jsxs(u,{children:[e.jsxs(f,{className:"flex items-center",children:[e.jsx(H,{className:"h-5 w-5 mr-2"}),"Información del Token"]}),e.jsx(N,{children:"Configuración básica del token API"})]}),e.jsxs(g,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"nombre",children:"Nombre del Token *"}),e.jsx(o,{id:"nombre",value:r.nombre,onChange:s=>t("nombre",s.target.value),placeholder:"Ej: Sistema CRM, Aplicación Móvil",className:i.nombre?"border-red-500":""}),i.nombre&&e.jsx("p",{className:"text-sm text-red-600",children:i.nombre})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Propietario"}),e.jsx(o,{value:`${a.usuario.name} (${a.usuario.email})`,readOnly:!0,className:"bg-gray-50"}),e.jsx("p",{className:"text-xs text-gray-600",children:"El propietario no se puede cambiar"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"descripcion",children:"Descripción"}),e.jsx(U,{id:"descripcion",value:r.descripcion,onChange:s=>t("descripcion",s.target.value),placeholder:"Describe el propósito de este token...",rows:3,className:i.descripcion?"border-red-500":""}),i.descripcion&&e.jsx("p",{className:"text-sm text-red-600",children:i.descripcion})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-4 border-t",children:[e.jsx(O,{id:"activo",checked:r.activo,onCheckedChange:s=>t("activo",s)}),e.jsx(l,{htmlFor:"activo",className:"cursor-pointer",children:"Token activo"}),e.jsx("p",{className:"text-sm text-gray-600 ml-4",children:r.activo?"El token puede ser usado":"El token está deshabilitado"})]})]})]}),e.jsxs(j,{children:[e.jsxs(u,{children:[e.jsxs(f,{className:"flex items-center",children:[e.jsx(R,{className:"h-5 w-5 mr-2"}),"Permisos"]}),e.jsx(N,{children:"Selecciona los permisos que tendrá este token"})]}),e.jsxs(g,{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Object.entries(T).map(([s,c])=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{id:s,checked:r.permisos.includes(s),onCheckedChange:p=>k(s,p)}),e.jsxs(l,{htmlFor:s,className:"text-sm cursor-pointer",children:[e.jsx("span",{className:"font-medium",children:s}),e.jsx("span",{className:"block text-gray-600 text-xs",children:c})]})]},s))}),i.permisos&&e.jsxs(A,{className:"border-red-200 bg-red-50",children:[e.jsx(S,{className:"h-4 w-4 text-red-600"}),e.jsx(E,{className:"text-red-800",children:i.permisos})]})]})]}),e.jsxs(j,{children:[e.jsxs(u,{children:[e.jsx(f,{children:"Configuración Avanzada"}),e.jsx(N,{children:"Restricciones y límites del token"})]}),e.jsxs(g,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"fecha_expiracion",children:"Fecha de Expiración"}),e.jsx(o,{id:"fecha_expiracion",type:"date",value:r.fecha_expiracion,onChange:s=>t("fecha_expiracion",s.target.value),min:new Date().toISOString().split("T")[0],className:i.fecha_expiracion?"border-red-500":""}),e.jsx("p",{className:"text-xs text-gray-600",children:"Deja vacío para que no expire nunca"}),i.fecha_expiracion&&e.jsx("p",{className:"text-sm text-red-600",children:i.fecha_expiracion})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"limite_usos",children:"Límite de Usos"}),e.jsx(o,{id:"limite_usos",type:"number",value:r.limite_usos,onChange:s=>t("limite_usos",s.target.value),placeholder:"Ej: 1000",min:"1",className:i.limite_usos?"border-red-500":""}),e.jsxs("p",{className:"text-xs text-gray-600",children:["Usos actuales: ",a.usos_realizados,a.limite_usos&&` / ${a.limite_usos}`]}),i.limite_usos&&e.jsx("p",{className:"text-sm text-red-600",children:i.limite_usos})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"IPs Permitidas"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(o,{value:m,onChange:s=>v(s.target.value),placeholder:"192.168.1.100",className:"flex-1"}),e.jsx(d,{type:"button",onClick:P,variant:"outline",children:e.jsx(V,{className:"h-4 w-4"})})]}),r.ips_permitidas.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:r.ips_permitidas.map(s=>e.jsxs(n,{variant:"outline",className:"flex items-center space-x-1",children:[e.jsx(G,{className:"h-3 w-3"}),e.jsx("span",{children:s}),e.jsx("button",{type:"button",onClick:()=>F(s),className:"ml-1 hover:text-red-600",children:e.jsx(K,{className:"h-3 w-3"})})]},s))}),e.jsx("p",{className:"text-xs text-gray-600",children:"Deja vacío para permitir acceso desde cualquier IP"})]}),i.ips_permitidas&&e.jsx("p",{className:"text-sm text-red-600",children:i.ips_permitidas})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(h,{href:"/admin/api-tokens",children:e.jsx(d,{variant:"outline",type:"button",children:"Cancelar"})}),e.jsx(d,{type:"submit",disabled:_||!x,children:_?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Guardar Cambios"]})})]})]})]})]})}export{Se as default};
