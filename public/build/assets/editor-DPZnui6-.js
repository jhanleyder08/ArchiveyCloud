import{r as h,u as se,j as e,H as ae,L as re}from"./app-B0qTBAke.js";import{A as le,T as k,F as P,X as ie,p as T}from"./app-sidebar-layout-DFKjANJB.js";import{c as te,B as r}from"./app-logo-icon-BPz3oRny.js";import{C as o,d as c,a as u,b as p,c as L}from"./card-D4UBhCKF.js";import{L as g,I as N}from"./label-CjHZv5e4.js";import{S as z,a as A,b as M,c as q,d as D}from"./select-bkkBUc_4.js";import{B as ne}from"./badge-BfEjTxB-.js";import{A as _,a as y}from"./alert-D_YNC9Mv.js";import{S as oe}from"./switch-DM46ZHy3.js";import{A as ce}from"./arrow-left-DojSOgLu.js";import{C as de}from"./check-dE-FsShf.js";import{E as I}from"./eye-Ddf6P-1T.js";import{S as me}from"./save-QBoNNjtv.js";import{P as F}from"./plus-ElTEKlBd.js";import{S as xe}from"./square-pen-C9ZpGD6B.js";import{T as he}from"./trash-2-DsuLBN5D.js";import{U as je}from"./upload-CrgsxyHP.js";/* empty css            */import"./index-DDzTzhRc.js";import"./index-D-todNvr.js";import"./index-C5MwE6sO.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]],pe=te("Code",ue);function Be({plantilla:l,categorias:H,series:ve,tipos_campo:B,estadisticas_uso:j}){const[f,b]=h.useState("visual"),[w,G]=h.useState(""),[n,R]=h.useState(null),[ge,$]=h.useState(null),[i,m]=h.useState({nombre:"",marcador:"",tipo:"text",requerido:!0,valor_default:""}),{data:t,setData:d,post:O,put:U,processing:E,errors:v,reset:Ne}=se({nombre:l?.nombre||"",descripcion:l?.descripcion||"",categoria:l?.categoria||"",serie_documental_id:"",contenido_html:l?.contenido_html||"",campos_variables:l?.campos_variables||[],metadatos_predefinidos:l?.metadatos_predefinidos||{},configuracion_formato:l?.configuracion_formato||{},tags:l?.tags||[],es_publica:!1}),J=()=>{l?U(route("admin.plantillas.update",l.id)):O(route("admin.plantillas.store"))},S=async()=>{try{const a=await(await fetch(route("admin.plantillas.validar-estructura"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({contenido_html:t.contenido_html})})).json();R(a)}catch(s){console.error("Error al validar estructura:",s)}},X=()=>{let s=t.contenido_html;t.campos_variables.forEach(a=>{const x=K(a);s=s.replace(new RegExp(Q(a.marcador),"g"),x)}),G(s)},K=s=>{switch(s.tipo){case"date":return new Date().toLocaleDateString();case"number":return"123";case"email":return"ejemplo@correo.com";case"tel":return"+57 300 123 4567";default:return s.valor_default||`[${s.nombre}]`}},Q=s=>s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),W=()=>{if(!i.nombre)return;const s=i.marcador||`{${i.nombre}}`,a={...i,marcador:s};d("campos_variables",[...t.campos_variables,a]),m({nombre:"",marcador:"",tipo:"text",requerido:!0,valor_default:""})},Y=s=>{const a=t.campos_variables.filter((x,C)=>C!==s);d("campos_variables",a)},Z=s=>{const a=document.getElementById("contenido_html");if(a){const x=a.selectionStart,C=a.selectionEnd,V=t.contenido_html,ee=V.substring(0,x)+s+V.substring(C);d("contenido_html",ee),setTimeout(()=>{a.focus(),a.setSelectionRange(x+s.length,x+s.length)},0)}};return h.useEffect(()=>{t.contenido_html&&S()},[t.contenido_html]),e.jsxs(le,{children:[e.jsx(ae,{title:`Editor - ${l?.nombre||"Nueva Plantilla"}`}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(re,{href:route("admin.plantillas.index"),children:e.jsxs(r,{variant:"outline",size:"sm",children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Volver"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:l?`Editar: ${l.nombre}`:"Nueva Plantilla"}),e.jsx("p",{className:"text-muted-foreground",children:"Editor avanzado de plantillas documentales"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(r,{variant:"outline",onClick:S,children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Validar"]}),e.jsxs(r,{variant:"outline",onClick:X,children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Vista Previa"]}),e.jsxs(r,{onClick:J,disabled:E,children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),E?"Guardando...":"Guardar"]})]})]}),j&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(o,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:j.documentos_generados}),e.jsx("p",{className:"text-sm text-gray-600",children:"Documentos Generados"})]})})}),e.jsx(o,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:j.uso_ultimo_mes}),e.jsx("p",{className:"text-sm text-gray-600",children:"Uso Último Mes"})]})})}),e.jsx(o,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:j.usuarios_distintos}),e.jsx("p",{className:"text-sm text-gray-600",children:"Usuarios Únicos"})]})})}),e.jsx(o,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:j.promedio_uso_mensual}),e.jsx("p",{className:"text-sm text-gray-600",children:"Promedio Mensual"})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(o,{children:[e.jsx(u,{children:e.jsx(p,{children:"Información Básica"})}),e.jsxs(c,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"nombre",children:"Nombre de la Plantilla"}),e.jsx(N,{id:"nombre",value:t.nombre,onChange:s=>d("nombre",s.target.value),placeholder:"Ej: Memorando Interno"}),v.nombre&&e.jsx("p",{className:"text-sm text-red-600",children:v.nombre})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"categoria",children:"Categoría"}),e.jsxs(z,{value:t.categoria,onValueChange:s=>d("categoria",s),children:[e.jsx(A,{children:e.jsx(M,{placeholder:"Seleccionar categoría"})}),e.jsx(q,{children:H.map(s=>e.jsx(D,{value:s.value,children:s.label},s.value))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"descripcion",children:"Descripción"}),e.jsx(k,{id:"descripcion",value:t.descripcion,onChange:s=>d("descripcion",s.target.value),placeholder:"Describe el propósito y uso de esta plantilla...",rows:3})]})]})]}),e.jsxs(o,{children:[e.jsx(u,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(p,{children:"Contenido de la Plantilla"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(r,{variant:f==="visual"?"default":"outline",size:"sm",onClick:()=>b("visual"),children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Visual"]}),e.jsxs(r,{variant:f==="codigo"?"default":"outline",size:"sm",onClick:()=>b("codigo"),children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),"Código"]})]})]})}),e.jsxs(c,{children:[f==="codigo"?e.jsxs("div",{className:"space-y-4",children:[e.jsx(k,{id:"contenido_html",value:t.contenido_html,onChange:s=>d("contenido_html",s.target.value),placeholder:"Escribe el contenido HTML de tu plantilla aquí...",rows:20,className:"font-mono text-sm"}),v.contenido_html&&e.jsx("p",{className:"text-sm text-red-600",children:v.contenido_html})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs(_,{children:[e.jsx(P,{className:"h-4 w-4"}),e.jsx(y,{children:"El editor visual estará disponible en la próxima actualización. Por ahora, usa el modo código para editar el contenido HTML."})]}),e.jsx(r,{onClick:()=>b("codigo"),className:"w-full",children:"Cambiar a Modo Código"})]}),n&&e.jsxs("div",{className:"mt-4 space-y-2",children:[!n.valida&&n.errores.length>0&&e.jsxs(_,{variant:"destructive",children:[e.jsx(ie,{className:"h-4 w-4"}),e.jsxs(y,{children:[e.jsx("strong",{children:"Errores encontrados:"}),e.jsx("ul",{className:"list-disc list-inside mt-1",children:n.errores.map((s,a)=>e.jsx("li",{children:s},a))})]})]}),n.advertencias.length>0&&e.jsx(_,{children:e.jsxs(y,{children:[e.jsx("strong",{children:"Advertencias:"}),e.jsx("ul",{className:"list-disc list-inside mt-1",children:n.advertencias.map((s,a)=>e.jsx("li",{children:s},a))})]})}),n.estadisticas&&e.jsxs("div",{className:"text-sm text-gray-600",children:["Tamaño: ",n.estadisticas.tamaño_bytes," bytes | Campos variables: ",n.estadisticas.campos_variables," | Elementos HTML: ",n.estadisticas.elementos_html]})]})]})]}),w&&e.jsxs(o,{children:[e.jsxs(u,{children:[e.jsx(p,{children:"Vista Previa"}),e.jsx(L,{children:"Visualización de la plantilla con valores de ejemplo"})]}),e.jsx(c,{children:e.jsx("div",{className:"border p-4 bg-white min-h-[300px]",dangerouslySetInnerHTML:{__html:w}})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(o,{children:[e.jsxs(u,{children:[e.jsx(p,{children:"Campos Variables"}),e.jsx(L,{children:"Gestiona los campos que pueden ser reemplazados dinámicamente"})]}),e.jsxs(c,{className:"space-y-4",children:[t.campos_variables.length>0&&e.jsx("div",{className:"space-y-2",children:t.campos_variables.map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:s.nombre}),e.jsxs("div",{className:"text-sm text-gray-500",children:[s.marcador," • ",s.tipo,s.requerido&&e.jsx(ne,{variant:"outline",className:"ml-1",children:"Requerido"})]})]}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(r,{size:"sm",variant:"outline",onClick:()=>Z(s.marcador),children:e.jsx(F,{className:"h-3 w-3"})}),e.jsx(r,{size:"sm",variant:"outline",onClick:()=>$(a),children:e.jsx(xe,{className:"h-3 w-3"})}),e.jsx(r,{size:"sm",variant:"outline",onClick:()=>Y(a),children:e.jsx(he,{className:"h-3 w-3"})})]})]},a))}),e.jsxs("div",{className:"space-y-3 p-3 border rounded bg-gray-50",children:[e.jsx("h4",{className:"font-medium",children:"Agregar Campo"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{placeholder:"Nombre del campo",value:i.nombre,onChange:s=>m({...i,nombre:s.target.value})}),e.jsx(N,{placeholder:"Marcador (ej: {nombre})",value:i.marcador,onChange:s=>m({...i,marcador:s.target.value})}),e.jsxs(z,{value:i.tipo,onValueChange:s=>m({...i,tipo:s}),children:[e.jsx(A,{children:e.jsx(M,{})}),e.jsx(q,{children:B.map(s=>e.jsx(D,{value:s.value,children:s.label},s.value))})]}),e.jsx(N,{placeholder:"Valor por defecto",value:i.valor_default,onChange:s=>m({...i,valor_default:s.target.value})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(oe,{checked:i.requerido,onCheckedChange:s=>m({...i,requerido:s})}),e.jsx(g,{children:"Campo requerido"})]}),e.jsxs(r,{onClick:W,className:"w-full",size:"sm",children:[e.jsx(F,{className:"h-4 w-4 mr-2"}),"Agregar Campo"]})]})]})]})]}),e.jsxs(o,{children:[e.jsx(u,{children:e.jsx(p,{children:"Acciones"})}),e.jsxs(c,{className:"space-y-2",children:[l&&e.jsxs(e.Fragment,{children:[e.jsxs(r,{variant:"outline",className:"w-full",children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Exportar JSON"]}),e.jsxs(r,{variant:"outline",className:"w-full",children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Exportar HTML"]}),e.jsxs(r,{variant:"outline",className:"w-full",children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Nueva Versión"]})]}),e.jsxs(r,{variant:"outline",className:"w-full",children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),"Importar Plantilla"]})]})]})]})]})]})]})}export{Be as default};
