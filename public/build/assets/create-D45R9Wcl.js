import{r as n,u as ae,j as e,H as oe,L as B}from"./app-mZuumBHF.js";import{A as ie}from"./app-layout-BAEvnt2M.js";import{B as C}from"./button-CUXILrBa.js";import{I as c}from"./input-BwUHTfxZ.js";import{L as i}from"./label-DtEYR7Zx.js";import{j as M,T as O}from"./app-sidebar-layout-DgXQHrk3.js";import{C as S,a as w,b as D,d as T,c as E}from"./card-CwuWjEsc.js";import{A as F,a as L}from"./alert-BDPsR-n9.js";import{B as re}from"./badge-B75X_rhA.js";import{A as ne}from"./arrow-left-CANkpnGq.js";import{S as H}from"./save-B5Ytldfv.js";import{F as z}from"./Combination-BPgq6ehx.js";import{S as q}from"./search-CkPPQGcv.js";import{M as G}from"./map-pin-CJIYgkwg.js";import{C as h}from"./circle-check-big-BfYQsKGY.js";import{U as J}from"./user-DfxlciF3.js";import{C as de}from"./circle-alert-BKj3DbLW.js";import{C as K}from"./calendar-q69EYwSx.js";/* empty css            */import"./index-d6pHo9Cr.js";import"./index-D6GAEQ53.js";import"./index-C5M9l-mU.js";import"./x-Br6x5XB2.js";import"./app-logo-icon-Cnzpm7V1.js";import"./mail-DVdBUCYf.js";import"./users-Y5nqKMVE.js";import"./folder-Bsqg8PO1.js";import"./triangle-alert-CDk1eHQ1.js";function $e({expedientes:N,documentos:g,usuarios:_,errors:a}){const[j,Q]=n.useState(""),[f,V]=n.useState(""),[x,A]=n.useState(""),[W,I]=n.useState([]),[l,$]=n.useState("usuario"),[d,X]=n.useState({nombre_completo:"",tipo_documento:"",numero_documento:"",email:"",telefono:"",cargo:"",dependencia:""}),m=(s,r)=>{X(u=>({...u,[s]:r})),o(s,r)},[Y,k]=n.useState([]),[Z,U]=n.useState([]),{data:t,setData:o,post:ee,processing:b,isDirty:R}=ae({tipo_prestamo:"expediente",expediente_id:"",documento_id:"",solicitante_id:"",motivo:"",fecha_devolucion_esperada:"",observaciones:"",tipo_solicitante:"usuario",nombre_completo:"",tipo_documento:"",numero_documento:"",email:"",telefono:"",cargo:"",dependencia:""});n.useEffect(()=>{if(j){const s=N.filter(r=>r.codigo.toLowerCase().includes(j.toLowerCase())||r.titulo.toLowerCase().includes(j.toLowerCase())).slice(0,10);U(s)}else U(N.slice(0,10))},[j,N]),n.useEffect(()=>{if(f){const s=g.filter(r=>r.titulo.toLowerCase().includes(f.toLowerCase())||(r.expediente?.codigo||"").toLowerCase().includes(f.toLowerCase())).slice(0,10);k(s)}else k(g.slice(0,10))},[f,g]),n.useEffect(()=>{if(x){const s=_.filter(r=>r.name.toLowerCase().includes(x.toLowerCase())||r.email.toLowerCase().includes(x.toLowerCase())).slice(0,10);I(s)}else I(_.slice(0,10))},[x,_]),n.useEffect(()=>{o("expediente_id",""),o("documento_id","")},[t.tipo_prestamo]);const se=s=>{if(s.preventDefault(),!t.tipo_prestamo){alert("Debe seleccionar el tipo de préstamo");return}if(t.tipo_prestamo==="expediente"&&!t.expediente_id){alert("Debe seleccionar un expediente");return}if(t.tipo_prestamo==="documento"&&!t.documento_id){alert("Debe seleccionar un documento");return}if(l==="usuario"&&!t.solicitante_id){alert("Debe seleccionar un usuario registrado");return}if(l==="externo"&&(!d.nombre_completo||!d.tipo_documento||!d.numero_documento||!d.email)){alert("Debe completar todos los campos requeridos del solicitante externo");return}if(!t.motivo){alert("Debe ingresar el motivo del préstamo");return}if(!t.fecha_devolucion_esperada){alert("Debe seleccionar la fecha de devolución esperada");return}const r={...t,tipo_solicitante:l,fecha_prestamo:new Date().toISOString().split("T")[0]};Object.keys(r).forEach(u=>{o(u,r[u])}),ee("/admin/prestamos",{onSuccess:()=>{},onError:u=>{console.error("Errores de validación:",u),alert("Error al crear el préstamo. Revisa los campos requeridos.")}})},p=N.find(s=>s.id.toString()===t.expediente_id),v=g.find(s=>s.id.toString()===t.documento_id),y=_.find(s=>s.id.toString()===t.solicitante_id),P=new Date;P.setDate(P.getDate()+1);const te=P.toISOString().split("T")[0];return e.jsxs(ie,{children:[e.jsx(oe,{title:"Crear Préstamo"}),e.jsxs("form",{onSubmit:se,className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(B,{href:"/admin/prestamos",className:"text-sm text-muted-foreground hover:text-foreground",children:"Préstamos"}),e.jsx("span",{className:"text-muted-foreground",children:"/"}),e.jsx("span",{className:"font-medium",children:"Nuevo Préstamo"})]}),e.jsx("h1",{className:"text-2xl font-bold mt-1",children:"Crear Préstamo"}),e.jsx("p",{className:"text-muted-foreground",children:"Registra un nuevo préstamo de expediente o documento"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{type:"button",variant:"outline",asChild:!0,children:e.jsxs(B,{href:"/admin/prestamos",children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Cancelar"]})}),e.jsxs(C,{type:"submit",disabled:b||!R,children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),b?"Creando...":"Crear Préstamo"]})]})]}),e.jsxs(S,{children:[e.jsxs(w,{children:[e.jsx(D,{children:"Tipo de Préstamo"}),e.jsx(T,{children:"Selecciona si prestarás un expediente o documento individual"})]}),e.jsx(E,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("button",{type:"button",onClick:()=>o("tipo_prestamo","expediente"),className:`p-4 border rounded-lg text-left transition-colors ${t.tipo_prestamo==="expediente"?"border-primary bg-primary/5":"border-border hover:border-primary/50"}`,children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(M,{className:`h-6 w-6 ${t.tipo_prestamo==="expediente"?"text-primary":"text-muted-foreground"}`}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Expediente Completo"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Prestar un expediente físico completo con todos sus documentos"})]})]})}),e.jsx("button",{type:"button",onClick:()=>o("tipo_prestamo","documento"),className:`p-4 border rounded-lg text-left transition-colors ${t.tipo_prestamo==="documento"?"border-primary bg-primary/5":"border-border hover:border-primary/50"}`,children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(z,{className:`h-6 w-6 ${t.tipo_prestamo==="documento"?"text-primary":"text-muted-foreground"}`}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Documento Individual"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Prestar un documento específico de un expediente"})]})]})})]})})]}),e.jsxs(S,{children:[e.jsxs(w,{children:[e.jsxs(D,{className:"flex items-center space-x-2",children:[t.tipo_prestamo==="expediente"?e.jsx(M,{className:"h-5 w-5"}):e.jsx(z,{className:"h-5 w-5"}),e.jsxs("span",{children:["Seleccionar ",t.tipo_prestamo==="expediente"?"Expediente":"Documento"]})]}),e.jsxs(T,{children:["Busca y selecciona el ",t.tipo_prestamo," que deseas prestar"]})]}),e.jsx(E,{className:"space-y-4",children:t.tipo_prestamo==="expediente"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"busqueda_expediente",children:"Buscar Expediente"}),e.jsxs("div",{className:"relative",children:[e.jsx(q,{className:"h-4 w-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground"}),e.jsx(c,{id:"busqueda_expediente",placeholder:"Buscar por código o nombre del expediente...",value:j,onChange:s=>Q(s.target.value),className:"pl-10"})]})]}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:Z.map(s=>e.jsx("div",{className:`p-3 border rounded-lg cursor-pointer transition-colors ${t.expediente_id===s.id.toString()?"border-primary bg-primary/5":"border-border hover:border-primary/50"}`,onClick:()=>o("expediente_id",s.id.toString()),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:s.codigo}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.titulo}),e.jsxs("div",{className:"flex items-center space-x-4 text-xs text-muted-foreground mt-1",children:[e.jsxs("span",{children:["Estado: ",s.estado]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(G,{className:"h-3 w-3 mr-1"}),s.ubicacion_fisica]})]})]}),t.expediente_id===s.id.toString()&&e.jsx(h,{className:"h-5 w-5 text-primary"})]})},s.id))}),p&&e.jsxs(F,{children:[e.jsx(h,{className:"h-4 w-4"}),e.jsxs(L,{children:[e.jsx("strong",{children:"Expediente seleccionado:"})," ",p.codigo," - ",p.titulo]})]}),a.expediente_id&&e.jsx("p",{className:"text-sm text-red-500",children:a.expediente_id})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"busqueda_documento",children:"Buscar Documento"}),e.jsxs("div",{className:"relative",children:[e.jsx(q,{className:"h-4 w-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground"}),e.jsx(c,{id:"busqueda_documento",placeholder:"Buscar por nombre del documento...",value:f,onChange:s=>V(s.target.value),className:"pl-10"})]})]}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:Y.map(s=>e.jsx("div",{className:`p-3 border rounded-lg cursor-pointer transition-colors ${t.documento_id===s.id.toString()?"border-primary bg-primary/5":"border-border hover:border-primary/50"}`,onClick:()=>o("documento_id",s.id.toString()),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:s.titulo}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Expediente: ",s.expediente?.codigo||"N/A"," - ",s.expediente?.titulo||"Sin expediente"]}),e.jsx("div",{className:"flex items-center space-x-4 text-xs text-muted-foreground mt-1",children:e.jsxs("span",{className:"flex items-center",children:[e.jsx(G,{className:"h-3 w-3 mr-1"}),s.ubicacion_fisica]})})]}),t.documento_id===s.id.toString()&&e.jsx(h,{className:"h-5 w-5 text-primary"})]})},s.id))}),v&&e.jsxs(F,{children:[e.jsx(h,{className:"h-4 w-4"}),e.jsxs(L,{children:[e.jsx("strong",{children:"Documento seleccionado:"})," ",v.titulo,e.jsx("br",{}),e.jsx("strong",{children:"Expediente:"})," ",v.expediente?.codigo||"N/A"," - ",v.expediente?.titulo||"Sin expediente"]})]}),a.documento_id&&e.jsx("p",{className:"text-sm text-red-500",children:a.documento_id})]})})]}),e.jsxs(S,{children:[e.jsxs(w,{children:[e.jsxs(D,{className:"flex items-center space-x-2",children:[e.jsx(J,{className:"h-5 w-5"}),e.jsx("span",{children:"Información del Préstamo"})]}),e.jsx(T,{children:"Datos del solicitante y detalles del préstamo"})]}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(i,{children:"Tipo de Solicitante *"}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",id:"usuario_registrado",name:"tipo_solicitante",checked:l==="usuario",onChange:()=>{$("usuario"),o("tipo_solicitante","usuario"),o("solicitante_id","")},className:"h-4 w-4"}),e.jsx(i,{htmlFor:"usuario_registrado",className:"cursor-pointer",children:"Usuario Registrado"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",id:"solicitante_externo",name:"tipo_solicitante",checked:l==="externo",onChange:()=>{$("externo"),o("tipo_solicitante","externo"),o("solicitante_id","")},className:"h-4 w-4"}),e.jsx(i,{htmlFor:"solicitante_externo",className:"cursor-pointer",children:"Solicitante Externo"})]})]})]}),l==="usuario"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"solicitante",children:"Buscar Usuario Registrado *"}),e.jsxs("div",{className:"relative",children:[e.jsx(q,{className:"h-4 w-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground"}),e.jsx(c,{placeholder:"Buscar usuario por nombre o email...",value:x,onChange:s=>A(s.target.value),className:"pl-10"})]}),x&&e.jsx("div",{className:"space-y-1 max-h-40 overflow-y-auto border rounded p-2",children:W.map(s=>e.jsxs("div",{className:`p-2 rounded cursor-pointer transition-colors ${t.solicitante_id===s.id.toString()?"bg-primary/10 border border-primary":"hover:bg-muted"}`,onClick:()=>{o("solicitante_id",s.id.toString()),A(s.name)},children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.email})]},s.id))}),y&&e.jsxs(F,{children:[e.jsx(h,{className:"h-4 w-4"}),e.jsxs(L,{children:[e.jsx("strong",{children:"Solicitante:"})," ",y.name," (",y.email,")"]})]}),a.solicitante_id&&e.jsx("p",{className:"text-sm text-red-500",children:a.solicitante_id})]}),l==="externo"&&e.jsxs("div",{className:"space-y-4 p-4 border rounded-lg bg-gray-50",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Datos del Solicitante Externo"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"nombre_completo",children:"Nombre Completo *"}),e.jsx(c,{id:"nombre_completo",placeholder:"Nombre completo del solicitante",value:d.nombre_completo,onChange:s=>m("nombre_completo",s.target.value),className:a.nombre_completo?"border-red-500":""}),a.nombre_completo&&e.jsx("p",{className:"text-sm text-red-500",children:a.nombre_completo})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"tipo_documento",children:"Tipo de Documento *"}),e.jsxs("select",{id:"tipo_documento",value:d.tipo_documento,onChange:s=>m("tipo_documento",s.target.value),className:`w-full px-3 py-2 border rounded-md ${a.tipo_documento?"border-red-500":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Seleccionar tipo"}),e.jsx("option",{value:"CC",children:"Cédula de Ciudadanía"}),e.jsx("option",{value:"CE",children:"Cédula de Extranjería"}),e.jsx("option",{value:"TI",children:"Tarjeta de Identidad"}),e.jsx("option",{value:"PP",children:"Pasaporte"}),e.jsx("option",{value:"NIT",children:"NIT"})]}),a.tipo_documento&&e.jsx("p",{className:"text-sm text-red-500",children:a.tipo_documento})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"numero_documento",children:"Número de Documento *"}),e.jsx(c,{id:"numero_documento",placeholder:"Número de identificación",value:d.numero_documento,onChange:s=>m("numero_documento",s.target.value),className:a.numero_documento?"border-red-500":""}),a.numero_documento&&e.jsx("p",{className:"text-sm text-red-500",children:a.numero_documento})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"email_externo",children:"Email *"}),e.jsx(c,{id:"email_externo",type:"email",placeholder:"correo@ejemplo.com",value:d.email,onChange:s=>m("email",s.target.value),className:a.email?"border-red-500":""}),a.email&&e.jsx("p",{className:"text-sm text-red-500",children:a.email})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"telefono",children:"Teléfono"}),e.jsx(c,{id:"telefono",placeholder:"Número de teléfono",value:d.telefono,onChange:s=>m("telefono",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"cargo",children:"Cargo"}),e.jsx(c,{id:"cargo",placeholder:"Cargo o posición",value:d.cargo,onChange:s=>m("cargo",s.target.value)})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(i,{htmlFor:"dependencia",children:"Dependencia/Institución"}),e.jsx(c,{id:"dependencia",placeholder:"Dependencia o institución de procedencia",value:d.dependencia,onChange:s=>m("dependencia",s.target.value)})]})]}),e.jsxs(F,{children:[e.jsx(de,{className:"h-4 w-4"}),e.jsxs(L,{children:[e.jsx("strong",{children:"Nota:"})," Los datos del solicitante externo se guardarán como parte del registro del préstamo para fines de evidencia y trazabilidad."]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"motivo",children:"Motivo del Préstamo *"}),e.jsx(O,{id:"motivo",placeholder:"Describe el motivo o propósito del préstamo...",value:t.motivo,onChange:s=>o("motivo",s.target.value),className:`min-h-[100px] ${a.motivo?"border-red-500":""}`}),a.motivo&&e.jsx("p",{className:"text-sm text-red-500",children:a.motivo})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(i,{htmlFor:"fecha_devolucion_esperada",className:"flex items-center space-x-2",children:[e.jsx(K,{className:"h-4 w-4"}),e.jsx("span",{children:"Fecha de Devolución Esperada *"})]}),e.jsx(c,{id:"fecha_devolucion_esperada",type:"date",min:te,value:t.fecha_devolucion_esperada,onChange:s=>o("fecha_devolucion_esperada",s.target.value),className:a.fecha_devolucion_esperada?"border-red-500":""}),a.fecha_devolucion_esperada&&e.jsx("p",{className:"text-sm text-red-500",children:a.fecha_devolucion_esperada})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"observaciones",children:"Observaciones"}),e.jsx(O,{id:"observaciones",placeholder:"Observaciones adicionales (opcional)",value:t.observaciones,onChange:s=>o("observaciones",s.target.value),className:"min-h-[80px]"})]})]})]}),(t.expediente_id||t.documento_id)&&t.solicitante_id&&e.jsxs(S,{className:"border-green-200 bg-green-50",children:[e.jsx(w,{children:e.jsxs(D,{className:"flex items-center space-x-2",children:[e.jsx(h,{className:"h-5 w-5 text-green-600"}),e.jsx("span",{children:"Resumen del Préstamo"})]})}),e.jsx(E,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(re,{variant:"outline",children:t.tipo_prestamo==="expediente"?"Expediente":"Documento"}),e.jsx("span",{className:"font-medium",children:p?`${p.codigo} - ${p.titulo}`:v?.titulo})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(J,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:["Solicitante: ",y?.name]})]}),t.fecha_devolucion_esperada&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(K,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:["Devolución esperada: ",new Date(t.fecha_devolucion_esperada).toLocaleDateString("es-ES")]})]})]})})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(C,{type:"button",variant:"outline",asChild:!0,children:e.jsx(B,{href:"/admin/prestamos",children:"Cancelar"})}),e.jsxs(C,{type:"submit",disabled:b||!R,children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),b?"Creando...":"Crear Préstamo"]})]})]})]})}export{$e as default};
