import{r as y,j as e,H as P,L as F,b as k,t as u}from"./app-DmFTQNHU.js";import{A as V}from"./app-layout-CF5PBVMg.js";import{B as h}from"./button-B9uqYTIR.js";import{C as f,a as b,b as N,c as _,d as G}from"./card-98qlzFSI.js";import{F as C,B as d}from"./Combination-DB4vhy5A.js";import{A as O,F as I,D as z,a as q,b as J,c as W,d as X,T as R,e as K,p as Q}from"./app-sidebar-layout-B4-tSBlc.js";import{I as $}from"./input-CXpCTHGE.js";import{L as l}from"./label-CYYsus1F.js";import{S as U,a as Y,b as Z,c as ee,d as v,C as se}from"./select-CTcGm3Mb.js";import{C as E}from"./checkbox-aJFP73X7.js";import{C as ie}from"./circle-check-big-DyCuRV4E.js";import{S as B}from"./square-pen-CQEvGVzK.js";import{D as re}from"./users-CA6jkooN.js";import{X as ae}from"./x-D4OXCe6m.js";import{S as oe}from"./save-Bs1a_bjc.js";import{P as ce}from"./plus-B4IyCcb9.js";import{T as te}from"./trash-2-DxjgEEuG.js";import{F as L}from"./folder-CyqBlkrb.js";import{F as ne}from"./folder-open-BVMoEmPp.js";/* empty css            */import"./index-6lxVY5DU.js";import"./index-BBDU3XkM.js";import"./index-D6-3VAHV.js";import"./app-logo-icon-B1r3bsQj.js";import"./user-2vHAz8tr.js";import"./mail-i7usF0Qz.js";import"./triangle-alert-Qv0vinvY.js";import"./search-BECONtiU.js";import"./BrandingProvider-BKZadETt.js";import"./index-_200N-9v.js";import"./check-kl6Xjmwn.js";const H=({node:s,tiemposRetencion:p,onEditTiempo:j,onDeleteTiempo:m,trdId:A})=>{const[g,x]=y.useState(!0),c=s.hijos&&s.hijos.length>0,a=p[s.id],r=!!a,o=t=>{switch(t){case"fondo":return e.jsx(ne,{className:"h-4 w-4 text-blue-600"});case"seccion":return e.jsx(L,{className:"h-4 w-4 text-green-600"});case"subseccion":return e.jsx(L,{className:"h-4 w-4 text-yellow-600"});case"serie":return e.jsx(C,{className:"h-4 w-4 text-purple-600"});case"subserie":return e.jsx(C,{className:"h-4 w-4 text-pink-600"});default:return e.jsx(C,{className:"h-4 w-4 text-gray-600"})}},w=t=>({fondo:"bg-blue-100 text-blue-800",seccion:"bg-green-100 text-green-800",subseccion:"bg-yellow-100 text-yellow-800",serie:"bg-purple-100 text-purple-800",subserie:"bg-pink-100 text-pink-800"})[t]||"bg-gray-100 text-gray-800",D=t=>({CT:"bg-green-100 text-green-800",E:"bg-red-100 text-red-800",D:"bg-blue-100 text-blue-800",S:"bg-yellow-100 text-yellow-800",M:"bg-purple-100 text-purple-800"})[t]||"bg-gray-100 text-gray-800";return e.jsxs("div",{className:"ml-4",children:[e.jsxs("div",{className:"flex items-start gap-2 py-2 group hover:bg-gray-50 rounded-md px-2 border-b border-gray-100",children:[e.jsx("button",{onClick:()=>x(!g),className:"p-0.5 hover:bg-gray-200 rounded mt-1",disabled:!c,children:c?g?e.jsx(se,{className:"h-4 w-4"}):e.jsx(Q,{className:"h-4 w-4"}):e.jsx("div",{className:"w-4 h-4"})}),e.jsx("div",{className:"mt-1",children:o(s.tipo_nivel)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-medium text-sm",children:s.nombre}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",s.codigo,")"]}),e.jsx(d,{variant:"outline",className:`text-xs ${w(s.tipo_nivel)}`,children:s.tipo_nivel}),!s.activo&&e.jsx(d,{variant:"outline",className:"text-xs bg-red-100 text-red-800",children:"Inactivo"})]}),r&&e.jsxs("div",{className:"mt-2 p-2 bg-blue-50 rounded-md border border-blue-200",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-600",children:"AG:"}),e.jsxs("span",{className:"ml-1 text-gray-900",children:[a.retencion_archivo_gestion," años"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-600",children:"AC:"}),e.jsxs("span",{className:"ml-1 text-gray-900",children:[a.retencion_archivo_central," años"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-600",children:"Disposición:"}),e.jsx(d,{className:`ml-1 text-xs ${D(a.disposicion_final)}`,children:a.disposicion_final})]}),e.jsxs("div",{className:"flex gap-1",children:[a.soporte_fisico&&e.jsx(d,{variant:"outline",className:"text-xs",children:"F"}),a.soporte_electronico&&e.jsx(d,{variant:"outline",className:"text-xs",children:"E"}),a.soporte_hibrido&&e.jsx(d,{variant:"outline",className:"text-xs",children:"H"})]})]}),a.procedimiento&&e.jsxs("div",{className:"mt-1 text-xs text-gray-600",children:[e.jsx("span",{className:"font-semibold",children:"Procedimiento:"})," ",a.procedimiento]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(h,{size:"sm",variant:"ghost",onClick:()=>j(s,a),className:"h-7 w-7 p-0 text-blue-600 hover:text-blue-800 hover:bg-blue-50",title:r?"Editar tiempo de retención":"Agregar tiempo de retención",children:r?e.jsx(B,{className:"h-3 w-3"}):e.jsx(ce,{className:"h-3 w-3"})}),r&&e.jsx(h,{size:"sm",variant:"ghost",onClick:()=>m(s.id),className:"h-7 w-7 p-0 hover:bg-red-100 hover:text-red-600",title:"Eliminar tiempo de retención",children:e.jsx(te,{className:"h-3 w-3"})})]})]}),g&&c&&e.jsx("div",{className:"border-l-2 border-gray-200 ml-2",children:s.hijos.map(t=>e.jsx(H,{node:t,tiemposRetencion:p,onEditTiempo:j,onDeleteTiempo:m,trdId:A},t.id))})]})};function Pe({trd:s,estructura:p,tiemposRetencion:j,estadisticas:m,tieneDocumentosAsociados:A}){const[g,x]=y.useState(!1),[c,a]=y.useState(null),[r,o]=y.useState({retencion_archivo_gestion:0,retencion_archivo_central:0,disposicion_final:"CT",soporte_fisico:!1,soporte_electronico:!1,soporte_hibrido:!1,procedimiento:"",observaciones:""}),w=[{title:"Dashboard",href:"/dashboard"},{title:"Administración",href:"#"},{title:"Tablas de Retención Documental",href:"/admin/trd"},{title:s.nombre,href:"#"}],D=(i,n)=>{a(i),o(n?{retencion_archivo_gestion:n.retencion_archivo_gestion,retencion_archivo_central:n.retencion_archivo_central,disposicion_final:n.disposicion_final,soporte_fisico:n.soporte_fisico,soporte_electronico:n.soporte_electronico,soporte_hibrido:n.soporte_hibrido,procedimiento:n.procedimiento||"",observaciones:n.observaciones||""}:{retencion_archivo_gestion:0,retencion_archivo_central:0,disposicion_final:"CT",soporte_fisico:!1,soporte_electronico:!1,soporte_hibrido:!1,procedimiento:"",observaciones:""}),x(!0)},t=i=>{confirm("¿Está seguro de eliminar este tiempo de retención?")&&k.delete(`/admin/trd/${s.id}/tiempo-retencion/${i}`,{preserveScroll:!0,onSuccess:()=>{u.success("Tiempo de retención eliminado exitosamente")},onError:()=>{u.error("Error al eliminar el tiempo de retención")}})},T=()=>{c&&k.post(`/admin/trd/${s.id}/tiempo-retencion`,{ccd_nivel_id:c.id,...r},{preserveScroll:!0,onSuccess:()=>{u.success("Tiempo de retención guardado exitosamente"),x(!1),a(null)},onError:i=>{console.error("Errores:",i),u.error("Error al guardar el tiempo de retención")}})},M=i=>({borrador:"bg-gray-100 text-gray-800",revision:"bg-yellow-100 text-yellow-800",aprobada:"bg-green-100 text-green-800",vigente:"bg-blue-100 text-blue-800",historica:"bg-purple-100 text-purple-800"})[i]||"bg-gray-100 text-gray-800",S=i=>i?new Date(i).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}):"No especificada";return e.jsxs(V,{breadcrumbs:w,children:[e.jsx(P,{title:`TRD - ${s.nombre}`}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs(F,{href:"/admin/trd",className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors",children:[e.jsx(O,{className:"h-4 w-4"}),"Volver a TRDs"]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(C,{className:"h-8 w-8 text-[#2a3d83]"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:s.nombre}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.codigo," • Versión ",s.version]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(d,{className:M(s.estado),children:s.estado}),s.vigente&&e.jsxs(d,{className:"bg-green-100 text-green-800",children:[e.jsx(ie,{className:"h-3 w-3 mr-1"}),"Vigente"]}),e.jsx(F,{href:`/admin/trd/${s.id}/edit`,children:e.jsxs(h,{className:"bg-[#2a3d83] hover:bg-[#1e2b5f]",children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Editar TRD"]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(N,{className:"text-sm font-medium text-gray-600",children:"CCD Asociado"})}),e.jsx(_,{children:s.cuadro_clasificacion?e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:s.cuadro_clasificacion.nombre}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.cuadro_clasificacion.codigo," • v",s.cuadro_clasificacion.version]})]}):e.jsx("p",{className:"text-sm text-gray-500",children:"No asociado"})})]}),e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(N,{className:"text-sm font-medium text-gray-600",children:"Fechas"})}),e.jsxs(_,{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Aprobación:"}),e.jsx("p",{className:"text-gray-600",children:S(s.fecha_aprobacion)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Vigencia:"}),e.jsxs("p",{className:"text-gray-600",children:[S(s.fecha_vigencia_inicio)," - ",S(s.fecha_vigencia_fin)]})]})]})]}),e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(N,{className:"text-sm font-medium text-gray-600",children:"Estadísticas"})}),e.jsxs(_,{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Niveles con tiempos:"}),e.jsxs("span",{className:"font-semibold",children:[m.niveles_con_tiempos," / ",m.niveles_totales]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Series:"}),e.jsx("span",{className:"font-semibold",children:m.series_count})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Expedientes:"}),e.jsx("span",{className:"font-semibold",children:m.expedientes_count})]})]})]})]}),e.jsxs(f,{children:[e.jsx(b,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-5 w-5 text-[#2a3d83]"}),"Estructura Jerárquica"]}),e.jsx(G,{children:"Gestione la estructura del cuadro de clasificación documental con tiempos de retención"})]}),e.jsxs(h,{variant:"outline",onClick:()=>window.location.href=`/admin/trd/${s.id}/export-pdf`,children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Exportar PDF"]})]})}),e.jsx(_,{children:p.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(I,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No hay estructura configurada"}),e.jsx("p",{className:"text-sm",children:"El CCD asociado no tiene niveles definidos"})]}):e.jsx("div",{className:"space-y-1",children:p.map(i=>e.jsx(H,{node:i,tiemposRetencion:j,onEditTiempo:D,onDeleteTiempo:t,trdId:s.id},i.id))})})]}),e.jsx(z,{open:g,onOpenChange:x,children:e.jsxs(q,{className:"sm:max-w-[600px]",children:[e.jsxs(J,{children:[e.jsx(W,{children:c&&j[c.id]?"Editar Tiempo de Retención":"Agregar Tiempo de Retención"}),e.jsx(X,{children:c&&e.jsxs(e.Fragment,{children:["Nivel: ",e.jsx("strong",{children:c.nombre})," (",c.codigo,")"]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Archivo de Gestión (AG) *"}),e.jsx($,{type:"number",min:"0",value:r.retencion_archivo_gestion,onChange:i=>o({...r,retencion_archivo_gestion:parseInt(i.target.value)||0}),placeholder:"Años"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Años en archivo de gestión"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Archivo Central (AC) *"}),e.jsx($,{type:"number",min:"0",value:r.retencion_archivo_central,onChange:i=>o({...r,retencion_archivo_central:parseInt(i.target.value)||0}),placeholder:"Años"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Años en archivo central"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Disposición Final *"}),e.jsxs(U,{value:r.disposicion_final,onValueChange:i=>o({...r,disposicion_final:i}),children:[e.jsx(Y,{children:e.jsx(Z,{})}),e.jsxs(ee,{children:[e.jsx(v,{value:"CT",children:"CT - Conservación Total"}),e.jsx(v,{value:"E",children:"E - Eliminación"}),e.jsx(v,{value:"D",children:"D - Digitalización"}),e.jsx(v,{value:"S",children:"S - Selección"}),e.jsx(v,{value:"M",children:"M - Microfilmación"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Soportes"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(E,{id:"soporte-fisico",checked:r.soporte_fisico,onCheckedChange:i=>o({...r,soporte_fisico:i})}),e.jsx(l,{htmlFor:"soporte-fisico",className:"font-normal",children:"Físico"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(E,{id:"soporte-electronico",checked:r.soporte_electronico,onCheckedChange:i=>o({...r,soporte_electronico:i})}),e.jsx(l,{htmlFor:"soporte-electronico",className:"font-normal",children:"Electrónico"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(E,{id:"soporte-hibrido",checked:r.soporte_hibrido,onCheckedChange:i=>o({...r,soporte_hibrido:i})}),e.jsx(l,{htmlFor:"soporte-hibrido",className:"font-normal",children:"Híbrido"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Procedimiento"}),e.jsx(R,{value:r.procedimiento,onChange:i=>o({...r,procedimiento:i.target.value}),placeholder:"Descripción del procedimiento de disposición final",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Observaciones"}),e.jsx(R,{value:r.observaciones,onChange:i=>o({...r,observaciones:i.target.value}),placeholder:"Observaciones adicionales",rows:2})]})]}),e.jsxs(K,{children:[e.jsxs(h,{variant:"outline",onClick:()=>x(!1),children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Cancelar"]}),e.jsxs(h,{onClick:T,className:"bg-[#2a3d83] hover:bg-[#1e2b5f]",children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Guardar"]})]})]})})]})]})}export{Pe as default};
