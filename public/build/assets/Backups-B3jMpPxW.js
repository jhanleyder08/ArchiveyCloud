import{r as i,j as e,H as O,a as P}from"./app-5lvxmL5N.js";import{s as G,A as j,m as k,n as U,Z as $,a as K,D as M,b as X,c as Z,d as q,e as J,f as Q,r as V,g as W}from"./app-sidebar-layout-CKEzWS_J.js";import{C as t,a as r,b as l,c}from"./card-LPn6WdOe.js";import{B as f}from"./badge-CRhtFKKP.js";import{B as g}from"./app-logo-icon-DTg4XN8t.js";import{L as d,I as Y}from"./label-BhumWj7F.js";import{A as I,b as ee,a as se}from"./alert-xVXVWRMh.js";import{P as D}from"./progress-rSLFRKpH.js";import{H as _}from"./hard-drive-i1NvzsoN.js";import{C as ae}from"./circle-check-big-BsqZqApd.js";import{C as te}from"./circle-x-DHplErrM.js";/* empty css            */import"./index-DrDC_1PC.js";import"./index-Cgyyrey8.js";function ge({backupHistory:m,storageInfo:a,backupConfig:o}){const[h,N]=i.useState(!1),[v,S]=i.useState("full"),[y,T]=i.useState(!0),[b,A]=i.useState(!0),[w,F]=i.useState(o.retention_days),[C,R]=i.useState(!1),[E,p]=i.useState(!1),L=async()=>{N(!0);try{const s={type:v,compress:y,cleanup:b,retention_days:w,dry_run:C},n=await(await fetch(route("admin.optimizacion.backups.create"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify(s)})).json();n.success?(alert("Backup creado exitosamente"),P.reload()):alert("Error durante backup: "+n.message)}catch(s){console.error("Error creating backup:",s),alert("Error interno del servidor")}finally{N(!1),p(!1)}},B=s=>{switch(s){case"full":return e.jsx(j,{className:"h-4 w-4"});case"database":return e.jsx(k,{className:"h-4 w-4"});case"files":return e.jsx(W,{className:"h-4 w-4"});default:return e.jsx(_,{className:"h-4 w-4"})}},H=s=>{switch(s){case"full":return"bg-blue-100 text-blue-800";case"database":return"bg-green-100 text-green-800";case"files":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}},z=s=>{const x=["B","KB","MB","GB","TB"];let n=s,u=0;for(;n>=1024&&u<x.length-1;)n/=1024,u++;return`${n.toFixed(2)} ${x[u]}`};return e.jsxs(G,{children:[e.jsx(O,{title:"Gestión de Backups"}),e.jsx("div",{className:"py-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8 space-y-6",children:[e.jsx("div",{className:"bg-white p-6 rounded-lg shadow",children:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Gestión de Backups"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(t,{children:[e.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:"Espacio Libre"}),e.jsx(_,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold",children:a.free_space_formatted}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Disponible"})]})]}),e.jsxs(t,{children:[e.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:"Espacio Usado"}),e.jsx(j,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold",children:a.used_space_formatted}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[a.usage_percentage.toFixed(1),"% del total"]})]})]}),e.jsxs(t,{children:[e.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:"Total de Backups"}),e.jsx(k,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold",children:m.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Almacenados"})]})]}),e.jsxs(t,{children:[e.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:"Retención"}),e.jsx(U,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold",children:o.retention_days}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Días"})]})]})]}),e.jsxs(t,{children:[e.jsx(r,{children:e.jsx(l,{children:"Uso de Almacenamiento"})}),e.jsx(c,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:["Usado: ",a.used_space_formatted]}),e.jsxs("span",{children:["Libre: ",a.free_space_formatted]})]}),e.jsx(D,{value:a.usage_percentage,className:"w-full"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[a.usage_percentage.toFixed(1),"% de ",a.total_space_formatted," usado"]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(t,{children:[e.jsx(r,{children:e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-5 w-5"}),"Crear Backup"]})}),e.jsxs(c,{className:"space-y-4",children:[e.jsxs(I,{children:[e.jsx(K,{className:"h-4 w-4"}),e.jsx(ee,{children:"Importante"}),e.jsx(se,{children:"Los backups pueden tomar tiempo según el tamaño de los datos. Se recomienda ejecutar durante períodos de bajo tráfico."})]}),e.jsxs(M,{open:E,onOpenChange:p,children:[e.jsx(X,{asChild:!0,children:e.jsxs(g,{className:"w-full flex items-center gap-2",children:[e.jsx(j,{className:"h-4 w-4"}),"Crear Nuevo Backup"]})}),e.jsxs(Z,{className:"sm:max-w-md",children:[e.jsxs(q,{children:[e.jsx(J,{children:"Crear Backup"}),e.jsx(Q,{children:"Configura las opciones para el nuevo backup."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Tipo de Backup"}),e.jsxs("select",{value:v,onChange:s=>S(s.target.value),className:"w-full p-2 border rounded-md",children:[e.jsx("option",{value:"full",children:"Backup Completo"}),e.jsx("option",{value:"database",children:"Solo Base de Datos"}),e.jsx("option",{value:"files",children:"Solo Archivos"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"retentionDays",children:"Días de Retención"}),e.jsx(Y,{id:"retentionDays",type:"number",value:w,onChange:s=>F(parseInt(s.target.value)),min:"1",max:"365"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"compress",checked:y,onChange:s=>T(s.target.checked)}),e.jsx(d,{htmlFor:"compress",children:"Comprimir backup"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"cleanup",checked:b,onChange:s=>A(s.target.checked)}),e.jsx(d,{htmlFor:"cleanup",children:"Limpiar backups antiguos"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"dryRun",checked:C,onChange:s=>R(s.target.checked)}),e.jsx(d,{htmlFor:"dryRun",children:"Modo simulación (dry run)"})]})]})]}),e.jsxs(V,{children:[e.jsx(g,{variant:"outline",onClick:()=>p(!1),children:"Cancelar"}),e.jsx(g,{onClick:L,disabled:h,children:h?"Creando...":"Crear Backup"})]})]})]}),h&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Creando backup..."}),e.jsx(D,{value:void 0,className:"w-full"})]})]})]}),e.jsxs(t,{children:[e.jsx(r,{children:e.jsx(l,{children:"Configuración"})}),e.jsxs(c,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:o.enabled?"Habilitado":"Deshabilitado"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Estado"})]}),e.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:o.compression?"Sí":"No"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Compresión"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Tipos Soportados:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:o.types.map(s=>e.jsxs(f,{variant:"outline",className:"flex items-center gap-1",children:[B(s),s]},s))})]})]})]})]}),e.jsxs(t,{children:[e.jsx(r,{children:e.jsx(l,{children:"Historial de Backups"})}),e.jsx(c,{children:e.jsxs("div",{className:"space-y-4",children:[m.map((s,x)=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:`p-2 rounded-lg ${H(s.type)}`,children:B(s.type)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.filename}),e.jsx("p",{className:"text-sm text-muted-foreground",children:new Date(s.created_at).toLocaleString()}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(f,{variant:"outline",className:"text-xs",children:s.type}),s.compressed&&e.jsx(f,{variant:"outline",className:"text-xs",children:"Comprimido"}),s.compression_ratio&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Ratio: ",s.compression_ratio.toFixed(1),"%"]})]})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-mono text-sm",children:z(s.size)}),s.status==="completed"?e.jsx(ae,{className:"h-4 w-4 text-green-600 mx-auto"}):e.jsx(te,{className:"h-4 w-4 text-red-600 mx-auto"})]})})]},x)),m.length===0&&e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No hay backups disponibles"})]})})]})]})})]})}export{ge as default};
