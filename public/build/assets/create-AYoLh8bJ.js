import{r as k,u as V,j as e,H as C,L as d}from"./app-B-PXR1Ni.js";import{A as y}from"./app-layout-DJutQZnN.js";import{C as x,a as h,b as p,c as j,d as u}from"./card-Dmlm_cpt.js";import{B as t}from"./app-logo-icon-BLsuM4IN.js";import{L as i,I as o}from"./label-CcIhawib.js";import{K as q,S as b,T as z,a as M}from"./app-sidebar-layout-D9ulO2li.js";import{B as _}from"./badge-CNo-IL5x.js";import{C as H}from"./checkbox-BbQFHxny.js";import{S as U,a as G,b as K,c as R,d as J}from"./select-B6s0-YwG.js";import{A as T,a as w}from"./alert-CjcJnkq6.js";import{A}from"./arrow-left-DbMIHj5m.js";import{C as Q}from"./circle-check-big-vwlwSDoT.js";import{C as W}from"./copy-B-dakBag.js";import{P as S}from"./plus-DmrOjBIx.js";import{N as X}from"./network-CTjrBv-E.js";import{M as Y}from"./minus-BJOt_SrD.js";import{S as Z}from"./save-CZYiVBmQ.js";/* empty css            */import"./index-DsJw0RIA.js";import"./index-DARluDlH.js";import"./index-CQZ_TJph.js";import"./check-BUuVkhmq.js";function Ce({usuarios:I,permisos_disponibles:f}){const[m,v]=k.useState(""),[l,P]=k.useState(null),{data:r,setData:c,post:D,processing:g,errors:a,reset:$}=V({nombre:"",descripcion:"",usuario_id:"",permisos:[],fecha_expiracion:"",limite_usos:"",ips_permitidas:[]}),E=s=>{s.preventDefault(),D("/admin/api-tokens",{onSuccess:n=>{n.props?.flash?.token_data&&P(n.props.flash.token_data)},onError:n=>{console.error("Errores:",n)}})},F=(s,n)=>{n?c("permisos",[...r.permisos,s]):c("permisos",r.permisos.filter(N=>N!==s))},B=()=>{m&&!r.ips_permitidas.includes(m)&&(c("ips_permitidas",[...r.ips_permitidas,m]),v(""))},L=s=>{c("ips_permitidas",r.ips_permitidas.filter(n=>n!==s))},O=()=>{l?.plain_token&&navigator.clipboard.writeText(l.plain_token)};return l?e.jsxs(y,{children:[e.jsx(C,{title:"Token Creado - API Tokens - ArchiveyCloud"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(d,{href:"/admin/api-tokens",children:e.jsxs(t,{variant:"outline",size:"sm",children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Volver a Tokens"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Token Creado Exitosamente"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Guarda el token de forma segura, no podrás verlo nuevamente"})]})]}),e.jsxs(T,{className:"border-green-200 bg-green-50",children:[e.jsx(Q,{className:"h-4 w-4 text-green-600"}),e.jsx(w,{className:"text-green-800",children:"El token API ha sido creado exitosamente"})]}),e.jsxs(x,{children:[e.jsxs(h,{children:[e.jsxs(p,{className:"flex items-center",children:[e.jsx(q,{className:"h-5 w-5 mr-2"}),"Nuevo Token API"]}),e.jsx(j,{children:"⚠️ Este es el único momento en que podrás ver el token completo. Guárdalo en un lugar seguro."})]}),e.jsxs(u,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(i,{children:"Nombre"}),e.jsx(o,{value:l.token.nombre,readOnly:!0})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Usuario"}),e.jsx(o,{value:l.token.usuario?.name||"",readOnly:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Token de Autenticación"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(o,{value:l.plain_token,readOnly:!0,className:"font-mono text-sm"}),e.jsx(t,{onClick:O,variant:"outline",children:e.jsx(W,{className:"h-4 w-4"})})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Incluye este token en el header: ",e.jsxs("code",{children:["Authorization: Bearer ",l.plain_token]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Permisos Asignados"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:l.token.permisos?.map(s=>e.jsxs(_,{variant:"outline",children:[e.jsx(b,{className:"h-3 w-3 mr-1"}),f[s]||s]},s))})]}),e.jsxs("div",{className:"flex justify-center space-x-4 pt-4",children:[e.jsx(d,{href:"/admin/api-tokens",children:e.jsx(t,{variant:"outline",children:"Ver Todos los Tokens"})}),e.jsx(d,{href:"/admin/api-tokens/create",children:e.jsxs(t,{children:[e.jsx(S,{className:"h-4 w-4 mr-2"}),"Crear Otro Token"]})})]})]})]})]})]}):e.jsxs(y,{children:[e.jsx(C,{title:"Crear Token - API Tokens - ArchiveyCloud"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(d,{href:"/admin/api-tokens",children:e.jsxs(t,{variant:"outline",size:"sm",children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Volver"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Crear Token API"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Crea un nuevo token de autenticación para integraciones externas"})]})]}),e.jsxs("form",{onSubmit:E,className:"space-y-6",children:[e.jsxs(x,{children:[e.jsxs(h,{children:[e.jsx(p,{children:"Información Básica"}),e.jsx(j,{children:"Define la información principal del token API"})]}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"nombre",children:"Nombre del Token *"}),e.jsx(o,{id:"nombre",value:r.nombre,onChange:s=>c("nombre",s.target.value),placeholder:"Ej: Sistema CRM, Aplicación Móvil",className:a.nombre?"border-red-500":""}),a.nombre&&e.jsx("p",{className:"text-sm text-red-600",children:a.nombre})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"usuario_id",children:"Usuario Propietario *"}),e.jsxs(U,{value:r.usuario_id,onValueChange:s=>c("usuario_id",s),children:[e.jsx(G,{className:a.usuario_id?"border-red-500":"",children:e.jsx(K,{placeholder:"Selecciona un usuario"})}),e.jsx(R,{children:I.map(s=>e.jsxs(J,{value:s.id.toString(),children:[s.name," - ",s.email]},s.id))})]}),a.usuario_id&&e.jsx("p",{className:"text-sm text-red-600",children:a.usuario_id})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"descripcion",children:"Descripción"}),e.jsx(z,{id:"descripcion",value:r.descripcion,onChange:s=>c("descripcion",s.target.value),placeholder:"Describe el propósito de este token...",rows:3,className:a.descripcion?"border-red-500":""}),a.descripcion&&e.jsx("p",{className:"text-sm text-red-600",children:a.descripcion})]})]})]}),e.jsxs(x,{children:[e.jsxs(h,{children:[e.jsxs(p,{className:"flex items-center",children:[e.jsx(b,{className:"h-5 w-5 mr-2"}),"Permisos"]}),e.jsx(j,{children:"Selecciona los permisos que tendrá este token"})]}),e.jsxs(u,{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Object.entries(f).map(([s,n])=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{id:s,checked:r.permisos.includes(s),onCheckedChange:N=>F(s,N)}),e.jsxs(i,{htmlFor:s,className:"text-sm cursor-pointer",children:[e.jsx("span",{className:"font-medium",children:s}),e.jsx("span",{className:"block text-gray-600 text-xs",children:n})]})]},s))}),a.permisos&&e.jsxs(T,{className:"border-red-200 bg-red-50",children:[e.jsx(M,{className:"h-4 w-4 text-red-600"}),e.jsx(w,{className:"text-red-800",children:a.permisos})]})]})]}),e.jsxs(x,{children:[e.jsxs(h,{children:[e.jsx(p,{children:"Configuración Avanzada"}),e.jsx(j,{children:"Opcional: configura restricciones adicionales"})]}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"fecha_expiracion",children:"Fecha de Expiración"}),e.jsx(o,{id:"fecha_expiracion",type:"date",value:r.fecha_expiracion,onChange:s=>c("fecha_expiracion",s.target.value),min:new Date().toISOString().split("T")[0],className:a.fecha_expiracion?"border-red-500":""}),e.jsx("p",{className:"text-xs text-gray-600",children:"Deja vacío para que no expire nunca"}),a.fecha_expiracion&&e.jsx("p",{className:"text-sm text-red-600",children:a.fecha_expiracion})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"limite_usos",children:"Límite de Usos"}),e.jsx(o,{id:"limite_usos",type:"number",value:r.limite_usos,onChange:s=>c("limite_usos",s.target.value),placeholder:"Ej: 1000",min:"1",className:a.limite_usos?"border-red-500":""}),e.jsx("p",{className:"text-xs text-gray-600",children:"Deja vacío para uso ilimitado"}),a.limite_usos&&e.jsx("p",{className:"text-sm text-red-600",children:a.limite_usos})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"IPs Permitidas"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(o,{value:m,onChange:s=>v(s.target.value),placeholder:"192.168.1.100",className:"flex-1"}),e.jsx(t,{type:"button",onClick:B,variant:"outline",children:e.jsx(S,{className:"h-4 w-4"})})]}),r.ips_permitidas.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:r.ips_permitidas.map(s=>e.jsxs(_,{variant:"outline",className:"flex items-center space-x-1",children:[e.jsx(X,{className:"h-3 w-3"}),e.jsx("span",{children:s}),e.jsx("button",{type:"button",onClick:()=>L(s),className:"ml-1 hover:text-red-600",children:e.jsx(Y,{className:"h-3 w-3"})})]},s))}),e.jsx("p",{className:"text-xs text-gray-600",children:"Deja vacío para permitir acceso desde cualquier IP"})]}),a.ips_permitidas&&e.jsx("p",{className:"text-sm text-red-600",children:a.ips_permitidas})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(d,{href:"/admin/api-tokens",children:e.jsx(t,{variant:"outline",children:"Cancelar"})}),e.jsx(t,{type:"submit",disabled:g,children:g?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Creando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Crear Token"]})})]})]})]})]})}export{Ce as default};
