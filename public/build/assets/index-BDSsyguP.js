import{r as g,j as e,H as W,b as n}from"./app-DyjZO5jj.js";import{f as J,C as Q,B as Z}from"./app-sidebar-layout-C_GZcBzp.js";import{B as h}from"./button-BDpOSzem.js";import{C as l,c as i,a as j,b as u,d as ee}from"./card-HvsWIqdm.js";import{I as v}from"./input-DWIA3fpi.js";import{S as y,a as b,b as T,c as w,d}from"./select-DvZyivWr.js";import{B as se,F as ae}from"./Combination-DJyQ0pUC.js";import{T as le,a as ie,b as L,c as o,d as te,e as x}from"./table-Bb3TmG3F.js";import{T as re,a as ce,b as C,c as _}from"./tabs-CmbIvw3G.js";import{R as de}from"./refresh-cw-gYKC0oQT.js";import{T as ne}from"./users-9LFUlpN0.js";import{S as A}from"./search-DVA9gPxa.js";import{T as S,S as p}from"./triangle-alert-Py5ZhKdg.js";import{U as R}from"./user-CRHhgD-B.js";import{G as D}from"./globe-uiLD7Yth.js";import{F as oe}from"./filter-DXpEmUe9.js";import{E as xe}from"./eye-BfFL3HCl.js";import{R as B,T as F}from"./CategoricalChart-Ct6dl_Hf.js";import{P as me,a as he}from"./PieChart-DjkI41b3.js";import{C as je}from"./tooltipContext-BU_hTYrg.js";import{B as ue,a as pe}from"./BarChart-D3merEMa.js";import{C as z,X as M,Y as V}from"./CartesianChart-AXJLme0E.js";import{L as fe}from"./LineChart-Cj3tTOp9.js";import{L as Ne}from"./Line-CSJp5z9K.js";import{M as ge}from"./monitor-XGezs86V.js";/* empty css            */import"./index-BjmZJ9zr.js";import"./index-CJU42caY.js";import"./index-BOu6Kk11.js";import"./x-BXa13Oug.js";import"./app-logo-icon-DvefdaCc.js";import"./label-CYKfv9Rz.js";import"./mail-r9sbyL42.js";import"./folder-c0_WrsOz.js";import"./BrandingProvider-BoXsXA66.js";import"./index-CMdJrQEA.js";import"./check-BoCkUy1v.js";import"./ActivePoints-k1_MZRyz.js";function rs({eventos:a,estadisticas:c,usuarios:H,acciones:U,filtros:t,resultados:ve,modulos:ye}){const[f,q]=g.useState(!1),[N,I]=g.useState(!1),P=s=>{switch(s){case"bloqueado":return"destructive";case"fallido":return"destructive";case"exitoso":return"secondary";default:return"outline"}},K=s=>{switch(s){case"bloqueado":return e.jsx(S,{className:"h-4 w-4 text-red-500"});case"fallido":return e.jsx(S,{className:"h-4 w-4 text-orange-500"});case"exitoso":return e.jsx(p,{className:"h-4 w-4 text-green-500"});default:return e.jsx(p,{className:"h-4 w-4 text-gray-500"})}},$=s=>{const O={autenticacion:R,gestion_usuarios:R,gestion_documentos:ae,gestion_expedientes:Z,seguridad:p,sistema:ge,general:D}[s]||D;return e.jsx(O,{className:"h-4 w-4"})},m=(s,r)=>{n.get(route("admin.auditoria.index"),{...t,[s]:r==="all"?"":r,page:1},{preserveState:!0,preserveScroll:!0})},G=s=>{n.get(route("admin.auditoria.index"),{...t,buscar:s,page:1},{preserveState:!0,preserveScroll:!0})},k=()=>{I(!0),n.reload({only:["eventos","estadisticas"],preserveScroll:!0,onFinish:()=>I(!1)})};g.useEffect(()=>{let s;return f&&(s=setInterval(k,3e4)),()=>{s&&clearInterval(s)}},[f]);const E=c.distribucion_resultados?.map(s=>({name:s.resultado,value:s.total,color:s.resultado==="fallido"?"#dc2626":s.resultado==="bloqueado"?"#ea580c":"#16a34a"}))||[],X=c.actividad_por_dia?.slice(-7).map(s=>({fecha:new Date(s.fecha).toLocaleDateString("es-ES",{month:"short",day:"numeric"}),eventos:s.total}))||[],Y=c.acciones_mas_frecuentes?.map(s=>({accion:s.accion.replace("_"," "),total:s.total}))||[];return e.jsxs(J,{children:[e.jsx(W,{title:"Auditoría y Trazabilidad Avanzada"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Auditoría y Trazabilidad Avanzada"}),e.jsx("p",{className:"text-muted-foreground",children:"Monitoreo y análisis de actividad del sistema en tiempo real"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"autoRefresh",checked:f,onChange:s=>q(s.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"autoRefresh",className:"text-sm",children:"Auto-refresh"})]}),e.jsxs(h,{variant:"outline",size:"sm",onClick:k,type:"button",disabled:N,children:[e.jsx(de,{className:`h-4 w-4 mr-2 ${N?"animate-spin":""}`}),N?"Actualizando...":"Actualizar"]}),e.jsxs(h,{variant:"outline",onClick:()=>n.visit(route("admin.auditoria.analytics")),type:"button",children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Analytics"]}),e.jsxs(h,{onClick:()=>n.visit(route("admin.auditoria.patrones")),type:"button",children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Patrones"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsx(l,{children:e.jsx(i,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(A,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Eventos"}),e.jsx("p",{className:"text-2xl font-bold",children:c.total_eventos.toLocaleString()})]})]})})}),e.jsx(l,{children:e.jsx(i,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(S,{className:"h-8 w-8 text-red-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Eventos Críticos"}),e.jsx("p",{className:"text-2xl font-bold",children:c.eventos_criticos})]})]})})}),e.jsx(l,{children:e.jsx(i,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(p,{className:"h-8 w-8 text-orange-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Alto Riesgo"}),e.jsx("p",{className:"text-2xl font-bold",children:c.eventos_alto_riesgo})]})]})})}),e.jsx(l,{children:e.jsx(i,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(R,{className:"h-8 w-8 text-green-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Usuarios Únicos"}),e.jsx("p",{className:"text-2xl font-bold",children:c.usuarios_unicos})]})]})})}),e.jsx(l,{children:e.jsx(i,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(D,{className:"h-8 w-8 text-purple-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"IPs Únicas"}),e.jsx("p",{className:"text-2xl font-bold",children:c.ips_unicas})]})]})})})]}),e.jsxs(re,{defaultValue:"eventos",className:"space-y-4",children:[e.jsxs(ce,{children:[e.jsx(C,{value:"eventos",children:"Eventos"}),e.jsx(C,{value:"estadisticas",children:"Estadísticas"}),e.jsx(C,{value:"tendencias",children:"Tendencias"})]}),e.jsxs(_,{value:"eventos",className:"space-y-4",children:[e.jsxs(l,{children:[e.jsx(j,{children:e.jsxs(u,{className:"flex items-center",children:[e.jsx(oe,{className:"h-5 w-5 mr-2"}),"Filtros de Auditoría"]})}),e.jsx(i,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 xl:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Búsqueda"}),e.jsxs("div",{className:"relative",children:[e.jsx(A,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(v,{placeholder:"Buscar eventos...",defaultValue:t.buscar,className:"pl-9",onChange:s=>{clearTimeout(window.searchTimeout),window.searchTimeout=setTimeout(()=>{G(s.target.value)},500)}})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Usuario"}),e.jsxs(y,{value:t.usuario_id||"all",onValueChange:s=>m("usuario_id",s),children:[e.jsx(b,{children:e.jsx(T,{placeholder:"Todos los usuarios"})}),e.jsxs(w,{children:[e.jsx(d,{value:"all",children:"Todos los usuarios"}),H.map(s=>e.jsx(d,{value:s.id.toString(),children:s.name},s.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Acción"}),e.jsxs(y,{value:t.accion||"all",onValueChange:s=>m("accion",s),children:[e.jsx(b,{children:e.jsx(T,{placeholder:"Todas las acciones"})}),e.jsxs(w,{children:[e.jsx(d,{value:"all",children:"Todas las acciones"}),U.map(s=>e.jsx(d,{value:s,children:s.replace("_"," ")},s))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Resultado"}),e.jsxs(y,{value:t.resultado||"all",onValueChange:s=>m("resultado",s),children:[e.jsx(b,{children:e.jsx(T,{placeholder:"Todos los resultados"})}),e.jsxs(w,{children:[e.jsx(d,{value:"all",children:"Todos los resultados"}),e.jsx(d,{value:"exitoso",children:"Exitoso"}),e.jsx(d,{value:"fallido",children:"Fallido"}),e.jsx(d,{value:"bloqueado",children:"Bloqueado"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Fecha Inicio"}),e.jsx(v,{type:"date",value:t.fecha_inicio||"",onChange:s=>m("fecha_inicio",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Fecha Fin"}),e.jsx(v,{type:"date",value:t.fecha_fin||"",onChange:s=>m("fecha_fin",s.target.value)})]})]})})]}),e.jsxs(l,{children:[e.jsxs(j,{children:[e.jsxs(u,{children:["Eventos de Auditoría (",a.meta?.total||0,")"]}),e.jsxs(ee,{children:["Mostrando ",a.meta?.from||0," a ",a.meta?.to||0," de ",a.meta?.total||0," eventos"]})]}),e.jsxs(i,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(le,{children:[e.jsx(ie,{children:e.jsxs(L,{children:[e.jsx(o,{children:"Riesgo"}),e.jsx(o,{children:"Fecha/Hora"}),e.jsx(o,{children:"Usuario"}),e.jsx(o,{children:"Acción"}),e.jsx(o,{children:"Descripción"}),e.jsx(o,{children:"IP / Ubicación"}),e.jsx(o,{children:"Acciones"})]})}),e.jsx(te,{children:a.data.map(s=>e.jsxs(L,{children:[e.jsx(x,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[K(s.resultado),e.jsx(se,{variant:P(s.resultado),children:s.resultado})]})}),e.jsx(x,{children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{children:new Date(s.fecha_hora).toLocaleDateString()}),e.jsx("div",{className:"text-gray-500",children:new Date(s.fecha_hora).toLocaleTimeString()})]})}),e.jsx(x,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.usuario?.name||"Sistema"}),e.jsx("div",{className:"text-sm text-gray-500",children:s.usuario?.email})]})}),e.jsx(x,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[$(s.modulo||"general"),e.jsx("span",{className:"font-medium",children:s.accion.replace("_"," ")})]})}),e.jsx(x,{children:e.jsx("div",{className:"max-w-xs truncate",title:s.descripcion,children:s.descripcion})}),e.jsx(x,{children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-mono",children:s.ip_address}),e.jsx("div",{className:"text-gray-500",children:s.pais||"N/A"}),e.jsxs("div",{className:"text-xs text-gray-400",children:[s.dispositivo||"N/A"," • ",s.navegador||"N/A"]})]})}),e.jsx(x,{children:e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>n.visit(route("admin.auditoria.show",s.id)),type:"button",children:[e.jsx(xe,{className:"h-4 w-4 mr-1"}),"Ver"]})})]},s.id))})]})}),a.data.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(A,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No hay eventos"}),e.jsx("p",{className:"text-gray-600",children:Object.keys(t).length>0?"No se encontraron eventos con los filtros aplicados":"No hay eventos de auditoría registrados"})]}),(a.meta?.last_page||0)>1&&e.jsxs("div",{className:"flex items-center justify-between mt-6",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Mostrando ",a.meta?.from||0," a ",a.meta?.to||0," de ",a.meta?.total||0," resultados"]}),e.jsx("div",{className:"flex space-x-1",children:(a.links||[]).map((s,r)=>e.jsx(h,{variant:s.active?"default":"outline",size:"sm",onClick:()=>s.url&&n.get(s.url),disabled:!s.url,dangerouslySetInnerHTML:{__html:s.label}},r))})]})]})]})]}),e.jsx(_,{value:"estadisticas",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(l,{children:[e.jsx(j,{children:e.jsx(u,{children:"Distribución por Nivel de Riesgo"})}),e.jsx(i,{children:e.jsx(B,{width:"100%",height:300,children:e.jsxs(me,{children:[e.jsx(he,{data:E,cx:"50%",cy:"50%",labelLine:!1,label:({name:s,percent:r})=>`${s} ${(r*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:E.map((s,r)=>e.jsx(je,{fill:s.color},`cell-${r}`))}),e.jsx(F,{})]})})})]}),e.jsxs(l,{children:[e.jsx(j,{children:e.jsx(u,{children:"Acciones Más Frecuentes"})}),e.jsx(i,{children:e.jsx(B,{width:"100%",height:300,children:e.jsxs(ue,{data:Y,children:[e.jsx(z,{strokeDasharray:"3 3"}),e.jsx(M,{dataKey:"accion"}),e.jsx(V,{}),e.jsx(F,{}),e.jsx(pe,{dataKey:"total",fill:"#3b82f6"})]})})})]})]})}),e.jsx(_,{value:"tendencias",className:"space-y-4",children:e.jsxs(l,{children:[e.jsx(j,{children:e.jsx(u,{children:"Actividad por Día (Últimos 7 días)"})}),e.jsx(i,{children:e.jsx(B,{width:"100%",height:300,children:e.jsxs(fe,{data:X,children:[e.jsx(z,{strokeDasharray:"3 3"}),e.jsx(M,{dataKey:"fecha"}),e.jsx(V,{}),e.jsx(F,{}),e.jsx(Ne,{type:"monotone",dataKey:"eventos",stroke:"#8884d8",strokeWidth:2})]})})})]})})]})]})]})}export{rs as default};
