import{r as m,u as U,j as e,H as B,b as F,t as T}from"./app-DyjZO5jj.js";import{A as M}from"./app-layout-CIaSKpEX.js";import{c as q,B as f}from"./button-BDpOSzem.js";import{I}from"./input-DWIA3fpi.js";import{L as t}from"./label-CYKfv9Rz.js";import{A as K,T as V}from"./app-sidebar-layout-C_GZcBzp.js";import{S as h,a as u,b as j,c as b,d as v}from"./select-DvZyivWr.js";import{C as d,a as n,b as c,c as o}from"./card-HvsWIqdm.js";import{A as X,a as Z}from"./alert-bVm3dmzb.js";import{I as z}from"./info-UJYRi27G.js";import{X as G}from"./x-BXa13Oug.js";import{S as J}from"./save-BgfQ_uVH.js";/* empty css            */import"./index-BOu6Kk11.js";import"./index-BjmZJ9zr.js";import"./Combination-DJyQ0pUC.js";import"./index-CJU42caY.js";import"./app-logo-icon-DvefdaCc.js";import"./user-CRHhgD-B.js";import"./mail-r9sbyL42.js";import"./users-9LFUlpN0.js";import"./folder-c0_WrsOz.js";import"./triangle-alert-Py5ZhKdg.js";import"./search-DVA9gPxa.js";import"./BrandingProvider-BoXsXA66.js";import"./index-CMdJrQEA.js";import"./check-BoCkUy1v.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],Q=q("FolderPlus",O);function Ee({opciones:l}){const[N,A]=m.useState(!1),[p,w]=m.useState([]),[_,D]=m.useState(""),[g,P]=m.useState([]),{data:i,setData:a,post:W,processing:C,errors:r,reset:Y}=U({titulo:"",descripcion:"",serie_id:"",subserie_id:"",tipo_expediente:"administrativo",nivel_acceso:"restringido",responsable_id:"",ubicacion_fisica:"",palabras_clave:[],notas:""}),L=[{title:"Inicio",href:"/dashboard"},{title:"Administración",href:"/admin"},{title:"Expedientes",href:"/admin/expedientes"},{title:"Crear Expediente",href:"/admin/expedientes/create"}];m.useEffect(()=>{if(i.serie_id&&l?.subseries){const s=l.subseries.filter(x=>x.serie_id===parseInt(i.serie_id));P(s)}else P([]),a("subserie_id","")},[i.serie_id,l]);const R=s=>{s.preventDefault(),A(!0);const x={...i,serie_id:parseInt(i.serie_id)||null,subserie_id:i.subserie_id?parseInt(i.subserie_id):null,responsable_id:parseInt(i.responsable_id)||null};F.post("/admin/expedientes",x,{preserveScroll:!0,onSuccess:()=>{T.success("Expediente creado exitosamente")},onError:E=>{T.error("Error al crear el expediente. Revisa los campos marcados."),console.error("Errores:",E)},onFinish:()=>{A(!1)}})},k=()=>{if(_.trim()&&!p.includes(_.trim())){const s=[...p,_.trim()];w(s),a("palabras_clave",s),D("")}},H=s=>{const x=p.filter(E=>E!==s);w(x),a("palabras_clave",x)},S=l?.series?.find(s=>s.id===parseInt(i.serie_id)),y=g.find(s=>s.id===parseInt(i.subserie_id));return e.jsxs(M,{breadcrumbs:L,children:[e.jsx(B,{title:"Crear Expediente"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Q,{className:"h-6 w-6 text-[#2a3d83]"}),e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Crear Expediente Electrónico"})]}),e.jsxs(f,{type:"button",variant:"outline",onClick:()=>F.visit("/admin/expedientes"),className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-4 w-4"}),"Volver"]})]}),e.jsxs(X,{children:[e.jsx(z,{className:"h-4 w-4"}),e.jsx(Z,{children:"Un expediente electrónico agrupa documentos relacionados siguiendo la estructura archivística de series y subseries documentales definidas en las TRD."})]}),e.jsxs("form",{onSubmit:R,className:"space-y-6",children:[e.jsxs(d,{children:[e.jsx(n,{children:e.jsx(c,{children:"Información Básica"})}),e.jsxs(o,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"titulo",children:"Título del Expediente *"}),e.jsx(I,{id:"titulo",type:"text",value:i.titulo,onChange:s=>a("titulo",s.target.value),placeholder:"Título descriptivo del expediente",className:r.titulo?"border-red-500":"",required:!0}),r.titulo&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:r.titulo})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"descripcion",children:"Descripción"}),e.jsx(V,{id:"descripcion",value:i.descripcion,onChange:s=>a("descripcion",s.target.value),placeholder:"Descripción detallada del expediente",rows:3,className:r.descripcion?"border-red-500":""}),r.descripcion&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:r.descripcion})]})]})]}),e.jsxs(d,{children:[e.jsx(n,{children:e.jsx(c,{children:"Clasificación Archivística"})}),e.jsxs(o,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"serie_id",children:"Serie Documental *"}),e.jsxs(h,{value:i.serie_id,onValueChange:s=>{a("serie_id",s),a("subserie_id","")},children:[e.jsx(u,{id:"serie_id",className:r.serie_id?"border-red-500":"",children:e.jsx(j,{placeholder:"Seleccionar serie"})}),e.jsx(b,{children:l.series.map(s=>e.jsxs(v,{value:s.id.toString(),children:[s.codigo," - ",s.nombre]},s.id))})]}),r.serie_id&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:r.serie_id})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"subserie_id",children:"Subserie Documental"}),e.jsxs(h,{value:i.subserie_id,onValueChange:s=>a("subserie_id",s),disabled:!i.serie_id||g.length===0,children:[e.jsx(u,{id:"subserie_id",className:r.subserie_id?"border-red-500":"",children:e.jsx(j,{placeholder:i.serie_id?g.length===0?"No hay subseries disponibles":"Seleccionar subserie (opcional)":"Primero selecciona una serie"})}),e.jsx(b,{children:g.map(s=>e.jsxs(v,{value:s.id.toString(),children:[s.codigo," - ",s.nombre]},s.id))})]}),r.subserie_id&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:r.subserie_id})]})]}),S&&e.jsx("div",{className:"p-3 bg-blue-50 rounded-lg border border-blue-200",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Serie seleccionada:"})," ",S.codigo," - ",S.nombre,y&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("strong",{children:"Subserie seleccionada:"})," ",y.codigo," - ",y.nombre]})]})})]})]}),e.jsxs(d,{children:[e.jsx(n,{children:e.jsx(c,{children:"Configuración del Expediente"})}),e.jsx(o,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"tipo_expediente",children:"Tipo de Expediente *"}),e.jsxs(h,{value:i.tipo_expediente,onValueChange:s=>a("tipo_expediente",s),children:[e.jsx(u,{id:"tipo_expediente",className:r.tipo_expediente?"border-red-500":"",children:e.jsx(j,{})}),e.jsx(b,{children:l.tipos_expediente.map(s=>e.jsx(v,{value:s.value,children:s.label},s.value))})]}),r.tipo_expediente&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:r.tipo_expediente})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"nivel_acceso",children:"Nivel de Acceso *"}),e.jsxs(h,{value:i.nivel_acceso,onValueChange:s=>a("nivel_acceso",s),children:[e.jsx(u,{id:"nivel_acceso",className:r.nivel_acceso?"border-red-500":"",children:e.jsx(j,{})}),e.jsx(b,{children:l.niveles_acceso?.map(s=>e.jsx(v,{value:s.value,children:s.label},s.value))})]}),r.nivel_acceso&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:r.nivel_acceso})]})]})})]}),e.jsxs(d,{children:[e.jsx(n,{children:e.jsx(c,{children:"Responsabilidad"})}),e.jsx(o,{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx(t,{htmlFor:"responsable_id",children:"Usuario Responsable *"}),e.jsxs(h,{value:i.responsable_id,onValueChange:s=>a("responsable_id",s),children:[e.jsx(u,{id:"responsable_id",className:r.responsable_id?"border-red-500":"",children:e.jsx(j,{placeholder:"Seleccionar responsable"})}),e.jsx(b,{children:l.usuarios?.map(s=>e.jsxs(v,{value:s.id.toString(),children:[s.name," (",s.email,")"]},s.id))})]}),r.responsable_id&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:r.responsable_id})]})})]}),e.jsxs(d,{children:[e.jsx(n,{children:e.jsx(c,{children:"Ubicación"})}),e.jsx(o,{children:e.jsxs("div",{children:[e.jsx(t,{htmlFor:"ubicacion_fisica",children:"Ubicación Física"}),e.jsx(I,{id:"ubicacion_fisica",type:"text",value:i.ubicacion_fisica,onChange:s=>a("ubicacion_fisica",s.target.value),placeholder:"Ej: Archivo Central, Estante A-1, Caja 5"})]})})]}),e.jsxs(d,{children:[e.jsx(n,{children:e.jsx(c,{children:"Palabras Clave"})}),e.jsxs(o,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{value:_,onChange:s=>D(s.target.value),placeholder:"Agregar palabra clave",onKeyPress:s=>s.key==="Enter"&&(s.preventDefault(),k())}),e.jsx(f,{type:"button",variant:"outline",onClick:k,children:"Agregar"})]}),p.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:p.map(s=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm bg-blue-100 text-blue-800",children:[s,e.jsx("button",{type:"button",onClick:()=>H(s),className:"hover:text-blue-600",children:e.jsx(G,{className:"h-3 w-3"})})]},s))})]})]}),e.jsxs(d,{children:[e.jsx(n,{children:e.jsx(c,{children:"Notas"})}),e.jsx(o,{children:e.jsx(V,{value:i.notas,onChange:s=>a("notas",s.target.value),placeholder:"Notas adicionales sobre el expediente",rows:3})})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-6",children:[e.jsx(f,{type:"button",variant:"outline",onClick:()=>F.visit("/admin/expedientes"),disabled:C||N,children:"Cancelar"}),e.jsxs(f,{type:"submit",disabled:C||N,className:"bg-[#2a3d83] hover:bg-[#1e2b5f] flex items-center gap-2",children:[e.jsx(J,{className:"h-4 w-4"}),C||N?"Creando...":"Crear Expediente"]})]})]})]})]})}export{Ee as default};
