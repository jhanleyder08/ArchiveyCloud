import{r as l,j as e,H as M,L as N,b as x}from"./app-PjT1iryK.js";import{A as P}from"./app-layout-B8yH-w41.js";import{c as I,B as t}from"./button-Cm9JNphY.js";import{B as f}from"./badge-DbeYhTsH.js";import{C as h}from"./card-Co6Hd2mM.js";import{T as O,a as H,b,c as y}from"./tabs-Buf1DGN1.js";import{f as R,D as z,a as _,b as w,c as D,d as C,T as S,e as E,t as p}from"./app-sidebar-layout-CwtDgbRQ.js";import{L as c}from"./label-D-XtUnrF.js";import{I as G}from"./input-D1CzKmS6.js";import{C as k}from"./checkbox-BVMe0qnV.js";import{A as J}from"./arrow-left-nBEtwD7M.js";import{T as K}from"./triangle-alert-8-FZxcpm.js";import{C as Q}from"./circle-pause-Q488Vr8K.js";import{C as U}from"./circle-play-CisNPhfv.js";import{L as W}from"./lock-DcaxAgiY.js";/* empty css            */import"./index-CZ_pd2E1.js";import"./index-cbXV-n8a.js";import"./index-DhjpsedO.js";import"./Combination-D9Z0pBWt.js";import"./x-BzfNQRjC.js";import"./app-logo-icon-MQmYQbHr.js";import"./user-DdNuv-nc.js";import"./mail-Df4Yzh_7.js";import"./users--70s-uSq.js";import"./folder-CRD69BSn.js";import"./search-Cv_ItJ_l.js";import"./index-1M4rcJkl.js";import"./check-D71jOTwn.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]],Y=I("LockOpen",X);function Le({proceso:a,diasRestantes:i,alertasActivas:g,integridadValida:v,acciones_disponibles:A,flash:Z}){const[L,o]=l.useState(!1),[q,d]=l.useState(!1),[ee,T]=l.useState(!1),[r,j]=l.useState({accion:"",observaciones:"",confirmacion:!1}),[n,u]=l.useState({fecha_fin_aplazamiento:"",razon_aplazamiento:"",confirmacion:!1}),[ae,se]=l.useState({razon_bloqueo:""}),F=s=>{switch(s){case"activo":return"bg-green-100 text-green-800";case"alerta_previa":return"bg-yellow-100 text-yellow-800";case"vencido":return"bg-red-100 text-red-800";case"en_disposicion":return"bg-blue-100 text-blue-800";case"transferido":return"bg-purple-100 text-purple-800";case"eliminado":return"bg-gray-100 text-gray-800";case"conservado":return"bg-emerald-100 text-emerald-800";case"aplazado":return"bg-orange-100 text-orange-800";case"suspendido":return"bg-gray-100 text-gray-600";default:return"bg-gray-100 text-gray-600"}},$=s=>({activo:"Activo",alerta_previa:"Alerta Previa",vencido:"Vencido",en_disposicion:"En Disposición",transferido:"Transferido",eliminado:"Eliminado",conservado:"Conservado",aplazado:"Aplazado",suspendido:"Suspendido"})[s]||s,V=s=>{s.preventDefault(),x.post(`/admin/retencion-disposicion/${a.id}/ejecutar-disposicion`,r,{onSuccess:()=>{o(!1),p.success("Acción de disposición ejecutada correctamente")},onError:()=>{p.error("Error al ejecutar la disposición")}})},B=s=>{s.preventDefault(),x.post(`/admin/retencion-disposicion/${a.id}/aplazar`,n,{onSuccess:()=>{d(!1),p.success("Disposición aplazada correctamente")},onError:()=>{p.error("Error al aplazar la disposición")}})};return e.jsxs(P,{children:[e.jsx(M,{title:`Proceso ${a.codigo_proceso}`}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-2",children:[e.jsx(N,{href:"/admin/retencion-disposicion",className:"hover:text-gray-900",children:"Retención y Disposición"}),e.jsx(R,{className:"h-4 w-4"}),e.jsx("span",{className:"text-gray-900",children:a.codigo_proceso})]}),e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:["Proceso de Retención: ",a.codigo_proceso]}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:a.tipo_entidad==="documento"?`Documento: ${a.documento?.titulo||"Sin título"}`:`Expediente: ${a.expediente?.titulo||"Sin título"}`})]}),e.jsx(N,{href:"/admin/retencion-disposicion",children:e.jsxs(t,{variant:"outline",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Volver"]})})]})]}),i<=0&&e.jsx("div",{className:"bg-red-50 border-l-4 border-red-400 p-4 mb-6",children:e.jsxs("div",{className:"flex",children:[e.jsx(K,{className:"h-5 w-5 text-red-400"}),e.jsx("div",{className:"ml-3",children:e.jsxs("p",{className:"text-sm text-red-700",children:[e.jsx("strong",{children:"Atención:"})," Este proceso ha vencido y requiere disposición inmediata.",i<0&&` Vencido hace ${Math.abs(i)} días.`]})})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsxs(h,{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Información del Proceso"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Estado actual"}),e.jsx(f,{className:`${F(a.estado)} mt-1`,children:$(a.estado)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Tipo de entidad"}),e.jsx("p",{className:"font-medium capitalize",children:a.tipo_entidad})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"TRD aplicada"}),e.jsx("p",{className:"font-medium",children:a.trd?.nombre||"No especificada"}),a.trd?.version&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Versión ",a.trd.version]})]}),a.serie_documental&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Serie documental"}),e.jsx("p",{className:"font-medium",children:a.serie_documental.nombre})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Fecha creación documento"}),e.jsx("p",{className:"font-medium",children:new Date(a.fecha_creacion_documento).toLocaleDateString("es-ES")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Vencimiento archivo gestión"}),e.jsx("p",{className:"font-medium",children:new Date(a.fecha_vencimiento_gestion).toLocaleDateString("es-ES")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Vencimiento archivo central"}),e.jsx("p",{className:"font-medium",children:new Date(a.fecha_vencimiento_central).toLocaleDateString("es-ES")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Días hasta vencimiento"}),e.jsx("p",{className:`font-bold ${i<=0?"text-red-600":i<=30?"text-yellow-600":"text-green-600"}`,children:i>0?`${i} días`:i===0?"Vence hoy":`Vencido hace ${Math.abs(i)} días`})]})]}),a.aplazado&&e.jsxs("div",{className:"mt-4 p-4 bg-orange-50 rounded-lg",children:[e.jsxs("h3",{className:"text-sm font-semibold text-orange-800 mb-2",children:[e.jsx(Q,{className:"inline h-4 w-4 mr-1"}),"Proceso Aplazado"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[a.fecha_fin_aplazamiento&&e.jsxs("p",{children:[e.jsx("span",{className:"text-gray-600",children:"Fin del aplazamiento:"})," ",new Date(a.fecha_fin_aplazamiento).toLocaleDateString("es-ES")]}),a.razon_aplazamiento&&e.jsxs("p",{children:[e.jsx("span",{className:"text-gray-600",children:"Razón:"})," ",a.razon_aplazamiento]})]})]})]}),e.jsx(h,{className:"p-6 mt-6",children:e.jsxs(O,{defaultValue:"historial",children:[e.jsxs(H,{children:[e.jsx(b,{value:"historial",children:"Historial"}),e.jsx(b,{value:"alertas",children:"Alertas"})]}),e.jsx(y,{value:"historial",className:"mt-4",children:e.jsx("div",{className:"space-y-3",children:a.historial_acciones&&a.historial_acciones.length>0?a.historial_acciones.slice(0,5).map((s,m)=>e.jsxs("div",{className:"border-l-2 border-gray-200 pl-4 pb-3",children:[e.jsx("p",{className:"text-sm",children:s.descripcion_accion}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:new Date(s.fecha_accion).toLocaleString("es-ES")})]},m)):e.jsx("p",{className:"text-sm text-gray-500",children:"No hay historial disponible"})})}),e.jsx(y,{value:"alertas",className:"mt-4",children:e.jsx("div",{className:"space-y-3",children:a.alertas&&a.alertas.length>0?a.alertas.slice(0,5).map((s,m)=>e.jsxs("div",{className:"border rounded p-3",children:[e.jsx("h4",{className:"font-medium text-sm",children:s.titulo_alerta}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:s.mensaje_alerta})]},m)):e.jsx("p",{className:"text-sm text-gray-500",children:"No hay alertas disponibles"})})})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(h,{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Acciones Disponibles"}),e.jsxs("div",{className:"space-y-2",children:[A.map(s=>e.jsx(t,{variant:"outline",className:"w-full justify-start",onClick:()=>{s.key==="aplazar"?d(!0):(j({...r,accion:s.key}),o(!0))},children:e.jsx("span",{className:"ml-2",children:s.label})},s.key)),a.aplazado&&e.jsxs(t,{variant:"outline",className:"w-full justify-start",onClick:()=>x.post(`/admin/retencion-disposicion/${a.id}/reactivar`),children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Reactivar Proceso"]}),a.bloqueado_eliminacion?e.jsxs(t,{variant:"outline",className:"w-full justify-start",onClick:()=>x.post(`/admin/retencion-disposicion/${a.id}/desbloquear-eliminacion`),children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Desbloquear Eliminación"]}):e.jsxs(t,{variant:"outline",className:"w-full justify-start",onClick:()=>T(!0),children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Bloquear Eliminación"]})]})]}),e.jsxs(h,{className:"p-6",children:[e.jsx("h3",{className:"text-sm font-semibold mb-3",children:"Indicadores"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Alertas activas"}),e.jsx(f,{variant:g>0?"destructive":"secondary",children:g})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Integridad"}),e.jsx(f,{variant:v?"default":"destructive",children:v?"Válida":"Comprometida"})]})]})]})]})]})]}),e.jsx(z,{open:L,onOpenChange:o,children:e.jsxs(_,{children:[e.jsxs(w,{children:[e.jsx(D,{children:"Ejecutar Disposición"}),e.jsx(C,{children:"Esta acción es irreversible. Por favor, confirme que desea proceder."})]}),e.jsxs("form",{onSubmit:V,children:[e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(c,{children:"Observaciones"}),e.jsx(S,{value:r.observaciones,onChange:s=>j({...r,observaciones:s.target.value}),placeholder:"Ingrese observaciones adicionales..."})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{id:"confirmacion",checked:r.confirmacion,onCheckedChange:s=>j({...r,confirmacion:!!s})}),e.jsx(c,{htmlFor:"confirmacion",children:"Confirmo que deseo ejecutar esta acción"})]})]}),e.jsxs(E,{children:[e.jsx(t,{type:"button",variant:"outline",onClick:()=>o(!1),children:"Cancelar"}),e.jsx(t,{type:"submit",disabled:!r.confirmacion,children:"Ejecutar"})]})]})]})}),e.jsx(z,{open:q,onOpenChange:d,children:e.jsxs(_,{children:[e.jsxs(w,{children:[e.jsx(D,{children:"Aplazar Disposición"}),e.jsx(C,{children:"Indique la fecha hasta la cual desea aplazar la disposición."})]}),e.jsxs("form",{onSubmit:B,children:[e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(c,{children:"Fecha fin de aplazamiento"}),e.jsx(G,{type:"date",value:n.fecha_fin_aplazamiento,onChange:s=>u({...n,fecha_fin_aplazamiento:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Razón del aplazamiento"}),e.jsx(S,{value:n.razon_aplazamiento,onChange:s=>u({...n,razon_aplazamiento:s.target.value}),placeholder:"Explique la razón del aplazamiento...",required:!0})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{id:"confirmacion-aplazar",checked:n.confirmacion,onCheckedChange:s=>u({...n,confirmacion:!!s})}),e.jsx(c,{htmlFor:"confirmacion-aplazar",children:"Confirmo el aplazamiento"})]})]}),e.jsxs(E,{children:[e.jsx(t,{type:"button",variant:"outline",onClick:()=>d(!1),children:"Cancelar"}),e.jsx(t,{type:"submit",disabled:!n.confirmacion,children:"Aplazar"})]})]})]})})]})}export{Le as default};
