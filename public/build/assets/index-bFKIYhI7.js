import{r as m,u as Z,b as P,j as e,H as ee,L as k}from"./app-JwgH7fJx.js";import{A as se}from"./app-layout-D20pifTo.js";import{C as x,a as h,b as u,c as p}from"./card-7tojpRmh.js";import{B as I}from"./badge-Cv1Y_W6j.js";import{B as o}from"./button-Cjj82jEq.js";import{I as z}from"./input-DCwrhWX4.js";import{L as j}from"./label-0AfHNJVG.js";import{x as $,D as ae,g as te,a as re,b as le,c as ce,d as ie,T as oe,e as ne,t as N}from"./app-sidebar-layout-Br3BnsV7.js";import{S as b,a as v,b as y,c as _,d as n}from"./select-Ci9Zrp_P.js";import{P as de}from"./plus-SC8-cB3Z.js";import{S as me}from"./save-Cs7AiPAC.js";import{U as G}from"./user-Rhg3RUSJ.js";import{C as xe}from"./circle-alert-jokJvm9O.js";import{T as he}from"./users-BEJv0c5Y.js";import{F as ue}from"./Combination-knBqfxod.js";import{F as pe}from"./folder-open-C2t5L3D0.js";import{E as je}from"./eye-rfeJsmlC.js";import{S as ge}from"./square-pen-CLcPaQXg.js";import{C as fe}from"./copy-BJOB0bJR.js";/* empty css            */import"./index-DU0AnDMx.js";import"./index-BzEbrGzy.js";import"./index-BCuVt-Cl.js";import"./x-D_uhydLd.js";import"./index-BQRiyf7_.js";import"./app-logo-icon-4Xbnxovr.js";import"./triangle-alert-CPuhcq_l.js";import"./folder-rl7uLIZU.js";import"./search-CoxLWjz_.js";import"./index-DkhkMmJK.js";import"./check-91UYGjtM.js";const Ne=r=>({borrador:"bg-gray-100 text-gray-800",revision:"bg-yellow-100 text-yellow-800",activa:"bg-green-100 text-green-800",archivada:"bg-blue-100 text-blue-800",obsoleta:"bg-red-100 text-red-800"})[r]||"bg-gray-100 text-gray-800",M=r=>({memorando:"",oficio:"",resolucion:"锔",acta:"",informe:"",circular:"",comunicacion:"",otro:""})[r]||"";function Xe({plantillas:r,estadisticas:g,series:O,filtros:E,categorias:F,estados:B}){const V={total:0,activas:0,borradores:0,publicas:0,por_categoria:{},mas_usadas:[]},d=g&&typeof g=="object"?{...V,...g}:V,[C,q]=m.useState(E),[f,A]=m.useState(E.buscar||""),[J,T]=m.useState(!1),[L,S]=m.useState(null),U=m.useRef(!0),{data:c,setData:i,post:K,processing:H,errors:l,reset:R}=Z({nombre:"",descripcion:"",categoria:"otro",tipo_documento:"",serie_documental_id:"",subserie_documental_id:"",contenido_html:"",es_publica:!1});m.useEffect(()=>{if(U.current){U.current=!1;return}if(f===(E.buscar||""))return;const s=setTimeout(()=>{w("buscar",f)},500);return()=>clearTimeout(s)},[f]);const w=(s,t)=>{const a={...C};a[s]=t,(!t||t==="all")&&delete a[s],q(a),P.get(route("admin.plantillas.index"),a,{preserveState:!0,preserveScroll:!0})},Q=()=>{q({}),A(""),P.get(route("admin.plantillas.index"))},W=s=>{P.post(route("admin.plantillas.duplicar",s),{},{onSuccess:()=>{}})},X=s=>{const t=O.find(a=>a.id.toString()===s);S(t||null),i("serie_documental_id",s),i("subserie_documental_id","")};return e.jsxs(se,{children:[e.jsx(ee,{title:"Plantillas Documentales"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($,{className:"h-6 w-6 text-[#2a3d83]"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Plantillas Documentales"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Gesti贸n y creaci贸n de plantillas para documentos estandarizados"})]})]}),e.jsxs(ae,{open:J,onOpenChange:T,children:[e.jsx(te,{asChild:!0,children:e.jsxs(o,{className:"bg-[#2a3d83] hover:bg-[#1e2b5f] flex items-center gap-2",children:[e.jsx(de,{className:"h-4 w-4"}),"Nueva Plantilla"]})}),e.jsxs(re,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(le,{children:[e.jsx(ce,{className:"text-xl font-semibold text-gray-900",children:"Crear Nueva Plantilla Documental"}),e.jsx(ie,{className:"text-sm text-gray-600",children:"Complete los siguientes datos para crear una nueva plantilla."})]}),e.jsxs("form",{onSubmit:s=>{if(s.preventDefault(),!c.nombre||!c.categoria){N.error("Por favor complete los campos requeridos");return}console.log("Datos del formulario:",c),console.log("Ruta:",route("admin.plantillas.store")),console.log("URL completa:",window.location.origin+route("admin.plantillas.store"));const t=route("admin.plantillas.store");console.log("Intentando conectar a:",t),K(route("admin.plantillas.store"),{onStart:()=>{console.log("Iniciando env铆o de formulario...")},onProgress:()=>{console.log("Enviando datos...")},onSuccess:()=>{T(!1),R(),S(null),N.success("Plantilla creada exitosamente")},onError:a=>{console.error("Error al crear plantilla:",a),console.error("Tipo de error:",typeof a),console.error("Errores completos:",JSON.stringify(a,null,2)),a?typeof a=="object"?Object.keys(a).forEach(D=>{const Y=Array.isArray(a[D])?a[D][0]:a[D];N.error(`Error en ${D}: ${Y}`)}):N.error(`Error: ${a}`):N.error("Error al crear la plantilla. Por favor, verifique su conexi贸n e intente nuevamente.")},onFinish:()=>{console.log("Finalizado env铆o de formulario")},preserveState:!1,preserveScroll:!1,only:[]})},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"create-nombre",children:"Nombre de la Plantilla *"}),e.jsx(z,{id:"create-nombre",value:c.nombre,onChange:s=>i("nombre",s.target.value),placeholder:"Ej: Memorando Interno",required:!0,className:l.nombre?"border-red-500":""}),l.nombre&&e.jsx("p",{className:"text-sm text-red-600",children:l.nombre})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"create-categoria",children:"Categor铆a *"}),e.jsxs(b,{value:c.categoria,onValueChange:s=>i("categoria",s),children:[e.jsx(v,{className:l.categoria?"border-red-500":"",children:e.jsx(y,{placeholder:"Seleccionar categor铆a"})}),e.jsx(_,{children:Object.entries(F).map(([s,t])=>e.jsxs(n,{value:s,children:[M(s)," ",t]},s))})]}),l.categoria&&e.jsx("p",{className:"text-sm text-red-600",children:l.categoria})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"create-tipo-documento",children:"Tipo de Documento"}),e.jsx(z,{id:"create-tipo-documento",value:c.tipo_documento,onChange:s=>i("tipo_documento",s.target.value),placeholder:"Ej: Memorando interno",className:l.tipo_documento?"border-red-500":""}),l.tipo_documento&&e.jsx("p",{className:"text-sm text-red-600",children:l.tipo_documento})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"create-descripcion",children:"Descripci贸n"}),e.jsx(oe,{id:"create-descripcion",value:c.descripcion,onChange:s=>i("descripcion",s.target.value),placeholder:"Descripci贸n de la plantilla",rows:3,className:l.descripcion?"border-red-500":""}),l.descripcion&&e.jsx("p",{className:"text-sm text-red-600",children:l.descripcion})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Serie Documental"}),e.jsxs(b,{onValueChange:X,value:c.serie_documental_id||"",children:[e.jsx(v,{children:e.jsx(y,{placeholder:"Seleccionar serie"})}),e.jsx(_,{children:O.map(s=>e.jsxs(n,{value:s.id.toString(),children:[s.codigo," - ",s.nombre]},s.id))})]})]}),L?.subseries&&L.subseries.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Subserie Documental"}),e.jsxs(b,{value:c.subserie_documental_id||"",onValueChange:s=>i("subserie_documental_id",s),children:[e.jsx(v,{children:e.jsx(y,{placeholder:"Seleccionar subserie"})}),e.jsx(_,{children:L.subseries.map(s=>e.jsxs(n,{value:s.id.toString(),children:[s.codigo," - ",s.nombre]},s.id))})]})]})]}),(c.serie_documental_id||c.subserie_documental_id)&&e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(o,{type:"button",variant:"ghost",size:"sm",onClick:()=>{i("serie_documental_id",null),i("subserie_documental_id",null),S(null)},className:"text-xs",children:"Limpiar selecci贸n"})}),e.jsxs(ne,{children:[e.jsx(o,{type:"button",variant:"outline",onClick:()=>{T(!1),R(),S(null)},children:"Cancelar"}),e.jsxs(o,{type:"submit",disabled:H,className:"bg-[#2a3d83] hover:bg-[#1e2b5f] flex items-center gap-2",children:[e.jsx(me,{className:"h-4 w-4"}),H?"Guardando...":"Crear Plantilla"]})]})]})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(x,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Total Plantillas"}),e.jsx($,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(p,{children:[e.jsx("div",{className:"text-2xl font-bold",children:d.total}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[d.activas," activas"]})]})]}),e.jsxs(x,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Plantillas P煤blicas"}),e.jsx(G,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(p,{children:[e.jsx("div",{className:"text-2xl font-bold",children:d.publicas}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Disponibles para todos"})]})]}),e.jsxs(x,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"En Desarrollo"}),e.jsx(xe,{className:"h-4 w-4 text-yellow-600"})]}),e.jsxs(p,{children:[e.jsx("div",{className:"text-2xl font-bold",children:d.borradores}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Borradores pendientes"})]})]}),e.jsxs(x,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"M谩s Usada"}),e.jsx(he,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(p,{children:[e.jsx("div",{className:"text-2xl font-bold",children:d.mas_usadas[0]?.documentos_generados_count||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:d.mas_usadas[0]?.nombre||"Sin uso"})]})]})]}),e.jsxs(x,{children:[e.jsx(h,{children:e.jsx(u,{children:"Filtros"})}),e.jsx(p,{children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(z,{placeholder:"Buscar por nombre, c贸digo o descripci贸n...",value:f,onChange:s=>A(s.target.value),onKeyPress:s=>{s.key==="Enter"&&(s.preventDefault(),w("buscar",f))}})}),e.jsxs(b,{value:C.categoria||"all",onValueChange:s=>w("categoria",s),children:[e.jsx(v,{className:"w-48",children:e.jsx(y,{placeholder:"Categor铆a"})}),e.jsxs(_,{children:[e.jsx(n,{value:"all",children:"Todas las categor铆as"}),Object.entries(F).map(([s,t])=>e.jsxs(n,{value:s,children:[M(s)," ",t]},s))]})]}),e.jsxs(b,{value:C.estado||"all",onValueChange:s=>w("estado",s),children:[e.jsx(v,{className:"w-48",children:e.jsx(y,{placeholder:"Estado"})}),e.jsxs(_,{children:[e.jsx(n,{value:"all",children:"Todos los estados"}),Object.entries(B).map(([s,t])=>e.jsx(n,{value:s,children:t},s))]})]}),Object.keys(C).length>0&&e.jsx(o,{variant:"outline",onClick:Q,children:"Limpiar"})]})})]}),e.jsxs(x,{children:[e.jsx(h,{children:e.jsx(u,{children:"Lista de Plantillas"})}),e.jsx(p,{children:r.data.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ue,{className:"mx-auto h-12 w-12 text-muted-foreground"}),e.jsx("h3",{className:"mt-2 text-sm font-semibold text-gray-900",children:"No hay plantillas"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"No se encontraron plantillas documentales."})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left py-3 px-4",children:"Plantilla"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Categor铆a"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Estado"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Serie"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Creador"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Versi贸n"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Fecha"}),e.jsx("th",{className:"text-right py-3 px-4",children:"Acciones"})]})}),e.jsx("tbody",{children:r.data.map(s=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:s.nombre}),s.es_publica&&e.jsx(I,{variant:"secondary",className:"text-xs",children:"P煤blica"})]}),e.jsx("div",{className:"text-sm text-gray-500",children:s.codigo}),s.descripcion&&e.jsx("div",{className:"text-sm text-gray-400 max-w-xs truncate",children:s.descripcion})]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:M(s.categoria)}),e.jsx("span",{className:"capitalize",children:F[s.categoria]})]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx(I,{className:Ne(s.estado),children:B[s.estado]})}),e.jsx("td",{className:"py-3 px-4",children:s.serie_documental?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(pe,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm",children:s.serie_documental.codigo})]}):e.jsx("span",{className:"text-gray-400 text-sm",children:"Sin serie"})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(G,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm",children:s.usuario_creador.name})]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs(I,{variant:"outline",children:["v",s.version]})}),e.jsx("td",{className:"py-3 px-4 text-sm text-gray-500",children:new Date(s.created_at).toLocaleDateString("es-ES")}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(k,{href:route("admin.plantillas.show",s.id),children:e.jsx(o,{variant:"outline",size:"sm",children:e.jsx(je,{className:"h-4 w-4"})})}),e.jsx(k,{href:route("admin.plantillas.edit",s.id),children:e.jsx(o,{variant:"outline",size:"sm",children:e.jsx(ge,{className:"h-4 w-4"})})}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>W(s.id),children:e.jsx(fe,{className:"h-4 w-4"})})]})})]},s.id))})]})})})]}),r.links&&r.links.length>3&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Mostrando ",r?.meta?.from||0," a ",r?.meta?.to||0," de ",r?.meta?.total||0," resultados"]}),e.jsx("div",{className:"flex gap-2",children:r.links.map((s,t)=>e.jsx(o,{variant:s.active?"default":"outline",size:"sm",disabled:!s.url,onClick:()=>s.url&&P.get(s.url),dangerouslySetInnerHTML:{__html:s.label}},t))})]})]})]})}export{Xe as default};
