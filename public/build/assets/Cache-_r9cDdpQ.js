import{r as o,j as e,H as K,a as T}from"./app-DPEjwQT9.js";import{s as G,m as y,o as X,a as L,D as q,b as V,c as W,d as Y,e as J,f as Q,r as Z,n as I}from"./app-sidebar-layout-IbwrykLk.js";import{C as t,a as l,b as n,c as i}from"./card-wRfpXQ5K.js";import{B as S}from"./badge-q1UJX4yT.js";import{c as ee,B as j}from"./app-logo-icon-H_IL7Yv2.js";import{L as C,I as D}from"./label-D3CTh0Ka.js";import{T as se,a as ae,b as u,c as p}from"./tabs-CCQZ9Yu6.js";import{A as _,b as E,a as k}from"./alert-NgRWBvCT.js";import{M as re}from"./memory-stick-CvI6xyEc.js";import{A as te}from"./activity-BGx48vpM.js";import{R as A,T as P}from"./CategoricalChart-BJZ9SJ72.js";import{P as ie,a as le}from"./PieChart-B1ZEhG8W.js";import{C as ne}from"./circle-check-big-DL14MBBS.js";import{I as ce}from"./info-CgHp_4YX.js";import{T as R}from"./trash-2-B1rUWTxk.js";import{B as de}from"./BarChart-GH59E8pm.js";import{C as oe,X as me,Y as xe,B as he}from"./CartesianChart-CKqN15vt.js";import{L as je}from"./Legend-CtOGrxFQ.js";/* empty css            */import"./index-hKtuufHU.js";import"./index-BV2fi4LF.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]],F=ee("Flame",ue);function ze({cacheInfo:r,cacheStats:m,ttlConfig:M}){const[x,h]=o.useState(!1),[c,z]=o.useState("all"),[f,B]=o.useState(""),[g,O]=o.useState(""),[$,N]=o.useState(!1),H=async()=>{h(!0);try{const a=await(await fetch(route("admin.optimizacion.cache.warmup"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}})).json();a.success?(alert(`Warmup exitoso en ${a.execution_time}`),T.reload()):alert("Error durante warmup: "+a.message)}catch(s){console.error("Error during cache warmup:",s),alert("Error interno del servidor")}finally{h(!1)}},U=async()=>{h(!0);try{const s={type:c};c==="user"&&f?s.user_id=f:c==="pattern"&&g&&(s.pattern=g);const d=await(await fetch(route("admin.optimizacion.cache.flush"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify(s)})).json();d.success?(alert(d.message),T.reload()):alert("Error durante limpieza: "+d.message)}catch(s){console.error("Error during cache flush:",s),alert("Error interno del servidor")}finally{h(!1),N(!1)}},b=s=>{if(s<60)return`${s}s`;if(s<3600)return`${Math.floor(s/60)}m`;{const a=Math.floor(s/3600),d=Math.floor(s%3600/60);return d>0?`${a}h ${d}m`:`${a}h`}};m.map(s=>({name:s.description,cached:s.exists?1:0,not_cached:s.exists?0:1}));const v=Object.entries(M).map(([s,a])=>({name:s.replace("_"," ").toUpperCase(),ttl:a,duration:b(a)})),w=["#10b981","#ef4444"];return e.jsxs(G,{children:[e.jsx(K,{title:"Gestión de Caché"}),e.jsx("div",{className:"py-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8 space-y-6",children:[e.jsx("div",{className:"bg-white p-6 rounded-lg shadow",children:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Gestión de Caché"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(t,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"Driver de Caché"}),e.jsx(y,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold",children:r.driver}),e.jsx(S,{variant:r.status==="healthy"?"default":"destructive",className:"mt-1",children:r.status})]})]}),r.redis&&e.jsxs(e.Fragment,{children:[e.jsxs(t,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"Hit Ratio"}),e.jsx(X,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(i,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[r.redis.hit_ratio,"%"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[r.redis.keyspace_hits.toLocaleString()," hits"]})]})]}),e.jsxs(t,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"Memoria Usada"}),e.jsx(re,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold",children:r.redis.used_memory}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Redis v",r.redis.version]})]})]}),e.jsxs(t,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"Clientes"}),e.jsx(te,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold",children:r.redis.connected_clients}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Conectados"})]})]})]})]}),e.jsxs(se,{defaultValue:"overview",className:"space-y-6",children:[e.jsxs(ae,{className:"grid w-full grid-cols-4",children:[e.jsx(u,{value:"overview",children:"Resumen"}),e.jsx(u,{value:"management",children:"Gestión"}),e.jsx(u,{value:"config",children:"Configuración TTL"}),e.jsx(u,{value:"stats",children:"Estadísticas"})]}),e.jsx(p,{value:"overview",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(t,{children:[e.jsx(l,{children:e.jsxs(n,{className:"flex items-center gap-2",children:[e.jsx(y,{className:"h-5 w-5"}),"Estado de Cachés Críticos"]})}),e.jsx(i,{children:e.jsx(A,{width:"100%",height:300,children:e.jsxs(ie,{children:[e.jsx(le,{data:[{name:"En Caché",value:m.filter(s=>s.exists).length,fill:w[0]},{name:"Sin Caché",value:m.filter(s=>!s.exists).length,fill:w[1]}],cx:"50%",cy:"50%",outerRadius:80,dataKey:"value",label:({name:s,value:a})=>`${s}: ${a}`}),e.jsx(P,{})]})})})]}),e.jsxs(t,{children:[e.jsx(l,{children:e.jsx(n,{children:"Cachés del Sistema"})}),e.jsx(i,{className:"space-y-3",children:m.map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[s.exists?e.jsx(ne,{className:"h-4 w-4 text-green-600"}):e.jsx(L,{className:"h-4 w-4 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.description}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.key})]})]}),e.jsx(S,{variant:s.exists?"default":"secondary",children:s.exists?"En Caché":"No Cacheado"})]},a))})]})]})}),e.jsx(p,{value:"management",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(t,{children:[e.jsx(l,{children:e.jsxs(n,{className:"flex items-center gap-2",children:[e.jsx(F,{className:"h-5 w-5"}),"Precalentamiento de Caché"]})}),e.jsxs(i,{className:"space-y-4",children:[e.jsxs(_,{children:[e.jsx(ce,{className:"h-4 w-4"}),e.jsx(E,{children:"Warmup de Caché"}),e.jsx(k,{children:"Precalienta los cachés críticos del sistema para mejorar el rendimiento."})]}),e.jsxs(j,{onClick:H,disabled:x,className:"w-full flex items-center gap-2",children:[e.jsx(F,{className:"h-4 w-4"}),x?"Precalentando...":"Precalentar Cachés"]})]})]}),e.jsxs(t,{children:[e.jsx(l,{children:e.jsxs(n,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5"}),"Limpieza de Caché"]})}),e.jsxs(i,{className:"space-y-4",children:[e.jsxs(_,{children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx(E,{children:"Precaución"}),e.jsx(k,{children:"La limpieza de caché puede afectar temporalmente el rendimiento."})]}),e.jsxs(q,{open:$,onOpenChange:N,children:[e.jsx(V,{asChild:!0,children:e.jsxs(j,{variant:"destructive",className:"w-full flex items-center gap-2",children:[e.jsx(R,{className:"h-4 w-4"}),"Limpiar Caché"]})}),e.jsxs(W,{children:[e.jsxs(Y,{children:[e.jsx(J,{children:"Limpiar Caché"}),e.jsx(Q,{children:"Selecciona el tipo de limpieza de caché que deseas realizar."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{children:"Tipo de Limpieza"}),e.jsxs("select",{value:c,onChange:s=>z(s.target.value),className:"w-full p-2 border rounded-md",children:[e.jsx("option",{value:"all",children:"Todo el caché"}),e.jsx("option",{value:"user",children:"Caché de usuario específico"}),e.jsx("option",{value:"pattern",children:"Por patrón"})]})]}),c==="user"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"userId",children:"ID del Usuario"}),e.jsx(D,{id:"userId",value:f,onChange:s=>B(s.target.value),placeholder:"ID del usuario",type:"number"})]}),c==="pattern"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"pattern",children:"Patrón"}),e.jsx(D,{id:"pattern",value:g,onChange:s=>O(s.target.value),placeholder:"user_*, document_*, etc."})]})]}),e.jsxs(Z,{children:[e.jsx(j,{variant:"outline",onClick:()=>N(!1),children:"Cancelar"}),e.jsx(j,{variant:"destructive",onClick:U,disabled:x,children:x?"Limpiando...":"Limpiar"})]})]})]})]})]})]})}),e.jsx(p,{value:"config",className:"space-y-4",children:e.jsxs(t,{children:[e.jsx(l,{children:e.jsxs(n,{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-5 w-5"}),"Configuración de TTL (Time To Live)"]})}),e.jsx(i,{children:v.length>0?e.jsxs(e.Fragment,{children:[e.jsx(A,{width:"100%",height:400,children:e.jsxs(de,{data:v,children:[e.jsx(oe,{strokeDasharray:"3 3"}),e.jsx(me,{dataKey:"name",angle:-45,textAnchor:"end",height:100}),e.jsx(xe,{}),e.jsx(P,{formatter:(s,a)=>[b(s),"TTL"],labelFormatter:s=>`Tipo: ${s}`}),e.jsx(je,{}),e.jsx(he,{dataKey:"ttl",fill:"#3b82f6",name:"TTL (segundos)"})]})}),e.jsx("div",{className:"mt-6 space-y-3",children:v.map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsx("span",{className:"font-medium",children:s.name}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-mono text-sm",children:s.duration}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.ttl.toLocaleString()," segundos"]})]})]},a))})]}):e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No hay configuración TTL disponible"})})]})}),e.jsx(p,{value:"stats",className:"space-y-4",children:r.redis?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(t,{children:[e.jsx(l,{children:e.jsx(n,{children:"Métricas de Redis"})}),e.jsxs(i,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:r.redis.keyspace_hits.toLocaleString()}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Cache Hits"})]}),e.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:r.redis.keyspace_misses.toLocaleString()}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Cache Misses"})]})]}),e.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[e.jsxs("div",{className:"text-3xl font-bold text-blue-600",children:[r.redis.hit_ratio,"%"]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Hit Ratio"})]})]})]}),e.jsxs(t,{children:[e.jsx(l,{children:e.jsx(n,{children:"Información del Sistema"})}),e.jsxs(i,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Versión Redis:"}),e.jsx("span",{className:"font-mono",children:r.redis.version})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Memoria Usada:"}),e.jsx("span",{className:"font-mono",children:r.redis.used_memory})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Clientes Conectados:"}),e.jsx("span",{className:"font-mono",children:r.redis.connected_clients})]})]})]})]}):e.jsx(t,{children:e.jsxs(i,{className:"text-center py-8",children:[e.jsx(y,{className:"h-16 w-16 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Estadísticas detalladas solo disponibles para Redis"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:["Driver actual: ",r.driver]})]})})})]})]})})]})}export{ze as default};
