import{r as N,u as se,j as e,H as ie,a as R}from"./app-B-PXR1Ni.js";import{A as ae}from"./app-layout-DJutQZnN.js";import{c as re,B as o}from"./app-logo-icon-BLsuM4IN.js";import{C as b,a as _,b as y,c as S,d as C}from"./card-Dmlm_cpt.js";import{L as n,I as F}from"./label-CcIhawib.js";import{F as E,T as ce,U as V,d as q,C as te,D as le,h as ne,i as oe,j as de,k as me,c as xe,q as he}from"./app-sidebar-layout-D9ulO2li.js";import{S as k,a as D,b as T,c as A,d as m}from"./select-B6s0-YwG.js";import{C as w}from"./checkbox-BbQFHxny.js";import{B as u}from"./badge-CNo-IL5x.js";import{A as ue,a as je}from"./alert-CjcJnkq6.js";import{T as pe,a as ge,b as O,c as j,d as fe,e as p}from"./table-DYV7DOqP.js";import{A as ve}from"./arrow-left-DbMIHj5m.js";import{T as Ne}from"./trash-2-v8S4Iyw0.js";import{C as be}from"./circle-alert-DQvq-mpa.js";import{S as _e}from"./save-CZYiVBmQ.js";import{P as ye}from"./plus-DmrOjBIx.js";/* empty css            */import"./index-DsJw0RIA.js";import"./index-DARluDlH.js";import"./index-CQZ_TJph.js";import"./check-BUuVkhmq.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],Fe=re("UserPlus",Ce);function Je({documentos:L,usuarios:M}){const[t,g]=N.useState([]),[$,f]=N.useState(!1),[v,U]=N.useState(""),[x,Y]=N.useState(null),{data:r,setData:c,post:G,processing:z,errors:h,reset:we}=se({documento_id:"",titulo:"",descripcion:"",tipo_flujo:"secuencial",prioridad:"normal",fecha_limite:"",requiere_todos:!1,configuracion:{permitir_comentarios:!0,notificar_cambios:!0,recordatorio_dias:3},firmantes:[]}),B=M.filter(s=>s.name.toLowerCase().includes(v.toLowerCase())||s.email.toLowerCase().includes(v.toLowerCase())||s.cargo&&s.cargo.toLowerCase().includes(v.toLowerCase())),I=s=>{if(t.some(l=>l.usuario_id===s.id))return;const a={usuario_id:s.id,orden:t.length+1,requerido:!0,usuario:s},i=[...t,a];g(i),c("firmantes",i.map(l=>({usuario_id:l.usuario_id,orden:l.orden,requerido:l.requerido}))),f(!1),U("")},J=s=>{const a=t.filter(i=>i.usuario_id!==s).map((i,l)=>({...i,orden:l+1}));g(a),c("firmantes",a.map(i=>({usuario_id:i.usuario_id,orden:i.orden,requerido:i.requerido})))},H=(s,a)=>{if(a<1||a>t.length)return;const i=[...t],l=i.findIndex(d=>d.usuario_id===s),Z=i[l];i.splice(l,1),i.splice(a-1,0,Z);const P=i.map((d,ee)=>({...d,orden:ee+1}));g(P),c("firmantes",P.map(d=>({usuario_id:d.usuario_id,orden:d.orden,requerido:d.requerido})))},K=s=>{const a=t.map(i=>i.usuario_id===s?{...i,requerido:!i.requerido}:i);g(a),c("firmantes",a.map(i=>({usuario_id:i.usuario_id,orden:i.orden,requerido:i.requerido})))},Q=s=>{const a=L.find(i=>i.id===parseInt(s));Y(a||null),c("documento_id",s),!r.titulo&&a&&c("titulo",`Solicitud de firma: ${a.nombre}`)},W=s=>{if(s.preventDefault(),t.length===0){alert("Debe agregar al menos un firmante");return}G(route("admin.firmas.solicitudes.store"),{onSuccess:()=>{},onError:a=>{console.error("Errores de validación:",a)}})},X=new Date().toISOString().split("T")[0];return e.jsxs(ae,{children:[e.jsx(ie,{title:"Crear Solicitud de Firma"}),e.jsx("div",{className:"py-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"flex items-center space-x-3 mb-2",children:e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>R.get(route("admin.firmas.solicitudes")),children:[e.jsx(ve,{className:"w-4 h-4 mr-2"}),"Volver"]})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Nueva Solicitud de Firma Digital"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Configura un flujo de firma digital para múltiples usuarios"})]}),e.jsxs("form",{onSubmit:W,className:"space-y-6",children:[e.jsxs(b,{children:[e.jsxs(_,{children:[e.jsxs(y,{className:"flex items-center",children:[e.jsx(E,{className:"w-5 h-5 mr-2"}),"Información de la Solicitud"]}),e.jsx(S,{children:"Datos básicos de la solicitud de firma"})]}),e.jsxs(C,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"documento_id",children:"Documento a Firmar *"}),e.jsxs(k,{value:r.documento_id,onValueChange:Q,children:[e.jsx(D,{children:e.jsx(T,{placeholder:"Selecciona un documento"})}),e.jsx(A,{children:L.map(s=>e.jsx(m,{value:s.id.toString(),children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.nombre}),e.jsxs("div",{className:"text-xs text-gray-500",children:[s.tipo_documento,s.expediente&&e.jsxs("span",{children:[" • Exp: ",s.expediente.numero_expediente]})]})]})},s.id))})]}),h.documento_id&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:h.documento_id})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"prioridad",children:"Prioridad"}),e.jsxs(k,{value:r.prioridad,onValueChange:s=>c("prioridad",s),children:[e.jsx(D,{children:e.jsx(T,{})}),e.jsxs(A,{children:[e.jsx(m,{value:"baja",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(u,{className:"bg-gray-500 text-white",children:"Baja"}),e.jsx("span",{children:"Sin urgencia"})]})}),e.jsx(m,{value:"normal",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(u,{className:"bg-blue-500 text-white",children:"Normal"}),e.jsx("span",{children:"Prioridad estándar"})]})}),e.jsx(m,{value:"alta",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(u,{className:"bg-orange-500 text-white",children:"Alta"}),e.jsx("span",{children:"Requiere atención"})]})}),e.jsx(m,{value:"urgente",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(u,{className:"bg-red-500 text-white",children:"Urgente"}),e.jsx("span",{children:"Crítica"})]})})]})]})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"titulo",children:"Título de la Solicitud *"}),e.jsx(F,{id:"titulo",value:r.titulo,onChange:s=>c("titulo",s.target.value),placeholder:"Ej: Solicitud de firma para contrato de servicios",required:!0}),h.titulo&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:h.titulo})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"descripcion",children:"Descripción"}),e.jsx(ce,{id:"descripcion",value:r.descripcion,onChange:s=>c("descripcion",s.target.value),placeholder:"Descripción detallada de lo que se necesita firmar y el propósito...",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"tipo_flujo",children:"Tipo de Flujo"}),e.jsxs(k,{value:r.tipo_flujo,onValueChange:s=>c("tipo_flujo",s),children:[e.jsx(D,{children:e.jsx(T,{})}),e.jsxs(A,{children:[e.jsx(m,{value:"secuencial",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Secuencial"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Firma en orden específico"})]})}),e.jsx(m,{value:"paralelo",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Paralelo"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Cualquier orden"})]})})]})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"fecha_limite",children:"Fecha Límite"}),e.jsx(F,{id:"fecha_limite",type:"date",min:X,value:r.fecha_limite,onChange:s=>c("fecha_limite",s.target.value)})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(w,{id:"requiere_todos",checked:r.requiere_todos,onCheckedChange:s=>c("requiere_todos",s)}),e.jsx(n,{htmlFor:"requiere_todos",className:"text-sm",children:"Requiere que todos los firmantes obligatorios firmen"})]})]})]}),x&&e.jsxs(b,{children:[e.jsx(_,{children:e.jsx(y,{children:"Documento Seleccionado"})}),e.jsx(C,{children:e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(E,{className:"w-5 h-5 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-blue-900",children:x.nombre}),e.jsxs("p",{className:"text-sm text-blue-700 mt-1",children:["Tipo: ",x.tipo_documento]}),x.expediente&&e.jsxs("p",{className:"text-sm text-blue-700",children:["Expediente: ",x.expediente.numero_expediente," - ",x.expediente.titulo]})]})]})})})]}),e.jsxs(b,{children:[e.jsxs(_,{children:[e.jsxs(y,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(V,{className:"w-5 h-5 mr-2"}),"Firmantes (",t.length,")"]}),e.jsxs(o,{type:"button",variant:"outline",size:"sm",onClick:()=>f(!0),children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),"Agregar Firmante"]})]}),e.jsx(S,{children:r.tipo_flujo==="secuencial"?"Los firmantes deben firmar en el orden especificado":"Los firmantes pueden firmar en cualquier orden"})]}),e.jsxs(C,{children:[t.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(V,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No se han agregado firmantes"}),e.jsx("p",{className:"text-sm",children:'Haz clic en "Agregar Firmante" para comenzar'})]}):e.jsx("div",{className:"space-y-4",children:e.jsxs(pe,{children:[e.jsx(ge,{children:e.jsxs(O,{children:[r.tipo_flujo==="secuencial"&&e.jsx(j,{children:"Orden"}),e.jsx(j,{children:"Firmante"}),e.jsx(j,{children:"Cargo"}),e.jsx(j,{children:"Requerido"}),e.jsx(j,{children:"Acciones"})]})}),e.jsx(fe,{children:t.sort((s,a)=>s.orden-a.orden).map(s=>e.jsxs(O,{children:[r.tipo_flujo==="secuencial"&&e.jsx(p,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-sm font-medium",children:["#",s.orden]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx(o,{type:"button",variant:"outline",size:"sm",className:"h-6 w-6 p-0",onClick:()=>H(s.usuario_id,s.orden-1),disabled:s.orden===1,children:"↑"}),e.jsx(o,{type:"button",variant:"outline",size:"sm",className:"h-6 w-6 p-0",onClick:()=>H(s.usuario_id,s.orden+1),disabled:s.orden===t.length,children:"↓"})]})]})}),e.jsx(p,{children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(q,{className:"w-4 h-4 text-gray-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.usuario?.name}),e.jsx("div",{className:"text-sm text-gray-500",children:s.usuario?.email})]})]})}),e.jsx(p,{children:e.jsx("span",{className:"text-sm text-gray-600",children:s.usuario?.cargo||"No especificado"})}),e.jsx(p,{children:e.jsx(w,{checked:s.requerido,onCheckedChange:()=>K(s.usuario_id)})}),e.jsx(p,{children:e.jsx(o,{type:"button",variant:"destructive",size:"sm",onClick:()=>J(s.usuario_id),children:e.jsx(Ne,{className:"w-4 h-4"})})})]},s.usuario_id))})]})}),h.firmantes&&e.jsxs(ue,{className:"mt-4",children:[e.jsx(be,{className:"h-4 w-4"}),e.jsx(je,{className:"text-red-600",children:h.firmantes})]})]})]}),e.jsxs(b,{children:[e.jsxs(_,{children:[e.jsx(y,{children:"Configuración Avanzada"}),e.jsx(S,{children:"Opciones adicionales para la solicitud"})]}),e.jsx(C,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(w,{id:"permitir_comentarios",checked:r.configuracion.permitir_comentarios,onCheckedChange:s=>c("configuracion",{...r.configuracion,permitir_comentarios:s})}),e.jsx(n,{htmlFor:"permitir_comentarios",className:"text-sm",children:"Permitir comentarios"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(w,{id:"notificar_cambios",checked:r.configuracion.notificar_cambios,onCheckedChange:s=>c("configuracion",{...r.configuracion,notificar_cambios:s})}),e.jsx(n,{htmlFor:"notificar_cambios",className:"text-sm",children:"Notificar cambios por email"})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"recordatorio_dias",className:"text-sm",children:"Recordatorio (días)"}),e.jsx(F,{id:"recordatorio_dias",type:"number",min:"1",max:"30",value:r.configuracion.recordatorio_dias,onChange:s=>c("configuracion",{...r.configuracion,recordatorio_dias:parseInt(s.target.value)||3}),className:"mt-1"})]})]})})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-4",children:[e.jsx(o,{type:"button",variant:"outline",onClick:()=>R.get(route("admin.firmas.solicitudes")),children:"Cancelar"}),e.jsx(o,{type:"submit",disabled:z||t.length===0,children:z?e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"w-4 h-4 mr-2 animate-spin"}),"Creando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Crear Solicitud"]})})]})]})]})}),e.jsx(le,{open:$,onOpenChange:f,children:e.jsxs(ne,{className:"max-w-2xl",children:[e.jsxs(oe,{children:[e.jsx(de,{children:"Seleccionar Firmantes"}),e.jsx(me,{children:"Busca y selecciona los usuarios que deben firmar el documento"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(xe,{className:"w-4 h-4 absolute left-3 top-3 text-gray-400"}),e.jsx(F,{placeholder:"Buscar por nombre, email o cargo...",value:v,onChange:s=>U(s.target.value),className:"pl-10"})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto",children:B.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(q,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No se encontraron usuarios"})]}):e.jsx("div",{className:"space-y-2",children:B.map(s=>{const a=t.some(i=>i.usuario_id===s.id);return e.jsxs("div",{className:`flex items-center justify-between p-3 border rounded-lg ${a?"bg-gray-50 border-gray-200":"hover:bg-gray-50 cursor-pointer"}`,onClick:()=>!a&&I(s),children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(q,{className:"w-5 h-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-sm text-gray-500",children:s.email}),s.cargo&&e.jsx("div",{className:"text-xs text-gray-400",children:s.cargo})]})]}),a?e.jsx(u,{variant:"secondary",children:"Ya agregado"}):e.jsx(o,{size:"sm",onClick:()=>I(s),children:e.jsx(ye,{className:"w-4 h-4"})})]},s.id)})})})]}),e.jsx(he,{children:e.jsx(o,{variant:"outline",onClick:()=>f(!1),children:"Cerrar"})})]})})]})}export{Je as default};
