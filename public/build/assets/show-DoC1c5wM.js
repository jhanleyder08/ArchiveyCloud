import{r as C,u as R,j as e,H as te,L as S,b as le}from"./app-BuJooCB2.js";import{A as ne,D as T,g as F,a as A,b as L,c as z,d as E,e as k,T as ce,K as oe}from"./app-sidebar-layout-CNDt14fj.js";import{B as c}from"./button-o7sDTR10.js";import{C as l,c as n,a as o,b as d,d as V}from"./card-Dm8Sxxxu.js";import{B as m}from"./badge-CLhckl5I.js";import{T as de,a as me,b as h,c as j}from"./tabs-CihxgkAA.js";import{T as xe,a as he,b as H,c as v,d as je,e as p}from"./table-C0z6qpZe.js";import{A as O,a as U}from"./alert-D3DVPO65.js";import{L as i}from"./label-zUIVNhJD.js";import{S as ve,a as pe,c as ue,d as N}from"./select-C_00d0nr.js";import{A as ge}from"./arrow-left-DQdW7X8c.js";import{D as Ne}from"./users-B1PaIWsM.js";import{R as fe}from"./refresh-cw-CWWjz2ZX.js";import{C as B}from"./circle-x-aM9Q-BJ6.js";import{T as f}from"./triangle-alert-DGPIiAMo.js";import{U as ye}from"./user-yB-EHhJt.js";import{F as be}from"./Combination-BNwokkeO.js";import{A as I}from"./activity-Djy0tIA0.js";import{C as _e}from"./folder-Cr7M8TWf.js";import{C as we}from"./circle-check-big-CuB9eUpY.js";/* empty css            */import"./index-Bdl-WcJK.js";import"./index-DmZWXubS.js";import"./index-CCv8Isyn.js";import"./x-BWy7YUo4.js";import"./index-B32rHSx8.js";import"./app-logo-icon-BDSQZXaI.js";import"./input-BTIJ4r9q.js";import"./search-BRBLXc6Q.js";import"./index-9ThOp0oj.js";import"./check-CSAT8V4U.js";function as({certificado:a,estadisticas_uso:t,validez:x,historial_auditoria:y}){const[P,u]=C.useState(!1),[M,g]=C.useState(!1),{data:K,setData:$,post:q,processing:b,errors:_}=R({razon_revocacion:""}),{data:X,setData:G,post:J,processing:w,errors:D}=R({nueva_fecha_vencimiento:"",mantener_configuracion:!0}),Q=s=>{switch(s){case"activo":return"default";case"vencido":return"destructive";case"revocado":return"secondary";case"suspendido":return"outline";default:return"secondary"}},W=()=>a.estado==="revocado"?e.jsx(B,{className:"h-5 w-5 text-red-500"}):a.vigente?a.proximo_a_vencer?e.jsx(_e,{className:"h-5 w-5 text-yellow-500"}):e.jsx(we,{className:"h-5 w-5 text-green-500"}):e.jsx(f,{className:"h-5 w-5 text-orange-500"}),Y=s=>({usuario:"Usuario",servidor:"Servidor",autoridad_certificadora:"Autoridad CA",sello_tiempo:"Sello de Tiempo"})[s]||s,Z=s=>({firma_digital:"Firma Digital",autenticacion:"Autenticación",cifrado:"Cifrado",sello_tiempo:"Sello de Tiempo"})[s]||s,ee=s=>{window.location.href=route("admin.certificados.descargar",{certificado:a.id,formato:s})},se=()=>{q(route("admin.certificados.revocar",a.id),{onSuccess:()=>{u(!1),le.reload()}})},ae=()=>{J(route("admin.certificados.renovar",a.id),{onSuccess:()=>{g(!1)}})},re=()=>{const s=new Date;return s.setDate(s.getDate()+1),s.toISOString().split("T")[0]};return e.jsxs(ne,{children:[e.jsx(te,{title:`Certificado: ${a.nombre_certificado}`}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(S,{href:route("admin.certificados.index"),children:e.jsxs(c,{variant:"outline",size:"sm",children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"Volver"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:a.nombre_certificado}),e.jsxs("p",{className:"text-muted-foreground",children:["Serie: ",a.numero_serie]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(ve,{onValueChange:ee,children:[e.jsxs(pe,{className:"w-auto",children:[e.jsx(Ne,{className:"h-4 w-4 mr-2"}),"Descargar"]}),e.jsxs(ue,{children:[e.jsx(N,{value:"pem",children:"Formato PEM"}),e.jsx(N,{value:"der",children:"Formato DER"}),e.jsx(N,{value:"crt",children:"Formato CRT"})]})]}),a.vigente&&e.jsxs(e.Fragment,{children:[e.jsxs(T,{open:M,onOpenChange:g,children:[e.jsx(F,{asChild:!0,children:e.jsxs(c,{variant:"outline",children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),"Renovar"]})}),e.jsxs(A,{children:[e.jsxs(L,{children:[e.jsx(z,{children:"Renovar Certificado"}),e.jsx(E,{children:"Se creará un nuevo certificado basado en la configuración actual. El certificado actual será marcado como vencido."})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"nueva_fecha_vencimiento",children:"Nueva Fecha de Vencimiento"}),e.jsx("input",{id:"nueva_fecha_vencimiento",type:"date",value:X.nueva_fecha_vencimiento,onChange:s=>G("nueva_fecha_vencimiento",s.target.value),min:re(),className:"w-full px-3 py-2 border border-gray-300 rounded-md"}),D.nueva_fecha_vencimiento&&e.jsx("p",{className:"text-sm text-red-600",children:D.nueva_fecha_vencimiento})]})}),e.jsxs(k,{children:[e.jsx(c,{variant:"outline",onClick:()=>g(!1),children:"Cancelar"}),e.jsx(c,{onClick:ae,disabled:w,children:w?"Renovando...":"Renovar Certificado"})]})]})]}),e.jsxs(T,{open:P,onOpenChange:u,children:[e.jsx(F,{asChild:!0,children:e.jsxs(c,{variant:"destructive",children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Revocar"]})}),e.jsxs(A,{children:[e.jsxs(L,{children:[e.jsx(z,{children:"Revocar Certificado"}),e.jsx(E,{children:"Esta acción no se puede deshacer. El certificado será marcado como revocado y todas las firmas realizadas con él serán inválidas."})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"razon_revocacion",children:"Razón de Revocación"}),e.jsx(ce,{id:"razon_revocacion",value:K.razon_revocacion,onChange:s=>$("razon_revocacion",s.target.value),placeholder:"Especifique la razón por la cual se revoca el certificado...",rows:3}),_.razon_revocacion&&e.jsx("p",{className:"text-sm text-red-600",children:_.razon_revocacion})]})}),e.jsxs(k,{children:[e.jsx(c,{variant:"outline",onClick:()=>u(!1),children:"Cancelar"}),e.jsx(c,{variant:"destructive",onClick:se,disabled:b,children:b?"Revocando...":"Revocar Certificado"})]})]})]})]})]})]}),e.jsx(l,{children:e.jsx(n,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[W(),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(m,{variant:Q(a.estado),className:"capitalize",children:a.estado}),e.jsx(m,{variant:"outline",children:Y(a.tipo_certificado)})]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Propietario: ",a.usuario.name," (",a.usuario.email,")"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-medium",children:["Vence: ",new Date(a.fecha_vencimiento).toLocaleDateString()]}),a.vigente&&e.jsxs("p",{className:`text-sm ${a.proximo_a_vencer?"text-orange-600":"text-gray-600"}`,children:[a.dias_restantes," días restantes"]})]})]})})}),!x.valido&&e.jsxs(O,{variant:"destructive",children:[e.jsx(f,{className:"h-4 w-4"}),e.jsxs(U,{children:[e.jsx("strong",{children:"Certificado inválido:"}),e.jsx("ul",{className:"list-disc list-inside mt-1",children:x.errores.map((s,r)=>e.jsx("li",{children:s},r))})]})]}),x.advertencias.length>0&&e.jsxs(O,{children:[e.jsx(f,{className:"h-4 w-4"}),e.jsxs(U,{children:[e.jsx("strong",{children:"Advertencias:"}),e.jsx("ul",{className:"list-disc list-inside mt-1",children:x.advertencias.map((s,r)=>e.jsx("li",{children:s},r))})]})]}),e.jsxs(de,{defaultValue:"detalles",className:"space-y-4",children:[e.jsxs(me,{children:[e.jsx(h,{value:"detalles",children:"Detalles"}),e.jsx(h,{value:"uso",children:"Estadísticas de Uso"}),e.jsx(h,{value:"firmas",children:"Firmas Realizadas"}),e.jsx(h,{value:"auditoria",children:"Auditoría"})]}),e.jsx(j,{value:"detalles",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(l,{children:[e.jsx(o,{children:e.jsxs(d,{className:"flex items-center",children:[e.jsx(oe,{className:"h-5 w-5 mr-2"}),"Información del Certificado"]})}),e.jsxs(n,{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium text-gray-600",children:"Número de Serie"}),e.jsx("p",{className:"font-mono text-sm break-all",children:a.numero_serie})]}),e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium text-gray-600",children:"Algoritmo de Firma"}),e.jsxs("p",{children:[a.algoritmo_firma," (",a.longitud_clave," bits)"]})]}),e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium text-gray-600",children:"Huella Digital (SHA256)"}),e.jsx("p",{className:"font-mono text-sm break-all",children:a.huella_digital})]}),e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium text-gray-600",children:"Fecha de Emisión"}),e.jsx("p",{children:new Date(a.fecha_emision).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium text-gray-600",children:"Fecha de Vencimiento"}),e.jsx("p",{children:new Date(a.fecha_vencimiento).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium text-gray-600",children:"Usos Permitidos"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:a.uso_permitido.map(s=>e.jsx(m,{variant:"outline",className:"text-xs",children:Z(s)},s))})]})]})]}),e.jsxs(l,{children:[e.jsx(o,{children:e.jsxs(d,{className:"flex items-center",children:[e.jsx(ye,{className:"h-5 w-5 mr-2"}),"Sujeto y Emisor"]})}),e.jsxs(n,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium text-gray-600",children:"Sujeto (Subject)"}),e.jsx("p",{className:"text-sm break-all",children:a.sujeto}),Object.keys(a.info_sujeto).length>0&&e.jsx("div",{className:"mt-2 space-y-1",children:Object.entries(a.info_sujeto).map(([s,r])=>e.jsxs("div",{className:"text-xs",children:[e.jsxs("span",{className:"font-medium",children:[s,":"]})," ",r]},s))})]}),e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium text-gray-600",children:"Emisor (Issuer)"}),e.jsx("p",{className:"text-sm break-all",children:a.emisor}),Object.keys(a.info_emisor).length>0&&e.jsx("div",{className:"mt-2 space-y-1",children:Object.entries(a.info_emisor).map(([s,r])=>e.jsxs("div",{className:"text-xs",children:[e.jsxs("span",{className:"font-medium",children:[s,":"]})," ",r]},s))})]})]})]})]})}),e.jsxs(j,{value:"uso",className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(l,{children:e.jsx(n,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:t.total_firmas}),e.jsx("p",{className:"text-sm text-gray-600",children:"Firmas Totales"})]})})}),e.jsx(l,{children:e.jsx(n,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:t.firmas_validas}),e.jsx("p",{className:"text-sm text-gray-600",children:"Firmas Válidas"})]})})}),e.jsx(l,{children:e.jsx(n,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:t.dias_desde_emision}),e.jsx("p",{className:"text-sm text-gray-600",children:"Días de Uso"})]})})}),e.jsx(l,{children:e.jsx(n,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-2xl font-bold",children:[Math.round(t.porcentaje_vida_util),"%"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Vida Útil Transcurrida"})]})})})]}),(t.primera_firma||t.ultima_firma)&&e.jsxs(l,{children:[e.jsx(o,{children:e.jsx(d,{children:"Historial de Uso"})}),e.jsxs(n,{className:"space-y-3",children:[t.primera_firma&&e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium text-gray-600",children:"Primera Firma"}),e.jsx("p",{children:new Date(t.primera_firma).toLocaleString()})]}),t.ultima_firma&&e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium text-gray-600",children:"Última Firma"}),e.jsx("p",{children:new Date(t.ultima_firma).toLocaleString()})]})]})]})]}),e.jsx(j,{value:"firmas",className:"space-y-6",children:e.jsxs(l,{children:[e.jsxs(o,{children:[e.jsxs(d,{children:["Firmas Realizadas (",a.firmas.length,")"]}),e.jsx(V,{children:"Documentos firmados con este certificado"})]}),e.jsx(n,{children:a.firmas.length>0?e.jsxs(xe,{children:[e.jsx(he,{children:e.jsxs(H,{children:[e.jsx(v,{children:"Documento"}),e.jsx(v,{children:"Fecha"}),e.jsx(v,{children:"Estado"}),e.jsx(v,{children:"Acciones"})]})}),e.jsx(je,{children:a.firmas.map(s=>e.jsxs(H,{children:[e.jsx(p,{children:e.jsx("div",{className:"font-medium",children:s.documento.nombre})}),e.jsx(p,{children:new Date(s.fecha_firma).toLocaleString()}),e.jsx(p,{children:e.jsx(m,{variant:s.valida?"default":"destructive",children:s.valida?"Válida":"Inválida"})}),e.jsx(p,{children:e.jsx(S,{href:route("admin.documentos.show",s.documento.id),children:e.jsx(c,{variant:"outline",size:"sm",children:"Ver Documento"})})})]},s.id))})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(be,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No se han realizado firmas con este certificado"})]})})]})}),e.jsx(j,{value:"auditoria",className:"space-y-6",children:e.jsxs(l,{children:[e.jsxs(o,{children:[e.jsxs(d,{className:"flex items-center",children:[e.jsx(I,{className:"h-5 w-5 mr-2"}),"Historial de Auditoría"]}),e.jsx(V,{children:"Registro de todas las acciones realizadas sobre este certificado"})]}),e.jsx(n,{children:y.length>0?e.jsx("div",{className:"space-y-4",children:y.map(s=>e.jsxs("div",{className:"border-l-2 border-gray-200 pl-4 pb-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(m,{variant:"outline",className:"capitalize",children:s.accion}),e.jsxs("span",{className:"text-sm text-gray-600",children:["por ",s.usuario.name]})]}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(s.created_at).toLocaleString()})]}),Object.keys(s.detalles).length>0&&e.jsx("div",{className:"mt-2 text-sm text-gray-600",children:Object.entries(s.detalles).map(([r,ie])=>e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[r,":"]})," ",String(ie)]},r))})]},s.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(I,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No hay registros de auditoría disponibles"})]})})]})})]})]})]})}export{as as default};
